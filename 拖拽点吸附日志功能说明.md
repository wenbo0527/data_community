# 拖拽点吸附日志功能说明

## 功能概述

为拖拽点吸附功能增加了详细的结果日志记录，包含吸附前的位置、吸附后的位置、拖拽点是否删除以及挂载的节点信息。

## 新增日志类型

### 1. 吸附检测日志 (`🎯 [拖拽点吸附] 检测到吸附条件`)

**触发时机**: 当节点拖拽时检测到距离拖拽点足够近时

**包含信息**:
- `timestamp`: 时间戳
- `beforeSnapPosition`: 吸附前位置信息
  - `draggedNode`: 被拖拽节点的ID、类型、位置、中心点
  - `dragHint`: 拖拽点的ID、位置、大小、距离
- `snapThreshold`: 吸附阈值 (80px)
- `actualDistance`: 实际距离

### 2. 连接创建日志 (`🔗 [拖拽点吸附] 开始创建连接`)

**触发时机**: 开始创建连接时

**包含信息**:
- `connectionInfo`: 连接信息（源节点、目标节点、端口、分支ID、分支标签）
- `snapInfo`: 吸附详细信息

### 3. 吸附完成日志 (`✅ [拖拽点吸附] 吸附完成`)

**触发时机**: 吸附成功完成时

**包含信息**:
- `snapResult`: 吸附结果
  - `success`: 是否成功
  - `beforeSnapPosition`: 吸附前位置
  - `afterSnapPosition`: 吸附后位置
  - `dragHintInfo`: 拖拽点信息（ID、分支ID、分支标签、是否删除）
  - `mountedNode`: 挂载的节点信息
  - `sourceNode`: 源节点信息
  - `connectionCreated`: 连接创建信息
  - `snapDistance`: 吸附距离
  - `snapThreshold`: 吸附阈值

### 4. 拖拽点删除日志 (`🗑️ [拖拽点删除] 删除拖拽提示点`)

**触发时机**: 拖拽点被删除时

**包含信息**:
- `dragHint`: 被删除的拖拽点详细信息
- `previewInstance`: 关联的预览线实例信息
- `context`: 删除上下文（是否在拖拽中、当前拖拽线ID等）

### 5. 拖拽结束日志 (`🎯 [拖拽结束] 开始处理拖拽结束`)

**触发时机**: 拖拽操作结束时

**包含信息**:
- `dragLine`: 拖拽线信息
- `dragHint`: 拖拽点信息
- `dropPosition`: 放置位置
- `nearestTargetNode`: 最近的目标节点

### 6. 拖拽吸附成功日志 (`✅ [拖拽结束] 拖拽吸附成功`)

**触发时机**: 拖拽成功吸附到目标节点时

**包含信息**:
- `beforeDrop`: 放置前状态
- `afterSnap`: 吸附后状态
- `dragHintInfo`: 拖拽点信息（包含删除状态）
- `mountedNode`: 挂载的目标节点
- `sourceNode`: 源节点
- `connectionInfo`: 连接信息

## 使用方法

1. 打开浏览器开发者工具的控制台
2. 进入营销任务创建页面
3. 拖拽节点到画布上
4. 将节点拖拽到拖拽点附近进行吸附操作
5. 观察控制台中的详细日志输出

## 日志示例

```javascript
// 吸附检测
🎯 [拖拽点吸附] 检测到吸附条件 - 吸附前状态: {
  timestamp: "2024-01-15T10:30:45.123Z",
  beforeSnapPosition: {
    draggedNode: {
      id: "node_1705312245123",
      type: "condition",
      position: { x: 200, y: 150 },
      center: { x: 250, y: 175 }
    },
    dragHint: {
      id: "hint_1705312245124",
      position: { x: 300, y: 200 },
      size: { width: 20, height: 20 },
      distance: 45.5
    }
  },
  snapThreshold: 80,
  actualDistance: 45.5
}

// 吸附完成
✅ [拖拽点吸附] 吸附完成 - 完整结果: {
  timestamp: "2024-01-15T10:30:45.456Z",
  snapResult: {
    success: true,
    beforeSnapPosition: { /* 吸附前位置 */ },
    afterSnapPosition: { /* 吸附后位置 */ },
    dragHintInfo: {
      id: "hint_1705312245124",
      branchId: "yes",
      branchLabel: "是",
      willBeDeleted: true,
      parentPreviewLine: "unified_preview_node_1705312245120_yes_1705312245125"
    },
    mountedNode: {
      id: "node_1705312245123",
      type: "condition",
      name: "条件判断",
      config: { /* 节点配置 */ }
    },
    sourceNode: {
      id: "node_1705312245120",
      type: "start",
      name: "开始"
    },
    connectionCreated: {
      id: "edge_1705312245456",
      branchId: "yes",
      branchLabel: "是"
    },
    snapDistance: 45.5,
    snapThreshold: 80
  }
}
```

## 注意事项

1. 所有日志都包含时间戳，便于追踪操作时序
2. 拖拽点删除状态会在连接成功后自动设置为 `true`
3. 日志中的位置信息都是相对于画布的坐标
4. 分支信息（branchId、branchLabel）仅在分支连接时存在
5. 挂载节点信息包含节点的完整配置数据

## 调试建议

1. 使用浏览器控制台的过滤功能，搜索 `[拖拽点吸附]` 或 `[拖拽结束]` 来查看相关日志
2. 关注 `snapDistance` 和 `snapThreshold` 的值来调试吸附灵敏度
3. 检查 `dragHintInfo.willBeDeleted` 来确认拖拽点的删除状态
4. 通过 `beforeSnapPosition` 和 `afterSnapPosition` 对比来验证吸附效果