# 画布拖拽修复测试指南

## 🎯 修复内容

### 1. 解决X6 Scroller冲突
- **问题**: X6的scroller与CanvasPanZoomManager争夺拖拽控制权
- **修复**: 禁用X6 scroller的`pannable`功能，完全由CanvasPanZoomManager接管

### 2. 优化累积算法参数
- **灵敏度提升**: 默认模式从1.0提升到1.5
- **平滑因子优化**: 从0.8提升到0.95，减少过度平滑
- **阈值降低**: 累积阈值从4像素降低到1像素，提高响应性

### 3. 增强调试信息
- 添加平移前后状态对比
- 检测其他组件干扰
- 提供直接变换备用方案

## 🧪 测试步骤

### 基础拖拽测试
1. **打开画布页面**
2. **在空白区域按下鼠标左键**
3. **拖拽鼠标移动画布**
4. **观察画布是否跟随鼠标移动**

### 预期结果
- ✅ 画布应该流畅跟随鼠标移动
- ✅ 移动应该是连续的，没有卡顿
- ✅ 控制台日志显示正常的平移操作

### 调试日志检查
打开浏览器控制台，观察以下日志：

#### 正常拖拽日志
```
🖱️ [CanvasPanZoomManager] 鼠标按下事件触发
🎯 [CanvasPanZoomManager] 空白区域检查: {isBlankArea: true}
🚀 [CanvasPanZoomManager] 拖拽条件判断: {canStartDrag: true}
✅ [CanvasPanZoomManager] 开始拖拽操作
🔄 [CanvasPanZoomManager] 拖拽移动计算(累积算法)
✅ [CanvasPanZoomManager] 执行累积平移
📍 [CanvasPanZoomManager] 平移前状态: {tx: X, ty: Y}
📍 [CanvasPanZoomManager] 平移后状态: {tx: X+ΔX, ty: Y+ΔY}
```

#### 配置检查日志
```
⚙️ [TaskFlowCanvas] 画布配置信息: {
  scroller: {
    enabled: true,
    pannable: false, // 应该是false
    modifiers: ['ctrl']
  }
}
```

## 🔍 问题排查

### 如果画布仍然不能拖拽

#### 1. 检查Scroller配置
- 确认`pannable: false`
- 确认日志显示正确的配置

#### 2. 检查累积算法
- 观察是否有"执行累积平移"日志
- 检查平移前后状态是否有变化

#### 3. 检查冲突检测
- 查看是否有"平移可能被其他组件阻止或覆盖"警告
- 观察是否触发了直接变换备用方案

### 常见问题

#### 问题1: 拖拽开始但画布不移动
**现象**: 看到"开始拖拽操作"但没有"执行累积平移"
**原因**: 累积阈值未达到
**解决**: 检查鼠标移动是否足够大

#### 问题2: 有平移日志但视觉上无变化
**现象**: 看到平移前后状态变化，但画布视觉上没有移动
**原因**: 可能有其他组件干扰
**解决**: 查看是否有冲突检测警告

#### 问题3: 拖拽过于敏感或迟钝
**现象**: 画布移动过快或过慢
**解决**: 调整灵敏度参数
- 默认模式: 1.5
- 精确模式: 0.5  
- 快速模式: 2.5

## 🎮 测试用例

### 用例1: 基础拖拽
1. 在空白区域拖拽
2. 预期: 画布平滑移动

### 用例2: 边界测试
1. 拖拽到画布边界
2. 预期: 应用阻力，不会超出边界

### 用例3: 节点区域测试
1. 在节点上拖拽
2. 预期: 移动节点，不移动画布

### 用例4: 快捷键测试
1. 按数字键1/2/3切换拖拽模式
2. 预期: 不同模式有不同的移动速度

## 📊 性能指标

### 响应时间
- 鼠标按下到开始拖拽: < 50ms
- 鼠标移动到画布响应: < 16ms (60fps)

### 流畅度
- 无明显卡顿
- 移动轨迹连续
- 边界处理平滑

## 🚀 下一步优化

如果基础拖拽正常，可以考虑：
1. 添加拖拽惯性效果
2. 优化边界弹性动画
3. 添加多点触控支持
4. 实现拖拽手势识别

## 📝 测试报告模板

```
测试时间: ____
测试环境: ____
浏览器版本: ____

基础拖拽: ✅/❌
边界处理: ✅/❌
模式切换: ✅/❌
性能表现: ✅/❌

问题描述:
____

日志截图:
____
```