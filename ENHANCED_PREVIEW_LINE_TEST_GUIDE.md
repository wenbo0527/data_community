# 增强预设线系统测试指南

## 测试目标
验证增强预设线系统的核心功能是否正常工作，包括：
1. 节点配置完成后自动生成可拖拽预设线
2. 预设线的拖拽交互
3. 拖拽到节点时的自动连接
4. 拖拽到空白区域时自动创建结束节点
5. 预设线的视觉反馈和状态管理

## 测试环境
- 开发服务器：http://localhost:5174/
- 测试页面：营销任务创建页面 `/marketing/tasks/create`

## 测试步骤

### 1. 基础功能测试

#### 1.1 访问测试页面
1. 打开浏览器访问 http://localhost:5174/
2. 导航到营销任务创建页面
3. 确认画布正常加载，开始节点已存在

#### 1.2 节点配置测试
1. 点击开始节点，打开配置抽屉
2. 填写基本配置信息（如任务名称等）
3. 点击确认保存配置
4. **预期结果**：配置完成后应该自动生成可拖拽的预设线

### 2. 预设线生成测试

#### 2.1 开始节点预设线
1. 配置开始节点后，检查是否生成预设线
2. **预期结果**：
   - 从开始节点的输出端口延伸出虚线预设线
   - 预设线末端有可拖拽的控制点
   - 预设线样式为虚线，颜色为蓝色系

#### 2.2 其他节点预设线
1. 添加其他类型节点（如AI外呼、短信等）
2. 配置这些节点
3. **预期结果**：每个配置完成的节点都应生成相应的预设线

### 3. 拖拽交互测试

#### 3.1 预设线拖拽
1. 鼠标悬停在预设线的控制点上
2. **预期结果**：鼠标指针变为拖拽状态，控制点高亮
3. 按住鼠标左键开始拖拽
4. **预期结果**：
   - 预设线跟随鼠标移动
   - 显示拖拽提示信息
   - 预设线样式可能发生变化（如透明度）

#### 3.2 拖拽到节点
1. 将预设线拖拽到另一个节点上
2. **预期结果**：
   - 目标节点高亮显示
   - 显示连接提示
3. 释放鼠标
4. **预期结果**：
   - 自动创建连接边
   - 预设线消失
   - 如果是分支连接，添加相应标签

#### 3.3 拖拽到空白区域
1. 将预设线拖拽到画布空白区域
2. 释放鼠标
3. **预期结果**：
   - 在释放位置自动创建结束节点
   - 创建从源节点到结束节点的连接
   - 预设线消失

### 4. 分支节点测试

#### 4.1 分流节点预设线
1. 添加人群分流或事件分流节点
2. 配置分支条件
3. **预期结果**：
   - 根据分支数量生成多条预设线
   - 每条预设线对应一个分支
   - 预设线上可能显示分支标签

#### 4.2 分支连接测试
1. 拖拽分支预设线到目标节点
2. **预期结果**：
   - 连接创建时自动添加分支标签
   - 标签内容对应分支条件

### 5. 错误处理测试

#### 5.1 无效连接
1. 尝试将预设线连接到不兼容的节点
2. **预期结果**：
   - 显示错误提示
   - 连接被拒绝
   - 预设线恢复原状

#### 5.2 重复连接
1. 尝试在已有连接的端口上再次连接
2. **预期结果**：
   - 根据节点类型决定是否允许
   - 显示相应提示信息

### 6. 性能测试

#### 6.1 多节点场景
1. 创建包含10+节点的复杂流程
2. 观察预设线的生成和交互性能
3. **预期结果**：
   - 预设线生成流畅
   - 拖拽交互无明显延迟
   - 内存使用合理

#### 6.2 频繁操作
1. 快速连续配置多个节点
2. 频繁拖拽预设线
3. **预期结果**：
   - 系统响应稳定
   - 无内存泄漏
   - 无异常错误

## 调试信息

### 控制台日志
在测试过程中，注意观察浏览器控制台的日志输出：
- `[EnhancedPreviewLineManager]` 开头的日志
- `[useConfigDrawers]` 开头的日志
- `[TaskFlowCanvas]` 开头的日志

### 关键日志标识
- ✅ `增强预设线管理器初始化完成`
- ✅ `为节点 xxx 创建增强预设线`
- ✅ `预设线拖拽开始`
- ✅ `连接到现有节点`
- ✅ `创建结束节点`

### 常见问题排查

#### 问题1：预设线未生成
- 检查增强预设线管理器是否正确初始化
- 确认节点配置是否正确完成
- 查看控制台是否有错误信息

#### 问题2：拖拽无响应
- 检查事件监听器是否正确绑定
- 确认预设线的可拖拽状态
- 查看鼠标事件处理逻辑

#### 问题3：连接创建失败
- 检查连接验证逻辑
- 确认目标节点是否支持连接
- 查看端口配置是否正确

## 测试报告模板

### 功能测试结果
- [ ] 预设线自动生成
- [ ] 预设线拖拽交互
- [ ] 拖拽到节点连接
- [ ] 拖拽到空白区域创建结束节点
- [ ] 分支节点预设线
- [ ] 错误处理
- [ ] 性能表现

### 发现的问题
1. 问题描述
2. 复现步骤
3. 预期结果 vs 实际结果
4. 错误信息（如有）

### 改进建议
1. 功能改进
2. 用户体验优化
3. 性能优化

## 下一步计划
根据测试结果，确定需要修复的问题和进一步的功能增强。