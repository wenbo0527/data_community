# 重绘总结日志功能说明

## 功能概述

在布局方向切换的重绘机制完成时，系统会自动生成一个详细的总结日志，打印页面上存在的节点、端口、拖拽点的位置信息，帮助开发者了解重绘后的布局状态。

## 功能位置

- **文件**: `src/composables/useStructuredLayout.js`
- **函数**: `logRedrawSummary(graph, direction)`
- **调用时机**: 在 `switchLayoutDirection` 函数的重绘完成后自动调用

## 日志内容

### 1. 节点统计
```
📊 [重绘总结] 节点统计 (布局方向: LR):
  ├─ 普通节点: 3 个
  ├─ 拖拽点: 2 个
  └─ 总计: 5 个
```

### 2. 端口统计
```
🔌 [重绘总结] 端口统计:
  ├─ 输入端口: 3 个
  ├─ 输出端口: 3 个
  └─ 总计: 6 个
```

### 3. 连接线统计
```
🔗 [重绘总结] 连接线统计:
  ├─ 普通连接: 2 条
  ├─ 预览线: 2 条
  └─ 总计: 4 条
```

### 4. 详细位置信息

#### 普通节点位置详情
```
📍 [重绘总结] 普通节点位置详情:
  1. start (node_start): 中心点(150, 100), 位置(100, 75), 尺寸(100×50)
  2. audience-split (node_split): 中心点(150, 200), 位置(100, 175), 尺寸(100×50)
  3. end (node_end): 中心点(150, 300), 位置(100, 275), 尺寸(100×50)
```

#### 拖拽点位置详情
```
🎯 [重绘总结] 拖拽点位置详情:
  1. 拖拽点 (hint_node_split_branch1): 中心点(250, 180), 位置(240, 170)
  2. 拖拽点 (hint_node_split_branch2): 中心点(250, 220), 位置(240, 210)
```

#### 端口位置详情
```
🔌 [重绘总结] 输入端口位置详情:
  1. 输入端口 (in) 在节点 node_split: 绝对位置(100, 200), 相对位置(0, 25)
  2. 输入端口 (in) 在节点 node_end: 绝对位置(100, 300), 相对位置(0, 25)

🔌 [重绘总结] 输出端口位置详情:
  1. 输出端口 (out) 在节点 node_start: 绝对位置(200, 100), 相对位置(100, 25)
  2. 输出端口 (out) 在节点 node_split: 绝对位置(200, 200), 相对位置(100, 25)
```

#### 连接线位置详情
```
🔗 [重绘总结] 普通连接线位置详情:
  1. 连接线 (edge_1): node_start[out] → node_split[in], 路由器: orth
     起点(200, 100) → 终点(100, 200)
  2. 连接线 (edge_2): node_split[out] → node_end[in], 路由器: orth
     起点(200, 200) → 终点(100, 300)

🔗 [重绘总结] 预览线位置详情:
  1. 预览线 (preview_1): node_split[out] → hint_node_split_branch1[in], 路由器: orth
     起点(200, 200) → 终点(240, 180)
```

### 5. 布局质量分析
```
📈 [重绘总结] 布局质量分析:
  ├─ 对齐质量: 优秀
  ├─ 间距分布: 合理
  ├─ 整体评分: 优秀
  └─ 建议: 布局质量良好，无需调整
```

## 布局质量评估标准

### 对齐质量
- **优秀**: 节点在主轴方向上对齐良好（偏差 ≤ 50px）
- **良好**: 节点对齐基本合理（偏差 ≤ 100px）
- **需要改进**: 节点对齐存在明显问题（偏差 > 100px）

### 间距分布
- **合理**: 节点间距适中（最小间距 ≥ 50px，平均间距 ≤ 300px）
- **可接受**: 节点间距基本合理
- **需要调整**: 节点过于密集或过于分散

### 整体评分
- **优秀**: 综合评分 ≥ 80分
- **良好**: 综合评分 ≥ 60分
- **需要优化**: 综合评分 < 60分

## 使用方法

### 自动触发
当调用 `switchLayoutDirection` 函数切换布局方向时，重绘总结日志会自动生成：

```javascript
// 切换到从左到右布局
await switchLayoutDirection('LR')

// 切换到从上到下布局
await switchLayoutDirection('TB')
```

### 手动调用
也可以手动调用总结日志函数：

```javascript
import { useStructuredLayout } from '@/composables/useStructuredLayout'

const { logRedrawSummary } = useStructuredLayout()

// 手动生成总结日志
await logRedrawSummary(graph, 'LR')
```

## 技术实现

### 数据收集
1. **节点信息**: 遍历所有节点，收集位置、尺寸、类型等信息
2. **端口信息**: 遍历每个节点的端口，收集相对位置和绝对位置
3. **连接线信息**: 遍历所有边，区分普通连接和预览线
4. **坐标计算**: 计算节点中心点、端口绝对位置等

### 质量分析
1. **对齐检查**: 根据布局方向检查节点在主轴上的对齐情况
2. **间距分析**: 计算节点间距离，评估分布合理性
3. **综合评分**: 结合对齐和间距得出整体质量评分

### 日志格式
- 使用树形结构显示统计信息
- 使用表情符号增强可读性
- 提供详细的位置坐标信息
- 包含质量分析和改进建议

## 应用场景

1. **开发调试**: 帮助开发者了解布局切换后的实际效果
2. **性能监控**: 监控重绘操作的完成情况
3. **质量评估**: 自动评估布局质量，提供优化建议
4. **问题排查**: 当布局出现问题时，提供详细的位置信息用于排查

## 注意事项

1. 总结日志会在控制台输出，建议在开发环境使用
2. 对于大型画布（节点数量 > 50），日志可能较长
3. 坐标信息已四舍五入到整数，便于阅读
4. 质量分析基于经验值，可根据实际需求调整评估标准

## 更新日志

- **2024-01-XX**: 初始版本，支持基本的节点、端口、连接线位置统计
- **2024-01-XX**: 添加布局质量分析功能
- **2024-01-XX**: 优化日志格式，增强可读性