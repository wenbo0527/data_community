<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸ƒå±€å¼•æ“ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            margin: 10px 0;
            padding: 8px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ”§ å¸ƒå±€å¼•æ“ä¿®å¤æµ‹è¯•</h1>
        <div id="test-results"></div>
        <h2>æ§åˆ¶å°æ—¥å¿—</h2>
        <pre id="console-logs"></pre>
    </div>

    <script>
        // æ•è·æ§åˆ¶å°æ—¥å¿—
        const originalLog = console.log;
        const logs = [];
        console.log = function(...args) {
            logs.push(args.join(' '));
            originalLog.apply(console, args);
            document.getElementById('console-logs').textContent = logs.join('\n');
        };

        function addTestResult(message, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.textContent = message;
            resultsDiv.appendChild(resultDiv);
        }

        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œæµ‹è¯•
        window.addEventListener('load', function() {
            setTimeout(runTests, 1000); // å»¶è¿Ÿ1ç§’ç¡®ä¿æ‰€æœ‰è„šæœ¬åŠ è½½å®Œæˆ
        });

        function runTests() {
            console.log('ğŸ”§ [æµ‹è¯•] å¼€å§‹éªŒè¯å¸ƒå±€å¼•æ“ä¿®å¤æ•ˆæœ...');
            addTestResult('å¼€å§‹éªŒè¯å¸ƒå±€å¼•æ“ä¿®å¤æ•ˆæœ...', 'info');

            // 1. æ£€æŸ¥å…¨å±€å˜é‡è®¾ç½®
            console.log('\nğŸ“‹ [æµ‹è¯•] æ£€æŸ¥å…¨å±€å˜é‡è®¾ç½®:');
            
            const hasUnifiedStructuredLayoutEngine = typeof window.UnifiedStructuredLayoutEngine !== 'undefined';
            const hasUnifiedStructuredLayoutEngineInstance = typeof window.unifiedStructuredLayoutEngine !== 'undefined';
            const hasLayoutEngine = typeof window.layoutEngine !== 'undefined';
            
            console.log('- window.UnifiedStructuredLayoutEngine:', typeof window.UnifiedStructuredLayoutEngine);
            console.log('- window.unifiedStructuredLayoutEngine:', typeof window.unifiedStructuredLayoutEngine);
            console.log('- window.layoutEngine:', typeof window.layoutEngine);

            if (hasUnifiedStructuredLayoutEngine) {
                addTestResult('âœ… window.UnifiedStructuredLayoutEngine å¯ç”¨', 'success');
            } else {
                addTestResult('âŒ window.UnifiedStructuredLayoutEngine ä¸å¯ç”¨', 'error');
            }

            if (hasUnifiedStructuredLayoutEngineInstance) {
                addTestResult('âœ… window.unifiedStructuredLayoutEngine å¯ç”¨', 'success');
            } else {
                addTestResult('âŒ window.unifiedStructuredLayoutEngine ä¸å¯ç”¨', 'error');
            }

            if (hasLayoutEngine) {
                addTestResult('âœ… window.layoutEngine å¯ç”¨', 'success');
            } else {
                addTestResult('âŒ window.layoutEngine ä¸å¯ç”¨', 'error');
            }

            // 2. æ£€æŸ¥å¸ƒå±€å¼•æ“æ„é€ å‡½æ•°æ˜¯å¦å¯ç”¨
            if (typeof window.UnifiedStructuredLayoutEngine === 'function') {
                console.log('âœ… [æµ‹è¯•] UnifiedStructuredLayoutEngineæ„é€ å‡½æ•°å¯ç”¨');
                addTestResult('âœ… UnifiedStructuredLayoutEngineæ„é€ å‡½æ•°å¯ç”¨', 'success');
                
                // å°è¯•åˆ›å»ºå®ä¾‹ï¼ˆéœ€è¦graphå‚æ•°ï¼Œè¿™é‡Œåªæ˜¯æµ‹è¯•æ„é€ å‡½æ•°ï¼‰
                try {
                    const testInstance = new window.UnifiedStructuredLayoutEngine(null);
                    console.log('âœ… [æµ‹è¯•] å¯ä»¥åˆ›å»ºUnifiedStructuredLayoutEngineå®ä¾‹');
                    addTestResult('âœ… å¯ä»¥åˆ›å»ºUnifiedStructuredLayoutEngineå®ä¾‹', 'success');
                } catch (error) {
                    console.log('âš ï¸ [æµ‹è¯•] åˆ›å»ºå®ä¾‹éœ€è¦æœ‰æ•ˆçš„graphå‚æ•°:', error.message);
                    addTestResult('âš ï¸ åˆ›å»ºå®ä¾‹éœ€è¦æœ‰æ•ˆçš„graphå‚æ•°: ' + error.message, 'warning');
                }
            } else {
                console.log('âŒ [æµ‹è¯•] UnifiedStructuredLayoutEngineæ„é€ å‡½æ•°ä¸å¯ç”¨');
                addTestResult('âŒ UnifiedStructuredLayoutEngineæ„é€ å‡½æ•°ä¸å¯ç”¨', 'error');
            }

            // 3. æ£€æŸ¥é¢„è§ˆçº¿ç®¡ç†å™¨
            if (typeof window.unifiedPreviewLineManager !== 'undefined') {
                console.log('âœ… [æµ‹è¯•] é¢„è§ˆçº¿ç®¡ç†å™¨å­˜åœ¨');
                addTestResult('âœ… é¢„è§ˆçº¿ç®¡ç†å™¨å­˜åœ¨', 'success');
                
                const manager = window.unifiedPreviewLineManager;
                console.log('- layoutEngineReady:', manager.layoutEngineReady);
                console.log('- layoutEngineå­˜åœ¨:', !!manager.layoutEngine);
                
                // æ£€æŸ¥å…³é”®æ–¹æ³•
                const methods = [
                    'initializeLayoutEngineIfNeeded',
                    'createBranchPreviewLines',
                    'checkBranchHasRealConnection',
                    'setLayoutEngine'
                ];
                
                methods.forEach(method => {
                    const methodExists = typeof manager[method] === 'function';
                    console.log(`- ${method}æ–¹æ³•:`, typeof manager[method]);
                    if (methodExists) {
                        addTestResult(`âœ… ${method}æ–¹æ³•å¯ç”¨`, 'success');
                    } else {
                        addTestResult(`âŒ ${method}æ–¹æ³•ä¸å¯ç”¨`, 'error');
                    }
                });
            } else {
                console.log('âŒ [æµ‹è¯•] é¢„è§ˆçº¿ç®¡ç†å™¨ä¸å­˜åœ¨');
                addTestResult('âŒ é¢„è§ˆçº¿ç®¡ç†å™¨ä¸å­˜åœ¨', 'error');
            }

            // 4. æ¨¡æ‹Ÿå¸ƒå±€å¼•æ“åˆå§‹åŒ–æµ‹è¯•
            console.log('\nğŸ”„ [æµ‹è¯•] æ¨¡æ‹Ÿå¸ƒå±€å¼•æ“åˆå§‹åŒ–...');

            if (window.unifiedPreviewLineManager && typeof window.unifiedPreviewLineManager.initializeLayoutEngineIfNeeded === 'function') {
                try {
                    window.unifiedPreviewLineManager.initializeLayoutEngineIfNeeded();
                    console.log('âœ… [æµ‹è¯•] å¸ƒå±€å¼•æ“åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨æˆåŠŸ');
                    addTestResult('âœ… å¸ƒå±€å¼•æ“åˆå§‹åŒ–æ–¹æ³•è°ƒç”¨æˆåŠŸ', 'success');
                } catch (error) {
                    console.log('âŒ [æµ‹è¯•] å¸ƒå±€å¼•æ“åˆå§‹åŒ–å¤±è´¥:', error.message);
                    addTestResult('âŒ å¸ƒå±€å¼•æ“åˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
                }
            }

            // 5. æ£€æŸ¥å‘½åä¸€è‡´æ€§ä¿®å¤
            console.log('\nğŸ” [æµ‹è¯•] éªŒè¯å‘½åä¸€è‡´æ€§ä¿®å¤:');
            const hasUpperCase = typeof window.UnifiedStructuredLayoutEngine !== 'undefined';
            const hasLowerCase = typeof window.unifiedStructuredLayoutEngine !== 'undefined';

            if (hasUpperCase && hasLowerCase) {
                console.log('âœ… [æµ‹è¯•] ä¸¤ç§å‘½åæ–¹å¼éƒ½å¯ç”¨ï¼Œå…¼å®¹æ€§è‰¯å¥½');
                addTestResult('âœ… ä¸¤ç§å‘½åæ–¹å¼éƒ½å¯ç”¨ï¼Œå…¼å®¹æ€§è‰¯å¥½', 'success');
            } else if (hasUpperCase) {
                console.log('âš ï¸ [æµ‹è¯•] åªæœ‰å¤§å†™å‘½åå¯ç”¨');
                addTestResult('âš ï¸ åªæœ‰å¤§å†™å‘½åå¯ç”¨', 'warning');
            } else if (hasLowerCase) {
                console.log('âš ï¸ [æµ‹è¯•] åªæœ‰å°å†™å‘½åå¯ç”¨');
                addTestResult('âš ï¸ åªæœ‰å°å†™å‘½åå¯ç”¨', 'warning');
            } else {
                console.log('âŒ [æµ‹è¯•] ä¸¤ç§å‘½åéƒ½ä¸å¯ç”¨');
                addTestResult('âŒ ä¸¤ç§å‘½åéƒ½ä¸å¯ç”¨', 'error');
            }

            console.log('\nğŸ [æµ‹è¯•] å¸ƒå±€å¼•æ“ä¿®å¤æ•ˆæœéªŒè¯å®Œæˆ');
            addTestResult('ğŸ å¸ƒå±€å¼•æ“ä¿®å¤æ•ˆæœéªŒè¯å®Œæˆ', 'info');
        }
    </script>
</body>
</html>