# 2.5D 首页轻交互实施方案（桌面端）

## 范围与目标
- 在现有项目（Vue3 + Vite + Arco Design）中实现 2.5D 分层视图与轻交互窗口（Popover/Dock），并支持“同步层级的数据流动”效果。
- 复用与对齐：[2.5D 素材规范](../design/2.5d-asset-spec.md) 与其中的“即梦拆分提示词”，以纯 SVG + CSS 为基础，不依赖 AntV X6。

## 时间线与里程碑（建议 3–4 周）
- 第 1 周：视觉资产准备与规范对齐（色板抽取、平台/节点/桥梁/路径/窗口皮肤）。
- 第 2 周：组件骨架搭建与坐标映射（Canvas2_5D、LayerPlatform、NodeCard、FlowOverlay、FocusMask、InfoDock）。
- 第 3 周：交互联动与动效实现（悬停/选中、路径流动、窗口避障、遮罩开窗）。
- 第 4 周：可访问性与性能优化、验收测试与上线准备。

## 角色分工
- 设计：素材交付（SVG/PNG）、色板与主题、动效参考帧；参与验收和视觉走查。
- 前端：组件实现、状态编排与动画、性能优化与可访问性、验收与上线。
- 产品/研发：数据字段与文案确认、指标定义与状态映射、路径/序列定义与联调。
- QA：交互流程回归、性能指标与日志检查、可访问性与降级策略验证。

## 技术与目录结构
- 技术选型：
  - Vue 3（Composition API）、Vite、Arco Popover/Drawer、Teleport、ResizeObserver。
  - SVG（`viewBox`、`<defs>`：`linearGradient`/`filter`/`marker`）、CSS 变量与 `transform/opacity` 动画。
- 目录建议：
  - `src/components/architecture/`：`Canvas2_5D.vue`、`LayerPlatform.vue`、`NodeCard.vue`、`FlowOverlay.vue`、`FocusMask.vue`、`InfoDock.vue`
  - `src/data/architecture/`：`layers.ts`、`nodes.ts`、`edges.ts`、`sequences.ts`、`palette.json`
  - `assets/2_5d/`：按规范组织素材文件（layers/nodes/bridges/paths/ui/bg/brand）

## 资产准备流程（“即梦”提示词）
- 按规范文档的“色板抽取/平台/节点/桥梁/路径/窗口/背景”提示词生成分层 SVG 素材与 PNG 噪点（可选）。
- 输出要求：所有 SVG 含 `viewBox` 与分面分组（g-top/g-side/g-shadow）；`<defs>` 内集中渐变/滤镜/箭头；light/dark 双主题。
- 自检：使用文档中的“验收自检提示词”逐项检查结构与主题对齐。

## 数据模型与示例
- 层（Layer）：`{ id, index, title, parallax }`
- 节点（Node）：`{ id, name, layerIndex, xPct, yPct, zWeight?, brief, details }`
- 边（Edge）：`{ id, source, target, kind? }`
- 序列（Sequence）：`{ id, name, nodeIds }`
- UI 状态：`{ hoveredNodeId, activeNodeId, activeSequenceId }`

## 组件职责与接口
- `Canvas2_5D.vue`
  - 职责：容器、尺寸管理、视差与倾斜、百分比坐标→像素映射。
  - 事件：`node-hover`, `node-click`, `sequence-play`。
- `LayerPlatform.vue`
  - 职责：单层平台三面绘制（SVG），承载节点插槽。
  - 参数：`layer`, `parallax`, `bounds`。
- `NodeCard.vue`
  - 职责：2.5D 卡片（顶面/侧面/阴影）、hover/click、Popover/Dock 触发。
  - 参数：`node`, `positionPx`, `active`, `hovered`。
- `FlowOverlay.vue`
  - 职责：路径与箭头绘制、主路径高亮与流动动画。
  - 参数：`edges`, `nodesPx`, `activeNodeId`, `activeSequenceId`。
- `FocusMask.vue`
  - 职责：全局暗化遮罩，针对活动节点开窗。
  - 参数：`activeRect`, `visible`。
- `InfoDock.vue`
  - 职责：锚定在节点外缘的小窗详情，避障与翻转。
  - 参数：`node`, `anchorRect`, `visible`。

## 交互流程与状态编排
- 悬停（mousemove/hover）：节点轻放大（`scale(1.02)`）、顶面增亮、侧面加深；显示 Popover。
- 选中（click）：激活遮罩开窗与 Dock；所在层与相邻层轻亮；主路径高亮并启动流动（1–1.2s）。
- 退出：点击空白或 ESC 关闭 Dock 与遮罩，回焦到触发节点。
- 键盘：节点 `role="button"`、`tabindex="0"`；Enter 打开、ESC 关闭；`aria-expanded` 同步。

## 动效规范
- 悬停入场：`120ms`，曲线 `cubic-bezier(0.2,0,0,1)`。
- 选中入场：`220–280ms`，曲线 `cubic-bezier(0.25,0.1,0.25,1)`。
- 流动路径：`stroke-dasharray/dashoffset` 或渐变滑动；主路径加粗并带轻微投影。
- 低频微动：活动态 2–3% 呼吸；`prefers-reduced-motion` 下禁用动画保留高亮。

## 性能与监控
- 优先使用 `transform/opacity`；避免频繁改动 `top/left/width/height`。
- 事件去抖（80–120ms）、`requestAnimationFrame` 驱动高频更新；预创建路径与箭头定义，仅切换类与属性。
- 并发动画限制：可见流动边 ≤ 12；超出时降权或批次播放。
- 监控：检查控制台无警告，绘制与交互稳定 60fps。

## 验收标准
- 悬停响应 < 50ms；并发路径动画稳定；窗口避障与翻转正确。
- 2.5D 光影一致、层级与视差逻辑清晰；WCAG 对比度满足 ≥ 4.5:1。
- 可访问性通过键盘操作与回焦；`prefers-reduced-motion` 降级正常。

## 风险与对策
- 资产不一致：建立素材自检清单与走查会议；严格使用文档命名与分组规范。
- 性能抖动：限制并发动画数量，避免几何属性的频繁更新；必要时关闭次路径动画。
- 层级遮挡：窗口统一 Teleport 到 `body`；遮罩与窗口 `z-index` 使用 CSS 变量集中管理。

## 联调与上线
- 与产品确认节点文案、指标与状态映射；序列路径与播放节奏定稿。
- 集成到首页容器（保留现有 `.architecture-container` 结构），按需替换或叠加原图层。
- 预发布环境走查：视觉还原、交互与性能标尺通过后上线。

## 回归测试清单
- 悬停/点击/键盘/退出流程正确；窗口避障与翻转；遮罩开窗与回焦。
- 动效：路径流动节奏自然、主次对比明显；降级策略有效。
- 控制台与日志：无报错与警告；指标记录（可选埋点）。

