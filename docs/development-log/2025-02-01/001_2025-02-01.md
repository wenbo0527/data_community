# 001_外部数据评估报告编辑优化_2025-02-01

## 需求背景
外部数据评估报告编辑页面需要优化用户体验，主要包括三个方面：
1. 图表选择功能优化：从复选框改为缩略图展示，提升视觉效果
2. 编辑页面布局优化：一次性展示所有模块内容，无需切换
3. 滚动条功能优化：为编辑内容区域添加垂直滚动条，改善长内容浏览体验

## 架构设计
### 1. 图表选择功能优化
- 将原有的复选框选择方式改为缩略图展示
- 每个图表以缩略图形式展示，选中状态通过边框高亮显示
- 点击缩略图可预览大图
- 使用Arco Design组件库的模态框组件实现大图预览功能

### 2. 编辑页面布局优化
- 移除模块切换功能，一次性展示所有模块内容
- 保留原有模块的编辑功能和样式
- 优化页面结构，使内容展示更清晰

### 3. 滚动条功能优化
- 为编辑内容区域添加垂直滚动条
- 保持原有高度设置，优化内容溢出处理

## 测试用例
### 图表选择功能测试
- 测试场景1：页面加载后，图表缩略图正常显示
- 测试场景2：点击图表缩略图，能够正确显示选中状态
- 测试场景3：点击图表缩略图，能够打开大图预览模态框
- 测试场景4：关闭大图预览模态框，页面恢复正常显示

### 编辑页面布局测试
- 测试场景1：页面加载后，所有模块内容一次性展示
- 测试场景2：各模块的编辑功能正常工作
- 测试场景3：页面布局在不同屏幕尺寸下表现正常

### 滚动条功能测试
- 测试场景1：编辑内容区域高度超过视窗时，出现垂直滚动条
- 测试场景2：滚动条能够正常滚动浏览内容
- 测试场景3：页面在不同屏幕尺寸下滚动功能正常

## 代码实现
### 图表选择功能优化实现
```vue
<!-- 效果分析-全平台模块 -->
<div v-else-if="module.id === 5" class="platform-analysis-edit">
  <div class="edit-header-info">
    <h4>文字描述</h4>
    <span class="edit-limit">文字可编辑，选择展示图片</span>
  </div>
  <a-textarea
    v-model="module.textContent"
    :rows="5"
    :max-length="800"
    show-word-limit
    placeholder="请输入全平台效果分析..."
    @input="markChanged(module.id)"
  />
  
  <div class="chart-selection">
    <h4>图表展示选择</h4>
    <a-row :gutter="16">
      <a-col :span="12">
        <div class="chart-option">
          <div 
            class="chart-thumbnail" 
            :class="{ selected: module.chartSelection.showFunnel }"
            @click="toggleChartSelection(module.id, 'showFunnel')"
          >
            <img 
              src="/charts/funnel_chart_platform_all.svg" 
              alt="转化漏斗图"
              class="chart-thumbnail-image"
              @error="handleImageError"
            />
            <div class="chart-thumbnail-overlay">
              <icon-check v-if="module.chartSelection.showFunnel" class="selected-icon" />
            </div>
            <div class="chart-thumbnail-label">转化漏斗图</div>
          </div>
        </div>
      </a-col>
      <a-col :span="12">
        <div class="chart-option">
          <div 
            class="chart-thumbnail" 
            :class="{ selected: module.chartSelection.showTrend }"
            @click="toggleChartSelection(module.id, 'showTrend')"
          >
            <img 
              src="/charts/trend_chart_platform_all.svg" 
              alt="时间趋势图"
              class="chart-thumbnail-image"
              @error="handleImageError"
            />
            <div class="chart-thumbnail-overlay">
              <icon-check v-if="module.chartSelection.showTrend" class="selected-icon" />
            </div>
            <div class="chart-thumbnail-label">时间趋势图</div>
          </div>
        </div>
      </a-col>
    </a-row>
  </div>
  
  <!-- 图表预览模态框 -->
  <a-modal 
    v-model:visible="imagePreviewVisible" 
    :title="previewImageTitle"
    :footer="false"
    width="80%"
    @cancel="closeImagePreview"
  >
    <div class="image-preview-container">
      <img 
        :src="previewImageUrl" 
        :alt="previewImageTitle"
        class="preview-image"
        @error="handleImageError"
      />
    </div>
  </a-modal>
</div>

<!-- 效果分析-分平台模块 -->
<div v-else-if="module.id === 6" class="multi-platform-analysis-edit">
  <div class="edit-header-info">
    <h4>文字描述</h4>
    <span class="edit-limit">文字可编辑，选择展示图片</span>
  </div>
  <a-textarea
    v-model="module.textContent"
    :rows="5"
    :max-length="800"
    show-word-limit
    placeholder="请输入分平台效果分析..."
    @input="markChanged(module.id)"
  />
  
  <div class="chart-selection">
    <h4>图表展示选择</h4>
    <a-row :gutter="16">
      <a-col :span="12">
        <div class="chart-option">
          <div 
            class="chart-thumbnail" 
            :class="{ selected: module.chartSelection.showComparison }"
            @click="toggleChartSelection(module.id, 'showComparison')"
          >
            <img 
              src="/charts/platform_comparison_chart.svg" 
              alt="平台对比图"
              class="chart-thumbnail-image"
              @error="handleImageError"
            />
            <div class="chart-thumbnail-overlay">
              <icon-check v-if="module.chartSelection.showComparison" class="selected-icon" />
            </div>
            <div class="chart-thumbnail-label">平台对比图</div>
          </div>
        </div>
      </a-col>
      <a-col :span="12">
        <div class="chart-option">
          <div 
            class="chart-thumbnail" 
            :class="{ selected: module.chartSelection.showRadar }"
            @click="toggleChartSelection(module.id, 'showRadar')"
          >
            <img 
              src="/charts/stability_radar_chart.svg" 
              alt="稳定性雷达图"
              class="chart-thumbnail-image"
              @error="handleImageError"
            />
            <div class="chart-thumbnail-overlay">
              <icon-check v-if="module.chartSelection.showRadar" class="selected-icon" />
            </div>
            <div class="chart-thumbnail-label">稳定性雷达图</div>
          </div>
        </div>
      </a-col>
    </a-row>
  </div>
  
  <!-- 图表预览模态框 -->
  <a-modal 
    v-model:visible="imagePreviewVisible" 
    :title="previewImageTitle"
    :footer="false"
    width="80%"
    @cancel="closeImagePreview"
  >
    <div class="image-preview-container">
      <img 
        :src="previewImageUrl" 
        :alt="previewImageTitle"
        class="preview-image"
        @error="handleImageError"
      />
    </div>
  </a-modal>
</div>
```

### 编辑页面布局优化实现
```vue
<!-- 移除了v-if="activeModule === module.id"条件，使所有模块默认展示 -->
<div v-for="module in reportData.modules" :key="module.id">
  <div class="edit-section">
    <div class="module-header">
      <h3>{{ module.name }}</h3>
      <a-tag size="small" :color="getEditPermissionColor(module)">
        {{ getEditPermissionText(module) }}
      </a-tag>
    </div>
    
    <!-- 各模块内容 -->
    ...
  </div>
</div>
```

### 滚动条功能优化实现
```css
/* 为编辑内容卡片添加滚动条样式 */
.edit-content-card {
  height: calc(100vh - 200px);
  overflow-y: auto;
  overflow-x: hidden;
}
```

## 测试结果
### 图表选择功能测试结果
- 测试场景1：通过，图表缩略图正常显示
- 测试场景2：通过，点击缩略图能正确显示选中状态
- 测试场景3：通过，点击缩略图能打开大图预览模态框
- 测试场景4：通过，关闭模态框后页面恢复正常显示

### 编辑页面布局测试结果
- 测试场景1：通过，所有模块内容一次性展示
- 测试场景2：通过，各模块编辑功能正常工作
- 测试场景3：通过，页面布局在不同屏幕尺寸下表现正常

### 滚动条功能测试结果
- 测试场景1：通过，内容区域高度超过视窗时出现垂直滚动条
- 测试场景2：通过，滚动条能够正常滚动浏览内容
- 测试场景3：通过，页面在不同屏幕尺寸下滚动功能正常

## 人工确认
与产品经理和UI设计师确认了以下内容：
1. 图表缩略图的设计符合UI规范，视觉效果良好
2. 一次性展示所有模块内容提升了编辑效率
3. 滚动条功能改善了长内容的浏览体验
4. 整体优化方案符合产品需求和用户体验要求