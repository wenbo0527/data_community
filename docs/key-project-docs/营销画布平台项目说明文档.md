# 营销画布平台项目说明文档

## 1. 产品定位与价值主张
让营销人员像搭积木一样设计复杂营销流程的可视化营销任务中心。

### 1.1 产品愿景
通过直观的流程画布，让营销人员无需技术背景就能设计、管理和优化复杂的营销活动，将"技术实现"变成"业务设计"。

### 1.2 核心价值主张
核心价值量化表：
| 维度     | 现状痛点                 | 平台解法           |
| ------ | -------------------- | -------------- |
| **设计** | 技术门槛高，需要开发介入，平均设计周期2周 | 拖拽式流程设计，业务人员自助完成 |
| **管理** | 营销活动分散管理，缺乏统一视图 | 一站式任务管理，实时监控执行状态 |
| **优化** | 效果分析滞后，难以快速调整策略 | 实时数据反馈，支持动态优化 |
| **协作** | 跨部门协作效率低，沟通成本高 | 可视化流程共享，团队协作透明化 |

### 1.3 目标用户画像
核心用户画像：
| 角色              | 高频场景        | 关键诉求            | 
| --------------- | ----------- | --------------- | 
| 营销运营专员    | 活动策划、用户分群、营销自动化配置 | 快速设计营销流程，无需技术介入，实时监控效果 |
| 产品经理        | 用户增长策略、产品推广活动设计 | 灵活配置营销策略，A/B测试快速迭代 |
| 数据分析师      | 营销效果分析、用户行为洞察 | 直观展示数据流向，支持复杂分析场景 |
| 技术运营        | 营销系统配置、数据接口管理 | 标准化流程模板，减少重复开发工作 |

### 1.4 业务目标与成功指标
【KPI指标：月活跃营销人员>200人、营销活动设计时间<30分钟、营销活动成功率>80%、用户满意度>90%、技术介入需求减少70%】

## 2. 用户研究与场景分析

### 2.1 用户痛点与场景故事

| 场景故事          | 当前痛点                    | 平台解法                        | 期望用户反馈                  | 
| ------------- | ----------------------- | --------------------------- | ---------------------- | 
| **新用户欢迎流程设计** | 需要开发写代码，调整一次要1周 | 拖拽式配置欢迎流程，实时预览效果 | 设计时间从天级缩短至分钟级 |
| **节日营销活动**   | 活动分散管理，效果监控不及时        | 统一活动管理面板，实时数据监控 | 活动响应速度提升，ROI提高30% |
| **用户分层运营**   | 用户标签复杂，策略配置门槛高        | 可视化标签配置，策略模板复用 | 用户分群效率提升，精准度提高 |
| **A/B测试优化**   | 测试周期长，调整不灵活        | 实时数据反馈，支持动态调整策略 | 测试周期缩短50%，优化效率提升 |
| **跨部门协作**   | 沟通成本高，需求理解偏差        | 可视化流程共享，需求透明传达 | 协作效率提升，需求理解一致 |
| **新员工培训**   | 营销系统复杂，上手慢        | 模板化流程，一键复用最佳实践 | 新员工培训时间从1周缩短到1天 |

### 2.2 用户旅程地图
【需求产生→流程设计→节点配置→效果预览→发布上线→监控优化→效果复盘→流程复用】

## 3. 产品功能架构

### 3.1 整体功能架构图
【统一入口层：任务列表+模板市场+个性化推荐
业务功能层：流程设计器+节点配置+任务管理+效果监控
技术支撑层：节点引擎+数据连接+执行调度+权限控制】

### 3.2 功能列表和介绍

### 3.2.1 任务管理 (Task Management)

**对应场景**：营销主管统一查看所有营销活动

任务管理模块帮助营销团队统一管理所有营销活动，解决"活动分散、状态不清"的核心问题。

**核心功能**：
- 营销活动总览：一眼看清当前有多少活动在进行，各处于什么状态
- 任务状态监控：实时展示每个营销活动的执行进度和效果数据
- 模板快速复用：将成功的营销活动保存为模板，一键复用
- 权限分级管理：不同角色看到不同的活动权限，确保数据安全

**用户价值**：
从"活动分散管理"到"一站式统一管控"，让营销活动变成可管理、可复用的业务资产

**核心代码路径**：
```
src/pages/marketing/tasks/
├── index.vue                    # 任务列表主页面
├── create.vue                   # 任务创建页面
└── components/
    ├── TaskFlowCanvas.vue      # 主画布组件
    ├── FlowNode.vue           # 流程节点组件
    └── NodeConfigDrawer.vue   # 节点配置抽屉
```

### 3.2.2 流程设计器 (Flow Designer)

**对应场景**：营销运营专员设计新用户欢迎流程

流程设计器解决"技术门槛高"的核心痛点，让业务人员像画画一样设计营销流程。

**核心功能**：
- 拖拽式流程设计：像搭积木一样连接各种营销节点
- 节点类型丰富：支持开始、判断、延迟、消息、结束等多种节点
- 实时效果预览：设计过程中实时预览流程执行效果
- 智能布局优化：自动调整节点位置，让流程图清晰美观

**用户价值**：
从"需要开发写代码"到"业务人员30分钟自助完成"，让营销流程设计变成创意工作

**核心代码路径**：
```
src/pages/marketing/tasks/components/
├── TaskFlowCanvas.vue      # 主画布组件
├── NodeTypeSelector.vue   # 节点类型选择器
├── FlowNode.vue           # 流程节点组件
└── CanvasManualControls.vue # 画布手动控制
```

### 3.2.3 节点配置 (Node Configuration)

**对应场景**：配置用户标签判断条件、消息内容等

节点配置模块让每个营销节点都能精准配置，解决"配置复杂"的问题。

**核心功能**：
- 表单化配置：每个节点都有对应的配置表单，填写即可使用
- 变量支持：支持使用用户属性、行为数据等动态变量
- 条件表达式：可视化配置复杂的判断条件
- 模板库：内置常用配置模板，一键应用

**用户价值**：
从"技术参数配置"到"业务语言填写"，让每个人都能配置专业的营销流程

**核心代码路径**：
```
src/pages/marketing/tasks/components/
├── NodeConfigDrawer.vue   # 节点配置抽屉
└── src/composables/
    ├── useConfigDrawers.js      # 配置抽屉逻辑
    ├── useStartNodeForm.js      # 开始节点表单逻辑
    └── useStructuredLayout.js   # 结构化布局逻辑
```

### 3.2.4 效果监控 (Performance Monitor)

**对应场景**：实时查看营销活动效果，及时调整策略

效果监控模块让营销活动的效果一目了然，解决"效果不透明"的问题。

**核心功能**：
- 实时数据面板：展示当前活动的执行数据，如触达人数、转化率等
- 节点级监控：每个节点的执行数据都能单独查看
- 异常预警：流程异常时及时通知相关人员
- 对比分析：支持不同活动的效果对比

**用户价值**：
从"事后分析"到"实时监控"，让营销活动变成可优化的增长引擎

**核心代码路径**：
```
src/utils/
├── CanvasPanZoomManager.js      # 画布平移缩放管理器
├── SmartCacheManager.js         # 智能缓存管理器
└── performanceUtils.js          # 性能工具
```

### 3.2.5 模板市场 (Template Market)

**对应场景**：新员工快速上手，复用最佳实践

模板市场模块让成功的营销经验可以复用，解决"重复造轮子"的问题。

**核心功能**：
- 场景模板库：按行业、目的分类的营销流程模板
- 一键复用：选择模板后一键生成新的营销活动
- 模板评价：用户对模板的使用效果进行评价
- 自定义模板：用户可以将自己的流程保存为模板

**用户价值**：
从"每次从零开始"到"站在巨人肩膀上"，让营销经验变成可复用的组织资产

## 4. 技术架构

### 4.1 前端技术栈
- Vue 3 (Composition API)
- TypeScript
- AntV X6 (图形引擎)
- Arco Design (UI组件库)
- Vuex (状态管理)
- Vue Router (路由管理)

### 4.2 项目结构
```
src/
├── pages/
│   └── marketing/
│       └── tasks/            # 营销任务模块
│           ├── index.vue     # 任务列表页面
│           ├── create.vue    # 任务创建页面
│           └── components/   # 画布组件
│               ├── TaskFlowCanvas.vue      # 主画布组件
│               ├── CanvasManualControls.vue # 画布手动控制
│               ├── FlowNode.vue           # 流程节点组件
│               ├── NodeConfigDrawer.vue   # 节点配置抽屉
│               ├── NodeTypeSelector.vue   # 节点类型选择器
│               └── PresetSlot.vue        # 预设插槽组件
├── composables/          # 组合式函数
│   ├── useBaseDrawer.js         # 基础抽屉逻辑
│   ├── useConfigDrawers.js      # 配置抽屉逻辑
│   ├── useStartNodeForm.js      # 开始节点表单逻辑
│   ├── useStructuredLayout.js   # 结构化布局逻辑
│   └── useX6Events.js          # X6 事件处理逻辑
├── config/               # 配置文件
│   ├── SnapConfig.js            # 吸附配置
│   ├── canvasAutomationConfig.js # 画布自动化配置
│   └── menuConfig.js            # 菜单配置
├── store/                # 状态管理
│   ├── index.js                 # Store 主文件
│   └── modules/                 # Store 模块
├── styles/               # 样式文件
│   ├── enhanced-canvas-styles.css    # 增强画布样式
│   ├── enhanced-node-styles.css      # 增强节点样式
│   └── enhanced-toolbar-styles.css   # 增强工具栏样式
├── types/                # TypeScript 类型定义
│   ├── canvas.d.ts                  # 画布类型
│   ├── connectionPreview.js/ts      # 连接预览类型
│   ├── nodeDrawerConfig.js/ts       # 节点抽屉配置类型
│   ├── startNodeConfig.js/ts        # 开始节点配置类型
│   ├── steps.js/ts                  # 步骤类型
│   └── taskflow.js                  # 任务流类型
└── utils/                # 工具函数
    ├── CanvasPanZoomManager.js      # 画布平移缩放管理器
    ├── CoordinateSystemManager.js   # 坐标系管理器
    ├── DragSnapLogger.js            # 拖拽吸附日志器
    ├── EdgeOverlapManager.js        # 边重叠管理器
    ├── EndNodeConfig.js             # 结束节点配置
    ├── NodeConfigManager.js         # 节点配置管理器
    ├── SmartCacheManager.js         # 智能缓存管理器
    ├── UnifiedPreviewLineManager.js # 统一预览线管理器
    ├── UnifiedStructuredLayoutEngine.js # 统一结构化布局引擎
    ├── branchSpacingConfig.js       # 分支间距配置
    ├── calculations.js/ts           # 计算工具
    ├── canvasConfig.js              # 画布配置
    ├── canvasValidation.js          # 画布验证
    ├── connectionConfigFactory.js   # 连接配置工厂
    ├── enhancedCanvasValidation.js  # 增强画布验证
    ├── enhancedErrorHandler.js      # 增强错误处理器
    ├── export.js/ts                 # 导出工具
    ├── nodeConnectionHelper.js      # 节点连接助手
    ├── nodeTypes.js                 # 节点类型定义
    ├── performanceUtils.js          # 性能工具
    ├── portConfigFactory.js         # 端口配置工厂
    ├── previewConfig.js             # 预览配置
    ├── taskStorage.js               # 任务存储
    ├── uiOptimizationConfig.js      # UI 优化配置
    ├── verticalLayoutConfig.js      # 垂直布局配置
    └── x6Config.js                  # X6 配置
```

### 4.3 核心业务流程

#### 4.3.1 画布初始化流程
```
App.vue → TaskFlowCanvas.vue → X6 Graph 初始化 → 加载节点和连接
```

#### 4.3.2 节点创建流程
```
NodeTypeSelector → 选择节点类型 → 创建节点实例 → 添加到画布 → 配置节点属性
```

#### 4.3.3 保存流程
```
用户触发保存 → 收集画布数据 → 数据验证 → 本地存储/API保存 → 保存确认
```

#### 4.3.4 加载流程
```
选择任务 → 获取任务数据 → 数据验证 → 清空画布 → 重建节点和连接 → 渲染完成
```

### 4.4 数据存储结构

#### 任务数据结构
```javascript
{
  id: "campaign_001",
  name: "新用户欢迎流程",
  description: "针对新注册用户的自动化欢迎营销",
  createTime: "2024-12-01 10:00:00",
  updateTime: "2024-12-01 15:30:00",
  version: 1,
  status: "draft", // draft, published, paused, archived
  canvasData: {
    nodes: [
      {
        id: "node_001",
        type: "start",
        label: "用户注册",
        position: { x: 100, y: 100 },
        data: { 
          trigger: "user_register",
          conditions: ["注册时间<24小时"]
        },
        config: { 
          color: "#1890ff",
          icon: "UserOutlined"
        }
      },
      {
        id: "node_002",
        type: "delay",
        label: "等待10分钟",
        position: { x: 300, y: 100 },
        data: { 
          delay: 600,
          unit: "seconds"
        }
      },
      {
        id: "node_003",
        type: "message",
        label: "发送欢迎短信",
        position: { x: 500, y: 100 },
        data: { 
          channel: "sms",
          template: "welcome_new_user",
          variables: ["user_name", "coupon_code"]
        }
      }
    ],
    connections: [
      {
        id: "connection_001",
        source: "node_001",
        target: "node_002",
        sourcePort: "out",
        targetPort: "in"
      },
      {
        id: "connection_002",
        source: "node_002",
        target: "node_003",
        sourcePort: "out",
        targetPort: "in"
      }
    ]
  },
  metrics: {
    totalExecutions: 1250,
    successRate: 0.85,
    avgCompletionTime: 3600,
    last7Days: {
      executions: 320,
      conversions: 48,
      revenue: 24000
    }
  }
}
```

## 5. 开发指南

### 5.1 启动项目
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build
```

### 5.2 开发规范

#### 5.2.1 组件开发
- 使用 Vue 3 Composition API
- 组件文件使用 PascalCase 命名
- 组合式函数使用 `use` 前缀

#### 5.2.2 工具函数开发
- 工具函数放在 `src/utils/` 目录
- 使用 ES6 模块导入导出
- 添加详细的 JSDoc 注释

#### 5.2.3 样式开发
- 使用 CSS 模块或 scoped 样式
- 遵循 BEM 命名规范
- 响应式设计优先

### 5.3 关键技术点

#### 5.3.1 X6 图形引擎集成
- 自定义节点和边的渲染
- 事件监听和处理
- 插件系统的使用

#### 5.3.2 预览线系统
- 实时预览连接效果
- 智能路径计算
- 多分支连接支持

#### 5.3.3 布局算法
- Dagre 自动布局
- 手动布局调整
- 布局方向切换

#### 5.3.4 数据持久化
- 本地存储 (LocalStorage)
- 任务导入导出
- 版本控制和备份

#### 5.3.5 性能优化
- 智能缓存机制
- 防抖和节流
- 虚拟滚动支持

## 6. 扩展开发

### 6.1 添加新节点类型
1. 在 <mcfile name="nodeTypes.js" path="src/utils/nodeTypes.js"></mcfile> 中定义节点类型
2. 在 <mcfile name="NodeConfigManager.js" path="src/utils/NodeConfigManager.js"></mcfile> 中添加配置逻辑
3. 创建对应的配置组件
4. 更新 <mcfile name="NodeTypeSelector.vue" path="src/pages/marketing/tasks/components/NodeTypeSelector.vue"></mcfile>

### 6.2 添加新布局算法
1. 在 <mcfile name="UnifiedStructuredLayoutEngine.js" path="src/utils/UnifiedStructuredLayoutEngine.js"></mcfile> 中实现算法
2. 在 <mcfile name="useStructuredLayout.js" path="src/composables/useStructuredLayout.js"></mcfile> 中添加调用接口
3. 更新布局配置文件

### 6.3 扩展存储功能
1. 在 <mcfile name="taskStorage.js" path="src/utils/taskStorage.js"></mcfile> 中添加新的存储方法
2. 实现云端同步功能
3. 添加协作编辑支持

## 7. 注意事项

1. **坐标系统**: 项目使用多种坐标系，注意坐标转换
2. **内存管理**: 及时清理 X6 实例和事件监听器
3. **性能监控**: 关注大量节点时的渲染性能
4. **数据一致性**: 确保保存和加载数据的完整性
5. **版本兼容**: 处理不同版本任务数据的兼容性

---

**文档版本**: v1.0  
**最后更新**: 2024年12月  
**维护者**: 前端开发团队