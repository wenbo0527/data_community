# 控制台日志系统使用说明

## 📋 系统概述

控制台日志系统是一个自动捕获浏览器控制台输出并保存为日志文件的工具。该系统会拦截所有的 `console.log`、`console.warn`、`console.error`、`console.info` 和 `console.debug` 输出，并定期将这些日志保存到本地文件。

## 🚀 功能特性

### ✅ 自动功能
- **自动启动**：在开发环境下自动初始化
- **自动捕获**：拦截所有控制台输出
- **自动保存**：每3秒自动保存一次日志
- **自动清理**：页面刷新时清空旧日志，开始新的记录

### 🎯 手动功能
- **手动保存**：`window.saveConsoleLogs()`
- **清空日志**：`window.clearConsoleLogs()`
- **查看统计**：`window.getLogStats()`

## 📁 文件输出

### 文件名格式
- **文件名**：`实时控制台日志.log`
- **保存位置**：浏览器下载目录
- **文件格式**：UTF-8编码的文本文件

### 文件内容结构
```
# 实时控制台日志
**生成时间：** 2025年01月16日 18:30:45
**页面URL：** http://localhost:5174/marketing/tasks/editor?taskId=5&version=1
**用户代理：** Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)...
**日志条数：** 156

---

[2025年01月16日 18:30:01] [INFO] [ConsoleLogger] 🚀 控制台日志捕获系统已启动
[2025年01月16日 18:30:02] [LOG] [Console] Registered route: /marketing/tasks/editor
[2025年01月16日 18:30:03] [WARN] [Console] 布局引擎警告: 虚拟endpoint节点未找到
[2025年01月16日 18:30:04] [ERROR] [Console] TypeError: Cannot read property 'x' of undefined

---
**日志结束** - 总计 156 条记录
**最后更新：** 2025年01月16日 18:30:45
```

## 🛠️ 使用方法

### 1. 自动使用（推荐）
系统在开发环境下会自动启动，无需任何配置：

```javascript
// 系统自动初始化，在控制台会看到：
// 🚀 控制台日志系统已启动 - 日志将自动保存到技术方案目录
```

### 2. 手动控制
在浏览器控制台中使用以下命令：

```javascript
// 立即保存当前日志
window.saveConsoleLogs();

// 清空当前日志缓存
window.clearConsoleLogs();

// 查看日志统计信息
window.getLogStats();
// 返回: { total: 156, byLevel: { LOG: 89, WARN: 45, ERROR: 12, INFO: 10 } }
```

### 3. 程序化使用
```javascript
import { getConsoleLogger } from '@/utils/consoleLogger.js';

const logger = getConsoleLogger();

// 手动保存
await logger.manualSave();

// 清空日志
logger.clearLogs();

// 获取当前日志
const logs = logger.getCurrentLogs();

// 获取统计信息
const stats = logger.getLogStats();
```

## ⚙️ 配置参数

### 默认配置
```javascript
{
  maxBufferSize: 500,      // 最大缓存日志条数
  flushInterval: 3000,     // 自动保存间隔（毫秒）
  logFileName: '实时控制台日志.log'  // 输出文件名
}
```

### 自定义配置
如需修改配置，可以编辑 `src/utils/consoleLogger.js` 文件中的构造函数参数。

## 📊 日志级别

系统捕获以下级别的日志：

| 级别 | 方法 | 描述 | 示例 |
|------|------|------|------|
| LOG | `console.log()` | 普通日志信息 | 调试输出、状态信息 |
| INFO | `console.info()` | 信息性消息 | 系统启动、功能初始化 |
| WARN | `console.warn()` | 警告消息 | 非关键错误、性能警告 |
| ERROR | `console.error()` | 错误消息 | 异常、崩溃、严重错误 |
| DEBUG | `console.debug()` | 调试信息 | 详细的调试输出 |

## 🔄 工作流程

### 页面加载时
1. 系统自动初始化
2. 重写控制台方法
3. 清空旧日志缓存
4. 开始捕获新日志

### 运行期间
1. 拦截所有控制台输出
2. 格式化并存储到缓存
3. 每3秒自动保存一次
4. 缓存超过500条时自动清理旧记录

### 页面刷新/关闭时
1. 保存当前所有日志
2. 清理内存缓存
3. 恢复原始控制台方法

## 📈 性能影响

### 内存使用
- **缓存大小**：最多500条日志记录
- **单条记录**：约100-200字节
- **总内存占用**：约50-100KB

### 性能开销
- **控制台拦截**：几乎无性能影响
- **日志格式化**：微秒级处理时间
- **文件保存**：异步操作，不阻塞主线程

## 🛡️ 安全考虑

### 数据隐私
- 日志仅保存在本地浏览器
- 不会上传到任何服务器
- 敏感信息需要开发者自行过滤

### 生产环境
- 系统仅在开发环境（`import.meta.env.DEV`）下启用
- 生产环境自动禁用，无性能影响

## 🔧 故障排除

### 常见问题

#### 1. 日志没有自动保存
**原因**：浏览器阻止了自动下载
**解决**：在浏览器设置中允许自动下载，或手动调用 `window.saveConsoleLogs()`

#### 2. 文件下载位置不对
**原因**：浏览器默认下载目录设置
**解决**：检查浏览器下载设置，或手动移动文件到技术方案目录

#### 3. 日志内容不完整
**原因**：缓存大小限制或页面刷新过快
**解决**：增加 `maxBufferSize` 或减少 `flushInterval`

#### 4. 系统没有启动
**原因**：不在开发环境或初始化失败
**解决**：检查 `import.meta.env.DEV` 或手动调用 `initConsoleLogger()`

### 调试命令
```javascript
// 检查系统状态
console.log('Logger initialized:', !!window.saveConsoleLogs);

// 查看当前日志
console.log('Current logs:', window.getLogStats());

// 强制保存
window.saveConsoleLogs();
```

## 📝 最佳实践

### 1. 定期保存
虽然系统会自动保存，但在重要操作前建议手动保存：
```javascript
// 在重要操作前保存日志
window.saveConsoleLogs();
```

### 2. 日志分类
使用不同的日志级别来分类信息：
```javascript
console.info('功能初始化完成');    // 信息
console.log('用户点击按钮');       // 普通日志
console.warn('性能警告');          // 警告
console.error('操作失败');         // 错误
```

### 3. 结构化日志
使用结构化的日志格式：
```javascript
console.log('用户操作', {
  action: 'click',
  element: 'submit-button',
  timestamp: Date.now(),
  userId: 'user123'
});
```

### 4. 敏感信息过滤
避免记录敏感信息：
```javascript
// ❌ 不要这样做
console.log('用户密码:', password);

// ✅ 应该这样做
console.log('用户登录成功');
```

## 📋 技术实现

### 核心技术
- **控制台拦截**：重写原生 `console` 方法
- **文件下载**：使用 `Blob` 和 `URL.createObjectURL`
- **定时器**：`setInterval` 实现自动保存
- **事件监听**：`beforeunload`、`visibilitychange` 等

### 兼容性
- **现代浏览器**：Chrome 60+、Firefox 55+、Safari 12+
- **移动端**：iOS Safari 12+、Chrome Mobile 60+
- **不支持**：IE 浏览器

## 🔄 更新日志

### v1.0.0 (2025-01-16)
- ✅ 初始版本发布
- ✅ 自动控制台日志捕获
- ✅ 定时自动保存功能
- ✅ 手动控制接口
- ✅ 页面刷新处理
- ✅ 本地存储备份

---

**文档版本**：1.0  
**最后更新**：2025年01月16日  
**维护者**：数据社区开发团队