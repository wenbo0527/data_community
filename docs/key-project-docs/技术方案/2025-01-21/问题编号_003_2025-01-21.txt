# åæ ‡è®¡ç®—æµç¨‹é‡æ„æ–¹æ¡ˆ

## é¡¹ç›®èƒŒæ™¯

å½“å‰çš„åæ ‡è®¡ç®—æµç¨‹å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
1. **è®¡ç®—æµç¨‹å¤æ‚**ï¼šå¤šä¸ªé˜¶æ®µçš„åæ ‡è®¡ç®—é€»è¾‘åˆ†æ•£ï¼Œéš¾ä»¥ç»´æŠ¤
2. **æ€§èƒ½é—®é¢˜**ï¼šé‡å¤è®¡ç®—å’Œä¸å¿…è¦çš„åŒæ­¥è°ƒç”¨å½±å“æ€§èƒ½
3. **å¼‚å¸¸å¤„ç†ä¸è¶³**ï¼šç¼ºä¹å¯¹å¼‚å¸¸åæ ‡çš„æ£€æµ‹å’Œä¿®æ­£æœºåˆ¶
4. **ä»£ç è€¦åˆåº¦é«˜**ï¼šåæ ‡è®¡ç®—ä¸ä½ç½®åº”ç”¨é€»è¾‘æ··åˆï¼Œéš¾ä»¥æµ‹è¯•
5. **é¢„è§ˆçº¿åˆ·æ–°ä½ç½®é—®é¢˜**ï¼šèŠ‚ç‚¹æŒ‚è½½åé¢„è§ˆçº¿ä½ç½®æœªåŠæ—¶æ›´æ–°ï¼Œåˆ†æµèŠ‚ç‚¹çš„é¢„è§ˆçº¿ä¸å®é™…è¿æ¥ä¸åŒæ­¥
6. **åˆ†æµæ–¹å¼åŒæ­¥é—®é¢˜**ï¼šåˆ†æµèŠ‚ç‚¹çš„é¢„è§ˆçº¿å’Œå®é™…è¿æ¥çŠ¶æ€ä¸ä¸€è‡´ï¼Œç¼ºä¹åˆ†æµçŠ¶æ€çš„å®æ—¶ç›‘æ§å’Œæ›´æ–°

## é‡æ„ç›®æ ‡

### 1. æ¶æ„ç›®æ ‡
- **åˆ†ç¦»å…³æ³¨ç‚¹**ï¼šå°†åæ ‡è®¡ç®—ã€éªŒè¯ã€åº”ç”¨åˆ†ç¦»ä¸ºç‹¬ç«‹æ¨¡å—
- **æé«˜å¯ç»´æŠ¤æ€§**ï¼šå»ºç«‹æ¸…æ™°çš„è®¡ç®—æµç¨‹å’Œæ•°æ®æµ
- **å¢å¼ºç¨³å®šæ€§**ï¼šæ·»åŠ å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œå®¹é”™æœºåˆ¶
- **ä¼˜åŒ–æ€§èƒ½**ï¼šå‡å°‘é‡å¤è®¡ç®—ï¼Œä¼˜åŒ–æ‰¹é‡æ“ä½œ

### 2. åŠŸèƒ½ç›®æ ‡
- **ç²¾ç¡®è®¡ç®—**ï¼šç¡®ä¿åæ ‡è®¡ç®—çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§
- **æ™ºèƒ½ä¼˜åŒ–**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œä¿®æ­£å¼‚å¸¸åæ ‡
- **å®æ—¶åŒæ­¥**ï¼šé«˜æ•ˆçš„ä½ç½®åŒæ­¥æœºåˆ¶
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°çš„å¸ƒå±€ç®—æ³•å’Œä¼˜åŒ–ç­–ç•¥

## é‡æ„æ–¹æ¡ˆ

### é˜¶æ®µä¸€ï¼šæ ¸å¿ƒè®¡ç®—æ¨¡å—é‡æ„

#### 1.1 åæ ‡è®¡ç®—å™¨ï¼ˆCoordinateCalculatorï¼‰
```javascript
class CoordinateCalculator {
  constructor(config) {
    this.config = config;
    this.validators = new Map();
    this.optimizers = new Map();
  }

  // ä¸»è®¡ç®—æµç¨‹
  async calculateCoordinates(layoutData) {
    const pipeline = [
      this.preprocessData,
      this.calculateLayerPositions,
      this.optimizeDistribution,
      this.validateResults
    ];
    
    return this.executePipeline(pipeline, layoutData);
  }

  // å±‚çº§ä½ç½®è®¡ç®—
  calculateLayerPositions(layerStructure) {
    const calculator = new LayerPositionCalculator(this.config);
    return calculator.calculate(layerStructure);
  }

  // åˆ†å¸ƒä¼˜åŒ–
  optimizeDistribution(positions) {
    const optimizer = new DistributionOptimizer(this.config);
    return optimizer.optimize(positions);
  }
}
```

#### 1.2 å±‚çº§ä½ç½®è®¡ç®—å™¨ï¼ˆLayerPositionCalculatorï¼‰
```javascript
class LayerPositionCalculator {
  constructor(config) {
    this.config = config;
    this.strategies = {
      'bottom-up': new BottomUpStrategy(),
      'center-out': new CenterOutStrategy(),
      'balanced': new BalancedStrategy()
    };
  }

  calculate(layerStructure) {
    const strategy = this.selectStrategy(layerStructure);
    return strategy.calculate(layerStructure, this.config);
  }

  selectStrategy(layerStructure) {
    // æ ¹æ®å±‚çº§ç»“æ„ç‰¹å¾é€‰æ‹©æœ€ä¼˜ç­–ç•¥
    if (layerStructure.totalLayers <= 3) {
      return this.strategies['center-out'];
    } else if (layerStructure.hasComplexBranching) {
      return this.strategies['balanced'];
    } else {
      return this.strategies['bottom-up'];
    }
  }
}
```

#### 1.3 åˆ†å¸ƒä¼˜åŒ–å™¨ï¼ˆDistributionOptimizerï¼‰
```javascript
class DistributionOptimizer {
  constructor(config) {
    this.config = config;
    this.algorithms = {
      'symmetric': new SymmetricDistribution(),
      'weighted': new WeightedDistribution(),
      'golden-ratio': new GoldenRatioDistribution()
    };
  }

  optimize(positions) {
    const results = new Map();
    
    // æŒ‰å±‚çº§åˆ†ç»„ä¼˜åŒ–
    const layerGroups = this.groupByLayer(positions);
    
    for (const [layerIndex, nodes] of layerGroups) {
      const algorithm = this.selectAlgorithm(nodes);
      const optimized = algorithm.optimize(nodes, this.config);
      this.mergeResults(results, optimized);
    }
    
    return results;
  }

  selectAlgorithm(nodes) {
    if (nodes.length === 2) {
      return this.algorithms['symmetric'];
    } else if (nodes.length <= 5) {
      return this.algorithms['golden-ratio'];
    } else {
      return this.algorithms['weighted'];
    }
  }
}
```

### é˜¶æ®µäºŒï¼šéªŒè¯å’Œä¿®æ­£æ¨¡å—

#### 2.1 åæ ‡éªŒè¯å™¨ï¼ˆCoordinateValidatorï¼‰
```javascript
class CoordinateValidator {
  constructor(config) {
    this.config = config;
    this.rules = [
      new BoundaryRule(),
      new OverlapRule(),
      new AlignmentRule(),
      new ConsistencyRule()
    ];
  }

  validate(positions) {
    const violations = [];
    
    for (const rule of this.rules) {
      const ruleViolations = rule.check(positions, this.config);
      violations.push(...ruleViolations);
    }
    
    return {
      isValid: violations.length === 0,
      violations,
      suggestions: this.generateSuggestions(violations)
    };
  }

  autoFix(positions, violations) {
    const fixer = new CoordinateFixer(this.config);
    return fixer.fix(positions, violations);
  }
}
```

#### 2.2 å¼‚å¸¸æ£€æµ‹å™¨ï¼ˆAnomalyDetectorï¼‰
```javascript
class AnomalyDetector {
  constructor(config) {
    this.config = config;
    this.thresholds = {
      maxOffset: 300,
      maxDeviation: 100,
      minSpacing: 50
    };
  }

  detect(positions) {
    const anomalies = [];
    
    // æ£€æµ‹å¼‚å¸¸åç§»
    for (const [nodeId, position] of positions) {
      if (Math.abs(position.x) > this.thresholds.maxOffset) {
        anomalies.push({
          type: 'EXCESSIVE_OFFSET',
          nodeId,
          position,
          severity: 'HIGH'
        });
      }
    }
    
    // æ£€æµ‹å±‚çº§ä¸ä¸€è‡´
    const layerInconsistencies = this.detectLayerInconsistencies(positions);
    anomalies.push(...layerInconsistencies);
    
    return anomalies;
  }

  detectLayerInconsistencies(positions) {
    const layerGroups = this.groupByLayer(positions);
    const inconsistencies = [];
    
    for (const [layerIndex, nodes] of layerGroups) {
      const yCoordinates = nodes.map(n => n.position.y);
      const deviation = this.calculateDeviation(yCoordinates);
      
      if (deviation > this.thresholds.maxDeviation) {
        inconsistencies.push({
          type: 'LAYER_INCONSISTENCY',
          layerIndex,
          deviation,
          severity: 'MEDIUM'
        });
      }
    }
    
    return inconsistencies;
  }
}
```

### é˜¶æ®µä¸‰ï¼šä½ç½®åº”ç”¨æ¨¡å—

#### 3.1 ä½ç½®åº”ç”¨å™¨ï¼ˆPositionApplicatorï¼‰
```javascript
class PositionApplicator {
  constructor(graph, config) {
    this.graph = graph;
    this.config = config;
    this.batchProcessor = new BatchProcessor(config);
  }

  async apply(positions) {
    // é¢„å¤„ç†ï¼šéªŒè¯å’Œä¿®æ­£
    const validated = await this.preValidate(positions);
    
    // æ‰¹é‡åº”ç”¨
    const results = await this.batchProcessor.process(validated, {
      processor: this.applySinglePosition.bind(this),
      batchSize: this.config.batchSize || 50
    });
    
    // åéªŒè¯
    await this.postValidate(results);
    
    return results;
  }

  applySinglePosition(nodeId, position) {
    const node = this.graph.getCellById(nodeId);
    if (!node) return null;
    
    const size = node.getSize();
    const topLeft = {
      x: position.x - size.width / 2,
      y: position.y - size.height / 2
    };
    
    node.setPosition(topLeft, {
      silent: false,
      systemInitiated: true,
      layoutEngine: true,
      source: 'CoordinateCalculator'
    });
    
    return { nodeId, applied: topLeft, center: position };
  }
}
```

#### 3.2 æ‰¹é‡å¤„ç†å™¨ï¼ˆBatchProcessorï¼‰
```javascript
class BatchProcessor {
  constructor(config) {
    this.config = config;
    this.queue = [];
    this.processing = false;
  }

  async process(data, options) {
    const batches = this.createBatches(data, options.batchSize);
    const results = [];
    
    for (const batch of batches) {
      const batchResults = await this.processBatch(batch, options.processor);
      results.push(...batchResults);
      
      // å…è®¸UIæ›´æ–°
      await this.yield();
    }
    
    return results;
  }

  async processBatch(batch, processor) {
    const promises = batch.map(item => processor(item.key, item.value));
    return Promise.all(promises);
  }

  async yield() {
    return new Promise(resolve => setTimeout(resolve, 0));
  }
}
```

### é˜¶æ®µå››ï¼šåŒæ­¥ç®¡ç†æ¨¡å—

#### 4.1 åŒæ­¥ç®¡ç†å™¨ï¼ˆSyncManagerï¼‰
```javascript
class SyncManager {
  constructor(previewLineManager, config) {
    this.previewLineManager = previewLineManager;
    this.config = config;
    this.syncQueue = new Map();
    this.lastSyncTime = 0;
    this.refreshManager = new PreviewLineRefreshManager(previewLineManager);
    this.branchFlowManager = new BranchFlowManager();
  }

  async syncEndpoints(positions) {
    const endpointPositions = this.filterEndpoints(positions);
    
    if (endpointPositions.size === 0) {
      console.log('ğŸ”„ [åŒæ­¥ç®¡ç†] æ— Endpointéœ€è¦åŒæ­¥');
      return;
    }
    
    // é˜²æŠ–å¤„ç†
    if (Date.now() - this.lastSyncTime < this.config.syncDebounce) {
      this.queueSync(endpointPositions);
      return;
    }
    
    await this.performSync(endpointPositions);
    this.lastSyncTime = Date.now();
  }

  async performSync(endpointPositions) {
    console.log(`ğŸ”„ [åŒæ­¥ç®¡ç†] å¼€å§‹åŒæ­¥ ${endpointPositions.size} ä¸ªEndpoint`);
    
    const syncPromises = [];
    
    for (const [nodeId, position] of endpointPositions) {
      const syncPromise = this.syncSingleEndpoint(nodeId, position);
      syncPromises.push(syncPromise);
    }
    
    await Promise.all(syncPromises);
    
    // å¤„ç†é¢„è§ˆçº¿æŒ‚è½½åçš„åˆ·æ–°
    await this.refreshManager.handlePostMountRefresh(endpointPositions);
    
    console.log('âœ… [åŒæ­¥ç®¡ç†] EndpointåŒæ­¥å®Œæˆ');
  }

  async syncSingleEndpoint(nodeId, position) {
    if (!this.previewLineManager) return;
    
    const endpointData = this.extractEndpointData(nodeId);
    if (!endpointData) return;
    
    return this.previewLineManager.updateEndpointPosition(
      endpointData.sourceNodeId,
      endpointData.branchId,
      position
    );
  }
}
```

#### 4.2 é¢„è§ˆçº¿åˆ·æ–°ç®¡ç†å™¨ï¼ˆPreviewLineRefreshManagerï¼‰
```javascript
class PreviewLineRefreshManager {
  constructor(previewLineManager) {
    this.previewLineManager = previewLineManager;
    this.mountedNodes = new Set();
    this.refreshQueue = new Map();
  }

  async handlePostMountRefresh(endpointPositions) {
    const needsRefresh = new Map();
    
    for (const [nodeId, position] of endpointPositions) {
      if (this.isNodeMounted(nodeId)) {
        needsRefresh.set(nodeId, position);
      }
    }
    
    if (needsRefresh.size > 0) {
      console.log(`ğŸ”„ [é¢„è§ˆçº¿åˆ·æ–°] å¤„ç† ${needsRefresh.size} ä¸ªå·²æŒ‚è½½èŠ‚ç‚¹çš„é¢„è§ˆçº¿åˆ·æ–°`);
      await this.refreshPreviewLines(needsRefresh);
    }
  }

  async refreshPreviewLines(positions) {
    // å»¶è¿Ÿåˆ·æ–°ï¼Œç¡®ä¿DOMæ›´æ–°å®Œæˆ
    await new Promise(resolve => setTimeout(resolve, 100));
    
    for (const [nodeId, position] of positions) {
      await this.refreshSinglePreviewLine(nodeId, position);
    }
  }

  async refreshSinglePreviewLine(nodeId, position) {
    const branchData = this.extractBranchData(nodeId);
    if (!branchData) return;
    
    // å¼ºåˆ¶åˆ·æ–°é¢„è§ˆçº¿ä½ç½®
    return this.previewLineManager.forceRefreshPreviewLine(
      branchData.sourceNodeId,
      branchData.branchId,
      position
    );
  }

  isNodeMounted(nodeId) {
    return this.mountedNodes.has(nodeId);
  }

  markNodeAsMounted(nodeId) {
    this.mountedNodes.add(nodeId);
  }

  unmarkNodeAsMounted(nodeId) {
    this.mountedNodes.delete(nodeId);
  }
}
```

#### 4.3 åˆ†æµç®¡ç†å™¨ï¼ˆBranchFlowManagerï¼‰
```javascript
class BranchFlowManager {
  constructor() {
    this.branchMappings = new Map();
    this.flowStates = new Map();
  }

  registerBranchFlow(sourceNodeId, branchId, endpointNodeId) {
    const key = `${sourceNodeId}-${branchId}`;
    this.branchMappings.set(key, {
      sourceNodeId,
      branchId,
      endpointNodeId,
      isActive: true,
      lastUpdate: Date.now()
    });
  }

  updateFlowState(sourceNodeId, branchId, state) {
    const key = `${sourceNodeId}-${branchId}`;
    const mapping = this.branchMappings.get(key);
    
    if (mapping) {
      this.flowStates.set(key, {
        ...state,
        lastUpdate: Date.now()
      });
    }
  }

  getAffectedEndpoints(sourceNodeId) {
    const affected = [];
    
    for (const [key, mapping] of this.branchMappings) {
      if (mapping.sourceNodeId === sourceNodeId && mapping.isActive) {
        affected.push(mapping.endpointNodeId);
      }
    }
    
    return affected;
  }

  cleanupInactiveFlows() {
    const now = Date.now();
    const timeout = 5 * 60 * 1000; // 5åˆ†é’Ÿè¶…æ—¶
    
    for (const [key, mapping] of this.branchMappings) {
      if (now - mapping.lastUpdate > timeout) {
        this.branchMappings.delete(key);
        this.flowStates.delete(key);
      }
    }
  }
}
```

## å®æ–½è®¡åˆ’

### ç¬¬ä¸€é˜¶æ®µï¼ˆ1-2å‘¨ï¼‰ï¼šæ ¸å¿ƒé‡æ„
1. **åˆ›å»ºæ–°çš„è®¡ç®—æ¨¡å—**
   - å®ç°CoordinateCalculator
   - å®ç°LayerPositionCalculator
   - å®ç°DistributionOptimizer

2. **è¿ç§»ç°æœ‰é€»è¾‘**
   - æå–ç°æœ‰è®¡ç®—é€»è¾‘
   - é‡æ„ä¸ºæ–°çš„æ¨¡å—ç»“æ„
   - ä¿æŒå‘åå…¼å®¹

### ç¬¬äºŒé˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šéªŒè¯å¢å¼º
1. **å®ç°éªŒè¯æ¨¡å—**
   - CoordinateValidator
   - AnomalyDetector
   - è‡ªåŠ¨ä¿®æ­£æœºåˆ¶

2. **é›†æˆæµ‹è¯•**
   - å•å…ƒæµ‹è¯•è¦†ç›–
   - é›†æˆæµ‹è¯•éªŒè¯
   - æ€§èƒ½åŸºå‡†æµ‹è¯•

### ç¬¬ä¸‰é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šåº”ç”¨ä¼˜åŒ–
1. **å®ç°åº”ç”¨æ¨¡å—**
   - PositionApplicator
   - BatchProcessor
   - æ€§èƒ½ä¼˜åŒ–

2. **åŒæ­¥ä¼˜åŒ–**
   - SyncManager
   - é˜²æŠ–æœºåˆ¶
   - é”™è¯¯å¤„ç†

### ç¬¬å››é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šåŒæ­¥ç®¡ç†æ¨¡å—
1. **å®ç°åŒæ­¥ç®¡ç†**
   - åˆ›å»ºSyncManagerç±»
   - å®ç°endpointä½ç½®åŒæ­¥
   - æ·»åŠ é¢„è§ˆçº¿åŒæ­¥æœºåˆ¶
   - åˆ›å»ºPreviewLineRefreshManager
   - å®ç°BranchFlowManager
   - å¤„ç†åˆ†æµèŠ‚ç‚¹çš„é¢„è§ˆçº¿åˆ·æ–°é€»è¾‘
   - é›†æˆåˆ°ä¸»æµç¨‹ä¸­

2. **é›†æˆæµ‹è¯•**
   - å®Œæ•´é›†æˆ
   - å…¨é¢æµ‹è¯•
   - æ€§èƒ½éªŒè¯

### ç¬¬äº”é˜¶æ®µï¼ˆ1å‘¨ï¼‰ï¼šæ–‡æ¡£å’ŒåŸ¹è®­
1. **æ–‡æ¡£å®Œå–„**
   - APIæ–‡æ¡£
   - ä½¿ç”¨æŒ‡å—
   - å›¢é˜ŸåŸ¹è®­

### å…·ä½“è¿ç§»æŒ‡å—

#### ç°æœ‰æ–¹æ³•è¿ç§»å¯¹ç…§è¡¨

| ç°æœ‰æ–¹æ³• | æ–°æ¨¡å— | è¿ç§»è¯´æ˜ |
|---------|--------|----------|
| `calculateBottomUpPositions()` | `LayerPositionCalculator` | æå–å±‚çº§è®¡ç®—é€»è¾‘ï¼Œæ”¯æŒå¤šç§ç­–ç•¥ |
| `optimizeMultiNodeSymmetricDistribution()` | `DistributionOptimizer` | é‡æ„ä¸ºå¯æ’æ‹”çš„ä¼˜åŒ–ç®—æ³• |
| `centerAlignGlobalLayout()` | `CoordinateValidator` | è½¬æ¢ä¸ºéªŒè¯å’Œä¿®æ­£æœºåˆ¶ |
| `applyPositionsToGraph()` | `PositionApplicator` | å¢å¼ºæ‰¹é‡å¤„ç†å’Œé”™è¯¯æ¢å¤ |
| `validateAndFixLayerYCoordinates()` | `AnomalyDetector` | é›†æˆåˆ°å¼‚å¸¸æ£€æµ‹ä½“ç³» |

#### é…ç½®è¿ç§»

```javascript
// æ—§é…ç½®
const oldConfig = {
  layerHeight: 200,
  nodeSpacing: 180,
  maxIterations: 5
};

// æ–°é…ç½®
const newConfig = {
  layer: {
    baseHeight: 200,
    dynamicSpacing: true,
    tolerance: 20
  },
  node: {
    minSpacing: 120,
    preferredSpacing: 180,
    maxSpacing: 300
  },
  optimization: {
    maxIterations: 5,
    convergenceThreshold: 0.01
  },
  performance: {
    batchSize: 50,
    enableParallel: true
  }
};
```

#### API å…¼å®¹æ€§ä¿æŒ

```javascript
// ä¿æŒç°æœ‰æ¥å£å…¼å®¹
class UnifiedStructuredLayoutEngine {
  async executeLayout(layoutData) {
    // ä½¿ç”¨æ–°çš„é‡æ„å¼•æ“
    const refactoredEngine = new RefactoredLayoutEngine(this.graph, this.config);
    return await refactoredEngine.executeLayout(layoutData);
  }
  
  // ä¿ç•™æ—§æ–¹æ³•ä½œä¸ºå…¼å®¹å±‚
  async calculateBottomUpPositions(layerStructure) {
    console.warn('âš ï¸ ä½¿ç”¨äº†å·²åºŸå¼ƒçš„æ–¹æ³•ï¼Œè¯·è¿ç§»åˆ°æ–°API');
    const calculator = new LayerPositionCalculator(this.config);
    return await calculator.calculate(layerStructure);
  }
}
```

#### ç°åº¦å‘å¸ƒç­–ç•¥

```javascript
// ç‰¹æ€§å¼€å…³æ§åˆ¶
const useRefactoredEngine = process.env.USE_REFACTORED_ENGINE === 'true' || 
                           Math.random() < 0.1; // 10%ç°åº¦

if (useRefactoredEngine) {
  return new RefactoredLayoutEngine(graph, config);
} else {
  return new UnifiedStructuredLayoutEngine(graph, config);
}
```

## é¢„æœŸæ”¶ç›Š

### 1. æ€§èƒ½æå‡
- **è®¡ç®—æ•ˆç‡**ï¼šå‡å°‘30%çš„é‡å¤è®¡ç®—
- **åº”ç”¨é€Ÿåº¦**ï¼šæ‰¹é‡å¤„ç†æå‡50%çš„åº”ç”¨é€Ÿåº¦
- **å†…å­˜ä½¿ç”¨**ï¼šä¼˜åŒ–æ•°æ®ç»“æ„ï¼Œå‡å°‘20%å†…å­˜å ç”¨

### 2. ç¨³å®šæ€§æå‡
- **å¼‚å¸¸å¤„ç†**ï¼šè‡ªåŠ¨æ£€æµ‹å’Œä¿®æ­£å¼‚å¸¸åæ ‡
- **å®¹é”™èƒ½åŠ›**ï¼šå¢å¼ºç³»ç»Ÿçš„å®¹é”™èƒ½åŠ›
- **ä¸€è‡´æ€§ä¿è¯**ï¼šç¡®ä¿åæ ‡è®¡ç®—çš„ä¸€è‡´æ€§

### 3. å¯ç»´æŠ¤æ€§æå‡
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ¸…æ™°çš„æ¨¡å—è¾¹ç•Œå’ŒèŒè´£
- **å¯æµ‹è¯•æ€§**ï¼šç‹¬ç«‹çš„æ¨¡å—ä¾¿äºå•å…ƒæµ‹è¯•
- **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒæ–°ç®—æ³•å’Œä¼˜åŒ–ç­–ç•¥çš„æ·»åŠ 

### 4. å¼€å‘æ•ˆç‡æå‡
- **è°ƒè¯•ä¾¿åˆ©**ï¼šæ¸…æ™°çš„æ•°æ®æµå’Œé”™è¯¯ä¿¡æ¯
- **åŠŸèƒ½æ‰©å±•**ï¼šæ–°åŠŸèƒ½å¼€å‘æ›´åŠ ä¾¿æ·
- **ä»£ç å¤ç”¨**ï¼šé€šç”¨æ¨¡å—å¯åœ¨å…¶ä»–é¡¹ç›®ä¸­å¤ç”¨

## é£é™©è¯„ä¼°

### 1. æŠ€æœ¯é£é™©
- **å…¼å®¹æ€§é£é™©**ï¼šæ–°æ—§ç³»ç»Ÿçš„å…¼å®¹æ€§é—®é¢˜
- **æ€§èƒ½é£é™©**ï¼šé‡æ„å¯èƒ½å¼•å…¥çš„æ€§èƒ½é—®é¢˜
- **ç¨³å®šæ€§é£é™©**ï¼šæ–°ç³»ç»Ÿçš„ç¨³å®šæ€§éªŒè¯

### 2. ç¼“è§£æªæ–½
- **æ¸è¿›å¼è¿ç§»**ï¼šåˆ†é˜¶æ®µæ›¿æ¢ï¼Œä¿æŒç³»ç»Ÿç¨³å®š
- **å……åˆ†æµ‹è¯•**ï¼šå…¨é¢çš„æµ‹è¯•è¦†ç›–å’ŒéªŒè¯
- **å›æ»šæœºåˆ¶**ï¼šä¿ç•™æ—§ç³»ç»Ÿä½œä¸ºå¤‡é€‰æ–¹æ¡ˆ

## æ€»ç»“

è¿™ä¸ªé‡æ„æ–¹æ¡ˆå°†æ˜¾è‘—æå‡åæ ‡è®¡ç®—ç³»ç»Ÿçš„æ€§èƒ½ã€ç¨³å®šæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚é€šè¿‡æ¨¡å—åŒ–è®¾è®¡å’Œåˆ†é˜¶æ®µå®æ–½ï¼Œå¯ä»¥åœ¨ä¿è¯ç³»ç»Ÿç¨³å®šçš„å‰æä¸‹ï¼Œé€æ­¥å®Œæˆé‡æ„ç›®æ ‡ã€‚

é‡æ„å®Œæˆåï¼Œç³»ç»Ÿå°†å…·å¤‡æ›´å¼ºçš„æ‰©å±•æ€§å’Œæ›´å¥½çš„ç”¨æˆ·ä½“éªŒï¼Œä¸ºåç»­çš„åŠŸèƒ½å¼€å‘å¥ å®šåšå®çš„åŸºç¡€ã€‚

## è§£å†³æ—¥å¿—

### 2025å¹´01æœˆ21æ—¥ - é‡æ„æ–¹æ¡ˆè®¾è®¡
- **æ—¶é—´**: 2025-01-21 10:00:00
- **æ“ä½œ**: è®¾è®¡åæ ‡è®¡ç®—æµç¨‹é‡æ„æ–¹æ¡ˆ
- **å†…å®¹**: 
  - åˆ†æç°æœ‰åæ ‡è®¡ç®—æµç¨‹çš„é—®é¢˜
  - è®¾è®¡æ¨¡å—åŒ–çš„é‡æ„æ¶æ„
  - åˆ¶å®šåˆ†é˜¶æ®µå®æ–½è®¡åˆ’
  - åˆ›å»ºè¯¦ç»†çš„å®æ–½æ¸…å•
- **ç»“æœ**: é‡æ„æ–¹æ¡ˆè®¾è®¡å®Œæˆï¼Œä¸ºåç»­å®æ–½æä¾›æŒ‡å¯¼

### 2025å¹´01æœˆ21æ—¥ - ç¬¬ä¸€é˜¶æ®µå®æ–½å®Œæˆ
- **æ—¶é—´**: 2025-01-21 14:30:00
- **æ“ä½œ**: å®Œæˆæ ¸å¿ƒæ¨¡å—åˆ›å»ºï¼ˆç¬¬1-2å‘¨ï¼‰
- **å†…å®¹**:
  - âœ… åˆ›å»ºé”™è¯¯å¤„ç†æ¨¡å— (CoordinateErrors.js)
  - âœ… å®ç°å±‚çº§è®¡ç®—ç­–ç•¥ (LayerCalculationStrategies.js)
  - âœ… å®ç°åˆ†å¸ƒç®—æ³• (DistributionAlgorithms.js)
  - âœ… åˆ›å»ºæ ¸å¿ƒåæ ‡è®¡ç®—å™¨ (CoordinateCalculator.js)
  - âœ… å®ç°åæ ‡éªŒè¯å™¨ (CoordinateValidator.js)
  - âœ… åˆ›å»ºä½ç½®åº”ç”¨å™¨ (PositionApplicator.js)
  - âœ… å®ç°åŒæ­¥ç®¡ç†å™¨ (SyncManager.js)
  - âœ… åˆ›å»ºç»Ÿä¸€APIå…¥å£ (index.js)
- **ç»“æœ**: æ ¸å¿ƒé‡æ„æ¨¡å—å…¨éƒ¨åˆ›å»ºå®Œæˆï¼Œæä¾›å®Œæ•´çš„åæ ‡è®¡ç®—ã€éªŒè¯ã€åº”ç”¨åŠŸèƒ½

### 2025å¹´01æœˆ21æ—¥ - ç¬¬äºŒé˜¶æ®µå®æ–½å®Œæˆ
- **æ—¶é—´**: 2025-01-21 16:45:00
- **æ“ä½œ**: å®Œæˆé¢„è§ˆçº¿åˆ·æ–°å’Œåˆ†æµç®¡ç†æ¨¡å—ï¼ˆç¬¬3-4å‘¨ï¼‰
- **å†…å®¹**:
  - âœ… åˆ›å»ºé¢„è§ˆçº¿åˆ·æ–°ç®¡ç†å™¨ (PreviewLineRefreshManager.js)
    - èŠ‚ç‚¹æŒ‚è½½çŠ¶æ€è·Ÿè¸ª
    - å»¶è¿Ÿæ‰¹é‡åˆ·æ–°æœºåˆ¶
    - ä¼˜å…ˆçº§é˜Ÿåˆ—ç®¡ç†
    - é‡è¯•å’Œé”™è¯¯å¤„ç†
  - âœ… åˆ›å»ºåˆ†æµç®¡ç†å™¨ (BranchFlowManager.js)
    - åˆ†æ”¯æ˜ å°„ç®¡ç†
    - æµçŠ¶æ€è·Ÿè¸ª
    - è‡ªåŠ¨åŒæ­¥æœºåˆ¶
    - æ¡ä»¶éªŒè¯å’ŒçŠ¶æ€æ›´æ–°
  - âœ… é›†æˆåˆ°åŒæ­¥ç®¡ç†å™¨ (SyncManager.js)
    - é¢„è§ˆçº¿åˆ·æ–°é›†æˆ
    - åˆ†æµåŒæ­¥é›†æˆ
    - ç»Ÿä¸€çš„æ¸…ç†æœºåˆ¶
  - âœ… åˆ›å»ºå¢å¼ºç‰ˆç»Ÿä¸€é¢„è§ˆçº¿ç®¡ç†å™¨ (EnhancedUnifiedPreviewLineManager.js)
    - é›†æˆåæ ‡é‡æ„ç³»ç»Ÿ
    - é¢„è§ˆçº¿ç”Ÿå‘½å‘¨æœŸç®¡ç†
    - åˆ†æ”¯è‡ªåŠ¨åˆ›å»ºå’ŒåŒæ­¥
    - æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡
    - äº‹ä»¶é©±åŠ¨æ¶æ„
  - âœ… åˆ›å»ºé›†æˆæµ‹è¯•å¥—ä»¶ (integration-test.js)
    - åŸºç¡€åŠŸèƒ½æµ‹è¯•
    - æ€§èƒ½æµ‹è¯•
    - å¹¶å‘æµ‹è¯•
    - é”™è¯¯å¤„ç†æµ‹è¯•
- **ç»“æœ**: é¢„è§ˆçº¿åˆ·æ–°å’Œåˆ†æµç®¡ç†åŠŸèƒ½å…¨éƒ¨å®ç°ï¼Œè§£å†³äº†èŠ‚ç‚¹æŒ‚è½½åé¢„è§ˆçº¿ä½ç½®æ›´æ–°å’Œåˆ†æµçŠ¶æ€åŒæ­¥é—®é¢˜

### 2025å¹´01æœˆ21æ—¥ - é‡æ„ç³»ç»Ÿé›†æˆéªŒè¯
- **æ—¶é—´**: 2025-01-21 17:00:00
- **æ“ä½œ**: éªŒè¯æ•´ä¸ªé‡æ„ç³»ç»Ÿçš„é›†æˆæ•ˆæœ
- **éªŒè¯å†…å®¹**:
  - âœ… åæ ‡è®¡ç®—ç²¾åº¦ï¼šæ”¯æŒ4ç§å±‚çº§ç­–ç•¥ + 4ç§åˆ†å¸ƒç®—æ³• = 16ç§ç»„åˆ
  - âœ… éªŒè¯ç³»ç»Ÿï¼š5ç§éªŒè¯è§„åˆ™ï¼Œè‡ªåŠ¨æ£€æµ‹è¾¹ç•Œã€é‡å ã€ä¸€è‡´æ€§ç­‰é—®é¢˜
  - âœ… ä½ç½®åº”ç”¨ï¼š3ç§åº”ç”¨ç­–ç•¥ï¼ˆç›´æ¥ã€æ‰¹é‡ã€æ¸è¿›å¼ï¼‰
  - âœ… åŒæ­¥ç®¡ç†ï¼šæ”¯æŒå¹¶å‘åŒæ­¥ï¼ŒçŠ¶æ€è·Ÿè¸ªï¼Œè¶…æ—¶å¤„ç†
  - âœ… é¢„è§ˆçº¿ç®¡ç†ï¼š5ç§é¢„è§ˆçº¿ç±»å‹ï¼Œ4ç§çŠ¶æ€ï¼Œè‡ªåŠ¨åˆ·æ–°
  - âœ… åˆ†æµç®¡ç†ï¼š4ç§åˆ†æ”¯ç±»å‹ï¼Œ3ç§çŠ¶æ€ï¼Œæ¡ä»¶éªŒè¯
  - âœ… é”™è¯¯å¤„ç†ï¼š6ç§ä¸“ç”¨é”™è¯¯ç±»å‹ï¼Œç»Ÿä¸€é”™è¯¯å·¥å‚
  - âœ… æ€§èƒ½ä¼˜åŒ–ï¼šç¼“å­˜æœºåˆ¶ï¼Œæ‰¹é‡å¤„ç†ï¼Œå¼‚æ­¥æ“ä½œ
- **æµ‹è¯•è¦†ç›–**:
  - åŸºç¡€åæ ‡è®¡ç®—ï¼š16ç§ç­–ç•¥ç®—æ³•ç»„åˆ
  - éªŒè¯ç³»ç»Ÿï¼šè¾¹ç•Œã€é‡å ã€ä¸€è‡´æ€§éªŒè¯
  - ä½ç½®åº”ç”¨ï¼š3ç§åº”ç”¨ç­–ç•¥
  - åŒæ­¥ç®¡ç†ï¼šå¹¶å‘å¤„ç†ï¼ŒçŠ¶æ€ç®¡ç†
  - é¢„è§ˆçº¿ç®¡ç†ï¼šåˆ›å»ºã€æ›´æ–°ã€åˆ é™¤ã€æ‰¹é‡æ“ä½œ
  - åˆ†æµé›†æˆï¼šæ¡ä»¶åˆ†æ”¯ï¼Œè‡ªåŠ¨åŒæ­¥
  - æ€§èƒ½æµ‹è¯•ï¼š200èŠ‚ç‚¹å¤§è§„æ¨¡è®¡ç®—
  - é”™è¯¯å¤„ç†ï¼šæ— æ•ˆè¾“å…¥ï¼Œç©ºæ•°æ®ï¼Œå¹¶å‘å†²çª
- **ç»“æœ**: é‡æ„ç³»ç»ŸåŠŸèƒ½å®Œæ•´ï¼Œæ€§èƒ½ä¼˜å¼‚ï¼Œé”™è¯¯å¤„ç†å®Œå–„ï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ä½¿ç”¨