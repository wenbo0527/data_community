# 外数评估需求文档

## 📋 文档信息
| 项目       | 详情                         |
| -------- | -------------------------- |
| **文档名称** | 外数评估报告-产品级效果评估需求文档         |
| **版本**   | v1.1                       |
| **最后更新** | 2025-08-07                 |
| **状态**   | 已审核                        |
| **编写人**  | AI需求分析专家                   |
| **审核人**  | 产品经理、数据科学家                 |
| **适用角色** | 产品经理、数据科学家、数据分析师、业务运营、技术开发 |

### 版本历史
| 版本 | 日期 | 变更内容 | 作者 |
|---|---|---|---|
| v1.0 | 2025-08-07 | 初始版本创建 | AI需求分析专家 |
| v1.1 | 2025-08-07 | 产品经理和数据科学家视角校验优化，补充角色操作流程 | AI需求分析专家 |

---

## 📖 术语定义
| 术语 | 定义 |
|---|---|
| **外数** | 从外部数据源引入的数据资产，包括第三方数据、合作方数据等 |
| **外数生命周期** | 外数从引入、评估、使用到最终下线的完整管理过程 |
| **分析报告** | 对外数效果进行产品级评估的文档，包含样本分析、效果评估、结论建议 |
| **样本文件** | 用于外数效果评估的Excel格式数据文件，包含测试数据和基准数据 |
| **关键变量** | 外数评估过程中需要重点监控和分析的核心数据指标 |

---

## 🎯 需求概述

### 背景
随着公司业务的快速发展，外部数据的引入变得越来越重要。当前缺乏统一的外数评估体系，导致数据引入决策缺乏科学依据，数据使用效果难以量化评估。

### 目标
建立一套完整的外数评估机制，支持外数引入前的预评估和引入后的效果评估，提升数据资产的管理水平和使用效率。

### 范围
**包含**：
- ✅ 外数效果查询列表页
- ✅ 外数产品分析报告查看
- ✅ 新建分析报告功能
- ✅ 分析报告任务管理
- ✅ 分析报告内容编辑
- ✅ 分析报告详情展示

**不包含**：
- ❌ 外数数据的实际采集和清洗
- ❌ 数据权限管理
- ❌ 数据血缘关系管理

---

# 🚀 功能需求

## 5.1 📊 效果查询列表页

### 功能概述
提供外数评估报告的集中管理界面，支持多维度筛选、快速查看和创建新报告。

### 核心功能

#### 5.1.1 报告列表展示
| 字段 | 说明 | 交互特性 |
|---|---|---|
| **报告名称** | 点击跳转详情页 | 蓝色链接样式 |
| **外数产品名称** | 显示被评估产品 | 支持按产品筛选 |
| **报告类型** | 当前仅支持产品级效果评估 | 标签样式展示 |
| **分析时间跨度** | YYYYmmDD - YYYYmmDD格式 | 时间轴展示 |
| **报告生成日期** | 系统创建时间 | 默认倒序排列 |
| **状态** | 待处理/处理中/已完成/失败 | 彩色状态标识 |

**列表特性**：
- ✅ 默认按生成日期倒序排列
- ✅ 支持分页（10/20/50/100条/页）
- ✅ 状态颜色：绿色(已完成)、黄色(处理中)、红色(失败)

#### 5.1.2 筛选功能
| 筛选条件 | 类型 | 默认值 | 限制 |
|---|---|---|---|
| **报告生成日期** | 日期范围选择器 | 近30天 | 无时间限制 |
| **报告类型** | 单选下拉框 | 产品级效果评估 | 仅支持单一类型 |

#### 5.1.3 新建报告
- **入口**：列表页右上角"新建产品级效果评估"按钮
- **跳转**：直接进入新建分析报告页面
- **权限**：仅支持产品级效果评估报告创建

## 5.2 📖 报告详情查看

### 功能概述
展示特定外数产品的完整分析报告，包含评估结果、数据洞察和关键指标。

### 核心信息
| 信息类别 | 展示内容 | 数据来源 |
|---|---|---|
| **基本信息** | 报告标题、外数产品信息、分析时间段、样本量 | 系统生成 |
| **评估结果** | 饱和度、相关性、提升度等关键指标 | 分析脚本计算 |
| **可视化图表** | 样本分布、效果对比、趋势分析图 | 自动生成 |

### 限制条件
- ⚠️ 报告标题不可编辑
- ⚠️ 外数产品信息从系统获取，不可修改

## 5.3 ➕ 新建分析报告

### 功能概述
创建新的外数评估分析任务，支持完整的信息配置和文件上传。

### 配置表单
| 字段 | 类型 | 默认值 | 验证规则 |
|---|---|---|---|
| **报告名称** | 自动生成文本 | [产品名]-产品级评估-[日期] | 唯一性校验 |
| **外数产品** | 下拉选择+手工输入 | - | 必填 |
| **展示配置模板** | 下拉选择 | 标准模板 | 必填 |
| **分析时间跨度** | 日期范围选择器 | - | 必填 |
| **样本文件** | 文件上传 | - | .xlsx/.csv, ≤50MB |
| **分析说明** | 文本域 | - | ≤500字符，可选 |

### 模板说明
| 模板类型 | 特点 | 适用场景 |
|---|---|---|
| **标准模板** | 完整分析维度+图表 | 常规评估 |
| **精简模板** | 核心指标+关键图表 | 快速评估 |
| **详细模板** | 全维度+深度图表 | 深度分析 |
| **自定义模板** | 可选维度 | 特殊需求 |

### 处理流程
```
提交 → 格式验证 → 数据处理 → 图表生成 → 报告生成 → 完成通知
```

## 5.4 ⚙️ 任务管理

### 功能概述
实时监控分析任务的处理状态和进度。

### 状态展示
| 状态 | 颜色标识 | 操作选项 |
|---|---|---|
| **待处理** | 灰色 | 查看详情 |
| **处理中** | 黄色+进度条 | 实时监控 |
| **已完成** | 绿色 | 查看报告 |
| **失败** | 红色 | 重新提交 |

### 监控特性
- 🔄 处理中任务每30秒自动刷新
- ⏱️ 显示预计剩余时间
- 📊 实时进度百分比
- ❗ 失败原因详细展示

## 5.5 ✏️ 内容编辑

### 功能概述
支持对生成的分析报告进行内容编辑、完善和发布，提供富文本编辑能力。

### 编辑能力
| 功能模块 | 支持操作 | 技术实现 |
|---|---|---|
| **富文本编辑** | 文本修改、格式调整、图表插入 | 集成富文本编辑器 |
| **图表管理** | 添加/删除图表、调整图表顺序 | 拖拽式操作 |
| **元数据编辑** | 报告摘要、标签管理 | 表单式输入 |

### 编辑流程
```
查看报告 → 进入编辑模式 → 内容修改 → 保存草稿 → 预览确认 → 正式发布
```

### 限制条件
- ⚠️ 已发布报告修改需二次确认
- ⚠️ 图表数据由分析脚本生成，不可直接修改
- ⚠️ 发布后需重新生成PDF版本

# 6 角色权限与操作流程

## 6.1 角色定义与权限矩阵

| 角色 | 权限范围 | 核心职责 | 数据访问级别 |
|---|---|---|---|
| **产品经理** | 报告创建、查看、编辑、发布 | 定义评估目标、解读业务结果、制定决策建议 | 业务指标全量访问 |
| **数据科学家** | 脚本配置、模型调优、结果验证 | 设计评估方案、验证数据质量、优化分析算法 | 原始数据+中间结果+最终输出 |
| **数据分析师** | 报告查看、基础编辑、数据导出 | 执行日常分析、生成标准报告、支持业务查询 | 汇总数据+可视化结果 |
| **业务运营** | 报告查看、结果反馈、需求提出 | 理解业务影响、提出优化建议、跟踪效果变化 | 业务指标查看 |
| **技术开发** | 系统集成、脚本部署、性能优化 | 确保系统稳定、处理技术故障、优化处理效率 | 系统日志+性能指标 |

## 6.2 产品经理操作流程

| 阶段 | 关键动作 | 输出物 | 时间节点 |
|---|---|---|---|
| **报告创建** | 明确评估目标、配置参数、设定样本 | 评估需求单 | T+0 |
| **结果解读** | 核心指标解读、业务价值评估、决策建议 | 决策建议书 | T+3 |
| **后续跟踪** | 监控指标设定、效果复盘 | 跟踪报告 | 每月 |

**配置参数清单**
- 外数产品：第三方用户画像数据
- 时间范围：≥1个完整业务周期
- 关键指标：注册转化率、7日留存率
- 样本要求：测试组≥1万用户，对照组1:1匹配

## 6.3 数据科学家工作流程

| 阶段 | 关键动作 | 技术规范 | 质量要求 |
|---|---|---|---|
| **方案设计** | 评估方法选择、抽样策略、统计检验 | 技术方案文档 | 方法科学性 |
| **数据检查** | 完整性、一致性、异常值处理 | 数据质量报告 | 缺失值<5% |
| **模型调优** | 饱和度权重、相关系数、置信区间 | 参数调优记录 | 95%置信水平 |
| **结果验证** | 交叉验证、敏感性分析、业务合理性 | 验证报告 | 一致性≥90% |
| **文档输出** | 方法记录、可信度说明、优化建议 | 技术文档 | 可追溯版本

## 6.4 跨角色协作流程

### 6.4.1 需求澄清会议
- **参与角色**：产品经理+数据科学家+业务运营
- **会议目标**：明确评估目标、关键指标、时间计划
- **输出文档**：需求确认单、技术方案初稿

### 6.4.2 中期检查会议
- **触发条件**：数据处理完成50%时
- **参与角色**：数据科学家+技术开发
- **检查内容**：数据质量、处理进度、技术风险
- **输出文档**：中期检查报告

### 6.4.3 结果评审会议
- **参与角色**：全员参与
- **评审内容**：业务结果、技术实现、后续计划
- **决策机制**：
  - 技术可行性：数据科学家一票否决
  - 业务价值：产品经理最终决策
  - 实施风险：业务运营评估

## 6.5 数据安全与合规

### 6.5.1 数据脱敏要求
- **个人信息**：手机号、身份证号等敏感信息脱敏
- **业务数据**：关键业务指标做模糊化处理
- **访问日志**：记录所有数据访问行为，保存180天

### 6.5.2 权限审批流程
- **数据访问申请**：需部门负责人审批
- **结果发布审批**：需数据安全团队审核
- **外部共享审批**：需法务部门合规审查

## 6.6 质量保障机制

### 6.6.1 数据质量检查点
1. **样本上传时**：格式校验、字段完整性检查
2. **处理过程中**：实时异常监控、自动告警
3. **结果输出前**：多重验证、交叉确认

### 6.6.2 业务合理性验证
- **指标阈值**：设定合理的业务指标范围
- **异常检测**：自动识别不符合业务逻辑的结果
- **人工复核**：关键结果需数据科学家人工确认

## 6.7 持续优化机制

### 6.7.1 效果跟踪
- **定期评估**：每季度评估外数实际使用效果
- **指标监控**：持续跟踪关键业务指标变化
- **反馈收集**：收集业务团队使用反馈

### 6.7.2 模型迭代
- **算法优化**：基于实际效果调整分析算法
- **参数调优**：根据业务变化优化评估参数
- **新需求响应**：快速响应新的评估需求

# 7 数据科学工作流规范

## 7.1 数据接入标准

| 数据类型 | 支持格式 | 必填字段 | 质量标准 | 处理规则 |
|---|---|---|---|---|
| **用户基础数据** | CSV/Excel | user_id、注册时间、渠道来源 | 缺失率<1% | user_id去重 |
| **行为数据** | JSON/Parquet | 时间戳、事件类型、事件属性 | 时间格式标准化 | 统一时间粒度 |
| **外数数据** | CSV/Excel | 加密用户标识、外数标签、置信度 | 覆盖度>80% | 维度标准化 |

**预处理规范**
- 异常值处理：3σ原则或IQR方法
- 缺失值插补：业务场景化策略
- 数据对齐：时间窗口、用户标识、维度定义

## 7.2 分析方法论

| 方法类别 | 具体技术 | 应用要点 | 验证标准 |
|---|---|---|---|
| **实验设计** | A/B测试 | 同期对照、相似用户匹配 | 样本量计算 |
| **显著性检验** | t检验+卡方检验 | 多重校正、95%置信区间 | p<0.05 |
| **因果推断** | PSM+双重差分 | 平衡性检验<0.1 | 平行趋势验证 |
| **稳健性检验** | 时间窗口验证 | 多期效应评估 | 结果一致性≥90%

## 7.3 模型评估指标

| 指标名称 | 计算公式 | 业务含义 | 阈值建议 |
|---|---|---|---|
| **饱和度** | 外数用户数/总用户数×100% | 数据覆盖程度 | >30% |
| **有效饱和度** | 高置信度用户数/总用户数×100% | 有效覆盖程度 | >20% |
| **提升度** | (实验-对照)/对照×100% | 相对效果提升 | >5% |
| **绝对提升** | 实验转化率-对照转化率 | 绝对效果提升 | >1pp |
| **置信度** | 1-p-value | 统计显著性 | >95% |

**长期跟踪指标**
- 衰减分析：月度效果衰减率
- 饱和效应：边际效用递减曲线
- 用户疲劳：响应率变化趋势

## 7.4 技术实现规范

### 7.4.1 代码规范
```python
# 标准化分析脚本模板
def analyze_external_data(
    test_data: pd.DataFrame,
    control_data: pd.DataFrame,
    external_data: pd.DataFrame
) -> Dict[str, Any]:
    """
    外数效果评估主分析函数
    
    Args:
        test_data: 实验组用户数据
        control_data: 对照组用户数据  
        external_data: 外数标签数据
    
    Returns:
        包含各项评估指标的字典
    """
    # 数据预处理
    processed_data = preprocess_data(test_data, control_data, external_data)
    
    # 饱和度计算
    saturation_metrics = calculate_saturation(processed_data)
    
    # 效果评估
    effect_metrics = evaluate_treatment_effect(processed_data)
    
    # 结果汇总
    return {
        'saturation': saturation_metrics,
        'effect': effect_metrics,
        'statistical_tests': run_statistical_tests(processed_data)
    }
```

### 7.4.2 结果输出标准
1. **标准化报告**：
   - 执行摘要：关键结论和建议
   - 详细分析：完整的数据分析过程
   - 技术附录：模型参数和假设检验
2. **可视化规范**：
   - 图表类型：根据数据类型选择合适图表
   - 颜色标准：使用品牌色彩体系
   - 标注要求：关键统计显著性标注

## 7.5 风险控制机制

### 7.5.1 数据质量风险
- **监控指标**：
  - 数据完整性：每日缺失率监控
  - 数据一致性：跨系统数据核对
  - 业务合理性：指标波动异常检测
- **应急预案**：
  - 数据缺失：使用历史均值插补
  - 系统故障：切换到备用数据源
  - 结果异常：触发人工复核流程

### 7.5.2 业务应用风险
- **过度解读防范**：
  - 明确统计vs实际显著性区别
  - 提供置信区间而非点估计
  - 强调相关不等同于因果
- **实施风险评估**：
  - 小范围试点：先在小规模用户群体验证
  - 分阶段推广：逐步扩大应用范围
  - 持续监控：建立长期效果跟踪机制
      - 支持版本历史查看和恢复
      - 模板类型在创建后不可更改
      - 单个模块文字内容限制：最大10000字符
      - 单个模块图片数量限制：最多20张图片
      - 支持撤销/重做操作（最多50步）

## 5.6 📊 报告详情页

### 功能概述
展示外数评估报告的完整内容，提供数据洞察、可视化图表和关键结论。

### 内容结构
| 模块 | 展示内容 | 数据类型 |
|---|---|---|
| **报告头信息** | 标题、产品信息、时间段、样本量 | 元数据 |
| **核心指标** | 饱和度、相关性、提升度 | 数值+图表 |
| **深度分析** | 样本分布、效果对比、趋势分析 | 可视化图表 |
| **关键洞察** | 结论总结、业务建议 | 文本描述 |

### 图表展示
| 图表类型 | 展示内容 | 交互功能 |
|---|---|---|
| **饱和度分析** | 样本饱和度分布图 | 悬停显示详情 |
| **相关性分析** | 相关性热力图 | 点击查看明细 |
| **效果对比** | 平台间效果对比图 | 支持筛选平台 |
| **趋势分析** | 月度效果趋势图 | 时间轴调整 |

### 操作选项
- 📥 下载PDF报告
- 🔄 重新生成图表
- ✏️ 进入编辑模式
- 📤 分享报告链接

# 版本信息
- **当前版本**：v1.0（2025-01-08）
- **变更记录**：
  - 2025-01-08：初始版本创建，包含外数评估的完整功能设计

# 附录
- **相关文档**：
  - 外数生命周期管理规范：/docs/key-project-docs/需求文档/外数生命周期/
  - 数据社区前端架构文档：/docs/key-project-docs/技术方案/
- **参考链接**：
  - 数据社区平台：http://data-platform.com
  - 外数管理最佳实践：https://example.com/external-data-guide