<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸é™„æ“ä½œæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin-top: 10px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ å¸é™„æ“ä½œæµ‹è¯•é¡µé¢</h1>
        <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•ä¿®å¤åçš„é¢„è§ˆçº¿åˆ é™¤åŠŸèƒ½</p>
        
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
            <ol>
                <li>æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨é¡µé¢</li>
                <li>æ‹–æ‹½èŠ‚ç‚¹åˆ›å»ºé¢„è§ˆçº¿</li>
                <li>å°†é¢„è§ˆçº¿å¸é™„åˆ°ç›®æ ‡èŠ‚ç‚¹</li>
                <li>æ£€æŸ¥é¢„è§ˆçº¿æ˜¯å¦æ­£ç¡®åˆ é™¤</li>
                <li>æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—éªŒè¯åˆ é™¤é€»è¾‘</li>
            </ol>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ æµ‹è¯•æ“ä½œ</h3>
            <button class="test-button" onclick="openTaskEditor()">æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨</button>
            <button class="test-button" onclick="checkPreviewLines()">æ£€æŸ¥é¢„è§ˆçº¿çŠ¶æ€</button>
            <button class="test-button" onclick="simulateSnapOperation()">æ¨¡æ‹Ÿå¸é™„æ“ä½œ</button>
            <button class="test-button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•çŠ¶æ€</h3>
            <div id="status" class="status">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“ æµ‹è¯•æ—¥å¿—</h3>
            <div id="logArea" class="log-area"></div>
        </div>
    </div>

    <script>
        let logArea = null;
        
        function log(message, type = 'info') {
            if (!logArea) {
                logArea = document.getElementById('logArea');
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${type.toUpperCase()}: ${message}\n`;
            logArea.textContent += logEntry;
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(`[æµ‹è¯•é¡µé¢] ${logEntry.trim()}`);
        }
        
        function updateStatus(message, isSuccess = true) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${isSuccess ? 'success' : 'error'}`;
        }
        
        function openTaskEditor() {
            log('æ­£åœ¨æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨é¡µé¢...');
            const url = 'http://localhost:5174/marketing/tasks/editor?mode=edit&id=2&version=1';
            window.open(url, '_blank');
            updateStatus('ä»»åŠ¡ç¼–è¾‘å™¨å·²åœ¨æ–°çª—å£æ‰“å¼€');
            log('ä»»åŠ¡ç¼–è¾‘å™¨é¡µé¢å·²æ‰“å¼€ï¼Œè¯·åœ¨è¯¥é¡µé¢è¿›è¡Œå¸é™„æµ‹è¯•');
        }
        
        function checkPreviewLines() {
            log('æ£€æŸ¥å…¨å±€é¢„è§ˆçº¿ç®¡ç†å™¨çŠ¶æ€...');
            
            if (typeof window !== 'undefined' && window.unifiedPreviewLineManager) {
                const manager = window.unifiedPreviewLineManager;
                
                if (typeof manager.debugCurrentState === 'function') {
                    log('è°ƒç”¨é¢„è§ˆçº¿ç®¡ç†å™¨è°ƒè¯•æ–¹æ³•...');
                    manager.debugCurrentState();
                    updateStatus('é¢„è§ˆçº¿çŠ¶æ€å·²è¾“å‡ºåˆ°æ§åˆ¶å°');
                } else {
                    log('é¢„è§ˆçº¿ç®¡ç†å™¨ç¼ºå°‘debugCurrentStateæ–¹æ³•', 'warn');
                    updateStatus('é¢„è§ˆçº¿ç®¡ç†å™¨æ–¹æ³•ä¸å®Œæ•´', false);
                }
                
                // æ£€æŸ¥é¢„è§ˆçº¿æ•°é‡
                if (manager.previewLines) {
                    const count = manager.previewLines.size || 0;
                    log(`å½“å‰é¢„è§ˆçº¿æ•°é‡: ${count}`);
                }
            } else {
                log('å…¨å±€é¢„è§ˆçº¿ç®¡ç†å™¨ä¸å­˜åœ¨ï¼Œè¯·å…ˆæ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨', 'error');
                updateStatus('éœ€è¦å…ˆæ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨é¡µé¢', false);
            }
        }
        
        function simulateSnapOperation() {
            log('å¼€å§‹æ¨¡æ‹Ÿå¸é™„æ“ä½œæµ‹è¯•...');
            
            // è¿™é‡Œåªæ˜¯è®°å½•æµ‹è¯•æ­¥éª¤ï¼Œå®é™…æ“ä½œéœ€è¦åœ¨ä»»åŠ¡ç¼–è¾‘å™¨é¡µé¢è¿›è¡Œ
            const steps = [
                '1. åœ¨ä»»åŠ¡ç¼–è¾‘å™¨ä¸­æ‹–æ‹½ä¸€ä¸ªèŠ‚ç‚¹',
                '2. è§‚å¯Ÿé¢„è§ˆçº¿çš„åˆ›å»º',
                '3. å°†èŠ‚ç‚¹æ‹–æ‹½åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹é™„è¿‘',
                '4. é‡Šæ”¾é¼ æ ‡å®Œæˆå¸é™„',
                '5. æ£€æŸ¥é¢„è§ˆçº¿æ˜¯å¦æ­£ç¡®åˆ é™¤',
                '6. æŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—ç¡®è®¤åˆ é™¤é€»è¾‘'
            ];
            
            steps.forEach((step, index) => {
                setTimeout(() => {
                    log(step);
                }, index * 500);
            });
            
            setTimeout(() => {
                updateStatus('å¸é™„æ“ä½œæµ‹è¯•æ­¥éª¤å·²åˆ—å‡ºï¼Œè¯·åœ¨ä»»åŠ¡ç¼–è¾‘å™¨ä¸­æ‰§è¡Œ');
                log('è¯·æŒ‰ç…§ä¸Šè¿°æ­¥éª¤åœ¨ä»»åŠ¡ç¼–è¾‘å™¨é¡µé¢è¿›è¡Œå®é™…æµ‹è¯•');
            }, steps.length * 500);
        }
        
        function clearLogs() {
            if (logArea) {
                logArea.textContent = '';
            }
            updateStatus('æ—¥å¿—å·²æ¸…ç©º');
            log('æµ‹è¯•æ—¥å¿—å·²æ¸…ç©ºï¼Œå‡†å¤‡æ–°çš„æµ‹è¯•');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.addEventListener('load', function() {
            logArea = document.getElementById('logArea');
            log('å¸é™„æ“ä½œæµ‹è¯•é¡µé¢å·²åŠ è½½');
            log('è¯·ç‚¹å‡»"æ‰“å¼€ä»»åŠ¡ç¼–è¾‘å™¨"æŒ‰é’®å¼€å§‹æµ‹è¯•');
            updateStatus('æµ‹è¯•é¡µé¢å·²å‡†å¤‡å°±ç»ª');
        });
        
        // ç›‘å¬æ¥è‡ªå…¶ä»–çª—å£çš„æ¶ˆæ¯ï¼ˆå¦‚æœéœ€è¦è·¨çª—å£é€šä¿¡ï¼‰
        window.addEventListener('message', function(event) {
            if (event.data && event.data.type === 'snap-test') {
                log(`æ”¶åˆ°æµ‹è¯•æ¶ˆæ¯: ${event.data.message}`, event.data.level || 'info');
            }
        });
    </script>
</body>
</html>