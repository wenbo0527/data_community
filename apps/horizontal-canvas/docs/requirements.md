# 横版画布应用需求说明（PRD）

## 背景与目标
- 目标：提供基于 AntV X6 的横向营销任务编排画布，支持节点配置、连线规则、统计分析与发布流程。
- 用户价值：降低运营搭建营销策略的门槛；提供策略运行监控与复盘能力；为开发与分析协作提供统一界面。

## 用户角色与使用场景
- 运营（主用户）：搭建与维护营销任务流（新增节点、配置内容、发布策略）。
- 数据分析：查看统计面板、分析用户路径与节点表现，导出数据。
- 开发/实施：扩展节点类型、抽屉表单与样式，修复问题与上线。

场景示例：
- 新活动上线：运营复用画布模板 → 修改节点配置 → 发布新版本。
- 运行监控：分析查看统计看板的运行天数、累计进入人次、策略结束等 KPI → 针对分流/AB 节点观测分支出人数。
- 策略迭代：对某节点（如短信）配置内容更新 → 回归测试 → 发布。

## 功能性需求
1. 画布与节点
   - 支持横向节点布局与连接（右向连接规则）。
   - 节点类型：开始、结束、人群分流、事件分流、AB 实验、短信、AI 外呼、权益等。
   - 节点配置抽屉：每种类型有独立的配置表单与验证。
   - 历史记录与撤销：提供撤销/重做与历史面板。
2. 连接规则
   - 横向连接：目标在源节点右侧。
   - 分流节点支持多出边；AB 实验分支按比例。
3. 查看与发布
   - 编辑模式与查看模式；查看模式禁止删除连线（已实现）。
   - 发布校验：节点配置完整、连接合法性校验。
4. 统计看板（底部面板）
   - 画布级 KPI：运行天数、累计进入人次、策略结束（按时间筛选范围统计）。
   - 节点级指标：进入节点人次、出节点人次；每日进入/出趋势（双柱+轴说明）。
   - 分支视图：对人群分流、事件分流、AB 实验节点展示各分支出人数（按百分比或出边权重）。
5. 工具栏与扩展
   - 保持现有布局；集成统计面板开关与快速布局/小地图/预览图等。

## 非功能性需求
- 兼容性：现代浏览器（Chromium 系）。
- 性能：在 100+ 节点下保持可用；操作流畅，统计查询常量时间合成。
- 可维护性：模块清晰，节点样式与配置分层。
- 安全性：本地开发不含敏感秘钥；生产部署禁止日志泄露。

## 数据与接口
- 本地开发使用 `RuntimeStatsMock` 与 `TaskStorage`（localStorage）模拟运行态数据与任务存储。
- 画布数据结构：
  - `nodes`: `{ id, type, x, y, label, config, isConfigured }`
  - `connections`: `{ source, target, sourcePort?, targetPort?, branchId? }`

## 版本历史与变更日志
- v1.0.0（2025-11-26）
  - 初版 PRD；统计面板重构为底部固定面板，支持分支统计与时间筛选。
  - 查看模式禁止删除连线（右键菜单/端口菜单/键盘删除）。
  - 趋势图加入双柱与轴说明；KPI 文案统一（累计进入人次/策略结束）。

