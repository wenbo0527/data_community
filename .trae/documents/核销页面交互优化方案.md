# 交互设计与功能优化方案

## 交互设计分析
针对核销流程，从用户体验角度分析如下：

### 1. 进度感知（Total / Remaining）
- **现状**：仅展示“待核销金额”，用户无法感知“总共多少”、“已完成多少”，缺乏全局进度感。
- **优化**：采用 **“总额 / 剩余”** 的对比展示格式（例如 `¥10,000 / ¥2,000`）。
  - **优势**：直观展示任务总量与当前进度，辅助用户判断工作量。
  - **视觉**：建议对“剩余金额”使用不同颜色（如橙色表示未完，绿色表示完成），增强视觉引导。

### 2. 操作连贯性（Input Persistence）
- **现状**：用户点击“执行”后，如果输入框清空，对于需要分批核销（如：金额较大需拆分到多个合同，或余额不足需多次操作）的场景，增加了重复输入的负担。
- **优化**：**保留输入框金额**。
  - **场景支持**：
    - **分批核销**：用户想将 1000 元分两笔 500 元核销，点击一次后，只需再次点击即可，无需重填。
    - **微调修正**：如果因余额不足失败，用户只需在原有数字上微调（如 500 改为 400），比重填更高效。
  - **防错机制**：为防止误触导致重复核销，当“待核销金额”归零时，必须**禁用**输入框和执行按钮，并给予明确的完成状态提示。

### 3. 反馈机制
- **执行反馈**：点击执行后，除了金额变化，应给予轻量级提示（Toast：核销成功），确认操作已被系统接收。

---

## 实施方案

### 1. 修改数据加载逻辑 (`WriteoffPanel.vue`)
- 在 `loadPending` 方法中，除了获取 `pending` 数据，还需要通过 `flowStore.getReconcile` 获取原始的核算/对账数据。
- 将原始总额 (`finalAmount`) 和 原始减免量 (`finalDiscount`) 注入到 `productRows` 中。

### 2. 优化界面展示 (`WriteoffPanel.vue`)
- 修改表格列模板：
  - **待核销总费用**列：改为展示 `{{ formatAmount(total) }} / {{ formatAmount(pending) }}`。
  - **待核销减免量**列：改为展示 `{{ totalDiscount }} / {{ pendingDiscount }}`。
- 增加颜色区分：剩余金额 > 0 时显示为橙色，等于 0 时显示为绿色或灰色。

### 3. 完善执行交互 (`WriteoffPanel.vue`)
- **保留输入**：确认 `confirmWriteoff` 方法中不执行清空操作（当前代码已符合，需确保无副作用）。
- **状态禁用**：在模板中增加逻辑，当 `record.pendingAmount <= 0` 时，禁用对应行的输入框和“执行”按钮，防止溢出核销。

## 验证计划
1.  加载页面，确认表格列显示为“总数/剩余”格式。
2.  输入金额执行核销，确认输入框内容**未被清空**。
3.  确认剩余金额减少，总额不变。
4.  当剩余金额减为 0 时，确认输入框和按钮自动变灰（禁用）。