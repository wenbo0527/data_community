# 数据社区平台 - 开发指南与规范

## 1. 开发环境配置

### 1.1 环境要求
- Node.js: 18.0.0+
- pnpm: 8.0.0+
- Git: 2.30.0+
- VS Code: 最新版本

### 1.2 开发工具配置
```json
// .vscode/settings.json
{
  "editor.formatOnSave": true,
  "editor.codeActionsOnSave": {
    "source.fixAll.eslint": true
  },
  "typescript.preferences.importModuleSpecifier": "shortest",
  "vue.inlayHints.missingProps": true,
  "vue.inlayHints.inlineHandlerLeading": true
}
```

### 1.3 推荐插件
- Vue Language Features (Volar)
- TypeScript Vue Plugin (Volar)
- ESLint
- Prettier
- Auto Rename Tag
- Bracket Pair Colorizer
- GitLens

## 2. 项目初始化

### 2.1 安装依赖
```bash
# 安装pnpm（如果未安装）
npm install -g pnpm

# 安装项目依赖
pnpm install

# 启动开发服务器
pnpm dev
```

### 2.2 环境变量配置
```bash
# 复制环境变量模板
cp .env.example .env.development

# 修改环境变量
VITE_API_BASE_URL=http://localhost:3000/api
VITE_APP_TITLE=数据社区平台
VITE_MOCK_ENABLED=true
```

## 3. 开发规范

### 3.1 Vue组件开发规范

#### 3.1.1 组件结构
```vue
<template>
  <!-- 模板部分 -->
  <div class="component-name">
    <!-- 组件内容 -->
  </div>
</template>

<script setup lang="ts">
// 类型导入
import type { ComponentProps } from './types'

// Vue导入
import { ref, computed, watch, onMounted } from 'vue'

// 组件导入
import BaseTable from '@/components/common/BaseTable.vue'

// 工具函数导入
import { formatDate, debounce } from '@/utils'

// 类型定义
interface Props {
  title: string
  data: Array<Record<string, any>>
  loading?: boolean
}

// Props定义
const props = withDefaults(defineProps<Props>(), {
  loading: false
})

// Emits定义
const emit = defineEmits<{
  submit: [data: any]
  cancel: []
}>()

// 响应式数据
const tableData = ref([])
const searchKeyword = ref('')

// 计算属性
const filteredData = computed(() => {
  if (!searchKeyword.value) return props.data
  return props.data.filter(item => 
    item.name.includes(searchKeyword.value)
  )
})

// 方法定义
const handleSubmit = () => {
  emit('submit', tableData.value)
}

// 生命周期
onMounted(() => {
  loadData()
})

// 异步方法
const loadData = async () => {
  try {
    const data = await fetchData()
    tableData.value = data
  } catch (error) {
    console.error('加载数据失败:', error)
  }
}
</script>

<style scoped>
.component-name {
  /* 组件样式 */
}
</style>
```

#### 3.1.2 组件命名规范
- **文件名**: PascalCase，如 `UserProfile.vue`
- **组件名**: PascalCase，与文件名保持一致
- **Props名**: camelCase，如 `userName`
- **事件名**: camelCase，如 `userSelect`
- **CSS类名**: kebab-case，如 `user-profile`

### 3.2 TypeScript使用规范

#### 3.2.1 接口定义
```typescript
// types/user.ts
export interface User {
  id: string
  name: string
  email: string
  role: UserRole
  department: string
  createdAt: Date
  updatedAt: Date
}

export type UserRole = 'admin' | 'user' | 'guest'

export interface UserQueryParams {
  keyword?: string
  role?: UserRole
  department?: string
  page: number
  size: number
}

export interface UserListResponse {
  list: User[]
  total: number
  page: number
  size: number
}
```

#### 3.2.2 枚举定义
```typescript
// enums/index.ts
export enum AssetType {
  TABLE = 'table',
  API = 'api',
  METRIC = 'metric',
  VARIABLE = 'variable'
}

export enum AssetStatus {
  ACTIVE = 'active',
  INACTIVE = 'inactive',
  DEPRECATED = 'deprecated'
}
```

### 3.3 组合式函数规范

#### 3.3.1 自定义组合式函数
```typescript
// composables/useUser.ts
import { ref, computed } from 'vue'
import type { User } from '@/types'

export function useUser() {
  const user = ref<User | null>(null)
  const isLoading = ref(false)
  const error = ref<string | null>(null)

  const isLoggedIn = computed(() => !!user.value)
  const userRole = computed(() => user.value?.role)

  const fetchUser = async (id: string) => {
    isLoading.value = true
    error.value = null
    
    try {
      const data = await getUserAPI(id)
      user.value = data
    } catch (err) {
      error.value = err.message
      console.error('获取用户信息失败:', err)
    } finally {
      isLoading.value = false
    }
  }

  const updateUser = async (updates: Partial<User>) => {
    if (!user.value) return
    
    try {
      const updated = await updateUserAPI(user.value.id, updates)
      user.value = { ...user.value, ...updated }
    } catch (err) {
      error.value = err.message
      throw err
    }
  }

  return {
    user: readonly(user),
    isLoading: readonly(isLoading),
    error: readonly(error),
    isLoggedIn,
    userRole,
    fetchUser,
    updateUser
  }
}
```

#### 3.3.2 使用组合式函数
```vue
<script setup>
import { useUser } from '@/composables/useUser'

const { user, isLoading, fetchUser } = useUser()

// 在组件中使用
onMounted(() => {
  fetchUser('user123')
})
</script>
```

## 4. 组件开发最佳实践

### 4.1 通用组件设计

#### 4.1.1 BaseTable组件
```vue
<template>
  <div class="base-table">
    <a-table
      :columns="columns"
      :data="data"
      :loading="loading"
      :pagination="paginationConfig"
      @page-change="handlePageChange"
      @selection-change="handleSelectionChange"
    >
      <template #columns>
        <a-table-column
          v-for="column in columns"
          :key="column.dataIndex"
          :title="column.title"
          :data-index="column.dataIndex"
          :width="column.width"
          :sortable="column.sortable"
        >
          <template #cell="{ record }">
            <slot 
              :name="`cell-${column.dataIndex}`" 
              :record="record"
              :value="record[column.dataIndex]"
            >
              {{ formatCellValue(record[column.dataIndex], column) }}
            </slot>
          </template>
        </a-table-column>
      </template>
    </a-table>
  </div>
</template>

<script setup lang="ts">
import type { TableColumn, TablePaginationConfig } from '@arco-design/web-vue'

interface Props {
  columns: TableColumn[]
  data: any[]
  loading?: boolean
  pagination?: Partial<TablePaginationConfig>
}

const props = withDefaults(defineProps<Props>(), {
  loading: false,
  pagination: () => ({})
})

const emit = defineEmits<{
  pageChange: [page: number]
  selectionChange: [selection: any[]]
}>()

const paginationConfig = computed(() => ({
  total: props.data.length,
  current: 1,
  pageSize: 10,
  showTotal: true,
  showJumper: true,
  showPageSize: true,
  ...props.pagination
}))

const formatCellValue = (value: any, column: TableColumn) => {
  if (column.formatter && typeof column.formatter === 'function') {
    return column.formatter(value)
  }
  return value
}

const handlePageChange = (page: number) => {
  emit('pageChange', page)
}

const handleSelectionChange = (selection: any[]) => {
  emit('selectionChange', selection)
}
</script>
```

#### 4.1.2 BaseForm组件
```vue
<template>
  <a-form
    ref="formRef"
    :model="formModel"
    :rules="rules"
    :layout="layout"
    :label-col="labelCol"
    :wrapper-col="wrapperCol"
    @submit="handleSubmit"
  >
    <slot :form="formModel" :rules="rules" />
    
    <a-form-item v-if="showActions">
      <a-space>
        <a-button 
          type="primary" 
          html-type="submit"
          :loading="submitLoading"
        >
          {{ submitText }}
        </a-button>
        <a-button @click="handleReset">
          {{ resetText }}
        </a-button>
        <a-button @click="handleCancel">
          {{ cancelText }}
        </a-button>
      </a-space>
    </a-form-item>
  </a-form>
</template>

<script setup lang="ts">
import type { FormInstance, FormProps } from '@arco-design/web-vue'

interface Props {
  model: Record<string, any>
  rules?: Record<string, any[]>
  layout?: FormProps['layout']
  labelCol?: FormProps['labelCol']
  wrapperCol?: FormProps['wrapperCol']
  showActions?: boolean
  submitText?: string
  resetText?: string
  cancelText?: string
  submitLoading?: boolean
}

const props = withDefaults(defineProps<Props>(), {
  layout: 'horizontal',
  showActions: true,
  submitText: '提交',
  resetText: '重置',
  cancelText: '取消',
  submitLoading: false
})

const emit = defineEmits<{
  submit: [data: any]
  reset: []
  cancel: []
}>()

const formRef = ref<FormInstance>()
const formModel = ref({ ...props.model })

const handleSubmit = async ({ errors, values }) => {
  if (errors) return
  
  try {
    emit('submit', values)
  } catch (error) {
    console.error('表单提交失败:', error)
  }
}

const handleReset = () => {
  formRef.value?.resetFields()
  emit('reset')
}

const handleCancel = () => {
  emit('cancel')
}

const validate = () => {
  return formRef.value?.validate()
}

const clearValidate = () => {
  formRef.value?.clearValidate()
}

defineExpose({
  validate,
  clearValidate,
  resetFields: handleReset
})
</script>
```

### 4.2 业务组件开发

#### 4.2.1 用户选择组件
```vue
<template>
  <div class="user-selector">
    <a-select
      v-model="selectedUserId"
      :placeholder="placeholder"
      :loading="loading"
      :disabled="disabled"
      allow-search
      @search="handleSearch"
    >
      <a-option
        v-for="user in userOptions"
        :key="user.id"
        :value="user.id"
        :label="formatUserLabel(user)"
      >
        <div class="user-option">
          <a-avatar :size="24">{{ user.name[0] }}</a-avatar>
          <div class="user-info">
            <div class="user-name">{{ user.name }}</div>
            <div class="user-dept">{{ user.department }}</div>
          </div>
        </div>
      </a-option>
    </a-select>
  </div>
</template>

<script setup lang="ts">
import type { User } from '@/types'

interface Props {
  modelValue?: string
  placeholder?: string
  disabled?: boolean
  department?: string
  role?: string
}

const props = withDefaults(defineProps<Props>(), {
  placeholder: '请选择用户'
})

const emit = defineEmits<{
  'update:modelValue': [value: string]
  'change': [user: User | undefined]
}>()

const selectedUserId = computed({
  get: () => props.modelValue,
  set: (value) => {
    emit('update:modelValue', value)
    const user = userOptions.value.find(u => u.id === value)
    emit('change', user)
  }
})

const loading = ref(false)
const userOptions = ref<User[]>([])
const searchKeyword = ref('')

const formatUserLabel = (user: User) => {
  return `${user.name} (${user.department})`
}

const handleSearch = async (keyword: string) => {
  searchKeyword.value = keyword
  await loadUsers()
}

const loadUsers = async () => {
  loading.value = true
  
  try {
    const params = {
      keyword: searchKeyword.value,
      department: props.department,
      role: props.role,
      page: 1,
      size: 50
    }
    
    const response = await getUserListAPI(params)
    userOptions.value = response.list
  } catch (error) {
    console.error('加载用户列表失败:', error)
  } finally {
    loading.value = false
  }
}

onMounted(() => {
  loadUsers()
})
</script>
```

## 5. 状态管理最佳实践

### 5.1 Store模块设计

#### 5.1.1 用户Store
```typescript
// store/modules/user.ts
import type { User, UserRole } from '@/types'

interface UserState {
  userInfo: User | null
  token: string | null
  permissions: string[]
  roles: UserRole[]
}

const state: UserState = {
  userInfo: null,
  token: localStorage.getItem('token'),
  permissions: [],
  roles: []
}

const getters = {
  isLoggedIn: (state: UserState) => !!state.token && !!state.userInfo,
  hasPermission: (state: UserState) => (permission: string) => {
    return state.permissions.includes(permission)
  },
  hasRole: (state: UserState) => (role: UserRole) => {
    return state.roles.includes(role)
  }
}

const mutations = {
  SET_USER_INFO(state: UserState, userInfo: User) {
    state.userInfo = userInfo
  },
  
  SET_TOKEN(state: UserState, token: string) {
    state.token = token
    if (token) {
      localStorage.setItem('token', token)
    } else {
      localStorage.removeItem('token')
    }
  },
  
  SET_PERMISSIONS(state: UserState, permissions: string[]) {
    state.permissions = permissions
  },
  
  SET_ROLES(state: UserState, roles: UserRole[]) {
    state.roles = roles
  },
  
  CLEAR_USER(state: UserState) {
    state.userInfo = null
    state.token = null
    state.permissions = []
    state.roles = []
    localStorage.removeItem('token')
  }
}

const actions = {
  async login({ commit }, credentials: LoginCredentials) {
    try {
      const response = await loginAPI(credentials)
      
      commit('SET_TOKEN', response.token)
      commit('SET_USER_INFO', response.userInfo)
      commit('SET_PERMISSIONS', response.permissions)
      commit('SET_ROLES', response.roles)
      
      return response
    } catch (error) {
      commit('CLEAR_USER')
      throw error
    }
  },
  
  async logout({ commit }) {
    try {
      await logoutAPI()
    } finally {
      commit('CLEAR_USER')
      router.push('/login')
    }
  },
  
  async getUserInfo({ commit, state }) {
    if (!state.token) return
    
    try {
      const response = await getUserInfoAPI()
      commit('SET_USER_INFO', response.userInfo)
      commit('SET_PERMISSIONS', response.permissions)
      commit('SET_ROLES', response.roles)
      
      return response
    } catch (error) {
      commit('CLEAR_USER')
      throw error
    }
  }
}

export default {
  namespaced: true,
  state,
  getters,
  mutations,
  actions
}
```

### 5.2 状态管理使用

#### 5.2.1 在组件中使用Store
```vue
<script setup>
import { useStore } from 'vuex'
import { computed } from 'vue'

const store = useStore()

// 使用计算属性获取状态
const userInfo = computed(() => store.state.user.userInfo)
const isLoggedIn = computed(() => store.getters['user/isLoggedIn'])

// 使用actions
const handleLogout = async () => {
  await store.dispatch('user/logout')
}

// 检查权限
const hasEditPermission = computed(() => 
  store.getters['user/hasPermission']('asset:edit')
)
</script>
```

## 6. 路由管理最佳实践

### 6.1 路由配置

#### 6.1.1 路由守卫
```typescript
// router/guards.ts
import type { Router } from 'vue-router'
import { useUserStore } from '@/store'

export function setupRouterGuards(router: Router) {
  // 全局前置守卫
  router.beforeEach(async (to, from, next) => {
    const userStore = useUserStore()
    
    // 设置页面标题
    if (to.meta?.title) {
      document.title = `${to.meta.title} - 数据社区平台`
    }
    
    // 白名单路由
    if (to.meta?.requiresAuth === false) {
      next()
      return
    }
    
    // 检查登录状态
    if (!userStore.isLoggedIn) {
      next({
        path: '/login',
        query: { redirect: to.fullPath }
      })
      return
    }
    
    // 检查权限
    if (to.meta?.requiredPermission) {
      const hasPermission = userStore.hasPermission(to.meta.requiredPermission)
      if (!hasPermission) {
        next({ path: '/403' })
        return
      }
    }
    
    next()
  })
  
  // 全局后置守卫
  router.afterEach((to, from) => {
    // 页面访问统计
    console.log(`导航: ${from.path} -> ${to.path}`)
    
    // 滚动到顶部
    window.scrollTo(0, 0)
  })
  
  // 错误处理
  router.onError((error) => {
    console.error('路由错误:', error)
    // 可以在这里发送错误到监控系统
  })
}
```

#### 6.1.2 路由配置
```typescript
// router/modules/discovery.ts
import type { RouteRecordRaw } from 'vue-router'

const discoveryRoutes: RouteRecordRaw[] = [
  {
    path: '/discovery',
    name: 'Discovery',
    redirect: '/discovery/asset-overview',
    meta: {
      title: '数据发现',
      icon: 'icon-search',
      requiresAuth: true
    },
    children: [
      {
        path: 'asset-overview',
        name: 'AssetOverview',
        component: () => import('@/pages/discovery/asset-overview/index.vue'),
        meta: {
          title: '资产总览',
          breadcrumb: ['数据发现', '资产总览']
        }
      },
      {
        path: 'customer360',
        name: 'Customer360',
        component: () => import('@/pages/discovery/customer360/index.vue'),
        meta: {
          title: '客户360',
          breadcrumb: ['数据发现', '客户360']
        }
      },
      {
        path: 'customer360/detail/:userId',
        name: 'Customer360Detail',
        component: () => import('@/pages/discovery/customer360/detail.vue'),
        meta: {
          title: '客户360详情',
          breadcrumb: ['数据发现', '客户360', '详情'],
          hidden: true
        },
        props: true,
        beforeEnter: (to) => {
          // 参数验证
          if (!to.params.userId || !/^\d+$/.test(to.params.userId as string)) {
            return '/discovery/customer360'
          }
        }
      }
    ]
  }
]

export default discoveryRoutes
```

## 7. API接口规范

### 7.1 接口封装

#### 7.1.1 基础请求配置
```typescript
// api/request.ts
import axios, { type AxiosInstance, type AxiosRequestConfig, type AxiosResponse } from 'axios'
import { useUserStore } from '@/store'
import { Message } from '@arco-design/web-vue'

class Request {
  private instance: AxiosInstance
  
  constructor() {
    this.instance = axios.create({
      baseURL: import.meta.env.VITE_API_BASE_URL,
      timeout: 30000,
      headers: {
        'Content-Type': 'application/json'
      }
    })
    
    this.setupInterceptors()
  }
  
  private setupInterceptors() {
    // 请求拦截器
    this.instance.interceptors.request.use(
      (config) => {
        const userStore = useUserStore()
        
        // 添加token
        if (userStore.token) {
          config.headers.Authorization = `Bearer ${userStore.token}`
        }
        
        // 添加请求时间戳
        config.params = {
          ...config.params,
          _t: Date.now()
        }
        
        return config
      },
      (error) => {
        return Promise.reject(error)
      }
    )
    
    // 响应拦截器
    this.instance.interceptors.response.use(
      (response: AxiosResponse<ApiResponse>) => {
        const { data } = response
        
        if (data.code === 0) {
          return data.data
        } else {
          Message.error(data.message || '请求失败')
          return Promise.reject(new Error(data.message))
        }
      },
      (error) => {
        this.handleError(error)
        return Promise.reject(error)
      }
    )
  }
  
  private handleError(error: any) {
    if (error.response) {
      const { status, data } = error.response
      
      switch (status) {
        case 401:
          // 未授权
          const userStore = useUserStore()
          userStore.logout()
          break
        case 403:
          Message.error('没有权限访问')
          break
        case 404:
          Message.error('请求的资源不存在')
          break
        case 500:
          Message.error('服务器内部错误')
          break
        default:
          Message.error(data?.message || '请求失败')
      }
    } else if (error.request) {
      Message.error('网络连接失败')
    } else {
      Message.error('请求配置错误')
    }
  }
  
  public get<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.get(url, config)
  }
  
  public post<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.post(url, data, config)
  }
  
  public put<T = any>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.put(url, data, config)
  }
  
  public delete<T = any>(url: string, config?: AxiosRequestConfig): Promise<T> {
    return this.instance.delete(url, config)
  }
}

export const request = new Request()
```

#### 7.1.2 API接口定义
```typescript
// api/user.ts
import { request } from './request'
import type { User, UserQueryParams, UserListResponse } from '@/types'

export const userAPI = {
  // 获取用户列表
  getUserList: (params: UserQueryParams) => {
    return request.get<UserListResponse>('/users', { params })
  },
  
  // 获取用户详情
  getUserDetail: (id: string) => {
    return request.get<User>(`/users/${id}`)
  },
  
  // 创建用户
  createUser: (data: Partial<User>) => {
    return request.post<User>('/users', data)
  },
  
  // 更新用户
  updateUser: (id: string, data: Partial<User>) => {
    return request.put<User>(`/users/${id}`, data)
  },
  
  // 删除用户
  deleteUser: (id: string) => {
    return request.delete(`/users/${id}`)
  },
  
  // 批量删除用户
  batchDeleteUsers: (ids: string[]) => {
    return request.post('/users/batch-delete', { ids })
  }
}
```

## 8. 错误处理规范

### 8.1 错误类型定义
```typescript
// types/error.ts
export class AppError extends Error {
  code: string
  details?: any
  
  constructor(message: string, code: string, details?: any) {
    super(message)
    this.name = 'AppError'
    this.code = code
    this.details = details
  }
}

export class ValidationError extends AppError {
  constructor(message: string, details?: any) {
    super(message, 'VALIDATION_ERROR', details)
    this.name = 'ValidationError'
  }
}

export class PermissionError extends AppError {
  constructor(message: string = '没有权限执行此操作') {
    super(message, 'PERMISSION_ERROR')
    this.name = 'PermissionError'
  }
}

export class NetworkError extends AppError {
  constructor(message: string = '网络连接失败') {
    super(message, 'NETWORK_ERROR')
    this.name = 'NetworkError'
  }
}
```

### 8.2 错误处理示例
```typescript
// composables/useErrorHandler.ts
import { Message } from '@arco-design/web-vue'
import type { AppError } from '@/types'

export function useErrorHandler() {
  const handleError = (error: Error | AppError) => {
    console.error('错误详情:', error)
    
    if (error instanceof AppError) {
      switch (error.code) {
        case 'VALIDATION_ERROR':
          Message.error(`验证失败: ${error.message}`)
          break
        case 'PERMISSION_ERROR':
          Message.error('没有权限执行此操作')
          break
        case 'NETWORK_ERROR':
          Message.error('网络连接失败，请检查网络')
          break
        default:
          Message.error(error.message || '操作失败')
      }
    } else {
      Message.error('系统错误，请联系管理员')
    }
    
    // 可以在这里添加错误上报逻辑
    reportError(error)
  }
  
  const reportError = (error: Error) => {
    // 发送到错误监控系统
    console.error('上报错误:', error)
  }
  
  return { handleError }
}
```

## 9. 测试规范

### 9.1 单元测试

#### 9.1.1 组件测试
```typescript
// components/__tests__/BaseTable.test.ts
import { describe, it, expect, vi } from 'vitest'
import { mount } from '@vue/test-utils'
import BaseTable from '../BaseTable.vue'

describe('BaseTable', () => {
  const mockColumns = [
    { title: '姓名', dataIndex: 'name' },
    { title: '年龄', dataIndex: 'age' }
  ]
  
  const mockData = [
    { name: '张三', age: 25 },
    { name: '李四', age: 30 }
  ]
  
  it('应该正确渲染表格', () => {
    const wrapper = mount(BaseTable, {
      props: {
        columns: mockColumns,
        data: mockData
      }
    })
    
    expect(wrapper.find('.base-table')).toBeTruthy()
    expect(wrapper.find('table')).toBeTruthy()
  })
  
  it('应该正确渲染数据', () => {
    const wrapper = mount(BaseTable, {
      props: {
        columns: mockColumns,
        data: mockData
      }
    })
    
    const rows = wrapper.findAll('tbody tr')
    expect(rows).toHaveLength(2)
    expect(rows[0].text()).toContain('张三')
    expect(rows[0].text()).toContain('25')
  })
  
  it('应该触发分页事件', async () => {
    const onPageChange = vi.fn()
    
    const wrapper = mount(BaseTable, {
      props: {
        columns: mockColumns,
        data: mockData,
        pagination: { total: 100, current: 1, pageSize: 10 },
        onPageChange
      }
    })
    
    // 模拟分页点击
    await wrapper.find('.arco-pagination-item-next').trigger('click')
    
    expect(onPageChange).toHaveBeenCalledWith(2)
  })
})
```

#### 9.1.2 工具函数测试
```typescript
// utils/__tests__/formatters.test.ts
import { describe, it, expect } from 'vitest'
import { formatDate, formatBytes } from '../formatters'

describe('formatters', () => {
  describe('formatDate', () => {
    it('应该正确格式化日期', () => {
      const date = new Date('2024-01-15 14:30:00')
      expect(formatDate(date)).toBe('2024-01-15 14:30')
    })
    
    it('应该处理时间戳', () => {
      const timestamp = 1705321800000 // 2024-01-15 14:30:00
      expect(formatDate(timestamp)).toBe('2024-01-15 14:30')
    })
    
    it('应该处理字符串日期', () => {
      expect(formatDate('2024-01-15')).toBe('2024-01-15')
    })
  })
  
  describe('formatBytes', () => {
    it('应该正确格式化字节', () => {
      expect(formatBytes(0)).toBe('0 B')
      expect(formatBytes(1024)).toBe('1 KB')
      expect(formatBytes(1048576)).toBe('1 MB')
      expect(formatBytes(1073741824)).toBe('1 GB')
    })
    
    it('应该处理小数', () => {
      expect(formatBytes(1536)).toBe('1.5 KB')
      expect(formatBytes(2621440)).toBe('2.5 MB')
    })
  })
})
```

### 9.2 端到端测试

#### 9.2.1 E2E测试示例
```typescript
// e2e/login.spec.ts
import { test, expect } from '@playwright/test'

test.describe('登录功能', () => {
  test.beforeEach(async ({ page }) => {
    await page.goto('/login')
  })
  
  test('应该显示登录表单', async ({ page }) => {
    await expect(page.locator('input[type="text"]')).toBeVisible()
    await expect(page.locator('input[type="password"]')).toBeVisible()
    await expect(page.locator('button[type="submit"]')).toBeVisible()
  })
  
  test('应该成功登录', async ({ page }) => {
    await page.fill('input[type="text"]', 'admin')
    await page.fill('input[type="password"]', 'password')
    await page.click('button[type="submit"]')
    
    // 等待页面跳转
    await page.waitForURL('/home')
    
    // 验证登录成功
    await expect(page).toHaveURL('/home')
    await expect(page.locator('.user-info')).toContainText('admin')
  })
  
  test('应该显示登录错误', async ({ page }) => {
    await page.fill('input[type="text"]', 'invalid')
    await page.fill('input[type="password"]', 'wrong')
    await page.click('button[type="submit"]')
    
    // 等待错误提示
    await expect(page.locator('.arco-message')).toContainText('用户名或密码错误')
  })
})
```

## 10. 性能优化指南

### 10.1 组件性能优化

#### 10.1.1 使用v-memo优化列表渲染
```vue
<template>
  <div class="user-list">
    <div 
      v-for="user in users" 
      :key="user.id"
      v-memo="[user.name, user.status]"
      class="user-item"
    >
      {{ user.name }} - {{ user.status }}
    </div>
  </div>
</template>
```

#### 10.1.2 使用computed缓存计算结果
```vue
<script setup>
import { computed } from 'vue'

const props = defineProps({
  users: Array,
  filter: String,
  sortBy: String
})

// 缓存过滤和排序结果
const processedUsers = computed(() => {
  let result = [...props.users]
  
  // 过滤
  if (props.filter) {
    result = result.filter(user => 
      user.name.includes(props.filter)
    )
  }
  
  // 排序
  if (props.sortBy) {
    result.sort((a, b) => {
      if (props.sortBy === 'name') {
        return a.name.localeCompare(b.name)
      }
      return 0
    })
  }
  
  return result
})
</script>
```

### 10.2 路由懒加载
```typescript
// 路由配置使用动态导入
const routes = [
  {
    path: '/heavy-page',
    component: () => import('@/pages/HeavyPage.vue')
  }
]

// 异步组件
import { defineAsyncComponent } from 'vue'

const HeavyComponent = defineAsyncComponent(() => 
  import('@/components/HeavyComponent.vue')
)
```

### 10.3 虚拟滚动优化大数据列表
```vue
<template>
  <virtual-list
    :data="largeDataList"
    :height="400"
    :item-height="32"
    :buffer="10"
  >
    <template #item="{ item, index }">
      <div class="list-item" :key="item.id">
        {{ item.name }}
      </div>
    </template>
  </virtual-list>
</template>

<script setup>
import { VirtualList } from '@arco-design/web-vue'

const largeDataList = ref([])
</script>
```

这个开发指南涵盖了从环境配置到性能优化的完整开发流程，为团队提供了统一的标准和最佳实践。开发者可以按照这些规范进行开发，确保代码质量和项目的一致性。