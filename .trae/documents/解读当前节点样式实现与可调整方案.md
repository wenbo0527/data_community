# 营销画布节点样式设计与实现文档

## 1. 产品概述

本文档定义了营销画布系统中节点的视觉样式、交互行为和数据结构规范。基于 AntV X6 图形引擎构建，采用 Vue 3 + TypeScript 技术栈，确保节点在不同类型和状态下的一致性和可扩展性。

## 2. 节点样式规范

### 2.1 整体布局结构

每个节点采用卡片式设计，包含以下区域：
- **标题区**（高度 36px）：节点类型图标、名称、操作菜单
- **内容区**（动态高度）：配置信息展示，每行 32px
- **端口区**：左侧输入端口，右侧输出端口（根据类型动态生成）

### 2.2 标题区设计

**视觉元素：**
- 背景色：`#F8FAFC`（浅灰背景）
- 边框：`1px solid #E5E7EB`
- 圆角：顶部 8px，与主体保持一致的 8px 圆角

**组成元素：**
```
┌─────────────────────────────────────┐
│ [图标] 节点名称              [···] │ ← 更多菜单（3个点）
└─────────────────────────────────────┘
```

**具体规范：**
- **类型图标块**：28×20px，背景色 `#14B8A6`，圆角 6px
- **类型缩写**：图标内居中显示，取 `nodeType` 前2个字符大写，字体 12px，白色
- **节点标题**：48px 左边距，13px 字体，粗体（600），颜色 `#111827`
- **更多菜单**：3个圆点，每个 3×3px，颜色 `#6B7280`，仅非 start/end 节点显示

**代码位置：**
- 创建：`src/pages/marketing/tasks/horizontal/index.vue:258-261`
- 更新：`src/pages/marketing/tasks/horizontal/index.vue:431-434`

### 2.3 内容区设计

**布局规则：**
- 行高：32px
- 起始位置：`contentStartY = headerHeight (36px) + contentPadding (12px) = 48px`
- 文本对齐：左对齐，`x=16px`，`textAnchor='start'`
- 基线调整：行中点基础上 +5px，确保视觉居中

**视觉样式：**
- 字体大小：13px
- 字体颜色：`#111827`（深灰）
- 行间距：通过 32px 行高自然形成

### 2.4 节点尺寸规范

**基础尺寸：**
- 宽度：固定 280px
- 最小高度：96px（包含标题区和至少一行内容）
- 动态高度计算公式：`headerHeight (36) + contentPadding (12) + rows.length × rowHeight (32) + 底部间距 (12)`

**不同类型节点的高度示例：**
- 开始节点（2行内容）：`36 + 12 + 2×32 + 12 = 124px`
- 分流节点（4行内容）：`36 + 12 + 4×32 + 12 = 188px`
- 简单节点（1行内容）：`36 + 12 + 1×32 + 12 = 92px`（使用最小高度 96px）

### 2.5 颜色主题

**节点类型与颜色映射：**
| 节点类型 | 颜色值 | 语义说明 |
|---------|--------|----------|
| start | `#5F95FF` | 蓝色，表示流程开始 |
| crowd-split / audience-split | `#FF6A6A` | 红色，人群相关 |
| event-split | `#69C0FF` | 天蓝色，事件相关 |
| ab-test | `#DDA0DD` | 紫色，实验性质 |
| sms | `#45B7D1` | 青色，消息触达 |
| email | `#52C41A` | 绿色，邮件相关 |
| wechat | `#1890FF` | 深蓝色，微信生态 |
| ai-call | `#96CEB4` | 浅绿色，AI智能 |
| manual-call | `#FFEAA7` | 黄色，人工操作 |
| wait | `#A8A8A8` | 灰色，等待状态 |
| benefit | `#FFD700` | 金黄色，权益奖励 |
| end | `#8C8C8C` | 深灰色，流程结束 |
| task | `#722ED1` | 深紫色，任务节点 |

**颜色应用规则：**
- 标题区图标背景使用类型主色
- 端口颜色使用统一的 `#4C78FF`
- 节点边框使用 `#D1D5DB`（浅灰）
- 节点主体背景使用 `#FFFFFF`（白色）

## 3. 组件与图标系统

### 3.1 核心组件

**CanvasController（画布控制器）**
- 位置：`src/pages/marketing/tasks/horizontal/services/CanvasController.js`
- 职责：协调事件服务、节点管理和画布状态
- 依赖：EventService、节点配置系统

**EventService（事件服务）**
- 位置：`src/pages/marketing/tasks/horizontal/services/EventService.js`
- 职责：处理节点交互、连接管理、配置抽屉触发
- 核心功能：节点点击、连接删除、节点插入、菜单操作

**NodeConfigDrawer（节点配置抽屉）**
- 位置：`src/pages/marketing/tasks/components/canvas/NodeConfigDrawer.vue`
- 职责：提供节点配置界面
- 特性：动态表单、类型特定配置、实时预览

**NodeTypeSelector（节点类型选择器）**
- 位置：`src/pages/marketing/tasks/components/canvas/NodeTypeSelector.vue`
- 职责：节点创建时的类型选择
- 特性：图标展示、拖拽支持、权限控制

### 3.2 图标系统

**类型图标生成规则：**
```javascript
const iconText = (nodeType || '').slice(0, 2).toUpperCase() || 'IF'
```

**各类型图标文本：**
| 节点类型 | 图标文本 | 说明 |
|---------|---------|------|
| start | ST | Start |
| crowd-split | CS | Crowd Split |
| event-split | ES | Event Split |
| ab-test | AB | AB Test |
| sms | SM | Short Message |
| email | EM | Email |
| wechat | WC | WeChat |
| ai-call | AI | AI Call |
| manual-call | MC | Manual Call |
| wait | WA | Wait |
| benefit | BE | Benefit |
| end | EN | End |
| task | TA | Task |

**图标样式：**
- 字体：12px，白色，居中显示
- 背景：类型主色，6px 圆角
- 位置：标题区左侧，12px 左边距，8px 上边距

## 4. 数据格式定义

### 4.1 节点基础数据结构

```typescript
interface NodeData {
  id: string
  type: string // 节点类型
  nodeType?: string // 兼容字段，优先使用 type
  config: NodeConfig // 节点配置
  isConfigured?: boolean // 是否已配置
  position?: { x: number, y: number }
  size?: { width: number, height: number }
}

interface NodeConfig {
  nodeName?: string // 自定义节点名称
  description?: string // 节点描述
  
  // 类型特定配置
  taskType?: string // 开始节点：任务类型
  targetAudience?: string[] // 开始节点：目标人群
  
  crowdLayers?: Array<{crowdName: string}> // 人群分流
  branches?: Array<{name: string, percentage?: number}> // 分流/AB测试
  variants?: Array<{name: string, percentage: number}> // AB测试变体
  versions?: Array<{name: string, ratio?: number}> // 兼容字段
  
  yesLabel?: string // 事件分流：确认标签
  timeout?: number // 事件分流：超时时间
  
  taskId?: string // AI外呼：任务ID
  smsTemplate?: string // 短信：模板内容
  configId?: string // 人工外呼：配置ID
  
  value?: number // 等待节点：数值
  unit?: string // 等待节点：单位
  
  benefitName?: string // 权益节点：权益名称
}
```

### 4.2 端口数据结构

```typescript
interface PortConfig {
  groups: {
    in: PortGroupConfig  // 输入端口
    out: PortGroupConfig // 输出端口
  }
  items: Array<PortItem>
}

interface PortGroupConfig {
  position: 'left' | 'right'
  attrs: {
    circle: {
      r: number      // 半径：4px
      magnet: boolean // 是否可连接：true
      stroke: string  // 边框颜色：#4C78FF
      strokeWidth: number // 边框宽度：1.5px
      fill: string    // 填充颜色：#FFFFFF（输入）或 #4C78FF（输出）
    }
  }
}

interface PortItem {
  id: string           // 端口ID：'in' 或 'out-{index}'
  group: 'in' | 'out'
  args?: {
    dy: number        // 垂直偏移，用于精确对齐
  }
}
```

### 4.3 兼容性考虑

**向后兼容：**
1. 支持 `nodeType` 和 `type` 两种字段名，优先使用 `type`
2. 保留 `crowd-split` 作为 `audience-split` 的别名
3. 支持 `branches`、`variants`、`versions` 多种变体配置格式
4. 兼容旧版数据中的 `splitCount` 字段

**数据迁移策略：**
```javascript
// 节点类型标准化
const normalizedType = node.type || node.nodeType || 'unknown'

// 变体数据统一处理
const mergedVariants = branches.length ? branches : 
                    (variants.length ? variants : versions)

// 分流配置兼容
const crowdConfig = crowdLayers || 
                   (splitCount ? generateDefaultBranches(splitCount) : 
                    (branches || []))
```

## 5. 节点类型映射与配置

### 5.1 节点类型定义

**核心类型配置**（位置：`src/utils/nodeTypes.js`）：

```javascript
const nodeTypes = {
  'start': {
    label: '开始',
    color: '#5F95FF',
    shape: 'circle',
    width: 100,
    height: 100,
    maxOutputs: 1,
    autoExpand: true
  },
  'audience-split': { // 标准名称
    label: '人群分流',
    color: '#FF6A6A',
    shape: 'circle',
    width: 100,
    height: 100,
    maxOutputs: 'dynamic', // 动态端口
    autoExpand: true
  },
  'crowd-split': { // 兼容名称
    label: '人群分流',
    color: '#FF6A6A',
    shape: 'circle',
    width: 100,
    height: 100,
    maxOutputs: 'dynamic',
    autoExpand: true
  }
  // ... 其他类型
}
```

### 5.2 动态端口生成规则

**分流类型节点：**
- 人群分流（audience-split/crowd-split）：根据 `crowdLayers` 或 `branches` 长度
- 事件分流（event-split）：固定 2 个端口（是/否）
- AB测试（ab-test）：根据 `variants` 或 `versions` 长度

**非分流类型节点：**
- 固定 1 个输出端口
- 输入端口始终为 1 个（除开始节点）

**端口位置计算：**
```javascript
// 垂直偏移计算
const verticalOffsets = isSplit
  ? rows.map((_, i) => headerHeight + contentPadding + i * rowHeight + Math.floor(rowHeight / 2))
  : [contentCenter]

// 端口对齐
const dy = lineCenter(i) - nodeHeight/2  // 输出端口
const dyIn = contentCenter - nodeHeight/2  // 输入端口
```

## 6. 端口与连接规则

### 6.1 连接约束

**方向限制：**
- 只允许 `out → in` 方向连接
- 目标节点必须在源节点右侧（横向布局）

**唯一性约束：**
- 同一个 `out` 端口只能有一条连接
- 同一个 `in` 端口只能有一条连接
- 开始节点没有输入端口
- 结束节点没有输出端口

### 6.2 端口对齐规则

**分流类型节点：**
- 每个输出行对应一个 `out-{index}` 端口
- 端口垂直位置对齐到对应行的中点
- 输入端口对齐到整个内容区的垂直中心

**非分流类型节点：**
- 单个 `out` 端口，对齐到内容区垂直中心
- 单个 `in` 端口，对齐到内容区垂直中心

**端口工厂配置：**
```javascript
// 位置：src/pages/marketing/tasks/horizontal/utils/portConfigFactoryHorizontal.js
createHorizontalPortConfig(outCount, {
  verticalOffsets,     // 垂直偏移数组
  nodeHeight,         // 节点总高度
  inVerticalOffset    // 输入端口垂直偏移
})
```

## 7. 交互行为

### 7.1 节点交互

**点击事件：**
- 左键点击：打开节点配置抽屉
- 右键点击：显示上下文菜单（复制、删除等）
- 入口：`useConfigDrawers.openConfigDrawer(type, node, data)`

**拖拽行为：**
- 支持节点拖拽移动
- 拖拽时端口和连接实时更新
- 网格吸附：8px 网格单位

**悬停效果：**
- 鼠标悬停时显示连接点（+号）
- 悬停时节点边框高亮
- 工具提示显示节点详细信息

### 7.2 连接交互

**创建连接：**
- 从输出端口拖拽到输入端口
- 自动验证连接合法性
- 支持连接过程中的视觉反馈

**删除连接：**
- 右键点击连接线：删除连接
- 选中后按 Delete 键：删除连接
- 拖拽回源端口：取消连接

**插入节点：**
- 连接线上悬停显示 + 号按钮
- 点击后在连接中点插入新节点
- 自动拆分原连接，保持流程连续性

### 7.3 菜单系统

**更多菜单（三点）：**
- 显示条件：非 start/end 节点
- 菜单位置：标题区右上角
- 菜单项：重命名、复制、删除
- 触发方式：点击三点图标

**节点选择器：**
- 触发方式：拖拽到画布、点击 + 号
- 展示形式：网格布局，2列显示
- 过滤机制：根据预设位权限过滤可用类型

## 8. 更新流程

### 8.1 配置更新流程

**触发链：**
```
配置抽屉保存 → 事件触发 → 节点更新 → 视觉刷新
```

**详细步骤：**
1. **抽屉确认**：`useConfigDrawers` 触发 `node:config-updated` 事件
2. **事件监听**：`updateNodeFromConfig` 函数接收更新事件
3. **数据重算**：
   - 重新计算显示行：`buildDisplayLines(nodeType, config)`
   - 重新计算节点尺寸：基于新的行数
   - 重新生成端口配置：基于新的内容布局
4. **视觉更新**：
   - 移除旧端口配置
   - 设置新的 markup 和 attrs
   - 应用新的尺寸和位置
   - 刷新节点渲染

**代码位置：**
- 事件触发：`src/pages/marketing/tasks/composables/canvas/useConfigDrawers.js:229-235`
- 更新处理：`src/pages/marketing/tasks/horizontal/index.vue:403-454`

### 8.2 实时预览机制

**配置预览：**
- 抽屉中配置变更时，实时更新节点预览
- 预览节点与真实节点样式保持一致
- 取消配置时恢复原始状态

**验证反馈：**
- 配置合法性实时验证
- 错误提示即时显示
- 保存按钮状态根据验证结果更新

## 9. 发布校验

### 9.1 校验规则

**连接完整性：**
- 所有输出端口必须有连接（除 end 节点）
- 孤立节点检测和提示
- 循环依赖检测和阻止

**配置完整性：**
- 必填字段验证
- 数据格式验证
- 业务规则验证（如百分比总和为100%）

**返回格式：**
```javascript
{
  valid: boolean,          // 是否通过验证
  errors: Array<{         // 错误列表
    nodeId: string,       // 问题节点ID
    portId: string,       // 问题端口ID
    message: string       // 错误描述
  }>
}
```

### 9.2 校验时机

**实时校验：**
- 连接创建/删除时
- 配置变更时
- 节点删除时

**发布前校验：**
- 点击发布按钮时触发完整校验
- 阻止发布并显示错误清单
- 提供快速定位到问题节点的功能

## 10. 测试与验收标准

### 10.1 视觉一致性测试

**标题区验证：**
- ✓ 图标与类型正确对应
- ✓ 标题文本基线对齐（y=22）
- ✓ 更多菜单显示逻辑正确（start/end 隐藏）
- ✓ 颜色主题与类型匹配

**内容区验证：**
- ✓ 文本左对齐，x=16px
- ✓ 行高中度 32px，基线调整 +5px
- ✓ 多行内容时间距正确
- ✓ 空状态处理恰当

### 10.2 交互功能测试

**节点操作：**
- ✓ 点击打开正确类型的配置抽屉
- ✓ 拖拽移动流畅，网格吸附准确
- ✓ 右键菜单功能完整
- ✓ 悬停效果及时响应

**连接操作：**
- ✓ 连接创建符合方向约束
- ✓ 端口对齐精确（误差 < 1px）
- ✓ 连接删除多种方式可用
- ✓ 节点插入自动拆分连接

### 10.3 数据兼容性测试

**历史数据兼容：**
- ✓ crowd-split 映射到 audience-split
- ✓ nodeType 和 type 字段兼容处理
- ✓ 多种变体配置格式支持
- ✓ 旧版 splitCount 配置识别

**配置更新测试：**
- ✓ 配置变更实时反映到节点显示
- ✓ 取消配置恢复原始状态
- ✓ 复杂配置（多层分流）正确渲染
- ✓ 边界情况处理（空数组、null值）

### 10.4 性能基准

**渲染性能：**
- 单节点创建：≤ 50ms
- 批量更新（10个节点）：≤ 200ms
- 复杂节点（10行内容）：≤ 100ms

**内存使用：**
- 单个节点内存占用：≤ 10KB
- 事件监听器正确清理
- 无内存泄漏风险

## 11. 扩展性考虑

### 11.1 新节点类型支持

**添加步骤：**
1. 在 `nodeTypes.js` 中定义类型配置
2. 在 `buildDisplayLines` 中添加数据映射逻辑
3. 更新节点类型选择器配置
4. 添加相应的配置抽屉组件

**配置模板：**
```javascript
'new-type': {
  label: '新类型',
  color: '#新颜色',
  shape: 'circle',
  width: 100,
  height: 100,
  maxOutputs: 1, // 或 'dynamic'
  autoExpand: true,
  nextSlots: [...]
}
```

### 11.2 主题系统预留

**颜色变量化：**
- 所有颜色值可通过配置覆盖
- 支持深色/浅色主题切换
- CSS 自定义属性支持

**尺寸响应式：**
- 基础尺寸可通过配置调整
- 支持不同屏幕密度的适配
- 字体大小层级可配置

### 11.3 插件化架构

**事件系统扩展：**
- 支持自定义事件监听
- 插件可注册新的交互行为
- 配置验证规则可扩展

**渲染器替换：**
- markup 生成逻辑可覆盖
- 支持自定义节点形状
- 动画效果可插拔

## 关键代码索引

**核心实现文件：**
- 节点创建与渲染：`src/pages/marketing/tasks/horizontal/index.vue:228-275`
- 节点更新与刷新：`src/pages/marketing/tasks/horizontal/index.vue:403-454`
- 数据映射逻辑：`src/pages/marketing/tasks/horizontal/index.vue:335-391`
- 端口配置工厂：`src/pages/marketing/tasks/horizontal/utils/portConfigFactoryHorizontal.js`
- 事件交互处理：`src/pages/marketing/tasks/horizontal/services/EventService.js`
- 节点类型定义：`src/utils/nodeTypes.js`
- 配置抽屉系统：`src/pages/marketing/tasks/composables/canvas/useConfigDrawers.js`

**工具函数：**
- 节点标签获取：`getNodeLabel()` in `src/utils/nodeTypes.js`
- 节点配置获取：`getNodeConfig()` in `src/utils/nodeTypes.js`
- 端口配置生成：`createHorizontalPortConfig()` in port factory
- 显示行构建：`buildDisplayLines()` in horizontal index.vue

**组件文件：**
- 节点配置抽屉：`src/pages/marketing/tasks/components/canvas/NodeConfigDrawer.vue`
- 节点类型选择器：`src/pages/marketing/tasks/components/canvas/NodeTypeSelector.vue`
- 画布控制器：`src/pages/marketing/tasks/horizontal/services/CanvasController.js`

**节点样式规范**

* 标题区
  * 组成：`header`（背景）、`header-icon`（类型图标块）、`header-icon-text`（类型缩写）、`header-title`（标题文本）、`menu-icons`（更多三点；非 start/end 显示）
  * 对齐：`header-title.y = header-icon-text.y`（建议 `22`）；图标块宽度 `20–24px`；标题左边距 `48`；行内对齐同基线
  * 标题文本取值：`config.nodeName || 类型标签`；开始/结束节点不显示“更多”
  * 参考位置
    * 创建：`src/pages/marketing/tasks/horizontal/index.vue:258-261`
    * 更新：`src/pages/marketing/tasks/horizontal/index.vue:431-434`

* 内容区（list）
  * 行布局：行高 `rowHeight=32`；起始 `contentStartY = headerHeight + contentPadding(=12)`；文本左对齐 `x=16`；`textAnchor='start'`
  * 文本基线：绘制在行中点基础上微调 `baselineAdjust=5`，保持视觉居中
  * 参考位置
    * 创建：`src/pages/marketing/tasks/horizontal/index.vue:265-272`
    * 更新：`src/pages/marketing/tasks/horizontal/index.vue:438-445`

**数据映射规则（buildDisplayLines）**

* start
  * 行：`任务类型：{taskType}`、`目标人群：{targetAudience.join('、')}`
* crowd-split
  * 行：`命中：{crowdName}`×N（兼容 `crowdLayers/branches/splitCount`）；尾行固定：`否则：{unmatchBranch.name}`
* event-split
  * 行：`命中：{yesLabel}`、`等待 {timeout} 分钟未命中`
* ab-test
  * 行：`{branch.name}：{percentage|ratio}%`×N（兼容 `branches/variants/versions`）
* ai-call
  * 行：`触达任务ID：{taskId}`
* sms
  * 行：`短信模板：{smsTemplate}`
* manual-call
  * 行：`配置ID：{configId}`（可选 `description` 作为附加行）
* wait
  * 行：`等待：{value} {unit}`
* benefit
  * 行：`权益包名称：{benefitName}`
* end
  * 不展示内容，不挂端口
* 参考位置：`src/pages/marketing/tasks/horizontal/index.vue:335-391`

**端口与连接规则**

* 规则
  * 方向限制：仅允许 `out → in`，目标在右侧
  * 唯一性：同一 `out` 端口仅一条连接；同一 `in` 端口仅一条连接
* 数量与对齐
  * 分流类型：每行一个 `out-i`，对齐到该行中点
  * 非分流类型：仅一个 `out`，对齐到内容区中心
  * 入端口：对齐到内容区中心（不包含标题），与 `out` 对齐保持同一区域
* 端口工厂参数
  * `createHorizontalPortConfig(outCount, { verticalOffsets, nodeHeight, inVerticalOffset })`
  * 出端口对齐：`dy = lineCenter(i) - nodeHeight/2`
  * 入端口对齐：`dyIn = contentCenter - nodeHeight/2`
* 参考位置
  * 工厂：`src/pages/marketing/tasks/horizontal/utils/portConfigFactoryHorizontal.js:20-35`
  * 创建传入：`src/pages/marketing/tasks/horizontal/index.vue:240-243`
  * 更新传入：`src/pages/marketing/tasks/horizontal/index.vue:413-416`

**交互行为**

* 点击节点打开抽屉：统一入口 `useConfigDrawers.openConfigDrawer(type, node, data)`
  * 位置：`src/pages/marketing/tasks/horizontal/services/EventService.js:70`
* 更多菜单（三点）
  * 仅非 start/end 显示；点击弹出重命名、复制、删除；位置固定在标题右上
* 右键连接线删除
  * 位置：`src/pages/marketing/tasks/horizontal/services/EventService.js:50`
* 插入节点（连接线上“+”）
  * 悬停显示工具，点击在中点插入并拆分原边；随后保持端口与行的一致性
  * 位置：`src/pages/marketing/tasks/horizontal/services/EventService.js:15-42`

**更新流程（抽屉确认 → 刷新）**

* 抽屉确认
  * useConfigDrawers 触发 `graph.trigger('node:config-updated',{ node, nodeType, config })`
  * 位置：`src/pages/marketing/tasks/composables/canvas/useConfigDrawers.js:229-235`
* 节点刷新
  * 监听 `node:config-updated` → `updateNodeFromConfig(node, nodeType, config)`
  * 刷新策略
    * 重算行：`buildDisplayLines(nodeType, config)`
    * 重算尺寸：`height = headerHeight + contentPadding + rows.length*rowHeight + 12`
    * 重算端口：移除旧端口 + 设置分组 + 新增 `in/out-i`（基于居中偏移 `dy`）+ 写回 `isConfigured/config`
    * 刷新渲染：`node.resize/setMarkup/setAttrs`；默认 `label` 隐藏
  * 位置：`src/pages/marketing/tasks/horizontal/index.vue:403-454`

**发布校验**

* 规则：所有 `out` 端口必须存在连接；阻止发布并返回 `{ nodeId, portId }` 问题清单
* 位置：`src/pages/marketing/tasks/horizontal/index.vue:527`（已有实现引用）

**测试与验收**

* 分流类
  * 修改分支（增/减）：行数与 `out-i` 数量与位置同步刷新；每行右侧端口垂直居中对齐
* 非分流类
  * 始终一个 `out`；内容变更后端口位置基于内容区中心；行文本左对齐且完整包裹
* 标题区
  * 标题与图标基线一致；开始/结束不显示更多图标
* 交互
  * 点击节点打开抽屉；右键连接删除；连接线上“+”插入生效

**关键代码索引**

* 创建节点渲染与端口：`src/pages/marketing/tasks/horizontal/index.vue:228-275`
* 更新节点刷新与端口重建：`src/pages/marketing/tasks/horizontal/index.vue:403-454`
* 端口工厂（横向对齐）：`src/pages/marketing/tasks/horizontal/utils/portConfigFactoryHorizontal.js:1-35`
* 内容映射：`src/pages/marketing/tasks/horizontal/index.vue:335-391`
* 事件与交互：`src/pages/marketing/tasks/horizontal/services/EventService.js:1-73`
* 抽屉系统触发：`src/pages/marketing/tasks/composables/canvas/useConfigDrawers.js:229-235`

如果你确认以上内容结构与细节，我将把它写入并覆盖更新到 `/.trae/documents/解读当前节点样式实现与可调整方案.md`，以便团队后续统一参考。
