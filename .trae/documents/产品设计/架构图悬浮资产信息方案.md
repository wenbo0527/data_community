# 社区架构图：鼠标悬浮资产信息动效方案（完整版）

## 背景与目标
- 将现有静态架构图升级为轻交互版本，仅在鼠标悬浮时展示资产信息，并配以轻量动效以增强可感知性。
- 优先信息表达与易读性，动效服务理解，不增加操作复杂度，不改变现有导航与页面结构。

## 范围与不做事项
- 范围：热点命中、模块高亮、Tooltip 信息展示、轻动效、无障碍、性能与降级方案。
- 不做：点击联动、上下游联动过滤、右键菜单、粒子流、场景切换、拖拽编辑与持久化。

## 体验原则
- 时机与节制：仅在有效命中时展示，避免频繁闪烁；同屏仅显示一个 Tooltip。
- 一致性：颜色、发光、阴影与品牌主色统一（建议 #165DFF）；动效时长统一规范。
- 清晰层级：模块高亮与信息面板分层，避免遮挡核心区域；鼠标移出延迟消失 120ms，降低抖动。
- 可达与可退：键盘可聚焦并触发显示；任何情况下可通过移出或 Esc 关闭。
- 尊重偏好：检测 prefers-reduced-motion，自动切换为无动画的静态信息展示。

## 交互说明
- 命中区域：热点节点略大于视觉模块边界 6–10px 提升命中容错。
- 展示触发：mouse enter 延迟 80–120ms 后显示，mouse leave 延迟 120ms 后隐藏，包含 50ms 防抖。
- 跟随策略：Tooltip 以模块为锚点，视窗边缘自动换方向；在大图缩放时始终贴合模块中心。
- 退出规则：移出模块与 Tooltip 均触发隐藏；Esc 键立即关闭；切换到其他模块时进行交叉淡出。

## 信息结构（Tooltip）
- 标题行：资产名称、健康状态徽标。
- 指标行：吞吐量、延迟、错误率；单位与小数位统一。
- 元信息：负责人、最近更新时间；标签或所属域可选。
- 行为：轻量操作不提供；如后续需要，可加入“查看详情”入口。

## 动效规范
- 模块高亮：边框描边由 0→1.5px，颜色由中性灰→品牌蓝；发光半径 2→6px，时长 300–400ms，缓动 cubic-bezier(0.2, 0.8, 0.2, 1)。
- Tooltip 出现：opacity 0→1 与 scale 0.98→1.0 同步，时长 160–200ms，缓动 ease-out；消失反向 120–160ms。
- 移动补偿：在连续移动中仅更新位置，不重复播放出现动画；最小位移阈值 6px。
- 降级模式：在 prefers-reduced-motion 下禁用发光与缩放，仅使用不透明度切换或直接静态显示。

## 数据字典
- asset：id、name、type、owner、health（ok/warn/error）、throughput（qps/mbps）、latency（ms）、errorRate（%）、lastUpdate、desc、tags。
- health 映射：ok=品牌蓝或绿；warn=琥珀；error=红；与 Arco Design 颜色体系一致。
- 指标格式：统一单位与阈值，错误率展示两位小数；延迟四舍五入到整数或 0.1ms。

## 坐标与布局
- 坐标系：以图容器为原点（左上），像素坐标记录 x、y、width、height；背景图按等比缩放。
- 对齐方法：定义背景图原始尺寸与显示尺寸，提供 scale=显示/原始，用节点原始坐标×scale 得到显示坐标。
- 边缘适配：当 Tooltip 超出容器边缘时自动换方向并向内偏移 12–16px。

## 技术实现
- 技术栈：Vue 3（Composition API）+ Vite；AntV X6 叠加交互图层；Arco Design Tooltip；Vuex 状态管理；Vue Router 保持现状。
- 图层结构：
  - 背景层：沿用现有图片。
  - 交互层：X6 Graph 节点覆盖在模块上，透明填充，悬浮时高亮。
- 事件绑定：node:mouseenter / node:mouseleave 控制高亮与 Tooltip；容器监听滚动与缩放进行位置重算。
- 动效实现：仅操作 transform 与 opacity；滤镜发光适度，避免昂贵重绘；统一由 Web Animations API 或 CSS 动画驱动。
- 性能优化：
  - 防抖与节流：mousemove 50ms 防抖；批量位置更新合并到 requestAnimationFrame。
  - 复用：Tooltip 容器复用单实例，内容与位置更新；减少 DOM 创建销毁。
  - 渲染层：尽量启用合成层（will-change: transform, opacity）。
- 降级与开关：提供全局开关禁用动效；在低性能设备自动降粒度（仅描边高亮，无发光）。

## 无障碍
- 节点可聚焦（tabindex=0）、role=button、aria-label 包含资产名称与健康状态。
- 键盘支持：Enter 显示 Tooltip、Esc 隐藏、方向键在可聚焦节点间移动。
- 对比度：描边与文字符合 WCAG AA；发光不替代对比度，而为辅助层次。

## 测试与验收
- 命中测试：全部模块均可稳定命中，命中容错有效；悬浮与移出无抖动。
- 信息准确：资产字段完整；单位与格式一致；边缘换向正确。
- 性能：常见设备与浏览器保持流畅，平均帧率接近 60fps；内存与事件无泄漏。
- 降级：在 prefers-reduced-motion 下功能完整、无动画；键盘与读屏正常。

## 交付计划
- W1 方案冻结：模块清单与坐标标注、动效 token、数据字典。
- W2 基础实现：X6 图层与热点、Tooltip 展示、基本高亮与边缘换向。
- W3 优化与联调：性能与无障碍完善、容器缩放适配、指标格式校准。
- W4 测试与发布：跨浏览器与设备测试、缺陷修复与上线。

## 风险与对策
- 坐标偏差：建立原始尺寸与 scale 的明确映射表，并在容器尺寸变更时统一重算。
- 遮挡冲突：Tooltip 动态换向与偏移，必要时沿边线对齐；限定最大宽度与自动换行。
- 抖动与闪烁：引入进入/退出延迟与防抖阈值；在高频移动时仅更新位置不重播动画。
- 性能瓶颈：合成层优化与 rAF 合并；在低性能设备禁用发光。

## 配置清单（动效与样式 token）
- colors：primary=#165DFF、border=#1D2129、warn=#F7BA1E、error=#F53F3F。
- durations：highlight=300–400ms、tooltipIn=160–200ms、tooltipOut=120–160ms。
- easing：highlight=cubic-bezier(0.2, 0.8, 0.2, 1)、tooltip=ease-out。
- spacing：tooltipPadding=12–16px、hitExpand=6–10px。
- accessibility：tabIndex=0、aria-label 模板="名称｜健康｜吞吐/延迟｜更新时间"。

## 后续扩展（非本期）
- 粒子式数据流、场景切换、异常态脉冲与链路断续动画、点击跳转与右键菜单、布局持久化。

