# 供应商管理统一入口方案总结

## 核心定位

**外数档案管理模块作为供应商信息的唯一管理入口和维护源头**，承担供应商全生命周期信息的统一管理职责。

## 统一管理原则

### 1. 供应商信息统一管理
- **外数档案模块**：供应商基础信息、评估信息、定价档案的唯一维护入口
- **结算系统**：仅引用外数档案中的供应商字典和定价档案，只读操作
- **预算管理模块**：引用外数档案供应商信息进行合同管理和分析，只读操作
- **数据发现模块**：引用外数档案供应商信息进行产品展示，只读操作

### 2. 数据一致性保障
- **事件通知机制**：供应商信息变更时，外数档案模块主动通知所有引用系统
- **历史版本保持**：历史结算任务保持当时的供应商信息和定价快照
- **实时同步更新**：当前有效任务和预算分析使用最新的供应商信息

### 3. 任务分拆机制
- **按供应商维度分拆**：结算任务按照供应商维度自动分拆为独立任务
- **独立执行跟踪**：每个供应商的结算任务独立执行、独立状态跟踪
- **批量操作支持**：支持多供应商批量发起结算，系统自动分拆处理

## 具体实现方案

### 外数档案模块职责
1. **供应商基础信息管理**
   - 公司信息、资质证书、统一社会信用代码
   - 联系人管理（商务、技术、客服多个角色）
   - 合作历史、信用评级（A-E五级）
   - 服务能力、服务级别协议（SLA）
   - 供应商状态（合作中、暂停、终止、黑名单）

2. **供应商评估信息管理**
   - 服务质量评分（稳定性、准确性、及时性，1-5分制）
   - 合作满意度（季度更新）
   - 问题处理效率（SLA达成率）
   - 价格竞争力（市场价格对比）
   - 创新能力评估

3. **定价档案管理**
   - 价格体系（基础价格、阶梯价格、优惠策略）
   - 计费模式（按次、按量、包年、包月）
   - 价格有效期管理（生效时间、失效时间）
   - 价格变更历史（版本管理）

### 结算系统引用机制
1. **供应商字典引用**
   - 通过API从外数档案模块获取可用供应商列表
   - 只读引用，不支持在结算页面新增或编辑供应商
   - 选择供应商后自动加载对应的有效合同和定价档案

2. **定价档案引用**
   - 自动带入外数档案中的当前有效定价档案
   - 基于引用价格进行预算与实际消耗的差异分析
   - 历史定价版本保持不变，确保结算数据一致性

3. **任务分拆执行**
   - 支持多供应商批量结算发起
   - 系统按供应商维度自动分拆为独立任务
   - 每个供应商任务独立执行、独立状态跟踪

### 预算管理模块引用机制
1. **供应商分析引用**
   - 合同管理中的供应商信息来源于外数档案模块
   - 供应商维度统计分析基于外数档案的统一供应商字典
   - 合同到期提醒基于外数档案的供应商状态

2. **合同管理引用**
   - 合同中的供应商信息必须来源于外数档案供应商字典
   - 不支持在预算管理模块新增或修改供应商信息
   - 供应商状态变更时通过事件通知同步更新

## API接口设计

### 外数档案模块提供API
```typescript
// 获取供应商字典列表（供引用系统使用）
GET /api/supplier/dictionary?status=active&page=1&pageSize=50

// 获取供应商定价档案
GET /api/supplier/pricing/{supplierId}?effectiveDate=2025-01-01

// 获取供应商合同列表
GET /api/supplier/{supplierId}/contracts

// 供应商信息变更通知（内部事件通知）
POST /api/supplier/notify-change
{
  supplierId: string,
  changeType: 'info' | 'pricing' | 'status',
  affectedModules: string[]
}
```

### 结算系统使用API
```typescript
// 发起结算时引用供应商信息
POST /api/settlements/tasks
{
  suppliers: [{supplierId, contractIds}], // 引用外数档案供应商
  pricingProfiles: [{supplierId, pricingId}], // 引用外数档案定价
  granularity: 'monthly' | 'quarterly' | 'yearly',
  settlementPeriod: '2025-Q1'
}
```

## 数据流转机制

### 1. 供应商信息维护流程
```
外数档案管理员 → 外数档案模块维护供应商信息 → 事件通知所有引用系统 → 各系统同步更新
```

### 2. 结算任务创建流程
```
采购人员 → 结算系统发起结算 → 引用外数档案供应商字典 → 按供应商分拆任务 → 独立执行
```

### 3. 供应商信息变更同步流程
```
外数档案模块更新供应商信息 → 事件通知结算系统 → 结算系统更新引用数据 → 保持数据一致性
```

## 权限控制

### 角色权限矩阵
| 角色 | 外数档案模块 | 结算系统 | 预算管理系统 |
|------|------------|----------|------------|
| 外数档案管理员 | 供应商信息全权限 | 查看权限 | 查看权限 |
| 采购人员 | 查看权限 | 结算任务全权限 | 预算管理全权限 |
| 结算专员 | 查看权限 | 结算任务全权限 | 查看权限 |
| 业务用户 | 查看权限 | 查看权限 | 查看权限 |

### 数据隔离原则
- **部门隔离**：不同部门的供应商信息相互隔离
- **角色隔离**：根据角色权限展示不同的供应商信息范围
- **状态隔离**：黑名单供应商对业务用户不可见

## 实施计划

### 第一阶段（1-2周）
- 外数档案模块供应商管理功能完善
- 供应商字典API接口开发
- 事件通知机制实现

### 第二阶段（2-3周）
- 结算系统供应商引用功能改造
- 任务按供应商分拆功能实现
- 定价档案引用机制实现

### 第三阶段（1-2周）
- 预算管理系统供应商引用改造
- 数据一致性验证
- 权限控制完善

### 第四阶段（1周）
- 集成测试
- 数据迁移
- 用户培训

## 成功指标

### 数据一致性指标
- 供应商信息一致性：100%
- 定价档案准确性：100%
- 结算任务分拆正确率：100%

### 操作效率指标
- 供应商信息维护效率提升：50%
- 结算任务创建效率提升：30%
- 数据一致性检查时间减少：80%

### 用户满意度指标
- 供应商管理操作满意度：>4.5分（5分制）
- 结算系统引用体验满意度：>4.3分（5分制）
- 跨模块数据一致性满意度：>4.4分（5分制）

## 风险控制

### 技术风险
- **API性能风险**：供应商信息查询API需优化性能，支持高并发
- **数据同步风险**：建立完善的异常处理机制，确保同步失败可恢复
- **版本兼容风险**：API版本管理，确保向后兼容

### 业务风险
- **操作习惯改变**：需要充分的用户培训和操作指导
- **数据迁移风险**：制定详细的数据迁移方案，确保数据完整性
- **权限控制风险**：严格的权限测试，防止数据越权访问

### 应对措施
- 建立完善的监控告警机制
- 制定详细的应急预案
- 定期进行数据一致性检查
- 建立用户反馈收集和处理机制