# 外数档案模块详细产品设计文档（更新版）

## 重要定位调整

### 核心定位变更
外数档案模块不再是元数据重复展示，而是作为**外部数据生命周期管理的功能中枢**，承担以下核心职责：
- 非元数据信息补充和完善
- 供应商关系维护（供应商信息统一管理中心）
- 跨模块业务串联
- 生命周期变更发起
- 效果评估和技术信息索引

### 供应商管理统一入口声明
**核心原则**：外数档案管理模块是供应商信息的唯一管理入口和维护源头
- **统一管理**：所有供应商基础信息、评估信息、定价档案必须在外数档案模块维护
- **结算引用**：结算系统仅引用外数档案中的供应商字典和定价档案，不进行增删改操作
- **任务分拆**：结算任务按供应商维度自动分拆，每个供应商生成独立的结算任务
- **数据一致性**：供应商信息变更时，通过事件通知机制同步到所有引用系统

### 与现有系统的关系
- **元数据管理入口**：`http://localhost:5174/discovery/asset-management/external-data-management`（负责元数据登记）
- **外数详情查看**：`http://localhost:5174/external-data-v1/list`（负责接口、表结构等技术详情）
- **外数档案**：作为中枢层，串联各模块，提供业务视角的数据资产管理

## 1. 模块核心定位

### 1.1 功能定位
外数档案是外部数据的"业务档案室"，专注于：
- **业务信息补充**：元数据之外的业务属性完善
- **供应商关系管理**：供应商信息维护和评估
- **使用说明管理**：使用指南、最佳实践沉淀
- **效果评估索引**：评估结果聚合和展示
- **技术信息索引**：技术详情跳转入口
- **生命周期管理**：变更发起和状态跟踪

### 1.2 与其他模块的协同关系
```
外数档案（中枢）
    ↓
元数据管理 ← → 外数评估 ← → 预算管理 ← → 数据服务
    ↑           ↑           ↑           ↑
技术详情    评估结果    成本信息    服务状态
```

## 2. 功能架构重新设计

### 2.1 核心功能矩阵（重新定义）

#### 2.1.1 业务信息补充管理
**功能定位**：完善元数据之外的业务属性信息

**详细功能点**：
- **业务属性补充**
  - 业务价值描述（预期收益、业务目标量化）
  - 使用场景细化（具体业务流程描述）
  - 业务影响评估（对核心指标的影响程度）
  - 替代方案说明（可替代数据源说明）
  - 业务风险识别（业务层面的风险点）

- **管理属性补充**
  - 采购信息（合同信息、采购周期、续约提醒）
  - 维护责任（明确维护责任人和职责）
  - 变更记录（业务层面的变更历史）
  - 审批记录（各阶段审批记录归档）
  - 合规状态（合规检查状态和结果）

#### 2.1.2 供应商信息管理（核心归属外数档案管理）
**功能定位**：外数档案管理模块作为供应商信息的唯一管理入口，维护供应商全生命周期信息，结算系统仅引用外数档案中的供应商与定价档案

**详细功能点**：
- **供应商基础信息（外数档案统一管理）**
  - 供应商档案（公司信息、资质证书、统一社会信用代码）
  - 联系人管理（多个联系人角色维护：商务、技术、客服）
  - 合作历史（合作项目历史记录、合同履约情况）
  - 信用评级（基于合作历史的信用评估，A-E五级）
  - 服务能力（数据覆盖范围、更新能力、服务级别协议）
  - 供应商状态（合作中、暂停、终止、黑名单）

- **供应商评估信息（外数档案统一管理）**
  - 服务质量评分（稳定性、准确性、及时性，1-5分制）
  - 合作满意度（内部用户满意度调研，季度更新）
  - 问题处理效率（问题响应和解决时效，SLA达成率）
  - 价格竞争力（市场价格对比分析，性价比评级）
  - 创新能力（新产品、新技术跟进能力评估）

- **供应商关系管理（外数档案统一管理）**
  - 合同管理（合同到期提醒、续约管理、版本控制）
  - 沟通记录（重要沟通内容记录、会议纪要）
  - 争议处理（争议事项和处理结果、赔偿记录）
  - 退出管理（供应商退出流程管理、交接方案）

- **定价档案管理（外数档案统一管理）**
  - 价格体系（基础价格、阶梯价格、优惠策略）
  - 计费模式（按次、按量、包年、包月）
  - 价格有效期（生效时间、失效时间）
  - 价格变更历史（版本管理、变更原因）

- **结算系统引用机制**
  - 结算系统仅引用外数档案中的供应商字典（只读）
  - 结算系统仅引用外数档案中的定价档案（只读）
  - 任务按供应商分拆：每个供应商生成独立的结算任务
  - 供应商信息变更时，结算系统通过API同步更新
  - 定价信息变更时，历史结算任务保持原有价格（不可追溯调整）

#### 2.1.3 使用说明管理
**功能定位**：沉淀和共享数据使用知识

**详细功能点**：
- **使用指南**
  - 快速入门（新用户上手指导）
  - API使用示例（常见调用场景示例）
  - 数据解读指南（字段含义解释）
  - 常见问题（FAQ和解决方案）
  - 最佳实践（高效使用经验分享）

- **案例沉淀**
  - 成功案例（业务应用成功案例分析）
  - 效果对比（使用前后效果对比）
  - 创新应用（创新使用方式收集）
  - 失败教训（失败案例和原因分析）

#### 2.1.4 效果评估索引
**功能定位**：聚合展示多维度评估结果

**详细功能点**：
- **评估结果聚合**
  - 评估指标汇总（从外数评估模块获取）
  - 评估趋势分析（历史评估变化趋势）
  - 评估对比分析（同类数据对比）
  - 评估报告归档（历史评估报告管理）

- **效果跟踪**
  - 业务效果监控（实际业务指标跟踪）
  - ROI计算展示（投入产出比计算）
  - 使用满意度（用户满意度调研结果）
  - 价值实现度（预期价值实现程度）

#### 2.1.5 技术信息索引
**功能定位**：提供技术详情的统一入口

**详细功能点**：
- **技术详情跳转**
  - 接口详情（跳转到external-data-v1/list查看）
  - 数据结构（跳转到元数据管理查看）
  - 技术文档（技术规格说明书链接）
  - 测试报告（数据质量测试报告）

- **技术状态监控**
  - 接口健康状态（API可用性监控）
  - 数据更新状态（数据更新及时性）
  - 技术问题记录（技术问题及处理状态）
  - 性能指标展示（响应时间、吞吐量等）

### 2.2 功能中枢特性

#### 2.2.1 跨模块串联能力
- **评估结果回写**：外数评估结果自动回写到档案
- **预算信息关联**：预算管理中的成本信息关联展示
- **服务状态同步**：数据服务中的服务状态实时同步
- **变更影响分析**：生命周期变更对各模块的影响分析

#### 2.2.2 生命周期变更发起
- **变更类型**
  - 新增数据申请
  - 现有数据变更
  - 数据下线申请
  - 供应商变更
  - 合同续约申请

- **变更流程**
  - 变更申请（填写变更内容和原因）
  - 影响分析（自动分析影响范围）
  - 审批流程（根据变更类型路由审批）
  - 执行跟踪（变更执行状态跟踪）
  - 结果确认（变更结果验证和确认）

## 3. 用户界面重新设计

### 3.1 档案详情页重构

#### 3.1.1 信息架构重新定义
**顶部信息区**（精简核心信息）：
- 数据名称和状态
- 重要级别标识
- 快速操作按钮（编辑、变更申请、评估查看）

**左侧导航区**（模块跳转）：
- 业务概览（当前页面）
- 技术详情（跳转到external-data-v1/list）
- 元数据管理（跳转到discovery/asset-management/external-data-management）
- 效果评估（跳转到外数评估模块）
- 预算信息（跳转到预算管理模块）
- 服务状态（跳转到数据服务模块）

**中央内容区**（业务信息重点）：
- **业务价值卡片**
  - 业务目标描述
  - 预期收益量化
  - 使用场景说明
  - 业务影响评估

- **供应商信息卡片**
  - 供应商基础信息
  - 合作状态展示
  - 评估得分聚合
  - 合同到期提醒

- **使用说明卡片**
  - 快速入门指南
  - 最佳实践推荐
  - 成功案例展示
  - FAQ快速入口

- **效果评估卡片**
  - 最新评估结果
  - 历史趋势图表
  - 同类对比分析
  - ROI计算展示

- **生命周期卡片**
  - 当前状态展示
  - 历史变更记录
  - 待处理事项
  - 变更申请入口

#### 3.1.2 档案列表页优化
**新增功能**：
- **状态快速筛选**：生命周期状态、评估状态、合同状态
- **供应商维度**：按供应商筛选和统计
- **效果排序**：按评估得分、ROI、满意度排序
- **批量变更**：支持批量发起变更申请

### 3.2 新增功能页面

#### 3.2.1 生命周期变更申请页
**表单设计**：
- 变更类型选择（下拉选择）
- 变更内容描述（富文本编辑器）
- 变更原因说明（必填项）
- 影响范围分析（自动分析+人工补充）
- 附件上传（支持相关文档）
- 紧急程度标识（影响审批优先级）

#### 3.2.2 供应商详情页（外数档案统一管理入口）
**信息展示**：
- 供应商基本信息（公司信息、资质证书、统一社会信用代码）
- 合作历史时间线（项目合作、合同签订、评估记录）
- 评估得分雷达图（服务质量、合作满意度、价格竞争力、创新能力）
- 合同信息卡片（当前有效合同、历史合同、到期提醒）
- 定价档案管理（价格体系、计费模式、价格变更历史）
- 问题处理记录（服务质量问题、处理时效、SLA达成情况）
- 沟通历史记录（商务沟通、技术交流、争议处理）

**统一供应商字典入口说明**：
- 此页面为供应商信息的唯一维护入口，所有供应商数据必须在此页面进行增删改操作
- 结算系统通过API只读引用此页面的供应商信息和定价档案
- 供应商状态变更时，系统通过消息通知机制同步到所有引用系统
- 支持供应商信息导出，供结算系统进行离线引用

## 5. 数据模型重新设计

### 5.1 核心实体重新定义

#### 5.1.1 外部数据档案（ExternalDataArchive）- 精简版（含供应商字典来源）
```typescript
interface ExternalDataArchive {
  id: string;                    // 档案ID
  code: string;                  // 档案编码（唯一）
  name: string;                  // 档案名称
  businessValue: BusinessValue;  // 业务价值信息
  supplierInfo: SupplierInfo;  // 供应商信息（来源于外数档案统一供应商字典）
  usageGuidance: UsageGuidance;  // 使用说明
  effectIndex: EffectIndex;      // 效果评估索引
  techIndex: TechIndex;          // 技术信息索引
  lifecycleStatus: LifecycleStatus; // 生命周期状态
  relatedModules: RelatedModules;  // 关联模块信息
  createdAt: Date;                // 创建时间
  updatedAt: Date;                // 更新时间
}
```

**供应商字典来源说明**：
- `supplierInfo` 中的供应商信息必须来源于外数档案模块的统一供应商字典
- 不支持手工输入供应商信息，必须通过选择已维护的供应商
- 供应商信息变更时，档案中的供应商信息可选择性同步更新
- 历史档案保持当时的供应商信息快照（用于追溯和结算一致性）

#### 5.1.2 业务价值信息（BusinessValue）
```typescript
interface BusinessValue {
  businessGoal: string;          // 业务目标
  expectedBenefit: string;       // 预期收益
  useScenario: string;          // 使用场景
  businessImpact: string;       // 业务影响
  alternativeSolution: string;  // 替代方案
  businessRisk: string;          // 业务风险
}
```

#### 5.1.3 供应商信息（SupplierInfo）- 外数档案统一管理
```typescript
interface SupplierInfo {
  supplierId: string;            // 供应商ID（唯一标识）
  supplierName: string;          // 供应商名称
  unifiedCode: string;           // 统一社会信用代码
  contractInfo: ContractInfo;    // 合同信息（当前有效合同）
  contactPersons: ContactPerson[]; // 联系人（商务、技术、客服）
  serviceCapability: string;    // 服务能力描述
  creditRating: number;          // 信用评级（A-E对应1-5分）
  evaluationScore: EvaluationScore; // 评估得分聚合
  supplierStatus: string;       // 供应商状态（合作中/暂停/终止/黑名单）
  pricing档案: PricingProfile[]; // 定价档案（结算系统引用）
  createdAt: Date;              // 创建时间
  updatedAt: Date;                // 更新时间
}

interface PricingProfile {
  pricingId: string;              // 定价档案ID
  serviceType: string;           // 服务类型
  billingModel: string;          // 计费模式（按次/按量/包年/包月）
  basePrice: number;             // 基础价格
  tieredPricing: TieredPrice[];  // 阶梯价格
  validFrom: Date;               // 生效时间
  validTo: Date;                 // 失效时间
  version: number;               // 版本号
  status: string;                // 状态（生效/失效）
}

interface TieredPrice {
  minQuantity: number;           // 最小数量
  maxQuantity: number;           // 最大数量
  unitPrice: number;             // 单价
  discount: number;               // 折扣率
}
```

#### 5.1.4 生命周期状态（LifecycleStatus）
```typescript
interface LifecycleStatus {
  currentStatus: string;         // 当前状态
  statusHistory: StatusHistory[]; // 状态历史
  pendingTasks: PendingTask[];   // 待处理任务
  changeApplications: ChangeApplication[]; // 变更申请
}
```

### 5.2 关联关系重新定义（供应商统一管理）
- 档案与外数评估：1:1（评估结果回写）
- 档案与预算管理：1:N（多个预算周期）
- 档案与数据服务：1:N（多个服务实例）
- 档案与供应商：N:1（多个档案对应一个供应商，供应商信息由外数档案统一管理）
- 档案与变更申请：1:N（一个档案多个变更申请）
- 供应商与结算管理：1:N（一个供应商对应多个结算任务，结算系统只读引用）
- 供应商与定价档案：1:N（一个供应商对应多个定价档案，支持历史版本管理）

**供应商统一管理机制**：
- 外数档案模块是供应商信息的唯一真实来源（Single Source of Truth）
- 结算系统通过API只读引用供应商字典和定价档案
- 供应商信息变更时，通过事件通知机制实时同步到引用系统
- 历史定价版本保持不变，确保结算数据的历史一致性

## 6. 跨模块集成设计

### 6.1 跨模块数据流（供应商管理统一入口）
```
外数档案模块 ← 供应商信息统一维护 ← 供应商字典唯一来源
     ↓
结算管理模块 → 引用供应商字典（只读）→ 任务按供应商分拆
     ↓
外数评估模块 → 评估结果 → 档案效果评估卡片
预算管理模块 → 成本数据 → 档案ROI计算
数据服务模块 → 服务状态 → 档案服务状态
元数据管理模块 → 技术详情 → 档案技术跳转
```

**供应商管理统一入口说明**：
- 外数档案模块是供应商信息的唯一管理入口和维护源头
- 结算系统仅引用外数档案中的供应商字典，不进行供应商信息的增删改操作
- 所有供应商基础信息、评估信息、定价档案必须在外数档案模块维护
- 结算任务按照供应商维度自动分拆，每个供应商生成独立的结算任务

### 6.2 统一跳转协议
定义标准化的URL跳转协议：
- **技术详情**：`/external-data-v1/list?archiveId={id}&tab=detail`
- **元数据管理**：`/discovery/asset-management/external-data-management?archiveId={id}`
- **效果评估**：`/external-data-evaluation/list?archiveId={id}`
- **预算信息**：`/budget-management?archiveId={id}`
- **服务状态**：`/management/service?archiveId={id}`

### 6.3 数据同步机制
- **实时同步**：关键状态变更通过消息队列实时同步
- **定时同步**：评估结果、成本数据通过定时任务同步
- **手动刷新**：支持用户手动刷新关联数据
- **变更通知**：关联数据变更时主动通知档案模块

## 6. 业务流程重新设计

### 6.1 生命周期变更流程
```
变更申请 → 影响分析 → 路由审批 → 执行跟踪 → 结果确认 → 模块通知
```

### 6.2 跨模块业务流程（供应商统一管理）
#### 6.2.1 新增外部数据流程
1. **供应商维护**：在外数档案模块维护供应商信息和定价档案（必须先行）
2. **技术登记**：在元数据管理模块完成技术信息登记
3. **档案创建**：在外数档案模块补充业务信息，选择已维护的供应商
4. **预算申请**：在预算管理模块申请采购预算
5. **效果评估**：在外数评估模块进行接入前评估
6. **服务接入**：在数据服务模块完成服务接入

#### 6.2.2 结算任务创建流程（供应商引用机制）
1. **结算发起**：在结算管理模块发起结算任务
2. **供应商选择**：从外数档案统一供应商字典中选择（只读引用）
3. **定价档案引用**：自动带入外数档案中的当前有效定价档案
4. **任务分拆**：按供应商维度自动分拆结算任务
5. **差异计算**：基于引用价格进行预算与实际消耗的差异分析
6. **结果确认**：结算结果写回预算管理模块，不影响供应商信息

#### 6.2.2 数据下线流程
1. **下线申请**：在外数档案模块发起下线申请
2. **影响分析**：系统自动分析影响的服务和业务
3. **审批流程**：相关部门审批下线申请
4. **服务下线**：在数据服务模块停止服务
5. **预算调整**：在预算管理模块调整预算计划
6. **档案更新**：更新档案状态和相关信息

## 7. 性能与扩展性优化

### 7.1 跨模块查询优化
- **分布式缓存**：跨模块数据缓存机制
- **异步加载**：非关键信息异步加载
- **分页查询**：大数据量分页处理
- **索引优化**：跨模块查询索引设计

### 7.2 高并发处理
- **读写分离**：查询和更新操作分离
- **队列机制**：变更申请队列化处理
- **限流机制**：防止高频变更申请
- **缓存预热**：常用数据预加载

## 8. 安全与合规增强

### 8.1 跨模块权限控制
- **统一权限模型**：基于角色的跨模块权限控制
- **数据隔离**：不同部门数据隔离机制
- **审计统一**：跨模块操作统一审计
- **敏感数据保护**：敏感信息跨模块传递加密

### 8.2 合规要求适配
- **数据流转合规**：跨模块数据流转合规检查
- **审批流程合规**：变更审批流程符合内控要求
- **数据保留策略**：档案数据保留期限管理
- **跨境传输控制**：支持跨境传输合规控制

## 9. 实施计划调整

### 9.1 第一阶段（功能中枢）
- 档案基础信息重构
- 跨模块跳转协议实现
- 供应商信息管理
- 生命周期变更申请

### 9.2 第二阶段（业务串联）
- 效果评估结果聚合
- 预算信息关联展示
- 服务状态实时同步
- 跨模块业务流程打通

### 9.3 第三阶段（智能优化）
- 智能影响分析
- 自动化变更流程
- 预测性维护
- 智能推荐优化

## 10. 成功指标重新定义

### 10.1 模块协同指标
- **跨模块跳转成功率**：> 99%
- **数据同步及时性**：< 1分钟
- **变更流程效率**：平均处理时间 < 3天
- **用户操作便捷性**：操作步骤减少 50%

### 10.2 业务价值指标
- **档案完整性**：业务信息完整度 > 95%
- **供应商管理覆盖率**：供应商信息完整度 > 90%
- **生命周期管理效率**：变更处理效率提升 60%
- **用户满意度**：跨模块操作满意度 > 4.5分

## 11. 数据模型字典与字段说明

### 11.1 核心实体与关键字段
- **ExternalDataArchive**：`id, code, name, businessValue, supplierInfo, lifecycleStatus, relatedModules, createdAt, updatedAt`
- **BusinessValue**：`businessGoal, expectedBenefit, useScenario, businessImpact, alternativeSolution, businessRisk`
- **SupplierInfo**：`supplierId, supplierName, contractInfo, contactPersons[], serviceCapability, creditRating, evaluationScore`
- **LifecycleStatus**：`currentStatus, statusHistory[], pendingTasks[], changeApplications[]`
- **RelatedModules**：`metadataUrl, techDetailUrl, evaluationUrl, budgetUrl, serviceUrl`

### 11.2 字段规范与一致性
- **命名规范**：使用驼峰命名；ID统一为字符串；时间统一ISO 8601
- **枚举统一**：状态、等级、角色等统一枚举字典，避免跨模块歧义
- **扩展字段**：保留`extra: Record<string, any>`用于临时扩展，避免模型污染

## 12. 跨模块跳转协议细化

### 12.1 路由与参数
- **统一参数**：`archiveId`, `from=archive`, `tab`, `version`
- **示例**：
  - 技术详情：`/external-data-v1/list?archiveId={id}&tab=detail&from=archive`
  - 元数据管理：`/discovery/asset-management/external-data-management?archiveId={id}&from=archive`
  - 评估中心：`/external-data-evaluation?archiveId={id}&from=archive`
  - 预算管理：`/external-data-budget-management?archiveId={id}&from=archive`
  - 数据服务：`/external-data-service?archiveId={id}&from=archive`

### 12.2 状态保持与回跳
- **状态保持**：通过`sessionStorage`保持最近一次档案上下文（`archiveId`, `name`, `supplier`）
- **回跳协议**：目标页支持`from=archive`时显示"返回档案"按钮并携带路由
- **失败回退**：目标页不可达时提示并回退至档案详情页

### 12.3 供应商字典API（供结算系统引用）
```typescript
// 获取供应商字典列表（结算系统引用）
GET /api/supplier/dictionary?status=active&page=1&pageSize=50

// 获取供应商定价档案（结算系统引用）
GET /api/supplier/pricing/{supplierId}?effectiveDate=2025-01-01

// 供应商信息变更通知（内部API）
POST /api/supplier/notify-change
{
  supplierId: string,
  changeType: 'info' | 'pricing' | 'status',
  affectedModules: string[]
}
```

**API使用说明**：
- 结算系统通过上述API只读引用供应商信息和定价档案
- 供应商信息变更时，外数档案模块主动通知引用系统
- 定价档案支持历史版本查询，确保结算数据一致性

## 13. 权限与角色矩阵

### 13.1 角色定义
- **管理员**：模型管理、跨模块配置、权限分配
- **档案负责人**：档案编辑、供应商维护、变更发起、评估索引管理
- **业务使用者**：档案查看、使用说明、效果评估查看
- **审计员**：审计日志与变更记录查看
- **访客**：只读访问公开信息

### 13.2 操作矩阵（示例）
- 编辑档案：管理员/负责人
- 发起变更：负责人
- 查看评估与预算：负责人/使用者/审计员（受部门隔离）
- 供应商维护：管理员/负责人
- 导出：管理员/审计员（审批）

## 14. 变更流程状态机

### 14.1 状态流
```
Draft → Submitted → Reviewing → Approved → Executing → Completed → Archived
                         ↘ Rejected
                         ↘ RolledBack
```
- **Draft**：草稿编辑阶段
- **Submitted**：提交待审核
- **Reviewing**：路由审批中（按类型与影响范围）
- **Approved/Rejected**：审批通过/拒绝
- **Executing**：变更执行（含跨模块联动）
- **Completed**：执行完成并记录结果
- **Archived**：变更记录归档
- **RolledBack**：失败回滚并生成复盘报告

### 14.2 关键联动
- **影响分析**：自动评估影响页面/接口/预算/服务
- **模块通知**：评估、预算、服务模块接收变更事件并更新状态
- **审计留痕**：审批与执行过程全链路留痕

## 15. 实施路线图与里程碑

### 15.1 里程碑
- M1：档案详情重构与跨模块跳转协议上线
- M2：供应商信息与效果评估索引完善，批量变更能力上线
- M3：生命周期变更状态机、审计日志与权限矩阵完善

### 15.2 风险与应对
- 跨模块字段不一致 → 建立统一字典与转换层
- 路由协议变更 → 版本化协议与兼容策略
- 权限边界不清 → 强化角色矩阵与审批流程

## 16. 术语表
- **档案**：外部数据的业务视角信息聚合体
- **索引**：聚合外数评估/预算/服务/技术信息的导航
- **路由协议**：跨模块跳转的路径与参数约定
- **影响分析**：变更对其他模块的影响范围与程度评估
