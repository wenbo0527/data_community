# 外数档案实现进度评估1112

## 概述
- 评估对象：`/risk/external-data/archive` 外数档案页面与相关路由/菜单/Store集成。
- 评估依据：现有代码实现与《外数档案模块详细产品设计文档（更新版）》的功能与数据流要求。
- 评估结论：当前实现完成“档案概览（统计）”与“技术详情跳转”基础能力，尚未覆盖“业务信息补充”“供应商信息管理”“效果评估索引”“生命周期变更发起”等核心中枢功能。

## 设计目标摘要（摘自产品文档）
- 作为外部数据生命周期管理的中枢，提供：
  - 业务信息补充与管理属性补充
  - 供应商信息维护与评估
  - 使用说明与案例沉淀
  - 效果评估索引与趋势对比
  - 技术信息索引与统一跳转协议
  - 生命周期变更发起与状态跟踪

## 代码实现覆盖点（当前）
- 页面与路由
  - 路由：`/risk/external-data/archive`（`src/router/index.js`，同一组件同时挂载到`/external-data-archive`与`/risk/external-data/archive`）。
  - 菜单：`risk-external-data-archive`（`src/config/menuConfig.js`），已在“数字风险/外数生命周期”分组下显示。
- 页面功能（`src/pages/external-data-archive/index.vue`）
  - 使用 Pinia Store `useExternalDataStore` 的 `fetchProducts()` 拉取“已注册外部数据产品”（来源：评估模块封装API）。
  - 档案概览统计卡片：
    - 产品总数：`list.length`
    - 接口总数：对每个产品的 `interfaces` 数量求和
    - 供应商总数：对产品 `supplier` 去重计数
  - 顶部动作：新增产品（弹窗组件 `ExternalProductModal`）、导入、导出（占位）。
  - 技术详情跳转：`goArchiveList()` 跳至 `'/external-data-v1/list'`。

## 与设计的一致性评估
- 技术信息索引
  - 一致项：提供技术详情跳转入口（到 `external-data-v1/list`）。
  - 差距：缺少统一跳转协议参数（`archiveId`, `from=archive`, `tab`），无法在目标页保持上下文与回跳。
- 档案概览与统计
  - 一致项：展示产品、接口、供应商的基本概览统计。
  - 差距：缺少更多业务维度统计（生命周期状态、评估状态、合同状态等）。
- 业务信息补充
  - 差距：未实现“业务价值、使用场景、影响评估、替代方案、业务风险”等业务属性的档案详情展示与编辑。
- 管理属性补充
  - 差距：未实现“采购信息、维护责任、变更/审批记录、合规状态”等属性维护与展示。
- 供应商信息管理
  - 部分关联：产品项包含`supplier`字段，并可统计供应商数。
  - 差距：未实现“供应商档案、联系人、合作历史、信用评级、评估得分、合同管理”等页面与模型。
- 使用说明管理
  - 差距：未实现“快速入门、API示例、数据解读、FAQ、最佳实践、案例沉淀”等内容聚合与编辑入口。
- 效果评估索引
  - 相关能力：Store 已有评估归档接口（`archiveEvaluation`→`api/external/evaluation.archiveReport`），但档案页未展示评估结果聚合与趋势分析。
  - 差距：未实现“评估指标汇总、趋势与对比、报告归档、ROI计算与满意度”等展示与索引。
- 生命周期变更发起
  - 差距：未实现“变更类型、影响分析、审批路由、执行跟踪、结果确认”等流程页面与状态管理。
- 权限与回跳协议
  - 差距：未实现“角色矩阵、跨模块权限控制、回跳协议（from=archive）、状态保持（sessionStorage）”。

## 数据与API现状
- 数据来源：`useExternalDataStore.fetchProducts()`（评估模块API封装，非档案独立数据模型）。
- 档案独立实体：未见 `ExternalDataArchive` 相关模型类型或API，档案页数据以产品列表近似代替。
- 评估归档API：`src/api/external/evaluation.js` 提供 `archiveReport(id)`，Store封装为 `archiveEvaluation(id)`，但未在档案UI中使用。

## 路由与导航一致性
- 路由：`/risk/external-data/archive` 可达，菜单位于“数字风险/外数生命周期”。
- 跨模块跳转：档案→技术详情已实现；档案→元数据/评估/预算/服务的规范化跳转参数与回跳协议尚未实现。

## 实现进度量化（粗略估算）
- 技术信息索引入口：60%（基本跳转已通，待参数协议与上下文保持）
- 档案概览统计：40%（基础统计有，待业务维度扩展）
- 业务信息补充：0%（未实现）
- 管理属性补充：0%（未实现）
- 供应商信息管理：10%（仅供应商字段统计）
- 使用说明管理：0%（未实现）
- 效果评估索引：10%（接口有，UI与聚合未实现）
- 生命周期变更发起：0%（未实现）
- 权限/回跳协议：0%（未实现）

## 优先改进路径（建议对齐M1里程碑）
1) 建立档案独立数据模型与API
   - 新增实体 `ExternalDataArchive`（参照文档5.1），实现CRUD与查询。
   - Store：`externalDataArchiveStore`（列表、详情、统计、变更记录）。
2) 档案详情页重构
   - 左侧模块导航（业务概览、技术详情、元数据、评估、预算、服务）。
   - 中央内容区：业务价值、供应商信息、使用说明、效果评估、生命周期五大卡片。
3) 统一跳转协议
   - 所有跳转携带 `archiveId&from=archive&tab`；目标页支持回跳按钮。
4) 评估索引与统计增强
   - 从评估模块聚合指标，显示最新结果与趋势；加入供应商维度统计。
5) 生命周期变更申请页
   - 表单字段、状态机与基础审批路由（最小可用版本）。

## 风险与依赖
- 模块间字段规范化依赖统一字典与转换层；需要跨模块协作。
- 路由协议改造涉及多个模块页面改动（评估、预算、服务、元数据）。
- 权限与回跳协议需要统一的角色矩阵与导航策略。

## 验收建议
- 路由可达性：`http://localhost:5173/risk/external-data/archive` 正常访问；菜单显示正确。
- 功能演示：当前可演示产品/接口/供应商统计与技术详情跳转；其余功能需按M1计划补齐后回归验收。

## 结论
当前“外数档案”处于“中枢雏形”阶段：具备基础统计与单一技术跳转入口，但尚未形成文档所定义的业务中枢能力。建议优先完成档案独立数据模型与详情页重构、统一跳转协议与评估索引，以打通跨模块协同的最小闭环。

---
参考文件：`.trae/documents/外数档案模块详细产品设计文档.md`
相关代码：
- `src/pages/external-data-archive/index.vue`
- `src/store/modules/external-data.ts`
- `src/router/index.js`
- `src/config/menuConfig.js`
