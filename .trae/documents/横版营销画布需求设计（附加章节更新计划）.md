# 横版营销画布需求设计（附加章节更新计划）

## 将新增内容（直接附加到现有文档）

### 1. 节点标题/内容映射表
- 统一说明各节点的“标题行来源（优先 config.nodeName）”与“内容行字段映射”
- 覆盖：start、audience-split、event-split、ab-test、ai-call、sms、manual-call、wait、benefit、end
- 明确分流类“内容行 = 分支数 + 未命中行”→ `out-i` 对齐规则

### 2. 类型图标清单
- 为每节点类型列出图标名与用途位置（标题行左侧）
- 图标大小、间距、主题色建议与可替换库说明（如 Arco Icons）

### 3. 交互流程细则
- 点击节点打开抽屉（统一使用 `openConfigDrawer`）
- 从 `out` 到 `in` 手动拖拽连线，完成后右键连接线删除
- 连接线“+”插入节点，分流默认保留 `out-0`
- 标明相关代码钩点：horizontal/index.vue 中的 `node:click`、`edge:contextmenu`、`edge:mouseenter/+`（以文件:行号形式）

### 4. 数据契约与示例
- 统一 CanvasData 结构与节点/连接字段列举
- 关键节点类型的 JSON 示例（AB/分流/权益/开始）
- 分流类的 `ports.items` 与 `out-i` 命名约定示例

### 5. 发布校验与错误态
- 规则：所有 `out` 端口需有连接；列表化错误输出格式 `{ nodeId, portId }`
- UI 提示策略与交互（高亮端口、阻止发布）

### 6. 验收用例
- 展示、交互、连接、删除、发布校验的分场景用例清单（含预期结果）

### 7. 性能与指标
- 100+ 节点场景的性能基准与优化要点（渲染缓存、回退到 SVG 文本）

### 8. 风险与回退
- HTML/foreignObject 对齐风险、类型枚举一致性风险；回退方案与监控点

### 9. 实施里程碑
- 阶段拆分：渲染层、交互层、抽屉接入、校验与验收；每阶段输出物与验收点

## 关键引用位置（为文档中插入用）
- 连接校验与方向：`src/pages/marketing/tasks/horizontal/index.vue:115-141`
- 连接线右键删除：`src/pages/marketing/tasks/horizontal/index.vue:179`
- 连接线上“+”插入：`src/pages/marketing/tasks/horizontal/index.vue:149-177, 262-271`
- 节点点击打开抽屉：`src/pages/marketing/tasks/horizontal/index.vue:194`（通过 `useConfigDrawers.openConfigDrawer`）
- 端口工厂（横向）：`src/pages/marketing/tasks/horizontal/utils/portConfigFactoryHorizontal.js:6,21`
- 原版导入/导出：`src/pages/marketing/tasks/components/TaskFlowCanvasRefactored.vue:3318,3337`

确认后我将把上述章节完整追加到 `/.../营销画布 - 横版工作流版本前端优化需求文档.md`，并补充字段级映射与示例 JSON，确保文档能直接指导实施与验收。