# 方案：在核销执行页面展示并联动合同剩余金额与免费量

## 目标
1.  在核销页面（`step=2`）选择合同后，展示该合同的“剩余金额”和“剩余免费量”。
2.  点击“执行”核销后，自动更新并展示最新的“剩余金额”和“剩余免费量”。

## 实施步骤

### 1. 更新合同数据模型 (Store)
**文件**: `apps/risk-app/src/modules/budget/stores/contract.ts`
- 修改 `ContractItem` 接口，增加 `totalFreeQuota` (总免费量) 和 `usedFreeQuota` (已用免费量) 字段。
- 修改 `fetchContractList` action，在生成模拟数据时初始化这两个字段（例如默认总免费量 10000，已用 0）。

### 2. 更新核销页面逻辑 (Component)
**文件**: `apps/risk-app/src/modules/budget/pages/settlement/WriteoffPanel.vue`

#### A. 补充 Mock 数据逻辑
- 修改 `supplementContractMock` 方法，在创建 Mock 合同时设定 `totalFreeQuota` 和 `usedFreeQuota` 的初始值。

#### B. 新增辅助计算方法
- 新增 `contractRemainingFree(contract)` 方法，计算公式：`totalFreeQuota - usedFreeQuota`。

#### C. 优化界面展示
- 在“选择合同与核销金额”列中，当用户选中某个合同后，在下拉框下方或旁边增加一行小字，实时显示：
  - 剩余金额：`XXX.XX`
  - 剩余免费量：`XXX`
- 同时更新下拉框的选项文本，使其包含免费量信息，方便选择时参考。

#### D. 更新执行逻辑
- 修改 `confirmWriteoff` 方法：
  - 在执行核销时，除了扣减合同的金额（更新 `writtenOffAmount`），同时扣减免费量（更新 `usedFreeQuota`，增加量为输入的“核销减免量”）。
  - 确保 Store 中的数据更新后，界面上的剩余量展示能自动刷新。

## 验证
- 打开页面，点击“补充合同Mock”。
- 选择一个合同，确认能看到剩余金额和免费量。
- 输入核销金额和减免量，点击“执行”。
- 确认显示的剩余金额和免费量已相应减少。