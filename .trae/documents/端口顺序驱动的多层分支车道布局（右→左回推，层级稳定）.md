## 目标
- 保留现有快速布局实现（车道/网格/右→左回推均可继续使用）
- 增加 `executeHierarchyTreeLayout` 方法，使用 @antv/hierarchy 的树布局（LR方向）
- 在工具栏提供开关：`布局模式 = 树布局 / 车道布局`
- 默认切到“树布局”实现；保证“端口顺序（上→下）”与“顶层居中”需求

## 设计与实现
### 1) DAG → Tree 树化策略
- 根节点：优先 `start` 或入度为 0；多根时选一个为主根，其余在根下拼接次树
- 子排序：
  - 取分支节点的 `out` 端口集合（`ports.items`），过滤 `group==='out'`
  - 排序规则：顶部优先（position/top 或几何 y 较小）→ 数字序（`out-0 < out-1`）
  - 使用边的 `sourcePortId` 将子节点按端口顺序排列为 `children`
- 多父节点：选择一个“主父”（多数上游、靠上端口、较短路径优先）参与 `children`；其他父边保留为跨层连线但不参与坐标计算

### 2) 调用 @antv/hierarchy
- 依赖：`import Hierarchy from '@antv/hierarchy'`
- 构造树数据：`{ id, children: [...] }`
- 计算坐标：
```js
const result = Hierarchy.compactBox(treeData, {
  direction: 'LR',
  getId: d => d.id,
  getChildren: d => d.children || [],
  getWidth: d => widthMap[d.id] || 120,
  getHeight: d => heightMap[d.id] || 60,
  nodeSize: [maxW, maxH],
  gap: [colSpacing, laneGapY]
})
// result.nodes: [{ id, x, y }]
```
- 动态间距：`colSpacing = max(maxW + 40, 280)`；`laneGapY = max(maxH + 20, 240)`

### 3) 应用到 X6
- 批量 `node.position(x,y)` 映射坐标；
- 清理所有边 `setVertices([])` 保持无控制点；
- 连线不变：`router: 'normal'` + `connector: 'smooth'`
- 视口仅 `centerContent()`，不调整缩放

### 4) 新方法 API
- 文件：`src/pages/marketing/tasks/horizontal/utils/quickLayout.js`
- 方法：`async executeHierarchyTreeLayout(graph, { startX=80, startY=120, colSpacing=280, laneGapY=240 })`
  - 采集节点宽高 map（`getBBox()`），端口顺序，边的 `sourcePortId/target`
  - 构造树 `treeData`（DAG 树化）
  - 调用 `Hierarchy.compactBox`（方向 LR）
  - 应用坐标并清理控制点

### 5) 工具栏与入口
- 文件：`src/pages/marketing/tasks/horizontal/index.vue`
- 新增状态：`layoutMode: 'hierarchy' | 'lane'`（默认 `hierarchy`）
- 工具栏新增切换按钮（或下拉框）：切换布局模式
- `handleQuickLayout`：按 `layoutMode` 调用 `executeHierarchyTreeLayout` 或现有 `executeRightToLeftLaneLayout`

### 6) 顶层居中与端口顺序
- 顶层居中：将“开始节点”和“首个分支头”的 y 调整为当前树的“全体 children 的中位 y”（或靠上的那条），增强视觉居中；其余节点按树布局坐标
- 端口顺序：上→下在 `children` 构造时体现，树布局会保持该顺序的垂直排列

### 7) 验证与日志
- 日志输出：节点/边计数、树化时间、层数、最大层宽、动态间距值
- 用例：线性、单分支、多分支、合流
- 拖拽新增节点、缩放后坐标正确（继续 `pageToLocal`）

### 8) 文档更新
- 更新 `API_DOCUMENTATION.md` 增加“树布局”章节：参数、输入、限制、示例
- 更新 `ERROR_ANALYSIS_REPORT.md` 增加“树化失败”处理策略（环/多根）与降级建议
- 如需单独文件 `LAYOUT_MODES.md`：比较“树布局 vs 车道网格布局”适用场景

## 风险与处理
- 版本 API 差异：`compactBox` 参数名与返回结构需按本项目版本校验；必要时切换到 `dendrogram` 或手动计算间距
- 环与多父：树化时选择主父；出现环则停止并提示（可回退到车道模式—仅在你允许时）

确认后我将实现该方案：新增树布局方法、工具栏切换入口、默认使用树布局，并更新文档说明。