## 目标与交付
- 生成 5 份中文 Markdown 文档并写入 `.trae/documents/`：
  - 外数生命周期产品方案.md
  - 外数档案模块详细设计.md
  - 外数评估模块详细设计.md
  - 外部数据服务模块详细设计.md
  - 预算管理模块详细设计（风险域）.md
- 融合现有四份文档的思路与当前代码实现，补充跨模块调用逻辑与落地路径。

## 文档列表与结构
### 外数生命周期产品方案.md
- 背景与目标（业务痛点、总体目标）
- 生命周期阶段与页面映射（档案→评估→服务→监控/预算）
- 关键指标与度量（预算健康度、评估质量、服务可用性）
- 系统架构与路由拓扑（含风险域与探索域入口）
- 数据流与协同机制（评估结果回写、预算同步、服务状态）
- 跨模块调用逻辑（统一跳转协议、上下文、事件驱动）
- 与现有代码的锚点映射（以 `file_path:line_number` 引用）

### 外数档案模块详细设计.md
- 页面与路由：`src/pages/external-data-archive/index.vue`、`/risk/external-data/archive`
- 数据模型与 Store：`src/store/modules/external-data.ts`（产品、预警、评估引用）
- 交互与编辑抽屉：`openEdit(record)`、`saveEdit()` 引用行号
- 跨模块跳转封装：`goWithQuery(path, extra)` 与参数约定（`archiveId/from/tab/product`）
- 列表筛选、导出与刷新
- 与评估/监控/预算的协同与回写

### 外数评估模块详细设计.md
- 页面与路由：探索域评估列表/详情/编辑/创建/进度
- 数据来源与 API：`src/api/external/evaluation.js`
- 评估详情核心函数：`fetchReportDetail()`、`saveReport()`、`publishReport()`、`archiveReport()` 等行号
- 图表渲染与指标口径
- 与档案、预算、监控的交互（结果回写与导航）

### 外部数据服务模块详细设计.md
- 页面与组件：`external-data-service` 及 `ServiceApplication.vue`、`TaskQuery.vue`、`ResultDisplay.vue`
- 任务与查询的模型、接口、错误处理
- 与评估/监控/档案的联动（使用记录、可用性、事件）

### 预算管理模块详细设计（风险域）.md
- 页面与路由：总览/列表/合同管理/监控/结算
- Store 与 API：`src/store/modules/budget.ts`、`src/api/budget.ts`
- 关键组件：`BudgetBurndownTabs.vue`、合同与关系图组件
- 结算页模型与流程：`SettlementManagement.vue` 任务创建/进度/报告
- KPI 与监控图（跳转与指标口径）
- 与档案/评估/服务的协同（成本同步、合同对齐、预警联动）

## 代码锚点引用约定
- 全文使用 `file_path:line_number` 标注关键函数与路由项，便于快速定位。
- 已研究的主要锚点：
  - 预算总览：`src/pages/budget/BudgetOverview.vue`（导航与 KPI、监控）
  - 预算列表：`src/pages/budget/BudgetList.vue`
  - 合同管理：`src/pages/budget/components/ContractManagement.vue`
  - 预算监控：`src/pages/budget/BudgetMonitor.vue`
  - 结算管理：`src/pages/budget/SettlementManagement.vue`
  - 预算 Store/API：`src/store/modules/budget.ts`、`src/api/budget.ts`
  - 档案列表：`src/pages/external-data-archive/index.vue`（编辑抽屉与跳转封装）
  - 评估列表/详情：`src/pages/exploration/ExternalDataEvaluationList.vue`、`ExternalDataEvaluationDetail.vue`
  - 监控视图：`src/pages/exploration/external-data-analysis/external-data-monitor.vue`
  - 服务管理：`src/pages/external-data-service/index.vue` 及组件
  - 路由/菜单：`src/router/index.js`、`src/config/menuConfig.js`

## 跨模块调用逻辑（将在各文档统一补充）
- 统一跳转协议：`archiveId`、`from`、`product`、`tab`（档案页已封装：`src/pages/external-data-archive/index.vue:347–349`）
- 评估→档案：评估发布与归档更新档案记录、评估标签与评分
- 评估→预算：评估结论映射预算项的“可用性/效果分”并触发监控阈值
- 档案→服务：使用场景更改同步服务申请与结果展示
- 服务→监控：任务结果写入监控数据源，触发告警
- 预算→合同→结算：预算监控发现异常→定位合同→发起结算任务→报告生成并更新预算核销
- 事件驱动：统一事件总线/消息队列概念性设计（前端以 Store 触发与消费事件为落地）

## 执行步骤
1. 逐份文档落地撰写，嵌入当前代码锚点与路由/菜单映射。
2. 补充跨模块调用逻辑与时序说明（文字+要点清单）。
3. 写入 `.trae/documents/` 对应文件名。
4. 自检：打开相关页面与对照行号，确保引用准确。

## 验证方式
- 通过现有页面：
  - 预算域：`/risk/budget-overview`、`/risk/budget/list`、`/risk/budget/contracts`、`/risk/budget/monitor`、`/risk/budget/settlement`
  - 外数域：`/risk/external-data/archive`、`/exploration/external-data-evaluation/list`、`/exploration/external-data-analysis/external-data-monitor`、`/external-data-service`
- 交叉检查路由与菜单配置对应关系。

## 预计工作量与风险
- 一次性交付 5 份文档，行号标注与页面核对需要约 1–2 小时。
- 风险：少量行号偏差（将通过二次校对修正）。

## 下一步
- 如确认本计划，立即开始撰写并写入 `.trae/documents/`，完成后给出文档索引与关键引用位置清单。