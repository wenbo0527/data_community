# 预算管理模块实现差距分析与优化方案

## 1. 现状分析概述

### 1.1 现有功能概览
当前预算管理模块已实现了基础框架，包括：
- 5个主要功能标签页：预算总览、预算制定、预算监控、合同管理、结算管理
- 基础的数据展示表格和统计卡片
- 简单的表单创建和编辑功能
- 基础的数据mock和状态管理

### 1.2 访问地址（风险模块）
当前主要入口（基于侧边菜单与路由）：
- 总览：`http://localhost:5173/risk/budget-overview`
- 列表：`http://localhost:5173/risk/budget/list`
- 合同：`http://localhost:5173/risk/budget/contracts`
- 监控：`http://localhost:5173/risk/budget/monitor`
- 结算：`http://localhost:5173/risk/budget/settlement`

说明：菜单到路由的映射定义见 `src/config/menuConfig.js:480-535`（模块 `risk` 下的 `risk-budget-center` 分组）。

### 1.3 页面实现状态总览（代码核对）
- 预算总览（`src/pages/budget/BudgetOverview.vue`）
  - 指标卡片：条目数/年度预算总额/已执行/执行率/健康度评分，含同比/环比占位（`src/pages/budget/BudgetOverview.vue:47-80, 284-317`）
  - 预算燃尽图：`BudgetBurndownTabs` 支持“燃尽/累积”与“月/季”切换（`src/pages/budget/BudgetOverview.vue:83-89`）
  - 列表与删除：表格展示预算字段，含删除操作（`src/pages/budget/BudgetOverview.vue:93-125, 440-447`）
  - 预警表：对比预算与实际，偏离率、趋势图标与导出（`src/pages/budget/BudgetOverview.vue:127-208, 342-350`）
  - 上传与新增：工具栏上传（Mock兜底）与新增预算弹窗（`src/pages/budget/BudgetOverview.vue:33-41, 221-250, 410-421, 429-438`）

- 预算列表（`src/pages/budget/BudgetList.vue`）
  - 筛选栏：业务/平台/粒度/年度/季度/月，右侧按钮“新建/上传预算”“下载模板”（`src/pages/budget/BudgetList.vue:4-57`）
  - 列表列：预算编号、业务类型、平台产品、目标贷余、预估放款、预估费用、年化数据成本、无风险收益、预算粒度、对应时间、剩余金额、操作（`src/pages/budget/BudgetList.vue:58-105`）
  - 新建/上传：弹窗包含“单独创建”“批量上传”，批量解析 CSV/XLSX 预览并逐条创建（`src/pages/budget/BudgetList.vue:106-200, 258-325, 328-347`）
  - 数据源：`budgetApiService.getBudgets/createBudget/deleteBudget`（开发环境内存后备）（`src/pages/budget/BudgetList.vue:362-374, 422-431` 与 `src/api/budget.ts`）

- 合同管理（`src/pages/budget/components/ContractManagement.vue`）
  - 工具栏与操作：供应商/状态筛选、跳转“合同上传”、新增供应商弹窗（`src/pages/budget/components/ContractManagement.vue:9-37, 157-159, 104-113`）
  - 统计卡片：合同数/总额/近30天到期/供应商数（`src/pages/budget/components/ContractManagement.vue:40-62`）
  - 供应商维度分析：点击联动筛选（`src/pages/budget/components/ContractManagement.vue:65-81, 152-155`）
  - 列表与详情：行点击跳合同详情（`src/pages/budget/components/ContractManagement.vue:83-102, 210-212`）
  - 数据源：本地mock与Store，未接真实API（`src/pages/budget/components/ContractManagement.vue:229-233`）

- 预算监控（`src/pages/budget/BudgetMonitor.vue`）
  - 关键指标：总/已/剩余预算，使用率进度（`src/pages/budget/BudgetMonitor.vue:8-25`）
  - 筛选栏：业务类型/平台/目标贷余/年份，查询/重置，悬浮固定（`src/pages/budget/BudgetMonitor.vue:28-60`）
  - 燃尽图：模式与粒度切换，联动远程拉取（`src/pages/budget/BudgetMonitor.vue:62-69, 219-233`）
  - 健康度预警表与平台详情弹窗（`src/pages/budget/BudgetMonitor.vue:71-163, 260-279`）
  - 刷新与导出：统一刷新拉取与导出预警数据（`src/pages/budget/BudgetMonitor.vue:292-316, 281-290`）

- 结算管理（`src/pages/budget/SettlementManagement.vue`）
  - 页面为占位：页头与说明，无数据与交互（`src/pages/budget/SettlementManagement.vue:1-8`）


## 2. 核心功能差距分析

### 2.1 预算展示管理差距

#### 更新后的确认（基于代码）
| 设计功能 | 当前实现状态 | 依据代码 | 备注 |
|---------|-------------|----------|------|
| 年度预算总览卡片 | ✅ 基本实现 | `src/pages/budget/BudgetOverview.vue:47-80` | 含健康度评分与同比/环比占位 |
| 预算执行趋势图 | ✅ 已实现 | `src/pages/budget/BudgetOverview.vue:83-89` | `BudgetBurndownTabs` 支持模式/粒度切换 |
| 产品类型/平台分布图 | ❌ 未实现 | — | 仍缺少维度占比/对比图 |
| 粒度聚合视图 | ⚠️ 部分实现 | `src/pages/budget/BudgetOverview.vue:83-89` | 支持月/季；年视图未落地 |
| 预算执行排行榜 | ❌ 未实现 | — | 仍缺少排名视图 |
| 预算异常预警区 | ⚠️ 部分实现 | `src/pages/budget/BudgetOverview.vue:127-208` | 已有详细预警表与导出，规则基础 |

#### ⚠️ 部分实现功能
- **预算总览统计卡片**：已实现基础统计，但缺少同比标识、健康度评分等高级指标
- **预算明细表格**：基础表格已包含业务类型、平台、目标贷余、预估放款、预估费用、年化数据成本、无风险收益等字段；建议补充“预算粒度（年/季/月）”“对应时间”列并展示执行率，以便与外数预算管理页保持一致。

### 2.2 成本监控预警差距

#### 成本监控预警现状
| 设计功能 | 当前实现状态 | 差距说明 |
|---------|-------------|----------|
| 实时成本监控面板 | ❌ 未实现 | 无当日/本周/本月实时面板 |
| 成本趋势折线图 | ⚠️ 部分实现 | 以燃尽/累积图替代趋势（`BudgetMonitor.vue:62-69`） |
| 成本构成饼图 | ❌ 未实现 | 仍缺 |
| 成本热力图 | ❌ 未实现 | 仍缺 |
| 成本异常检测 | ❌ 未实现 | 仍缺 |
| 预算余额不足预警 | ⚠️ 部分实现 | 预警表展示偏离与状态（`BudgetMonitor.vue:71-152`） |
| 超预算预警 | ⚠️ 部分实现 | 规则基础，未推送（`BudgetOverview.vue:127-208`） |
| 成本异常波动预警 | ❌ 未实现 | 仍缺 |

### 2.3 合同信息展示差距

#### 合同信息展示现状
| 设计功能 | 当前实现状态 | 差距说明 |
|---------|-------------|----------|
| 合同统计卡片 | ✅ 基本实现 | 统计卡片可用（`ContractManagement.vue:40-62`），无趋势图 |
| 合同状态分布图 | ❌ 未实现 | 仍缺 |
| 供应商合同排行榜 | ⚠️ 部分实现 | 供应商维度分析表可作为基础（`ContractManagement.vue:65-81`） |
| 合同金额趋势图 | ❌ 未实现 | 仍缺 |
| 合同到期预警 | ⚠️ 部分实现 | 近30天到期计数与标签（`ContractManagement.vue:40-62, 196-203`） |

### 2.4 结算信息展示差距

#### 结算信息展示现状
| 设计功能 | 当前实现状态 | 差距说明 |
|---------|-------------|----------|
| 结算统计卡片 | ❌ 未实现 | 当前页占位，无统计（`SettlementManagement.vue:1-8`） |
| 结算趋势图 | ❌ 未实现 | 仍缺 |
| 供应商结算排行榜 | ❌ 未实现 | 仍缺 |
| 结算差异展示 | ❌ 未实现 | 仍缺 |
| 结算效率统计 | ❌ 未实现 | 仍缺 |

## 3. 数据模型差距分析

### 3.1 当前数据模型问题

#### ❌ 核心实体缺失
```typescript
// 设计文档中的Budget接口
interface Budget {
  id: string;
  budgetName: string;          // ❌ 缺失
  budgetYear: number;          // ❌ 缺失
  budgetType: BudgetType;      // ❌ 缺失
  department: Department;      // ❌ 缺失
  totalAmount: number;         // ✅ 存在
  usedAmount: number;          // ✅ 存在
  remainingAmount: number;     // ✅ 存在
  executionRate: number;       // ✅ 存在
  status: BudgetStatus;        // ❌ 缺失
  version: number;             // ❌ 缺失
  validFrom: Date;             // ❌ 缺失
  validTo: Date;               // ❌ 缺失
}
```

#### ✅ 展示视图模型（与外数预算管理页对齐）
```typescript
// 预算展示以年/季/月结合产品类型与平台维度进行制定与呈现
export interface BudgetDisplay {
  id: string
  businessType: string           // 产品/业务类型（如：助贷、融担、直贷）
  platform: string               // 平台产品（如：字节、蚂蚁、京东、美团）
  targetLoan: number             // 目标贷余（预算目标）
  estimatedLoan: number          // 预估放款（预算执行预估）
  estimatedCost: number          // 预估费用
  estimatedAnnualCost: number    // 年化数据成本（百分比）
  estimatedRiskFreeReturn: number// 无风险收益（百分比）
  budgetGranularity: '年' | '季' | '月' // 预算粒度
  budgetTime: string             // 对应时间（如：2024、2024Q1、2024-06）
}
```

#### ❌ 关联关系缺失
- BudgetItem（预算科目）实体完全缺失
- CostRecord（成本记录）实体完全缺失
- AlertRecord（预警记录）实体完全缺失
- 供应商、部门、成本中心等基础数据缺失

### 3.2 当前store结构问题
当前 `BudgetData` 接口与外数预算管理页的展示字段基本对齐（`businessType/platform/targetLoan/estimatedLoan/estimatedCost/estimatedAnnualCost/estimatedRiskFreeReturn`），但为完善展示与筛选，建议在 Store 层补充：

- `budgetGranularity: '年' | '季' | '月'`
- `budgetTime: string`（如 `2024`、`2024Q1`、`2024-06`）

并统一枚举/字典：`businessType`（产品/业务类型）与 `platform`（平台产品）。

## 4. 用户界面差距分析

### 4.1 可视化组件缺失

#### ❌ 图表组件完全缺失
- ECharts/Chart.js等图表库未集成
- 无仪表盘、进度条等可视化组件
- 缺少红绿灯状态指示器
- 无趋势线动画效果

#### ❌ 预警展示不足
- 预警信息卡片样式不符合设计要求
- 缺少声音提示功能
- 无预警历史记录展示

### 4.2 交互体验问题

#### ⚠️ 基础交互存在但体验不佳
- 表格筛选功能基础，缺少高级筛选
- 表单验证规则不完整
- 缺少批量操作功能
- 无数据导出进度提示

## 5. 业务逻辑差距分析

### 5.1 核心算法缺失

#### ❌ 预算计算逻辑
```javascript
// 设计文档要求的计算公式
预算执行率 = 已执行预算 / 总预算 × 100%
预算偏差率 = (实际支出 - 预算金额) / 预算金额 × 100%
// 当前实现中缺少这些核心计算逻辑
```

#### ❌ 预警规则引擎
```javascript
// 设计文档要求的预警规则
预算余额预警：剩余预算 < 预算总额的10%
超预算预警：实际支出 > 预算金额
成本异常预警：成本增长率 > 50% 或成本下降率 > 30%
// 当前实现中无预警规则引擎
```

### 5.2 业务流程不完整

#### ❌ 关键流程缺失
- 预算审批流程未实现
- 成本数据采集流程缺失
- 预警处理流程不完整
- 结算对账流程缺失

## 6. 技术架构优化建议

### 6.1 前端架构优化

#### 📋 推荐技术栈升级
```json
{
  "图表库": "ECharts 5.4+ 或 Chart.js 4.0+",
  "数据可视化": "AntV G2Plot 或 D3.js",
  "仪表盘组件": "Vue3-circle-progress 或 vue-gauge",
  "表格增强": "@arco-design/web-vue 表格高级功能",
  "导出功能": "xlsx + file-saver"
}
```

#### 📋 组件架构重构
```
src/pages/budget-management/
├── components/                    # 组件目录
│   ├── charts/                    # 图表组件
│   │   ├── BudgetTrendChart.vue   # 预算趋势图
│   │   ├── CostStructurePie.vue   # 成本构成饼图
│   │   ├── ExecutionGauge.vue     # 执行率仪表盘
│   │   └── WarningHeatmap.vue     # 预警热力图
│   ├── cards/                     # 卡片组件
│   │   ├── BudgetOverviewCard.vue # 预算总览卡片
│   │   ├── WarningAlertCard.vue   # 预警信息卡片
│   │   └── ContractStatCard.vue   # 合同统计卡片
│   └── tables/                    # 表格组件
│       ├── BudgetDetailTable.vue  # 预算明细表格
│       ├── CostAnalysisTable.vue  # 成本分析表格
│       └── SettlementDiffTable.vue # 结算差异表格
├── composables/                   # 组合式函数
│   ├── useBudgetCalculations.ts   # 预算计算逻辑
│   ├── useWarningRules.ts         # 预警规则引擎
│   └── useChartData.ts           # 图表数据处理
└── utils/                        # 工具函数
    ├── budget-formulas.ts        # 预算计算公式
    ├── warning-engine.ts         # 预警引擎
    └── data-formatters.ts        # 数据格式化
```

### 6.2 数据模型重构

#### 📋 完整数据模型定义
```typescript
// src/types/budget.ts
export interface Budget {
  id: string;
  budgetName: string;
  budgetYear: number;
  budgetType: BudgetType;
  department: Department;
  totalAmount: number;
  usedAmount: number;
  remainingAmount: number;
  executionRate: number;
  status: BudgetStatus;
  version: number;
  createdBy: User;
  createdAt: Date;
  validFrom: Date;
  validTo: Date;
  items: BudgetItem[];
}

export interface BudgetItem {
  id: string;
  budgetId: string;
  itemCode: string;
  itemName: string;
  parentId?: string;
  itemType: ItemType;
  plannedAmount: number;
  actualAmount: number;
  variance: number;
  varianceRate: number;
  costCenter: CostCenter;
  supplier?: Supplier;
}

export interface CostRecord {
  id: string;
  costType: CostType;
  amount: number;
  currency: string;
  costDate: Date;
  department: Department;
  supplier: Supplier;
  budgetItem?: BudgetItem;
  description: string;
}

export interface AlertRecord {
  id: string;
  alertType: AlertType;
  alertLevel: AlertLevel;
  title: string;
  content: string;
  relatedObjectId: string;
  relatedObjectType: string;
  isRead: boolean;
  readAt?: Date;
  createdAt: Date;
  validUntil: Date;
}
```

### 6.3 状态管理优化

#### 📋 Pinia Store重构
```typescript
// src/stores/budget.ts
export const useBudgetStore = defineStore('budget', () => {
  // 状态
  const budgets = ref<Budget[]>([]);
  const costRecords = ref<CostRecord[]>([]);
  const alertRecords = ref<AlertRecord[]>([]);
  const departments = ref<Department[]>([]);
  const suppliers = ref<Supplier[]>([]);
  
  // 计算属性
  const totalBudget = computed(() => 
    budgets.value.reduce((sum, budget) => sum + budget.totalAmount, 0)
  );
  
  const totalUsedBudget = computed(() => 
    budgets.value.reduce((sum, budget) => sum + budget.usedAmount, 0)
  );
  
  const executionRate = computed(() => 
    totalBudget.value > 0 ? (totalUsedBudget.value / totalBudget.value) * 100 : 0
  );
  
  const activeAlerts = computed(() =>
    alertRecords.value.filter(alert => 
      !alert.isRead && new Date() < new Date(alert.validUntil)
    )
  );

  // Actions
  async function fetchBudgets(params: BudgetQueryParams) {
    // 实现预算数据获取
  }
  
  async function createBudget(budget: BudgetCreateParams) {
    // 实现预算创建
  }
  
  async function updateBudgetExecution(budgetId: string, actualAmount: number) {
    // 更新预算执行金额
  }
  
  function calculateExecutionRate(budget: Budget): number {
    return budget.totalAmount > 0 ? (budget.usedAmount / budget.totalAmount) * 100 : 0;
  }
  
  function checkBudgetAlerts(budget: Budget): AlertRecord[] {
    // 实现预算预警检查
    const alerts: AlertRecord[] = [];
    
    // 余额不足预警
    if (budget.remainingAmount < budget.totalAmount * 0.1) {
      alerts.push(createAlert(
        AlertType.BUDGET_INSUFFICIENT,
        AlertLevel.CRITICAL,
        `预算余额不足：${budget.budgetName}`,
        `剩余预算 ${formatCurrency(budget.remainingAmount)} 低于预算总额的10%`
      ));
    }
    
    // 超预算预警
    if (budget.usedAmount > budget.totalAmount) {
      alerts.push(createAlert(
        AlertType.BUDGET_OVERRUN,
        AlertLevel.CRITICAL,
        `超预算警告：${budget.budgetName}`,
        `实际支出 ${formatCurrency(budget.usedAmount)} 超过预算金额`
      ));
    }
    
    return alerts;
  }
  
  return {
    budgets,
    costRecords,
    alertRecords,
    totalBudget,
    totalUsedBudget,
    executionRate,
    activeAlerts,
    fetchBudgets,
    createBudget,
    updateBudgetExecution,
    calculateExecutionRate,
    checkBudgetAlerts
  };
});
```

## 7. 分阶段优化方案

### 7.1 第一阶段：核心功能补全（2-3周）

#### 🎯 优先级：高
- [ ] 集成ECharts图表库
- [ ] 实现预算执行趋势图
- [ ] 补全预算总览卡片（添加同比、健康度）
- [ ] 实现基础预警规则引擎
- [ ] 重构数据模型接口

#### 📊 预期效果
- 核心数据可视化展示
- 基础预警功能可用
- 数据模型结构合理

### 7.2 第二阶段：高级功能实现（3-4周）

#### 🎯 优先级：中
- [ ] 实现成本监控面板
- [ ] 添加部门预算分布图
- [ ] 实现合同到期预警
- [ ] 添加结算差异对比
- [ ] 优化用户交互体验

#### 📊 预期效果
- 多维度数据分析
- 智能预警系统
- 用户体验提升

### 7.3 第三阶段：智能化增强（2-3周）

#### 🎯 优先级：低
- [ ] 实现预算预测算法
- [ ] 添加成本优化建议
- [ ] 实现个性化配置
- [ ] 添加数据导出报表
- [ ] 性能优化和缓存

#### 📊 预期效果
- 预测分析能力
- 个性化用户体验
- 高性能数据展示

## 8. 技术实施要点

### 8.1 数据流设计
```
用户界面 → Pinia Store → API接口 → 后端服务 → 数据库
     ↑          ↑         ↑          ↑         ↑
  图表展示  ←  数据处理  ←  响应数据  ←  业务逻辑  ←  数据查询
```

### 8.2 性能优化策略
- **数据缓存**：前端缓存常用数据，减少API请求
- **分页加载**：大数据量分页展示，提升加载速度
- **异步更新**：非关键数据异步加载，不阻塞主流程
- **图表优化**：使用Canvas渲染，避免大量DOM操作

### 8.3 错误处理机制
- **接口容错**：API请求失败时提供默认值
- **数据校验**：前后端双重数据校验
- **用户提示**：友好的错误提示信息
- **日志记录**：关键操作记录日志，便于问题追踪

## 9. 风险评估与应对

### 9.1 技术风险
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 图表库性能问题 | 高 | 选择成熟图表库，进行性能测试 |
| 数据量大导致卡顿 | 中 | 实现分页和虚拟滚动 |
| 浏览器兼容性 | 中 | 使用Babel转译，添加Polyfill |

### 9.2 业务风险
| 风险 | 影响 | 应对措施 |
|------|------|----------|
| 预警规则不准确 | 高 | 与业务方确认规则，提供配置界面 |
| 数据展示不一致 | 中 | 统一数据源，建立数据标准 |
| 用户操作复杂 | 低 | 优化交互设计，提供操作引导 |

## 10. 验收标准

### 10.1 功能验收
- [ ] 所有核心图表正确展示
- [ ] 预警规则准确触发
- [ ] 数据模型完整可用
- [ ] 用户操作流程顺畅

### 10.2 性能验收
- [ ] 页面加载时间 < 2秒
- [ ] 图表渲染时间 < 1秒
- [ ] 数据查询响应 < 500ms
- [ ] 并发用户支持 > 50个

### 10.3 用户体验验收
- [ ] 界面美观度评分 > 4分（5分制）
- [ ] 操作易用性评分 > 4分（5分制）
- [ ] 功能完整性评分 > 4分（5分制）
- [ ] 用户满意度调查 > 80%

---

**总结**：当前预算管理模块完成了基础框架搭建，但距离设计文档要求还有较大差距。建议按照分阶段优化方案，优先补全核心功能，再逐步增强高级特性，最终实现完整的预算管理体系。
# 预算管理模块实现差距分析与优化方案（重写版）

## 1. 概述与访问入口（更新）
- 风险模块入口：`/risk/budget-overview`（预算总览）
- 风险模块入口：`/risk/external-data/budget-management`（预算管理）
- 预算中心入口（多页聚合）：`/budget/index`（含总览、列表、核销、关系图）

本评估结合以下资料与代码：
- 产品文档：《预算管理模块详细产品设计文档.md》
- 技术文档：《预算管理模块技术架构优化方案.md》
- 代码与路由：`src/router/index.js`、`src/pages/budget/*`、`src/pages/exploration/external-data-analysis/budget-management.vue`、`src/store/modules/budget.ts`、`src/api/budget.ts`、`src/components/modals/BudgetBurndownTabs.vue`

结论摘要：预算模块已具备“总览卡片 + 燃尽图 + 预警列表 + 列表/核销/关系图”的基础能力；但与产品设计的“多维分析、完整预警引擎、合同与结算展示、科目模型”等存在显著差距。风险模块下的预算管理页仍为演示型（基于 mock 生成与筛选），未与统一 Store/API 打通。

补充现状：
- 预算中心另外包含“创建（`/budget/create`）/编辑（`/budget/edit/:id`）/详情（`/budget/detail/:id`）”页面与路由，已与 `budgetApiService` 对接可用。
- “预算核销”前端通过 `budgetApiService.createVerification` 提交，后端接口存在“内存后备/占位”，属于可用的前端能力，需后续与真实接口联通。

## 2. 现有实现盘点

### 2.1 路由与导航
- `风险模块`：
  - `ROUTE_PATHS.RISK.budget-overview` → `src/pages/budget/BudgetOverview.vue`
  - `ROUTE_PATHS.RISK.external-data/budget-management` → `src/pages/exploration/external-data-analysis/budget-management.vue`
- `预算中心`：`/budget/index` 选项卡聚合：总览、列表、核销、关系图

### 2.2 页面与功能
- `BudgetOverview.vue`（总览页）
  - 指标卡片：预算条目数、年度预算总额、已执行预算、执行率
  - 燃尽图：`BudgetBurndownTabs.vue`（ECharts），支持“燃尽/累积消耗”与“月/季/年”切换
  - 预警列表：`useWarningRules`（余额不足、超预算等基础规则）
  - 数据来源：`useBudgetStore.fetchBudgetList`（Pinia）+ `budgetApiService.getBudgets`（含内存后备）
- `budget-management.vue`（风险模块预算管理页）
  - 上传与模板下载，粒度/时间筛选，表格展示
  - 数据来源：`generateWarningData()` mock；未接入统一 Store/API
- `预算中心`页签：
  - 列表：`BudgetList.vue`（查看/编辑/删除，接 API 服务）
  - 核销：`BudgetVerificationPanel.vue`（提交核销参数到 API 服务占位）
  - 关系图：`BudgetProjectRelationGraph.vue`（X6 示例图，未接后端数据）

### 2.3 Store 与 API
- Store：`src/store/modules/budget.ts`
  - `BudgetData`结构：`businessType/platform/targetLoan/estimatedLoan/...`
  - 动作：`fetchBudgetList`、`uploadMock`、`deleteById`
- API：`src/api/budget.ts`
  - 对外方法：`getBudgets/getBudget/createBudget/updateBudget/deleteBudget/createVerification`
  - 真实接口占位，存在“内存后备”与兼容 mock 返回结构的处理
  - 与 Store 的数据结构不一致（API更贴近预算域：`budgetName/budgetYear/totalAmount/...`）

### 2.4 用户视角调用逻辑（总览/预算管理/列表）
- 总览页（`/risk/budget-overview`）
  - 入口：直接路由进入或从预算中心标签页进入（风险首页当前无侧边菜单）。
  - 操作：选择`业务类型`、`平台产品`、`年份`；查看指标卡（条目数/年度预算总额/已执行/执行率/健康度评分[建议展示]）；切换燃尽图（类型“燃尽/累积消耗”+ 粒度“月/季/年”）；查看预警列表并跳转到详情/列表筛选[建议]。
  - 数据调用链：`useBudgetStore.fetchBudgetList(params)` → `budgetApiService.getBudgets(params)`（成功填充Store，失败走内存后备）→ `useBudgetCalculations`衍生指标 → `BudgetBurndownTabs`渲染图表。
- 风险预算管理页（`/risk/external-data/budget-management`）
  - 入口：风险模块“外数生命周期”页面按钮“预算管理”。
  - 操作：上传预算/下载模板；选择`预算粒度`（年/季/月）与`对应时间`（如：2025、2025Q1、2025-03）；筛选`业务类型`与`平台产品`；查看表格字段（目标/预估放款、预估成本、年化成本、无风险收益、预算粒度、对应时间）。
  - 数据调用链（现状与建议）：现状为`generateWarningData()`生成mock；建议改为`useBudgetStore.fetchBudgetList`统一查询 + 上传走`budgetApiService.createBudget`；`businessType/platform`字典在Store统一。
- 预算中心列表页（`/budget/list`）
  - 入口：`/budget/index` 标签页“列表”。
  - 操作：新增/上传/下载；查看表格并执行详情/编辑/删除；按`业务类型/平台产品/年份`筛选。
  - 数据调用链：`budgetApiService.getBudgets`加载列表；`createBudget/updateBudget/deleteBudget`执行后刷新；与Store对齐策略为操作后触发`useBudgetStore.fetchBudgetList`或监听变更，确保风险/预算中心两入口一致。
- 预算中心总览（`/budget/index` → 总览tab）
  - 操作与数据源同风险总览；差异是入口集中且可联动核销与关系图。

### 2.5 入口与侧边菜单栏评估（确认）
- 现状：`src/config/menuConfig.js:480-535` 已配置“预算总览/预算列表/合同管理/预算监控/结算管理”等入口，点击进入对应页面；“新增预算”菜单项已移除以降低入口分散。
- 建议：继续统一“风险模块 → 预算中心”视角，保持菜单与路由一致；风险侧重点在总览/监控与跳转管理，完整管理能力（创建/编辑/核销/关系图）仍保留在预算中心页签。


## 3. 与产品设计的差距评估

### 3.1 预算展示管理（年度/滚动/明细）
- 已实现：
  - 基础总览卡片（预算总额/使用/执行率）
  - 燃尽图（ECharts 组件，支持类型与粒度切换）
  - 列表与删除/追加 Mock
- 缺口：
  - 部门预算分布、科目结构图、执行排行榜、同比标识、预算健康度评分（现有 `useBudgetCalculations` 有评分但未在 UI 展示）
  - 滚动预算的“季度调整历史、偏差分析、预测趋势、调整影响”
  - 明细层级（科目/预算执行流水/对比分析/效率指标）

### 3.2 成本监控与预警
- 已实现：
  - 预警基础规则（余额不足/超预算），列表展示
- 缺口：
  - 实时成本面板（当日/本周/本月）、趋势折线、构成饼图、热力图
  - 异常检测（增长率/下降率阈值）、预警推送与历史记录、红绿灯状态、声音提示

### 3.3 合同信息展示
- 已实现：
  - 暂无合同页（预算中心仍未接入合同数据）
- 缺口：
  - 合同统计卡片、状态分布、供应商合同排行榜、金额趋势、到期预警、合同详情与执行进度、关联数据展示

### 3.4 结算信息展示
- 已实现：
  - 暂无结算页（预算中心仍未接入结算数据）
- 缺口：
  - 结算总览、趋势与状态分布、结算列表与详情、对账差异展示、效率统计

## 4. 与技术架构方案的差距评估
- 图表库：ECharts 已在燃尽图组件落地，但未形成“统一图表层/数据转换层”的可重用架构（各图表缺失）
- 计算引擎：`useBudgetCalculations` 已实现执行率/偏差率/增长率/健康度评分，但未在各页面形成统一使用与指标面板
- 预警规则引擎：`useWarningRules`为基础版，缺少完整规则模型、有效期管理、分级策略、通知与处理闭环
- 数据模型：Store 使用业务线条款字段（`targetLoan/estimatedLoan`），与预算域（`totalAmount/usedAmount`）不一致；缺少 `BudgetItem/CostRecord/AlertRecord` 等核心实体与关联关系
- API 层：存在“内存后备”，缺少真实接口与统一错误处理/缓存；风险模块页未接入 Store/API 导致双轨数据来源

## 5. 优先级优化方案（两阶段）

### 阶段 M1（2 周，打通与对齐）
1) 路由与入口统一：
   - 在风险模块下统一入口到 `BudgetOverview.vue` 与一个“统一预算管理页”（将现有 `budget-management.vue` 改造为使用 Store/API）。
   - 沿用现有“风险模块侧边菜单”（Arco Menu），核对并对齐预算相关导航项（总览/外数生命周期/预算管理/预警中心）。
   - 在预算中心保留完整管理能力（总览/列表/核销/关系图），确保导航一致性。
2) 数据模型对齐：
   - 在 `src/types/budget.ts` 定义统一 `Budget/BudgetItem/AlertRecord` 等类型
   - 调整 `useBudgetStore` 的 `BudgetData` 为 `Budget` 域字段（`totalAmount/usedAmount/remainingAmount/executionRate/...`）
3) API 接入与兼容：
   - 将 `budget-management.vue` 的数据源替换为 `useBudgetStore.fetchBudgetList`；上传模板仍走前端模拟，但触发 `budgetApiService.createBudget`
   - 对 `budgetApiService` 增加缓存与错误提示；保留内存后备但优先请求接口
4) 指标与图表增强：
   - 在总览页引入“健康度评分”展示（计算已具备）
   - 增加“同比/环比”标签与指标卡片注释
5) 预警列表增强：
   - 扩充规则（增长率异常、执行滞后）；在列表中增加等级颜色、跳转行为（至预算详情）

交付物：统一入口可用；总览/管理页数据打通；基础指标与预警增强；数据类型与 Store 对齐。

实施起点（本次迭代将先落地的改动）：
- 改造风险预算管理页为使用 `useBudgetStore + budgetApiService` 的统一数据源，保留上传/筛选交互但移除 `generateWarningData()` mock。
- 在总览页增加“健康度评分”展示，并添加“同比/环比”标识占位（后端数据就绪后联动计算）。
- 暂不调整 Store 字段结构，先完成数据源打通与展示增强，后续分支推进模型对齐。

### 阶段 M2（3–4 周，拓展分析与页面）
1) 分析图表：部门预算分布、科目结构、执行排行榜、趋势预测（ECharts）
2) 成本监控页：实时面板、趋势/构成/热力、异常检测与告警
3) 合同与结算页：统计卡片、列表与详情、到期/差异预警、效率指标
4) 预警引擎：规则模型、有效期、分级策略、通知通道与处理闭环（置为“已读/忽略/分享”）
5) 关系图数据：X6 图接入后端，展示预算与项目/合同/结算的关联拓扑

交付物：预算域的多维分析全覆盖；合同/结算闭环；统一预警引擎；可视化能力完善。

## 6. 路由与导航一致性建议
- 风险模块与预算中心的角色划分：
  - 风险模块提供“预算总览 + 简化管理入口”，强调端到端风险视角的快速发现与跳转
  - 预算中心承载完整管理能力（创建/编辑/核销/关系图/后续合同结算）
- 为避免双轨数据源：风险预算管理页改造为使用 `useBudgetStore + budgetApiService`，不再使用 `generateWarningData()`
 - 侧边菜单落地路径：在 `src/pages/risk/index.vue` 引入布局组件（如 `RiskLayout`），包含左侧 Arco Menu 与右侧 `<router-view>`；菜单项与路由常量复用 `src/router/constants.js`；点击菜单触发 `vue-router.push` 并加载统一数据源。

## 7. 数据模型对齐与落地计划
- 新增 `src/types/budget.ts`：统一 `Budget/BudgetItem/AlertRecord` 类型
- Store：
  - 将 `BudgetData` 替换为统一类型；计算型字段由 `useBudgetCalculations` 提供
  - 扩充 getter：科目聚合/部门聚合/同比环比
- API：
  - 在 `budgetApiService` 增加分页/筛选参数与统计接口占位；保持内存后备
  - 统一返回结构（`{ list, total, page, pageSize }`）并在 Store 层封装

## 8. 风险与依赖
- 真实后端接口尚未就绪：以“内存后备 + mock 兼容”保障可用，待后端联调
- 图表类型拓展需要通用数据转换层：建议在 `composables` 增加 `useChartData`
- 预警引擎与通知系统需要跨模块依赖：可先在预算中心内闭环，后续抽象为共享服务

## 9. 验收点与下一步
- 风险入口可用（两地址均正常）：`/risk/budget-overview`、`/risk/external-data/budget-management`
- 总览页：健康度、同比/环比、燃尽图切换与预警增强落地
- 管理页：接入 Store/API；筛选与模板保留；与预算中心列表数据一致
- 文档对齐：产品与技术两文档中的核心指标、图表与规则逐步落地
 - 风险模块侧边菜单（现有）：包含预算相关导航项，可直达各页；导航与统一数据源一致。

（本重写版基于现有代码与文档现状完成，后续可根据联调进度与上层需求迭代完善。）
