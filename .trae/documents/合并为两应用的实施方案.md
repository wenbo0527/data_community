## 总体目标
- 将“数字风险”拆分为两个应用：外数生命周期管理、离线模型
- 外数生命周期管理包含：外数生命周期首页、外数评估、外数档案、预算管理、外数服务四大模块
- 保持现有页面与交互不变，主要做路由、模块边界与共享资源的重构与整合

## 应用与目录规划
- 外数生命周期管理
  - 入口：apps/lifecycle-app
  - 模块：external-data/lifecycle、external-data/evaluation、external-data/archive(+detail)、budget(overview/monitor/contracts/settlement)、external-data/service
  - 共享：组件、常量、工具、API 调用统一抽到 shared 包
- 离线模型
  - 入口：apps/offline-model-app
  - 模块：model-offline-analysis（feature-center、task-management、model-evaluation 等）
- 共享包
  - packages/shared-components（StatusTag 等基础组件）
  - packages/shared-utils（dateUtils 等）
  - packages/shared-constants（status 字典、路由常量）
  - packages/domain-api（外数/预算 API 封装，复用 mock 与后端请求）

## 路由与导航规划
- 外数生命周期管理
  - 顶层：/（跳转至 /lifecycle）
  - /lifecycle（首页）
  - /external-data/archive、/external-data/archive/:id
  - /external-data/evaluation
  - /external-data/service
  - /budget/*（overview、monitor、contracts、settlement、accounting、list、detail 等）
- 离线模型
  - 顶层：/model-offline-analysis/*（feature-center、task-management、model-evaluation）
- 兼容策略
  - 保留旧路径到新路径的重定向，确保收藏与内链不失效
  - 跨应用跳转通过统一的导航组件（共享包）与路由常量实现

## 状态管理与数据边界
- 按域拆分 Pinia store：external-data、budget、model-offline 分域管理
- 共享状态（如状态字典、通用 UI 状态）移至 shared-constants 与 shared-components
- API 边界：外数域（评估/档案/服务/监控）、预算域（合同/结算/预算清单）；统一在 domain-api 层定义，页面仅调用域 API

## API 与数据契约
- 统一封装：getBurndown/getWarnings、contracts/pricing/usage/settlement 等接口
- 兼容 mock 与后端：API 返回支持 {list}/{data}/数组三种形态适配，减少迁移风险
- 结算任务契约：任务（task）与子任务（subtask）字段统一，报告生成、导出 CSV 保持一致

## 组件与样式
- 统一 Arco Design 用法（按钮 size、弹窗与抽屉交互、表格分页、筛选表单一致化）
- 图表（ECharts）统一封装初始化与销毁（safeInitECharts/safeDisposeChart），保障跨模块复用
- 抽取 StatusTag、通用描述/表格/导出方法到 shared-components/shared-utils

## 构建与工程化
- Vite + TS：各应用各自 tsconfig、vite.config，统一 @ 别名到各自 src
- 环境变量：按应用划分（如 VITE_USE_MOCK），共享公共变量前缀
- Lint/Format：统一 ESLint/Prettier 配置；避免“中文 size 值”等类型错误

## 迁移步骤（不改功能，仅整合）
1. 创建 apps/lifecycle-app 与 apps/offline-model-app骨架，复制现有页面与模块到对应应用
2. 拆分并抽取 shared 包（components/utils/constants/domain-api）；修正页面 import 路径
3. 整理路由树与重定向；校验跨应用跳转与面包屑/导航一致
4. 对齐 store 命名空间与初始化顺序；确认图表与表格渲染无异常
5. 验证页面：生命周期首页、评估、档案/详情、预算（列表/合同/结算）、服务；以及离线模型三页
6. 加入兼容层（API 返回形态适配、旧路径重定向）；清理重复文件与死引用

## 风险与规避
- 路由碎片化：通过重定向与路径常量减少断链
- 共享字典与工具重复：抽取 shared，避免两端分叉
- Mock 与真实数据不一致：API 适配层容错（list/data/数组）+ 空值兜底
- ECharts 卸载异常：统一封装生命周期与数组判断，避免 reduce 空对象错误

## 验证与回滚
- 验证：页面加载、筛选、导出、报告生成、结算流程（成本计提→对账核对→费用核销）
- 性能与交互一致性自测（移动端卡顿与图表缩放）
- 回滚：路径重定向与分支保留；shared 包不破坏原引用时可快速回退至旧结构

## 产出物
- 两个应用的基础工程、完整路由与页面复制版
- shared 包（components/utils/constants/api）与统一状态字典
- 迁移检查清单（路由、store、API、组件、样式、构建）