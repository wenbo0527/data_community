# 社区产品文档中心重构方案（对标火山引擎文档体验）

## 目标与原则
- 用产品化文档中心替代详情弹窗，形成可分享、可深链、可搜索、可反馈的文档门户
- 三栏布局：左侧导航树、右侧目录（TOC）、中间主内容；滚动同步高亮
- 支持 Markdown 与 PDF 混合展示；统一通知类内容为“文档页风格”
- 强化“最新快照”的体验：点击即可到达最新文档内容，不做时间范围选择

## 现状与入口
- 入口：/community/guide，对应页面 [guide.vue](file:///Users/mac/nis_mock/data_comunity/data_comunity/src/pages/community/guide.vue)
- 列表页组件：[CommunityResource.vue](file:///Users/mac/nis_mock/data_comunity/data_comunity/src/components/community/CommunityResource.vue)
- 当前交互：文档用 PDFViewer 在右侧打开；通知用 a-modal 弹窗显示，深链与可读性有限

## 效果对标（火山引擎）
- 三栏布局，右侧 TOC 目录、标题锚点与复制、代码块复制、全局搜索、版本/语言切换
- 路由可深链，小节锚点可分享；文档之间有推荐与上下文导航

## 总体方案
- 路由
  - 新增文档详情路由：/docs/:slug（或 /community/guide/:docId），跳转详情页替代弹窗
  - 列表页点击 viewItem 改为 router.push，不再弹窗
- 详情页（三栏）
  - 左侧：导航树（分组与文档），支持搜索与展开状态记忆
  - 中间：Markdown 渲染主内容（代码高亮、图片/图表、表格、提示块）
  - 右侧：TOC（H2/H3），滚动同步高亮，Anchor 固定定位；标题锚点可复制
- 内容源
  - 文档存放：/Users/mac/nis_mock/data_comunity/data_comunity/.trae/documents 下 *.md 与 diagrams/*.mmd
  - 解析：marked + DOMPurify（安全清洗），gray-matter 解析 Frontmatter
  - Mermaid：diagrams/*.mmd 渲染为图（或预生成 SVG）

## 页面与组件
- 列表页（保留）
  - CommunityResource 列表与树；点击跳转详情路由
  - 支持排序（发布时间/浏览/标题）、过滤与搜索
- 文档详情页（新增 DocViewer.vue）
  - 顶部：面包屑（社区资源/操作指南/文档标题）、操作（复制链接、反馈）
  - 主内容：Markdown 渲染；支持代码块复制、提示块（info/warn）
  - TOC：Affix + Anchor，基于 H2/H3 自动生成
  - 底部：“最后更新于”、相关推荐
- 通知详情页统一为文档风格（DocViewer 复用）

## 搜索与导航
- 索引文件：docs-index.json（构建或启动时扫描 .md 生成）
  - 字段：id、slug、title、tags、category、updatedAt、headings（H2/H3 数组）
- 全局搜索：标题/描述/heading/标签匹配；详情页内高亮匹配并定位
- 右侧 TOC 与页面滚动同步；标题锚点支持复制与深链 hash

## 交互增强
- 复制链接：当前页或小节锚点；toast 提示复制成功
- 代码块：语言标签、复制按钮；支持多语言/环境 Tab 切换（可选）
- 反馈：文末“有帮助/无帮助”“反馈问题”，记录 docId 与段落锚点
- 推荐：根据标签与相似度推荐相关文档

## 安全与性能
- Markdown 渲染必须使用 DOMPurify 清理，阻断 XSS
- 图片与资源路径白名单；外链 target=_blank + rel="noopener"
- 性能：目录与代码高亮延迟渲染（首屏先渲染正文），内容懒加载与分片

## Frontmatter 与数据契约
- Frontmatter 规范（示例）
  - title: 文档标题
  - slug: 文档唯一标识
  - tags: [指南, 权限, 配置]
  - category: 操作指南|政策法规|通知
  - updatedAt: 2026-01-06
  - author: XXX
  - description: 文档摘要
- docs-index.json 结构
  - [{ id, slug, title, tags, category, updatedAt, headings: [{id, text, level}]}]
- 详情渲染流程
  - 加载 Markdown → 解析 Frontmatter → marked 渲染 → DOMPurify 清洗 → 扫描 H2/H3 构建 TOC → 绑定滚动同步

## 实施计划
- 里程碑 1
  - 新增 DocViewer 路由与页面；CommunityResource 点击跳转
  - 接入 .trae/documents 的 Markdown 内容；渲染正文与 TOC
- 里程碑 2
  - 搜索索引与全局搜索；锚点复制；代码块复制
  - 通知内容统一为文档风格；推荐文档
- 里程碑 3
  - Mermaid 图渲染；多语言/环境 Tab；反馈埋点
  - 性能优化（懒加载、目录延迟渲染）

## 验收标准
- 列表点击进入详情路由，URL 可分享；小节锚点可复制与定位
- TOC 正确同步高亮；搜索能定位到正文并高亮
- 通知详情不弹窗，统一文档风格；Markdown 渲染安全、样式一致

## 风险与注意
- 文档元数据不规范会影响索引与推荐；需制定提交校验
- PDF 兼容保留：对非 MD 文档在 DocViewer 中内嵌 PDF（降级）
- Mermaid 渲染在低端机性能需注意，可按需开启与懒加载

## 参考文件
- 列表页组件：[CommunityResource.vue](file:///Users/mac/nis_mock/data_comunity/data_comunity/src/components/community/CommunityResource.vue)
- 入口页：[guide.vue](file:///Users/mac/nis_mock/data_comunity/data_comunity/src/pages/community/guide.vue)
- 设计图（线框）：.trae/documents/diagrams/产品文档中心线框.mmd

