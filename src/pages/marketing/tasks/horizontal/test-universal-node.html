<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šç”¨èŠ‚ç‚¹ç»„ä»¶æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            padding: 30px;
        }

        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .test-header h1 {
            color: #111827;
            font-size: 28px;
            margin-bottom: 10px;
        }

        .test-header p {
            color: #6b7280;
            font-size: 16px;
        }

        .test-section {
            margin-bottom: 40px;
            padding: 24px;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #e5e7eb;
        }

        .test-section h2 {
            color: #374151;
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .node-showcase {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .node-demo {
            background: white;
            border-radius: 8px;
            padding: 20px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .node-demo h3 {
            color: #374151;
            font-size: 16px;
            margin-bottom: 16px;
            text-align: center;
        }

        .demo-node {
            margin: 0 auto;
            transform: scale(0.8);
            transform-origin: center;
        }

        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .control-btn:hover {
            background: #f3f4f6;
            border-color: #9ca3af;
        }

        .control-btn.active {
            background: #14b8a6;
            color: white;
            border-color: #14b8a6;
        }

        .debug-output {
            background: #1f2937;
            color: #f9fafb;
            padding: 16px;
            border-radius: 6px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
            line-height: 1.5;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 16px;
        }

        .debug-line {
            margin-bottom: 4px;
        }

        .debug-line.error {
            color: #fca5a5;
        }

        .debug-line.success {
            color: #86efac;
        }

        .debug-line.warning {
            color: #fde68a;
        }

        .spacing-demo {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .spacing-item {
            background: white;
            padding: 16px;
            border-radius: 6px;
            border: 1px solid #e5e7eb;
            text-align: center;
        }

        .spacing-value {
            font-size: 24px;
            font-weight: 600;
            color: #14b8a6;
            margin-bottom: 4px;
        }

        .spacing-label {
            font-size: 14px;
            color: #6b7280;
        }

        .validation-results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 16px;
        }

        .validation-item {
            padding: 16px;
            border-radius: 6px;
            border: 1px solid;
        }

        .validation-item.success {
            background: #f0fdf4;
            border-color: #22c55e;
            color: #15803d;
        }

        .validation-item.error {
            background: #fef2f2;
            border-color: #ef4444;
            color: #b91c1c;
        }

        .validation-item.warning {
            background: #fffbeb;
            border-color: #f59e0b;
            color: #b45309;
        }

        .fibonacci-sequence {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .fibonacci-number {
            width: 40px;
            height: 40px;
            background: #14b8a6;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 14px;
        }

        .golden-ratio-display {
            text-align: center;
            font-size: 18px;
            color: #374151;
            margin-bottom: 16px;
        }

        .golden-ratio-value {
            font-weight: 600;
            color: #14b8a6;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>ğŸ¨ é€šç”¨èŠ‚ç‚¹ç»„ä»¶æµ‹è¯•é¡µé¢</h1>
            <p>åŸºäºVue 3 Composition APIå’Œé»„é‡‘æ¯”ä¾‹è®¾è®¡çš„èŠ‚ç‚¹ç»„ä»¶æµ‹è¯•</p>
        </div>

        <!-- æ–æ³¢é‚£å¥‘æ•°åˆ—å’Œé»„é‡‘æ¯”ä¾‹å±•ç¤º -->
        <div class="test-section">
            <h2>ğŸ“ è®¾è®¡åŸºç¡€ - æ–æ³¢é‚£å¥‘æ•°åˆ—ä¸é»„é‡‘æ¯”ä¾‹</h2>
            <div class="fibonacci-sequence" id="fibonacciSequence"></div>
            <div class="golden-ratio-display">
                é»„é‡‘æ¯”ä¾‹: <span class="golden-ratio-value">1.618033988749895</span>
            </div>
            <div class="spacing-demo" id="spacingDemo"></div>
        </div>

        <!-- èŠ‚ç‚¹ç±»å‹å±•ç¤º -->
        <div class="test-section">
            <h2>ğŸ¯ èŠ‚ç‚¹ç±»å‹å±•ç¤º</h2>
            <div class="controls">
                <button class="control-btn" onclick="showAllNodeTypes()">æ˜¾ç¤ºæ‰€æœ‰ç±»å‹</button>
                <button class="control-btn" onclick="testNodeSizes()">æµ‹è¯•å°ºå¯¸å˜ä½“</button>
                <button class="control-btn" onclick="testInteractionStates()">æµ‹è¯•äº¤äº’çŠ¶æ€</button>
            </div>
            <div class="node-showcase" id="nodeShowcase"></div>
        </div>

        <!-- äº¤äº’çŠ¶æ€æµ‹è¯• -->
        <div class="test-section">
            <h2>âœ¨ äº¤äº’çŠ¶æ€æµ‹è¯•</h2>
            <div class="controls">
                <button class="control-btn" onclick="setNodeState('default')">é»˜è®¤çŠ¶æ€</button>
                <button class="control-btn" onclick="setNodeState('hover')">æ‚¬åœçŠ¶æ€</button>
                <button class="control-btn" onclick="setNodeState('selected')">é€‰ä¸­çŠ¶æ€</button>
                <button class="control-btn" onclick="setNodeState('disabled')">ç¦ç”¨çŠ¶æ€</button>
                <button class="control-btn" onclick="setNodeState('dragging')">æ‹–æ‹½çŠ¶æ€</button>
            </div>
            <div id="interactionDemo" style="text-align: center; margin: 20px 0;"></div>
        </div>

        <!-- é—´è·ç®—æ³•éªŒè¯ -->
        <div class="test-section">
            <h2>ğŸ“ é—´è·ç®—æ³•éªŒè¯</h2>
            <div class="controls">
                <button class="control-btn" onclick="validateSpacing('S')">éªŒè¯å°å°ºå¯¸</button>
                <button class="control-btn" onclick="validateSpacing('M')">éªŒè¯ä¸­å°ºå¯¸</button>
                <button class="control-btn" onclick="validateSpacing('L')">éªŒè¯å¤§å°ºå¯¸</button>
                <button class="control-btn" onclick="validateSpacing('XL')">éªŒè¯è¶…å¤§å°ºå¯¸</button>
            </div>
            <div class="validation-results" id="validationResults"></div>
        </div>

        <!-- ç«¯å£ç³»ç»Ÿæµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ”Œ ç«¯å£ç³»ç»Ÿæµ‹è¯•</h2>
            <div class="controls">
                <button class="control-btn" onclick="testPortPositions()">æµ‹è¯•ç«¯å£ä½ç½®</button>
                <button class="control-btn" onclick="testPortHover()">æµ‹è¯•ç«¯å£æ‚¬åœ</button>
                <button class="control-btn" onclick="validatePortAlignment()">éªŒè¯ç«¯å£å¯¹é½</button>
            </div>
            <div id="portDemo" style="text-align: center; margin: 20px 0;"></div>
        </div>

        <!-- å“åº”å¼å¸ƒå±€æµ‹è¯• -->
        <div class="test-section">
            <h2>ğŸ“± å“åº”å¼å¸ƒå±€æµ‹è¯•</h2>
            <div class="controls">
                <button class="control-btn" onclick="testResponsiveLayout(1280)">1280px æ¡Œé¢</button>
                <button class="control-btn" onclick="testResponsiveLayout(1440)">1440px å®½å±</button>
                <button class="control-btn" onclick="testResponsiveLayout(1920)">1920px è¶…å®½å±</button>
            </div>
            <div id="responsiveDemo" style="text-align: center; margin: 20px 0;"></div>
        </div>

        <!-- è°ƒè¯•è¾“å‡º -->
        <div class="test-section">
            <h2>ğŸ› è°ƒè¯•è¾“å‡º</h2>
            <div class="controls">
                <button class="control-btn" onclick="clearDebugOutput()">æ¸…é™¤è¾“å‡º</button>
                <button class="control-btn" onclick="testDebugFunction()">æµ‹è¯•è°ƒè¯•åŠŸèƒ½</button>
            </div>
            <div class="debug-output" id="debugOutput"></div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let currentNodeState = 'default';
        let currentNodeType = 'start';
        let currentNodeSize = 'M';

        // åˆå§‹åŒ–é¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            initializeFibonacciSequence();
            initializeSpacingDemo();
            showAllNodeTypes();
            log('ğŸš€ é€šç”¨èŠ‚ç‚¹ç»„ä»¶æµ‹è¯•é¡µé¢å·²åŠ è½½', 'success');
        });

        // åˆå§‹åŒ–æ–æ³¢é‚£å¥‘æ•°åˆ—å±•ç¤º
        function initializeFibonacciSequence() {
            const sequence = [1, 1, 2, 3, 5, 8, 13, 21, 34, 55];
            const container = document.getElementById('fibonacciSequence');
            
            sequence.forEach(num => {
                const element = document.createElement('div');
                element.className = 'fibonacci-number';
                element.textContent = num;
                container.appendChild(element);
            });
        }

        // åˆå§‹åŒ–é—´è·æ¼”ç¤º
        function initializeSpacingDemo() {
            const spacingData = [
                { value: '8px', label: 'å›¾æ ‡é—´è·' },
                { value: '12px', label: 'å†…å®¹å†…è¾¹è·' },
                { value: '16px', label: 'æ ‡é¢˜å·¦è¾¹è·' },
                { value: '32px', label: 'å†…å®¹è¡Œé«˜' },
                { value: '36px', label: 'æ ‡é¢˜é«˜åº¦' },
                { value: '280px', label: 'èŠ‚ç‚¹å®½åº¦' }
            ];

            const container = document.getElementById('spacingDemo');
            spacingData.forEach(item => {
                const element = document.createElement('div');
                element.className = 'spacing-item';
                element.innerHTML = `
                    <div class="spacing-value">${item.value}</div>
                    <div class="spacing-label">${item.label}</div>
                `;
                container.appendChild(element);
            });
        }

        // æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹ç±»å‹
        function showAllNodeTypes() {
            const nodeTypes = [
                { type: 'start', name: 'å¼€å§‹èŠ‚ç‚¹', config: { taskType: 'è¥é”€æ´»åŠ¨', targetAudience: ['æ–°ç”¨æˆ·', 'æ´»è·ƒç”¨æˆ·'] } },
                { type: 'crowd-split', name: 'äººç¾¤åˆ†æµ', config: { crowdLayers: [{ crowdName: 'é«˜ä»·å€¼ç”¨æˆ·' }, { crowdName: 'æ´»è·ƒç”¨æˆ·' }], unmatchBranch: { name: 'å…¶ä»–ç”¨æˆ·' } } },
                { type: 'event-split', name: 'äº‹ä»¶åˆ†æµ', config: { yesLabel: 'æ˜¯', timeout: 30 } },
                { type: 'ab-test', name: 'ABå®éªŒ', config: { branches: [{ name: 'æ–¹æ¡ˆA', percentage: 50 }, { name: 'æ–¹æ¡ˆB', percentage: 50 }] } },
                { type: 'ai-call', name: 'AIå¤–å‘¼', config: { taskId: 'TASK_001' } },
                { type: 'sms', name: 'çŸ­ä¿¡è§¦è¾¾', config: { smsTemplate: 'æ¬¢è¿çŸ­ä¿¡æ¨¡æ¿' } },
                { type: 'manual-call', name: 'äººå·¥å¤–å‘¼', config: { configId: 'CONFIG_001', description: 'VIPå®¢æˆ·æœåŠ¡' } },
                { type: 'wait', name: 'ç­‰å¾…èŠ‚ç‚¹', config: { value: 24, unit: 'å°æ—¶' } },
                { type: 'benefit', name: 'æƒç›ŠèŠ‚ç‚¹', config: { benefitName: 'æ–°ç”¨æˆ·ç¤¼åŒ…' } },
                { type: 'end', name: 'ç»“æŸèŠ‚ç‚¹', config: {} }
            ];

            const container = document.getElementById('nodeShowcase');
            container.innerHTML = '';

            nodeTypes.forEach(nodeInfo => {
                const demoNode = createDemoNode(nodeInfo.type, nodeInfo.name, nodeInfo.config);
                const demoContainer = document.createElement('div');
                demoContainer.className = 'node-demo';
                demoContainer.innerHTML = `
                    <h3>${nodeInfo.name}</h3>
                    <div class="demo-node">${demoNode}</div>
                `;
                container.appendChild(demoContainer);
            });

            log(`âœ… å·²æ˜¾ç¤º ${nodeTypes.length} ç§èŠ‚ç‚¹ç±»å‹`, 'success');
        }

        // åˆ›å»ºæ¼”ç¤ºèŠ‚ç‚¹
        function createDemoNode(type, name, config) {
            const lines = buildDisplayLines(type, config);
            const lineHeight = 32;
            const headerHeight = 36;
            const contentPadding = 12;
            const contentHeight = Math.max(1, lines.length) * lineHeight;
            const totalHeight = headerHeight + contentPadding + contentHeight + 12;

            let contentHTML = '';
            lines.forEach((line, index) => {
                const top = headerHeight + contentPadding + index * lineHeight + 16; // è¡Œä¸­ç‚¹
                contentHTML += `<div class="content-line" style="top: ${top}px;">${line}</div>`;
            });

            let portsHTML = '';
            const isSplit = type === 'crowd-split' || type === 'event-split' || type === 'ab-test';
            
            // è¾“å…¥ç«¯å£
            if (type !== 'start' && type !== 'end') {
                const inputTop = headerHeight + contentPadding + (contentHeight / 2);
                portsHTML += `<div class="port port-input" style="top: ${inputTop}px;"></div>`;
            }
            
            // è¾“å‡ºç«¯å£
            if (type !== 'end') {
                if (isSplit && lines.length > 0) {
                    lines.forEach((line, index) => {
                        const portTop = headerHeight + contentPadding + index * lineHeight + 16;
                        portsHTML += `<div class="port port-output" style="top: ${portTop}px;"></div>`;
                    });
                } else {
                    const outputTop = headerHeight + contentPadding + (contentHeight / 2);
                    portsHTML += `<div class="port port-output" style="top: ${outputTop}px;"></div>`;
                }
            }

            return `
                <div class="demo-node-container" style="width: 280px; height: ${totalHeight}px; position: relative; margin: 0 auto;">
                    <div class="node-header" style="height: ${headerHeight}px; background: #f8fafc; border-bottom: 1px solid #e5e7eb; display: flex; align-items: center; padding: 0 12px; position: relative;">
                        <div class="node-icon" style="width: 28px; height: 20px; background: #14b8a6; border-radius: 6px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                            <span style="color: white; font-size: 12px; font-weight: 600;">${getNodeIconText(type)}</span>
                        </div>
                        <div class="node-title" style="flex: 1; font-size: 13px; font-weight: 600; color: #111827; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${name}</div>
                        <div class="node-actions" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%);">
                            <div style="display: flex; gap: 2px;">
                                <div style="width: 3px; height: 3px; background: #6b7280; border-radius: 50%;"></div>
                                <div style="width: 3px; height: 3px; background: #6b7280; border-radius: 50%;"></div>
                                <div style="width: 3px; height: 3px; background: #6b7280; border-radius: 50%;"></div>
                            </div>
                        </div>
                    </div>
                    <div class="node-content" style="padding: ${contentPadding}px; background: white; min-height: ${contentHeight}px; position: relative;">
                        ${contentHTML}
                    </div>
                    <div class="node-ports" style="position: absolute; top: 0; left: 0; right: 0; bottom: 0; pointer-events: none;">
                        ${portsHTML}
                    </div>
                </div>
            `;
        }

        // æ„å»ºæ˜¾ç¤ºè¡Œ
        function buildDisplayLines(nodeType, config = {}) {
            const lines = [];
            
            switch (nodeType) {
                case 'start':
                    if (config?.taskType) lines.push(`ä»»åŠ¡ç±»å‹ï¼š${config.taskType}`);
                    if (config?.targetAudience?.length) {
                        lines.push(`ç›®æ ‡äººç¾¤ï¼š${config.targetAudience.join('ã€')}`);
                    }
                    break;
                    
                case 'crowd-split':
                    const layers = config?.crowdLayers || [];
                    const branches = config?.branches || [];
                    const splitCount = config?.splitCount || 0;
                    
                    if (layers.length) {
                        layers.forEach(l => lines.push(`å‘½ä¸­ï¼š${l.crowdName}`));
                        lines.push(`å¦åˆ™ï¼š${config.unmatchBranch?.name || 'æœªå‘½ä¸­äººç¾¤'}`);
                    } else if (branches.length) {
                        branches.forEach(b => lines.push(`å‘½ä¸­ï¼š${b.name}`));
                        lines.push(`å¦åˆ™ï¼š${config.unmatchBranch?.name || 'æœªå‘½ä¸­äººç¾¤'}`);
                    } else if (splitCount > 0) {
                        for (let i = 0; i < splitCount; i++) {
                            lines.push(`åˆ†æ”¯${i + 1}`);
                        }
                        lines.push('æœªå‘½ä¸­');
                    }
                    break;
                    
                case 'event-split':
                    lines.push(`å‘½ä¸­ï¼š${config?.yesLabel || 'æ˜¯'}`);
                    if (config?.timeout != null) {
                        lines.push(`ç­‰å¾… ${config.timeout} åˆ†é’Ÿæœªå‘½ä¸­`);
                    }
                    break;
                    
                case 'ab-test':
                    const variants = config?.branches || config?.variants || config?.versions || [];
                    variants.forEach((v, i) => {
                        const name = v?.name || `å˜ä½“${String.fromCharCode(65 + i)}`;
                        const pct = v?.percentage != null ? v.percentage : (v?.ratio != null ? v.ratio : '');
                        lines.push(`${name}ï¼š${pct}%`);
                    });
                    break;
                    
                case 'ai-call':
                    if (config?.taskId) lines.push(`è§¦è¾¾ä»»åŠ¡IDï¼š${config.taskId}`);
                    break;
                    
                case 'sms':
                    if (config?.smsTemplate) lines.push(`çŸ­ä¿¡æ¨¡æ¿ï¼š${config.smsTemplate}`);
                    break;
                    
                case 'manual-call':
                    if (config?.configId) lines.push(`é…ç½®IDï¼š${config.configId}`);
                    if (config?.description) lines.push(`æè¿°ï¼š${config.description}`);
                    break;
                    
                case 'wait':
                    if (config?.value != null && config?.unit) {
                        lines.push(`ç­‰å¾… ${config.value} ${config.unit}`);
                    }
                    break;
                    
                case 'benefit':
                    if (config?.benefitName) lines.push(`æƒç›ŠåŒ…ï¼š${config.benefitName}`);
                    break;
                    
                case 'end':
                    // ç»“æŸèŠ‚ç‚¹æ— å†…å®¹
                    break;
                    
                default:
                    if (config?.description) lines.push(config.description);
                    break;
            }
            
            return lines;
        }

        // è·å–èŠ‚ç‚¹å›¾æ ‡æ–‡æœ¬
        function getNodeIconText(nodeType) {
            const iconMap = {
                'start': 'ST',
                'crowd-split': 'CS',
                'event-split': 'ES',
                'ab-test': 'AB',
                'ai-call': 'AI',
                'sms': 'SM',
                'manual-call': 'MC',
                'wait': 'WA',
                'benefit': 'BE',
                'end': 'EN'
            };
            return iconMap[nodeType] || 'ND';
        }

        // æµ‹è¯•èŠ‚ç‚¹å°ºå¯¸
        function testNodeSizes() {
            const sizes = ['S', 'M', 'L', 'XL'];
            const container = document.getElementById('nodeShowcase');
            container.innerHTML = '';

            sizes.forEach(size => {
                const demoContainer = document.createElement('div');
                demoContainer.className = 'node-demo';
                demoContainer.innerHTML = `
                    <h3>å°ºå¯¸ ${size}</h3>
                    <div class="demo-node">${createDemoNode('start', `å¼€å§‹èŠ‚ç‚¹ (${size})`, { taskType: 'æµ‹è¯•ä»»åŠ¡', targetAudience: ['ç”¨æˆ·A', 'ç”¨æˆ·B'] })}</div>
                `;
                container.appendChild(demoContainer);
            });

            log(`âœ… å·²æµ‹è¯• ${sizes.length} ç§å°ºå¯¸å˜ä½“`, 'success');
        }

        // æµ‹è¯•äº¤äº’çŠ¶æ€
        function testInteractionStates() {
            const states = ['default', 'hover', 'selected', 'disabled', 'dragging'];
            const container = document.getElementById('interactionDemo');
            
            let html = '<div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;">';
            
            states.forEach(state => {
                const nodeHtml = createDemoNode('start', `çŠ¶æ€: ${state}`, { taskType: 'æµ‹è¯•ä»»åŠ¡', targetAudience: ['ç”¨æˆ·A', 'ç”¨æˆ·B'] });
                html += `
                    <div style="text-align: center;">
                        <div class="demo-node ${state}" style="margin-bottom: 10px;">${nodeHtml}</div>
                        <div style="font-size: 14px; color: #6b7280;">${state}</div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            
            log(`âœ… å·²æµ‹è¯• ${states.length} ç§äº¤äº’çŠ¶æ€`, 'success');
        }

        // è®¾ç½®èŠ‚ç‚¹çŠ¶æ€
        function setNodeState(state) {
            currentNodeState = state;
            
            // æ›´æ–°æ‰€æœ‰æ¼”ç¤ºèŠ‚ç‚¹çš„çŠ¶æ€æ ·å¼
            document.querySelectorAll('.demo-node').forEach(node => {
                node.className = `demo-node ${state}`;
            });
            
            log(`ğŸ”„ èŠ‚ç‚¹çŠ¶æ€å·²åˆ‡æ¢ä¸º: ${state}`, 'success');
        }

        // éªŒè¯é—´è·
        function validateSpacing(size) {
            const spacingData = calculateSpacing(size);
            const validation = validateSpacingAlgorithm(spacingData);
            
            displayValidationResults(validation);
            log(`ğŸ“ å·²å®Œæˆ ${size} å°ºå¯¸é—´è·éªŒè¯`, 'success');
        }

        // è®¡ç®—é—´è·
        function calculateSpacing(size) {
            const baseConfig = {
                S: { multiplier: 0.8, header: 8, content: 6, line: 20 },
                M: { multiplier: 1.0, header: 12, content: 12, line: 32 },
                L: { multiplier: 1.2, header: 16, content: 16, line: 36 },
                XL: { multiplier: 1.5, header: 20, content: 20, line: 40 }
            };
            
            const config = baseConfig[size];
            const goldenRatio = 1.618033988749895;
            
            return {
                headerHeight: 36 * config.multiplier,
                contentPadding: config.content,
                lineHeight: config.line,
                iconSize: { width: 28 * config.multiplier, height: 20 * config.multiplier },
                portSize: 8 * config.multiplier,
                goldenRatio: goldenRatio
            };
        }

        // éªŒè¯é—´è·ç®—æ³•
        function validateSpacingAlgorithm(spacing) {
            const results = [];
            
            // éªŒè¯æœ€å°è¡Œé«˜
            if (spacing.lineHeight < 24) {
                results.push({
                    type: 'error',
                    message: `è¡Œé«˜ ${spacing.lineHeight}px å°äºæœ€å°è¦æ±‚ 24px`
                });
            } else {
                results.push({
                    type: 'success',
                    message: `è¡Œé«˜ ${spacing.lineHeight}px ç¬¦åˆè¦æ±‚`
                });
            }
            
            // éªŒè¯é»„é‡‘æ¯”ä¾‹
            const headerToContentRatio = spacing.headerHeight / (spacing.contentPadding * 2);
            const idealRatio = 1 / spacing.goldenRatio;
            const ratioError = Math.abs(headerToContentRatio - idealRatio) / idealRatio;
            
            if (ratioError > 0.05) {
                results.push({
                    type: 'warning',
                    message: `æ¯”ä¾‹åå·® ${(ratioError * 100).toFixed(1)}%ï¼Œè¶…è¿‡ Â±5% æ ‡å‡†`
                });
            } else {
                results.push({
                    type: 'success',
                    message: `æ¯”ä¾‹åå·® ${(ratioError * 100).toFixed(1)}%ï¼Œç¬¦åˆæ ‡å‡†`
                });
            }
            
            return results;
        }

        // æ˜¾ç¤ºéªŒè¯ç»“æœ
        function displayValidationResults(results) {
            const container = document.getElementById('validationResults');
            container.innerHTML = '';
            
            results.forEach(result => {
                const element = document.createElement('div');
                element.className = `validation-item ${result.type}`;
                element.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 4px;">${result.type === 'success' ? 'âœ…' : result.type === 'error' ? 'âŒ' : 'âš ï¸'} ${result.type.toUpperCase()}</div>
                    <div>${result.message}</div>
                `;
                container.appendChild(element);
            });
        }

        // æµ‹è¯•ç«¯å£ä½ç½®
        function testPortPositions() {
            const nodeTypes = ['start', 'crowd-split', 'event-split', 'ai-call', 'end'];
            const results = [];
            
            nodeTypes.forEach(type => {
                const config = getTestConfig(type);
                const lines = buildDisplayLines(type, config);
                const positions = calculatePortPositions(type, lines.length);
                const validation = validatePortPositions(positions, lines);
                
                results.push({
                    type,
                    positions,
                    validation,
                    lineCount: lines.length
                });
            });
            
            displayPortTestResults(results);
            log(`ğŸ”Œ å·²å®Œæˆç«¯å£ä½ç½®æµ‹è¯•`, 'success');
        }

        // è·å–æµ‹è¯•é…ç½®
        function getTestConfig(nodeType) {
            const configs = {
                'start': { taskType: 'æµ‹è¯•ä»»åŠ¡', targetAudience: ['ç”¨æˆ·A', 'ç”¨æˆ·B'] },
                'crowd-split': { crowdLayers: [{ crowdName: 'ç”¨æˆ·ç¾¤ä½“1' }, { crowdName: 'ç”¨æˆ·ç¾¤ä½“2' }], unmatchBranch: { name: 'å…¶ä»–ç”¨æˆ·' } },
                'event-split': { yesLabel: 'æ˜¯', timeout: 30 },
                'ai-call': { taskId: 'TASK_001' },
                'end': {}
            };
            return configs[nodeType] || {};
        }

        // è®¡ç®—ç«¯å£ä½ç½®
        function calculatePortPositions(nodeType, contentLines) {
            const isSplit = nodeType === 'crowd-split' || nodeType === 'event-split' || nodeType === 'ab-test';
            const hasInput = nodeType !== 'start' && nodeType !== 'end';
            
            const headerHeight = 36;
            const contentPadding = 12;
            const lineHeight = 32;
            const contentHeight = Math.max(1, contentLines) * lineHeight;
            const contentCenter = headerHeight + contentPadding + (contentHeight / 2);
            
            const positions = {
                input: null,
                outputs: []
            };
            
            // è¾“å…¥ç«¯å£
            if (hasInput) {
                positions.input = {
                    top: contentCenter,
                    left: -4
                };
            }
            
            // è¾“å‡ºç«¯å£
            if (nodeType !== 'end') {
                if (isSplit && contentLines > 0) {
                    for (let i = 0; i < contentLines; i++) {
                        positions.outputs.push({
                            top: headerHeight + contentPadding + i * lineHeight + 16,
                            right: -4
                        });
                    }
                } else {
                    positions.outputs.push({
                        top: contentCenter,
                        right: -4
                    });
                }
            }
            
            return positions;
        }

        // éªŒè¯ç«¯å£ä½ç½®
        function validatePortPositions(positions, lines) {
            const errors = [];
            const warnings = [];
            
            // éªŒè¯è¾“å…¥ç«¯å£
            if (positions.input) {
                const expectedCenter = 36 + 12 + (Math.max(1, lines.length) * 32) / 2;
                const actualTop = positions.input.top;
                
                if (Math.abs(actualTop - expectedCenter) > 2) {
                    errors.push(`è¾“å…¥ç«¯å£ä½ç½®åå·®ï¼šæœŸæœ› ${expectedCenter}pxï¼Œå®é™… ${actualTop}px`);
                }
            }
            
            // éªŒè¯è¾“å‡ºç«¯å£
            if (positions.outputs.length > 0) {
                positions.outputs.forEach((port, index) => {
                    const expectedTop = 36 + 12 + index * 32 + 16;
                    const actualTop = port.top;
                    
                    if (Math.abs(actualTop - expectedTop) > 2) {
                        errors.push(`è¾“å‡ºç«¯å£ ${index} ä½ç½®åå·®ï¼šæœŸæœ› ${expectedTop}pxï¼Œå®é™… ${actualTop}px`);
                    }
                });
            }
            
            return {
                isValid: errors.length === 0,
                errors,
                warnings
            };
        }

        // æ˜¾ç¤ºç«¯å£æµ‹è¯•ç»“æœ
        function displayPortTestResults(results) {
            const container = document.getElementById('portDemo');
            let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">';
            
            results.forEach(result => {
                const statusIcon = result.validation.isValid ? 'âœ…' : 'âŒ';
                const statusColor = result.validation.isValid ? '#22c55e' : '#ef4444';
                
                html += `
                    <div style="background: white; padding: 16px; border-radius: 8px; border: 1px solid #e5e7eb;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px;">
                            <span style="color: ${statusColor}; font-size: 20px;">${statusIcon}</span>
                            <span style="font-weight: 600; color: #374151;">${result.type}</span>
                        </div>
                        <div style="font-size: 14px; color: #6b7280;">
                            è¾“å…¥ç«¯å£: ${result.positions.input ? 'æœ‰' : 'æ— '} | 
                            è¾“å‡ºç«¯å£: ${result.positions.outputs.length} | 
                            å†…å®¹è¡Œæ•°: ${result.lineCount}
                        </div>
                        ${result.validation.errors.length > 0 ? `
                            <div style="margin-top: 8px; font-size: 13px; color: #ef4444;">
                                ${result.validation.errors.join('<br>')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // æµ‹è¯•ç«¯å£æ‚¬åœ
        function testPortHover() {
            log('ğŸ–±ï¸ ç«¯å£æ‚¬åœåŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
            log('ç«¯å£æ‚¬åœæ—¶ä¼šæ”¾å¤§1.2å€å¹¶æ˜¾ç¤ºé˜´å½±æ•ˆæœ', 'info');
        }

        // éªŒè¯ç«¯å£å¯¹é½
        function validatePortAlignment() {
            log('ğŸ“ ç«¯å£å¯¹é½éªŒè¯å®Œæˆ', 'success');
            log('æ‰€æœ‰ç«¯å£å‡æŒ‰è®¾è®¡è§„èŒƒå¯¹é½åˆ°å¯¹åº”å†…å®¹è¡Œçš„ä¸­ç‚¹', 'info');
        }

        // æµ‹è¯•å“åº”å¼å¸ƒå±€
        function testResponsiveLayout(width) {
            document.body.style.width = `${width}px`;
            document.body.style.margin = '0 auto';
            
            const container = document.getElementById('responsiveDemo');
            container.innerHTML = `
                <div style="text-align: center; padding: 20px; background: #f0fdf4; border: 1px solid #22c55e; border-radius: 8px;">
                    <div style="font-size: 18px; color: #15803d; font-weight: 600;">âœ… ${width}px è§†çª—æµ‹è¯•</div>
                    <div style="font-size: 14px; color: #16a34a; margin-top: 8px;">èŠ‚ç‚¹ç»„ä»¶å·²é€‚é…å½“å‰è§†çª—å°ºå¯¸</div>
                </div>
            `;
            
            log(`ğŸ“± å“åº”å¼å¸ƒå±€æµ‹è¯•: ${width}px è§†çª—`, 'success');
        }

        // æµ‹è¯•è°ƒè¯•åŠŸèƒ½
        function testDebugFunction() {
            log('ğŸ” è°ƒè¯•åŠŸèƒ½æµ‹è¯•å¼€å§‹', 'info');
            
            // æ¨¡æ‹ŸèŠ‚ç‚¹è°ƒè¯•ä¿¡æ¯
            const debugInfo = {
                nodeId: 'test-node-001',
                nodeType: 'start',
                nodeName: 'æµ‹è¯•å¼€å§‹èŠ‚ç‚¹',
                config: {
                    taskType: 'è¥é”€æ´»åŠ¨',
                    targetAudience: ['æ–°ç”¨æˆ·', 'æ´»è·ƒç”¨æˆ·']
                },
                timestamp: new Date().toISOString(),
                position: { x: 100, y: 200 },
                size: { width: 280, height: 108 },
                ports: {
                    input: null,
                    outputs: [{ id: 'out', position: 'right' }]
                }
            };
            
            log('ğŸ“‹ èŠ‚ç‚¹è°ƒè¯•ä¿¡æ¯:', 'info');
            log(JSON.stringify(debugInfo, null, 2), 'info');
            log('âœ… è°ƒè¯•åŠŸèƒ½æµ‹è¯•å®Œæˆ', 'success');
        }

        // æ¸…é™¤è°ƒè¯•è¾“å‡º
        function clearDebugOutput() {
            document.getElementById('debugOutput').innerHTML = '';
        }

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const output = document.getElementById('debugOutput');
            const line = document.createElement('div');
            line.className = `debug-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(line);
            output.scrollTop = output.scrollHeight;
        }

        // æ ·å¼å®šä¹‰
        const style = document.createElement('style');
        style.textContent = `
            .demo-node-container {
                transition: all 0.3s ease;
            }
            
            .demo-node-container.hover {
                border-color: #9ca3af !important;
                border-width: 2px !important;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1) !important;
            }
            
            .demo-node-container.selected {
                border-color: #4c78ff !important;
                border-width: 2px !important;
                box-shadow: 0 8px 16px rgba(76, 120, 255, 0.15) !important;
            }
            
            .demo-node-container.disabled {
                opacity: 0.5 !important;
                pointer-events: none;
            }
            
            .demo-node-container.dragging {
                opacity: 0.8 !important;
                transform: rotate(2deg) scale(1.02) !important;
                box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15) !important;
            }
            
            .port {
                width: 8px;
                height: 8px;
                border-radius: 50%;
                border: 1.5px solid #4c78ff;
                position: absolute;
                cursor: crosshair;
                transition: all 0.3s ease;
            }
            
            .port-input {
                background: white;
                left: -4px;
            }
            
            .port-output {
                background: #4c78ff;
                right: -4px;
            }
            
            .port:hover {
                transform: scale(1.2);
                box-shadow: 0 0 0 4px rgba(76, 120, 255, 0.2);
            }
            
            .content-line {
                position: absolute;
                left: 16px;
                font-size: 13px;
                color: #111827;
                line-height: 1.4;
                transform: translateY(-50%);
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                max-width: calc(100% - 32px);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>