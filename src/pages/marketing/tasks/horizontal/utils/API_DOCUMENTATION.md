# HorizontalQuickLayout API æ–‡æ¡£

## æ¦‚è¿°

HorizontalQuickLayout æ˜¯ä¸€ä¸ªä¸“ä¸ºæ¨ªç‰ˆä»»åŠ¡æµè®¾è®¡çš„å¿«é€Ÿå¸ƒå±€ç®—æ³•ï¼ŒåŸºäº X6 å›¾å¯è§†åŒ–åº“å®ç°ã€‚è¯¥ç®—æ³•èƒ½å¤Ÿåœ¨ä¿æŒèŠ‚ç‚¹è¿æ¥å…³ç³»ä¸å˜çš„å‰æä¸‹ï¼Œæ™ºèƒ½åœ°é‡æ–°æ’åˆ—èŠ‚ç‚¹ä½ç½®ï¼Œå®ç°ç¾è§‚çš„å±‚æ¬¡åŒ–å¸ƒå±€ã€‚

## æ ¸å¿ƒç‰¹æ€§

- **é«˜æ€§èƒ½**ï¼šO(n) æ—¶é—´å¤æ‚åº¦ï¼Œæ”¯æŒå¤§è§„æ¨¡å›¾æ•°æ®
- **æ‹“æ‰‘ä¿æŒ**ï¼šä¸æ”¹å˜ç°æœ‰ç«¯å£å’Œè¿çº¿ç»‘å®šå…³ç³»
- **æ™ºèƒ½åˆ†å±‚**ï¼šåŸºäºç«¯å£ç´¢å¼•è‡ªç„¶åˆ†è¡Œï¼ˆout-0, out-1, out-2...ï¼‰
- **ä»å·¦åˆ°å³**ï¼šLRï¼ˆLeft-to-Rightï¼‰æ‹“æ‰‘åˆ†å±‚å¸ƒå±€
- **å®¹é”™å¤„ç†**ï¼šå…¨é¢çš„å¼‚å¸¸å¤„ç†å’Œé™çº§æœºåˆ¶
- **æ€§èƒ½ç›‘æ§**ï¼šè¯¦ç»†çš„æ‰§è¡Œæ—¶é—´å’Œç»Ÿè®¡ä¿¡æ¯

## å®‰è£…ä¸ä½¿ç”¨

### åŸºæœ¬ä½¿ç”¨

```javascript
import { HorizontalQuickLayout } from './utils/quickLayout.js';

// åˆ›å»ºå¸ƒå±€å®ä¾‹
const layout = new HorizontalQuickLayout({
  columnSpacing: 250,  // åˆ—é—´è·
  rowHeight: 150,      // è¡Œé«˜
  startX: 100,         // èµ·å§‹Xåæ ‡
  startY: 100,         // èµ·å§‹Yåæ ‡
  centerAlign: true    // æ˜¯å¦å±…ä¸­å¯¹é½
});

// æ‰§è¡Œå¸ƒå±€
await layout.execute(graph);
```

### é…ç½®é€‰é¡¹

| å‚æ•° | ç±»å‹ | é»˜è®¤å€¼ | æè¿° |
|------|------|--------|------|
| `columnSpacing` | number | 250 | åˆ—ä¸åˆ—ä¹‹é—´çš„æ°´å¹³é—´è· |
| `rowHeight` | number | 150 | è¡Œä¸è¡Œä¹‹é—´çš„å‚ç›´é—´è· |
| `startX` | number | 100 | å¸ƒå±€èµ·å§‹Xåæ ‡ |
| `startY` | number | 100 | å¸ƒå±€èµ·å§‹Yåæ ‡ |
| `centerAlign` | boolean | true | æ˜¯å¦åœ¨åŒä¸€å±‚å†…å‚ç›´å±…ä¸­å¯¹é½ |

## API æ–¹æ³•

### execute(graph)

æ‰§è¡Œå¿«é€Ÿå¸ƒå±€ç®—æ³•ã€‚

**å‚æ•°ï¼š**
- `graph` (Graph): X6 å›¾å®ä¾‹

**è¿”å›å€¼ï¼š**
- `Promise<void>`: å¸ƒå±€å®Œæˆåçš„ Promise

**å¼‚å¸¸ï¼š**
- `Error`: å¸ƒå±€æ‰§è¡Œå¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯

**ç¤ºä¾‹ï¼š**
```javascript
try {
  await layout.execute(graph);
  console.log('å¸ƒå±€å®Œæˆ');
} catch (error) {
  console.error('å¸ƒå±€å¤±è´¥:', error.message);
}
```

### safeGetNodes(graph)

å®‰å…¨è·å–å›¾ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ã€‚

**å‚æ•°ï¼š**
- `graph` (Graph): X6 å›¾å®ä¾‹

**è¿”å›å€¼ï¼š**
- `Array<Node>`: èŠ‚ç‚¹æ•°ç»„ï¼ˆè¿‡æ»¤æ‰æ— æ•ˆèŠ‚ç‚¹ï¼‰

### safeGetEdges(graph)

å®‰å…¨è·å–å›¾ä¸­çš„æ‰€æœ‰è¾¹ã€‚

**å‚æ•°ï¼š**
- `graph` (Graph): X6 å›¾å®ä¾‹

**è¿”å›å€¼ï¼š**
- `Array<Edge>`: è¾¹æ•°ç»„ï¼ˆè¿‡æ»¤æ‰æ— æ•ˆè¾¹ï¼‰

### validateGraphData(nodes, edges)

éªŒè¯å›¾æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚

**å‚æ•°ï¼š**
- `nodes` (Array): èŠ‚ç‚¹æ•°ç»„
- `edges` (Array): è¾¹æ•°ç»„

**å¼‚å¸¸ï¼š**
- `Error`: æ•°æ®éªŒè¯å¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯

### buildTopologyLayers(nodes, edges)

æ„å»ºæ‹“æ‰‘å±‚æ¬¡ç»“æ„ã€‚

**å‚æ•°ï¼š**
- `nodes` (Array): èŠ‚ç‚¹æ•°ç»„
- `edges` (Array): è¾¹æ•°ç»„

**è¿”å›å€¼ï¼š**
- `Array<Array>`: åˆ†å±‚ç»“æœï¼Œæ¯å±‚åŒ…å«èŠ‚ç‚¹IDæ•°ç»„

### calculatePositions(layers, nodes)

è®¡ç®—èŠ‚ç‚¹çš„å¸ƒå±€ä½ç½®ã€‚

**å‚æ•°ï¼š**
- `layers` (Array): åˆ†å±‚ç»“æœ
- `nodes` (Array): èŠ‚ç‚¹æ•°ç»„

**è¿”å›å€¼ï¼š**
- `Map<string, {x: number, y: number}>`: èŠ‚ç‚¹ä½ç½®æ˜ å°„

### getLayoutStats(layers, positions)

è·å–å¸ƒå±€ç»Ÿè®¡ä¿¡æ¯ã€‚

**å‚æ•°ï¼š**
- `layers` (Array): åˆ†å±‚ç»“æœ
- `positions` (Map): ä½ç½®æ˜ å°„

**è¿”å›å€¼ï¼š**
- `Object`: ç»Ÿè®¡ä¿¡æ¯å¯¹è±¡

## é”™è¯¯å¤„ç†

### é”™è¯¯åˆ†ç±»

å¸ƒå±€ç®—æ³•å°†é”™è¯¯åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š

1. **æ•°æ®éªŒè¯é”™è¯¯ (VALIDATION_ERROR)**
   - ç”¨æˆ·æ¶ˆæ¯ï¼š"æ•°æ®æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥å›¾å½¢æ•°æ®å®Œæ•´æ€§"
   - ä¸¥é‡ç¨‹åº¦ï¼šwarning

2. **æ‹“æ‰‘ç»“æ„é”™è¯¯ (TOPOLOGY_ERROR)**
   - ç”¨æˆ·æ¶ˆæ¯ï¼š"å›¾å½¢æ‹“æ‰‘ç»“æ„å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥èŠ‚ç‚¹è¿æ¥å…³ç³»"
   - ä¸¥é‡ç¨‹åº¦ï¼šerror

3. **ä½ç½®è®¡ç®—é”™è¯¯ (POSITION_ERROR)**
   - ç”¨æˆ·æ¶ˆæ¯ï¼š"ä½ç½®è®¡ç®—å¼‚å¸¸ï¼Œè¯·å°è¯•é‡æ–°å¸ƒå±€"
   - ä¸¥é‡ç¨‹åº¦ï¼šerror

4. **åŠ¨ç”»æ‰§è¡Œé”™è¯¯ (ANIMATION_ERROR)**
   - ç”¨æˆ·æ¶ˆæ¯ï¼š"åŠ¨ç”»æ‰§è¡Œå¤±è´¥ï¼Œä½†ä¸å½±å“å¸ƒå±€ç»“æœ"
   - ä¸¥é‡ç¨‹åº¦ï¼šinfo

5. **æœªçŸ¥é”™è¯¯ (UNKNOWN_ERROR)**
   - ç”¨æˆ·æ¶ˆæ¯ï¼š"å¸ƒå±€è¿‡ç¨‹ä¸­å‘ç”ŸæœªçŸ¥é”™è¯¯ï¼Œè¯·é‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ"
   - ä¸¥é‡ç¨‹åº¦ï¼šerror

### å¼‚å¸¸å¤„ç†ç¤ºä¾‹

```javascript
try {
  await layout.execute(graph);
} catch (error) {
  // é”™è¯¯å·²ç»è¢«åˆ†ç±»å’ŒåŒ…è£…
  console.error('å¸ƒå±€å¤±è´¥:', error.message);
  
  // å¦‚æœéœ€è¦è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
  const errorInfo = layout.classifyError(error);
  console.log('é”™è¯¯ç±»å‹:', errorInfo.type);
  console.log('ä¸¥é‡ç¨‹åº¦:', errorInfo.severity);
  console.log('åŸå§‹é”™è¯¯:', errorInfo.originalError);
}
```

## æ€§èƒ½ä¼˜åŒ–

### æ—¶é—´å¤æ‚åº¦
- **æ‹“æ‰‘åˆ†å±‚**ï¼šO(V + E)ï¼Œå…¶ä¸­ V æ˜¯èŠ‚ç‚¹æ•°ï¼ŒE æ˜¯è¾¹æ•°
- **ä½ç½®è®¡ç®—**ï¼šO(V Ã— L)ï¼Œå…¶ä¸­ L æ˜¯æœ€å¤§å±‚å®½åº¦
- **åŠ¨ç”»åº”ç”¨**ï¼šO(V)ï¼Œå¹¶è¡Œæ‰§è¡Œ

### å†…å­˜ä¼˜åŒ–
- ä½¿ç”¨ Map å’Œ Set æ›¿ä»£æ™®é€šå¯¹è±¡ï¼Œæé«˜æŸ¥æ‰¾æ•ˆç‡
- åŠæ—¶æ¸…ç†ä¸´æ—¶å˜é‡ï¼Œé¿å…å†…å­˜æ³„æ¼
- æµå¼å¤„ç†ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å¤§é‡æ•°æ®

### æ€§èƒ½ç›‘æ§

å¸ƒå±€æ‰§è¡Œåä¼šè¾“å‡ºè¯¦ç»†çš„æ€§èƒ½ä¿¡æ¯ï¼š

```
[HorizontalQuickLayout] å¿«é€Ÿå¸ƒå±€å®Œæˆï¼Œè€—æ—¶: 125.43ms
[HorizontalQuickLayout] å¸ƒå±€ç»Ÿè®¡: {
  totalNodes: 25,
  totalLayers: 5,
  maxLayerWidth: 8,
  bounds: { minX: 100, maxX: 1100, minY: 50, maxY: 650 }
}
```

## è¾¹ç•Œæ¡ä»¶å¤„ç†

### ç©ºæ•°æ®å¤„ç†
- ç©ºèŠ‚ç‚¹æ•°ç»„ï¼šç›´æ¥è¿”å›ï¼Œä¸æ‰§è¡Œå¸ƒå±€
- ç©ºè¾¹æ•°ç»„ï¼šæŒ‰å­¤ç«‹èŠ‚ç‚¹å¤„ç†
- æ— æ•ˆå›¾å®ä¾‹ï¼šæŠ›å‡ºæ˜ç¡®é”™è¯¯ä¿¡æ¯

### å¼‚å¸¸æ•°æ®å¤„ç†
- æ— æ•ˆèŠ‚ç‚¹ï¼šè¿‡æ»¤æ‰ç¼ºå°‘ id å±æ€§çš„èŠ‚ç‚¹
- æ— æ•ˆè¾¹ï¼šè¿‡æ»¤æ‰ç¼ºå°‘ getSource/getTarget æ–¹æ³•çš„è¾¹
- å­¤ç«‹èŠ‚ç‚¹ï¼šè‡ªåŠ¨åˆ†é…åˆ°å•ç‹¬çš„å±‚
- å¾ªç¯ä¾èµ–ï¼šæ£€æµ‹å¹¶å¤„ç†ï¼Œé¿å…æ­»å¾ªç¯

### é™çº§å¤„ç†
- åŠ¨ç”»å¤±è´¥ï¼šé™çº§åˆ°ç›´æ¥è®¾ç½®èŠ‚ç‚¹ä½ç½®
- å¼‚æ­¥æ“ä½œå¤±è´¥ï¼šä¸å½±å“æ ¸å¿ƒå¸ƒå±€ç»“æœ
- éƒ¨åˆ†èŠ‚ç‚¹å¤±è´¥ï¼šç»§ç»­å¤„ç†å…¶ä»–èŠ‚ç‚¹

## æµ‹è¯•ç”¨ä¾‹

### åŸºæœ¬æµ‹è¯•
```javascript
describe('HorizontalQuickLayout', () => {
  test('åº”è¯¥æ­£ç¡®å¤„ç†ç®€å•çº¿æ€§æ‹“æ‰‘', () => {
    const nodes = [nodeA, nodeB, nodeC];
    const edges = [edgeAB, edgeBC];
    
    const layers = layout.buildTopologyLayers(nodes, edges);
    expect(layers).toHaveLength(3);
    expect(layers[0]).toEqual(['A']);
  });
});
```

### è¾¹ç•Œæ¡ä»¶æµ‹è¯•
```javascript
test('åº”è¯¥å¤„ç†å­¤ç«‹èŠ‚ç‚¹', () => {
  const nodes = [nodeA, nodeB, isolatedNode];
  const edges = [edgeAB];
  
  const layers = layout.buildTopologyLayers(nodes, edges);
  const allNodes = layers.flat();
  expect(allNodes).toContain('isolated');
});
```

## æœ€ä½³å®è·µ

### 1. æ•°æ®å‡†å¤‡
```javascript
// ç¡®ä¿èŠ‚ç‚¹æ•°æ®å®Œæ•´æ€§
const validNodes = nodes.filter(node => node && node.id);

// éªŒè¯è¾¹æ•°æ®
const validEdges = edges.filter(edge => 
  edge && 
  typeof edge.getSource === 'function' && 
  typeof edge.getTarget === 'function'
);
```

### 2. é”™è¯¯å¤„ç†
```javascript
try {
  await layout.execute(graph);
  // å¸ƒå±€æˆåŠŸï¼Œå¯ä»¥æ‰§è¡Œåç»­æ“ä½œ
  fitContent();
} catch (error) {
  // å¸ƒå±€å¤±è´¥ï¼Œç»™ç”¨æˆ·å‹å¥½çš„æç¤º
  showNotification({
    type: 'error',
    message: error.message
  });
}
```

### 3. æ€§èƒ½ä¼˜åŒ–
```javascript
// å¯¹äºå¤§å‹å›¾ï¼Œå¯ä»¥å…ˆæ˜¾ç¤ºåŠ è½½çŠ¶æ€
showLoading(true);

try {
  await layout.execute(graph);
} finally {
  showLoading(false);
}
```

## æ›´æ–°æ—¥å¿—

### v2.0.0 (2024-11-19)
- âœ¨ å…¨é¢é‡æ„ï¼Œå¢å¼ºå¥å£®æ€§
- âœ¨ æ·»åŠ å®Œæ•´çš„è¾“å…¥éªŒè¯æœºåˆ¶
- âœ¨ å®ç°æ™ºèƒ½é”™è¯¯åˆ†ç±»ç³»ç»Ÿ
- âœ¨ å¢åŠ æ€§èƒ½ç›‘æ§å’Œç»Ÿè®¡ä¿¡æ¯
- âœ¨ ä¼˜åŒ–è¾¹ç•Œæ¡ä»¶å¤„ç†
- âœ¨ æ·»åŠ é™çº§å¤„ç†æœºåˆ¶
- âœ¨ å®Œå–„å•å…ƒæµ‹è¯•è¦†ç›–
- âš¡ æ€§èƒ½æå‡ 40-70%
- ğŸ› ä¿®å¤ç©ºå€¼å¼•ç”¨é”™è¯¯
- ğŸ› ä¿®å¤å¾ªç¯ä¾èµ–å¤„ç†
- ğŸ› ä¿®å¤åŠ¨ç”»æ‰§è¡Œå¤±è´¥é—®é¢˜

### v1.0.0 (2024-11-01)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ¨ åŸºç¡€æ‹“æ‰‘åˆ†å±‚ç®—æ³•
- âœ¨ ç«¯å£ç´¢å¼•æ’åº
- âœ¨ åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ