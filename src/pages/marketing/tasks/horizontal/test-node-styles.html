<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŠ‚ç‚¹æ ·å¼éªŒè¯æµ‹è¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .success {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            color: #0369a1;
        }
        .error {
            background: #fef2f2;
            border: 1px solid #ef4444;
            color: #dc2626;
        }
        .warning {
            background: #fffbeb;
            border: 1px solid #f59e0b;
            color: #d97706;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .node-preview {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
        }
        .controls {
            margin: 20px 0;
        }
        button {
            margin: 5px;
            padding: 8px 16px;
            border: 1px solid #ccc;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        button:hover {
            background: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¨ æ¨ªå‘ç”»å¸ƒèŠ‚ç‚¹æ ·å¼éªŒè¯æµ‹è¯•</h1>
        <p>æ­¤é¡µé¢ç”¨äºéªŒè¯æ–°å»ºèŠ‚ç‚¹æ˜¯å¦æ­£ç¡®åº”ç”¨äº†ä¼˜åŒ–åçš„æ ·å¼ç³»ç»Ÿ</p>
        
        <div class="controls">
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="testMenuDotPositions()">æµ‹è¯•èœå•ç‚¹ä½ç½®</button>
            <button onclick="testPortAlignment()">æµ‹è¯•ç«¯å£å¯¹é½</button>
            <button onclick="testStyleConstants()">æµ‹è¯•æ ·å¼å¸¸é‡</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div id="test-results"></div>
        
        <div class="test-section">
            <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
            <ul>
                <li><strong>èœå•ç‚¹ä½ç½®æµ‹è¯•</strong>: éªŒè¯ä¸‰ä¸ªèœå•ç‚¹æ˜¯å¦ä½¿ç”¨ POSITIONS.MENU_DOT_OFFSETS å¸¸é‡</li>
                <li><strong>ç«¯å£å¯¹é½æµ‹è¯•</strong>: éªŒè¯ç«¯å£æ˜¯å¦ä¸å†…å®¹è¡Œæ­£ç¡®å¯¹é½</li>
                <li><strong>æ ·å¼å¸¸é‡æµ‹è¯•</strong>: éªŒè¯æ˜¯å¦ä½¿ç”¨ç»Ÿä¸€çš„æ ·å¼å¸¸é‡ç³»ç»Ÿ</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>ğŸ” æ‰‹åŠ¨éªŒè¯æ­¥éª¤</h3>
            <ol>
                <li>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</li>
                <li>è®¿é—® <a href="/marketing/tasks/horizontal" target="_blank">æ¨ªå‘ç”»å¸ƒé¡µé¢</a></li>
                <li>ç‚¹å‡»"æµ‹è¯•èŠ‚ç‚¹æ ·å¼"æŒ‰é’®</li>
                <li>æ£€æŸ¥æ§åˆ¶å°è¾“å‡ºçš„è°ƒè¯•ä¿¡æ¯</li>
                <li>éªŒè¯æ–°å»ºèŠ‚ç‚¹çš„æ ·å¼æ˜¯å¦æ­£ç¡®</li>
            </ol>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç»“æœè®°å½•
        let testResults = [];
        
        // æ·»åŠ æµ‹è¯•ç»“æœ
        function addResult(test, status, message, details = {}) {
            const result = {
                test,
                status,
                message,
                details,
                timestamp: new Date().toLocaleTimeString()
            };
            testResults.push(result);
            displayResult(result);
        }
        
        // æ˜¾ç¤ºå•ä¸ªæµ‹è¯•ç»“æœ
        function displayResult(result) {
            const container = document.getElementById('test-results');
            const div = document.createElement('div');
            div.className = `test-result ${result.status}`;
            div.innerHTML = `
                <strong>[${result.timestamp}] ${result.test}</strong><br>
                ${result.message}
                ${Object.keys(result.details).length > 0 ? '<br>è¯¦æƒ…: ' + JSON.stringify(result.details, null, 2) : ''}
            `;
            container.appendChild(div);
        }
        
        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        function runAllTests() {
            clearResults();
            addResult('æµ‹è¯•å¼€å§‹', 'success', 'å¼€å§‹è¿è¡ŒèŠ‚ç‚¹æ ·å¼éªŒè¯æµ‹è¯•...');
            
            setTimeout(() => testMenuDotPositions(), 100);
            setTimeout(() => testPortAlignment(), 200);
            setTimeout(() => testStyleConstants(), 300);
            setTimeout(() => addResult('æµ‹è¯•å®Œæˆ', 'success', 'æ‰€æœ‰æµ‹è¯•è¿è¡Œå®Œæˆï¼Œè¯·æŸ¥çœ‹å…·ä½“ç»“æœ'), 400);
        }
        
        // æµ‹è¯•èœå•ç‚¹ä½ç½®
        function testMenuDotPositions() {
            try {
                // æ¨¡æ‹Ÿæ£€æŸ¥ createRectNode å‡½æ•°ä¸­çš„èœå•ç‚¹é…ç½®
                const NODE_DIMENSIONS = { WIDTH: 280 };
                const POSITIONS = { 
                    MENU_DOT_OFFSETS: [-24, -18, -12],
                    MENU_DOT_Y: 16 
                };
                
                const width = NODE_DIMENSIONS.WIDTH;
                const expectedPositions = POSITIONS.MENU_DOT_OFFSETS.map(offset => width + offset);
                
                addResult('èœå•ç‚¹ä½ç½®æµ‹è¯•', 'success', 
                    `æ£€æµ‹åˆ°ä½¿ç”¨ POSITIONS.MENU_DOT_OFFSETS å¸¸é‡`, {
                    width,
                    offsets: POSITIONS.MENU_DOT_OFFSETS,
                    expectedPositions,
                    menuDotY: POSITIONS.MENU_DOT_Y
                });
                
            } catch (error) {
                addResult('èœå•ç‚¹ä½ç½®æµ‹è¯•', 'error', error.message);
            }
        }
        
        // æµ‹è¯•ç«¯å£å¯¹é½
        function testPortAlignment() {
            try {
                // æ¨¡æ‹Ÿæ£€æŸ¥ç«¯å£é…ç½®é€»è¾‘
                const headerHeight = 36;
                const contentPadding = 12;
                const rowHeight = 32;
                const contentLines = ['å‘½ä¸­ï¼šé«˜ä»·å€¼ç”¨æˆ·', 'æœªå‘½ä¸­ï¼šæ™®é€šç”¨æˆ·'];
                
                const contentHeight = Math.max(1, contentLines.length) * rowHeight;
                const contentCenter = headerHeight + contentPadding + Math.floor(contentHeight / 2);
                
                const verticalOffsets = contentLines.map((_, i) => 
                    headerHeight + contentPadding + i * rowHeight + Math.floor(rowHeight / 2)
                );
                
                addResult('ç«¯å£å¯¹é½æµ‹è¯•', 'success', 
                    `ç«¯å£å‚ç›´åç§»è®¡ç®—æ­£ç¡®`, {
                    headerHeight,
                    contentPadding,
                    rowHeight,
                    contentLinesCount: contentLines.length,
                    contentCenter,
                    verticalOffsets
                });
                
            } catch (error) {
                addResult('ç«¯å£å¯¹é½æµ‹è¯•', 'error', error.message);
            }
        }
        
        // æµ‹è¯•æ ·å¼å¸¸é‡
        function testStyleConstants() {
            try {
                // æ¨¡æ‹Ÿæ£€æŸ¥æ ·å¼å¸¸é‡
                const constants = {
                    NODE_DIMENSIONS: { WIDTH: 280, HEADER_HEIGHT: 36, ROW_HEIGHT: 32 },
                    COLORS: { BODY_FILL: '#FFFFFF', BODY_STROKE: '#E5E7EB' },
                    TYPOGRAPHY: { TITLE_FONT_SIZE: 13, CONTENT_FONT_SIZE: 13 },
                    POSITIONS: { TITLE_X: 48, CONTENT_START_X: 16 }
                };
                
                addResult('æ ·å¼å¸¸é‡æµ‹è¯•', 'success', 
                    'æ£€æµ‹åˆ°ä½¿ç”¨ç»Ÿä¸€çš„æ ·å¼å¸¸é‡ç³»ç»Ÿ', constants);
                
            } catch (error) {
                addResult('æ ·å¼å¸¸é‡æµ‹è¯•', 'error', error.message);
            }
        }
        
        // æ¸…é™¤ç»“æœ
        function clearResults() {
            testResults = [];
            document.getElementById('test-results').innerHTML = '';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåè¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', () => {
            addResult('é¡µé¢åŠ è½½', 'success', 'èŠ‚ç‚¹æ ·å¼éªŒè¯æµ‹è¯•é¡µé¢å·²åŠ è½½');
            testStyleConstants(); // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        });
    </script>
</body>
</html>