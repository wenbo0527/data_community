# 预览线吸附操作指南

## 问题分析

从控制台日志分析，当前页面状态：
- 有1个节点（ai-call类型）
- 有预览线存在
- 用户进行了节点移动操作，但没有触发吸附

## 如何正确触发吸附操作

### 1. 确认预览线存在
首先确认页面上有预览线（从某个节点延伸出来的虚线）。

### 2. 正确的吸附操作步骤

1. **拖拽节点到预览线终点**：
   - 选中一个节点（不是预览线的源节点）
   - 将该节点拖拽到预览线的终点附近（80px范围内）
   - 当节点接近预览线终点时，预览线会变红色并闪烁，表示检测到吸附
   - 释放鼠标，系统会自动创建连接并删除预览线

2. **注意事项**：
   - 不能将节点拖拽到自己的预览线上
   - 如果节点已经有输入连接，不会触发吸附
   - 吸附距离为80px，需要足够接近预览线终点

### 3. 预期的调试日志输出

当正确触发吸附时，应该看到以下日志：

```
🎯 [统一预览线管理器] 检测到预览线终点吸附: {
  dragNodeId: "节点ID",
  sourceNodeId: "源节点ID", 
  branchId: "分支ID或null",
  distance: 距离值,
  snapPosition: { x: x坐标, y: y坐标 }
}

🔍 [吸附调试] 吸附前预览线状态: {
  sourceNodeId: "源节点ID",
  branchId: "分支ID或null",
  totalPreviewLines: 预览线总数,
  hasPreviewInstance: true/false,
  previewInstanceType: "branches"或"single",
  branchCount: 分支数量
}

🧹 [吸附调试] 开始移除分支预览线/单一预览线: { ... }

🔍 [吸附调试] 吸附后预览线状态: {
  ...
  previewLinesRemoved: 删除的预览线数量
}

✅ [统一预览线管理器] 预览线终点吸附连接创建成功: {
  edgeId: "连接ID",
  sourceNodeId: "源节点ID",
  targetNodeId: "目标节点ID", 
  branchId: "分支ID或null",
  branchLabel: "分支标签或null",
  previewLinesCleanedUp: 清理的预览线数量
}
```

### 4. 如果没有看到调试日志

可能的原因：
1. **没有正确触发吸附**：节点没有拖拽到预览线终点附近
2. **节点已有连接**：目标节点已经有输入连接，会跳过吸附
3. **预览线不存在**：源节点没有预览线
4. **距离太远**：节点距离预览线终点超过80px

### 5. 调试建议

1. **检查预览线状态**：
   - 确认页面上确实有预览线显示
   - 预览线应该是从某个节点延伸出来的虚线

2. **检查节点状态**：
   - 确认要拖拽的节点没有输入连接
   - 不要拖拽预览线的源节点

3. **精确拖拽**：
   - 将节点拖拽到预览线的圆点终点位置
   - 当看到预览线变红色闪烁时，表示检测到吸附

## 当前页面状态分析

根据控制台日志，当前页面：
- 节点ID：`node_1758783755124`
- 节点类型：`ai-call`
- 节点状态：未配置（`isConfigured: false`）
- 有预览线存在但节点移动时显示"节点不应该有预览线"

建议：
1. 检查是否有其他节点可以拖拽到当前节点的预览线上
2. 或者添加新节点，然后拖拽到现有预览线的终点