<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>静态测试页面 - 无模块导入</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 20px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .counter {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>静态测试页面 - 诊断重新加载问题</h1>
        
        <div class="status" id="status">
            页面已加载，等待测试...
        </div>
        
        <div class="counter" id="counter">
            页面加载次数: <span id="load-count">1</span>
        </div>
        
        <div>
            <button class="test-button" onclick="testBasicFunction()">测试基础功能</button>
            <button class="test-button" onclick="testLocalStorage()">测试本地存储</button>
            <button class="test-button" onclick="testTimer()">测试定时器</button>
            <button class="test-button" onclick="clearLogs()">清空日志</button>
        </div>
        
        <div class="log" id="log">
            <div><strong>测试日志:</strong></div>
        </div>
        
        <div id="test-content">
            <h3>测试内容区域</h3>
            <p>这是一个完全静态的HTML页面，不使用任何ES模块导入。</p>
            <p>如果这个页面也在重新加载，说明问题不在于模块导入。</p>
        </div>
    </div>
    
    <script>
        // 页面加载计数器
        let loadCount = parseInt(localStorage.getItem('pageLoadCount') || '0') + 1;
        localStorage.setItem('pageLoadCount', loadCount.toString());
        document.getElementById('load-count').textContent = loadCount;
        
        // 日志函数
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('log');
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // 更新状态
        function updateStatus(message) {
            document.getElementById('status').textContent = message;
        }
        
        // 测试基础功能
        function testBasicFunction() {
            log('开始测试基础功能');
            
            try {
                // 测试DOM操作
                const testContent = document.getElementById('test-content');
                const testDiv = document.createElement('div');
                testDiv.innerHTML = `<p style="color: green;">✅ 基础功能测试成功 - ${new Date().toLocaleString()}</p>`;
                testContent.appendChild(testDiv);
                
                log('基础功能测试完成');
                updateStatus('基础功能测试完成');
                
            } catch (error) {
                log(`基础功能测试失败: ${error.message}`);
                updateStatus('基础功能测试失败');
            }
        }
        
        // 测试本地存储
        function testLocalStorage() {
            log('开始测试本地存储');
            
            try {
                const testKey = 'test_' + Date.now();
                const testValue = 'test_value_' + Math.random();
                
                localStorage.setItem(testKey, testValue);
                const retrievedValue = localStorage.getItem(testKey);
                
                if (retrievedValue === testValue) {
                    log('本地存储测试成功');
                    updateStatus('本地存储测试成功');
                } else {
                    log('本地存储测试失败：值不匹配');
                    updateStatus('本地存储测试失败');
                }
                
                localStorage.removeItem(testKey);
                
            } catch (error) {
                log(`本地存储测试失败: ${error.message}`);
                updateStatus('本地存储测试失败');
            }
        }
        
        // 测试定时器
        let timerCount = 0;
        let testTimerInterval = null;
        
        function testTimer() {
            log('开始测试定时器');
            
            if (testTimerInterval) {
                clearInterval(testTimerInterval);
                testTimerInterval = null;
                log('定时器已停止');
                updateStatus('定时器已停止');
                return;
            }
            
            timerCount = 0;
            testTimerInterval = setInterval(() => {
                timerCount++;
                log(`定时器运行中: ${timerCount}`);
                
                if (timerCount >= 5) {
                    clearInterval(testTimerInterval);
                    testTimerInterval = null;
                    log('定时器测试完成');
                    updateStatus('定时器测试完成');
                }
            }, 1000);
            
            updateStatus('定时器测试进行中...');
        }
        
        // 清空日志
        function clearLogs() {
            document.getElementById('log').innerHTML = '<div><strong>测试日志:</strong></div>';
            log('日志已清空');
        }
        
        // 页面加载事件
        window.addEventListener('load', () => {
            log(`页面加载完成 - 第${loadCount}次加载`);
            updateStatus(`页面已加载 - 第${loadCount}次`);
            
            // 检查是否频繁重新加载
            if (loadCount > 5) {
                log('⚠️ 检测到页面频繁重新加载！');
                updateStatus('⚠️ 检测到页面频繁重新加载！');
            }
        });
        
        // 页面卸载事件
        window.addEventListener('beforeunload', () => {
            log('页面即将卸载');
        });
        
        // 全局错误处理
        window.addEventListener('error', (event) => {
            log(`全局错误: ${event.error?.message || event.message}`);
        });
        
        // 监听页面可见性变化
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                log('页面变为不可见');
            } else {
                log('页面变为可见');
            }
        });
        
        // 初始化日志
        log('静态测试页面初始化完成');
        
    </script>
</body>
</html>