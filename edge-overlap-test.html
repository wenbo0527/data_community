<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>连线重叠避免功能测试</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
    }
    
    .test-container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    
    .test-header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      text-align: center;
    }
    
    .test-header h1 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
    }
    
    .test-header p {
      margin: 8px 0 0 0;
      opacity: 0.9;
      font-size: 14px;
    }
    
    .test-content {
      padding: 20px;
    }
    
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      border: 1px solid #e8e8e8;
      border-radius: 6px;
      background: #fafafa;
    }
    
    .test-section h3 {
      margin: 0 0 15px 0;
      color: #333;
      font-size: 16px;
      font-weight: 600;
    }
    
    .test-description {
      color: #666;
      font-size: 14px;
      line-height: 1.6;
      margin-bottom: 15px;
    }
    
    .test-steps {
      background: white;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      padding: 15px;
    }
    
    .test-steps ol {
      margin: 0;
      padding-left: 20px;
    }
    
    .test-steps li {
      margin-bottom: 8px;
      color: #333;
      font-size: 14px;
    }
    
    .expected-result {
      background: #f6ffed;
      border: 1px solid #b7eb8f;
      border-radius: 4px;
      padding: 12px;
      margin-top: 15px;
    }
    
    .expected-result h4 {
      margin: 0 0 8px 0;
      color: #52c41a;
      font-size: 14px;
      font-weight: 600;
    }
    
    .expected-result ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .expected-result li {
      color: #333;
      font-size: 13px;
      margin-bottom: 4px;
    }
    
    .status-indicator {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 8px;
    }
    
    .status-active {
      background: #52c41a;
    }
    
    .status-pending {
      background: #faad14;
    }
    
    .canvas-link {
      display: inline-block;
      background: linear-gradient(135deg, #5F95FF, #4080FF);
      color: white;
      padding: 12px 24px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
      transition: all 0.3s ease;
      margin-top: 15px;
    }
    
    .canvas-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(95, 149, 255, 0.3);
      text-decoration: none;
      color: white;
    }
    
    .implementation-status {
      background: #e6f7ff;
      border: 1px solid #91d5ff;
      border-radius: 4px;
      padding: 15px;
      margin-bottom: 20px;
    }
    
    .implementation-status h3 {
      margin: 0 0 10px 0;
      color: #1890ff;
      font-size: 16px;
    }
    
    .feature-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    
    .feature-item {
      background: white;
      border: 1px solid #d9d9d9;
      border-radius: 4px;
      padding: 12px;
    }
    
    .feature-item h4 {
      margin: 0 0 8px 0;
      font-size: 14px;
      font-weight: 600;
    }
    
    .feature-item p {
      margin: 0;
      font-size: 13px;
      color: #666;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div class="test-container">
    <div class="test-header">
      <h1>🔗 连线重叠避免功能测试</h1>
      <p>测试同端口连线的路径偏移算法和重叠避免机制</p>
    </div>
    
    <div class="test-content">
      <div class="implementation-status">
        <h3><span class="status-indicator status-active"></span>实现状态</h3>
        <p>连线重叠避免管理器已成功集成到 TaskFlowCanvas 组件中，包含以下核心功能：</p>
        
        <div class="feature-list">
          <div class="feature-item">
            <h4>🎯 智能偏移算法</h4>
            <p>基于 X6 的 orth 路由器，自动计算连线偏移量，避免同端口连线重叠</p>
          </div>
          
          <div class="feature-item">
            <h4>📊 连接计数管理</h4>
            <p>实时跟踪每个端口的连接数量，动态调整偏移策略</p>
          </div>
          
          <div class="feature-item">
            <h4>🔄 事件驱动更新</h4>
            <p>监听连线添加、删除和节点移动事件，自动重新计算偏移</p>
          </div>
          
          <div class="feature-item">
            <h4>🎨 路径优化</h4>
            <p>支持自定义路径点和方向控制，确保连线美观且不重叠</p>
          </div>
        </div>
      </div>
      
      <div class="test-section">
        <h3>📋 测试场景一：同源端口多连线</h3>
        <div class="test-description">
          测试从同一个节点的输出端口连接到多个不同目标节点时的重叠避免效果。
        </div>
        
        <div class="test-steps">
          <ol>
            <li>在画布中创建一个开始节点</li>
            <li>创建 3-4 个不同类型的任务节点</li>
            <li>从开始节点的输出端口分别连接到每个任务节点</li>
            <li>观察连线是否自动应用偏移避免重叠</li>
            <li>移动节点位置，观察连线偏移是否动态调整</li>
          </ol>
        </div>
        
        <div class="expected-result">
          <h4>🎯 预期结果：</h4>
          <ul>
            <li>多条连线从同一输出端口发出时，自动应用不同的偏移量</li>
            <li>连线路径呈扇形分布，避免视觉重叠</li>
            <li>节点移动时，连线偏移自动重新计算</li>
            <li>连线删除后，剩余连线的偏移自动调整</li>
          </ul>
        </div>
      </div>
      
      <div class="test-section">
        <h3>📋 测试场景二：同目标端口多连线</h3>
        <div class="test-description">
          测试多个不同源节点连接到同一个目标节点的输入端口时的重叠避免效果。
        </div>
        
        <div class="test-steps">
          <ol>
            <li>创建 3-4 个不同的源节点</li>
            <li>创建一个目标节点（如条件判断节点）</li>
            <li>从每个源节点分别连接到目标节点的输入端口</li>
            <li>观察连线在目标端口处的偏移效果</li>
            <li>测试连线删除和重新创建的动态调整</li>
          </ol>
        </div>
        
        <div class="expected-result">
          <h4>🎯 预期结果：</h4>
          <ul>
            <li>多条连线汇聚到同一输入端口时，自动应用偏移</li>
            <li>连线在目标端口附近呈收敛分布</li>
            <li>偏移量根据连线数量动态调整</li>
            <li>保持连线的可读性和美观性</li>
          </ul>
        </div>
      </div>
      
      <div class="test-section">
        <h3>📋 测试场景三：复杂网络拓扑</h3>
        <div class="test-description">
          测试复杂流程图中多个节点间的多重连接，验证整体的重叠避免效果。
        </div>
        
        <div class="test-steps">
          <ol>
            <li>创建一个包含 6-8 个节点的复杂流程</li>
            <li>建立多个一对多和多对一的连接关系</li>
            <li>创建分支连线（带标签的连线）</li>
            <li>测试节点拖拽时的连线重新布局</li>
            <li>验证预览线和正式连线的协调工作</li>
          </ol>
        </div>
        
        <div class="expected-result">
          <h4>🎯 预期结果：</h4>
          <ul>
            <li>复杂拓扑中所有连线都能正确避免重叠</li>
            <li>分支连线的标签显示正常，不影响偏移计算</li>
            <li>预览线不干扰正式连线的偏移管理</li>
            <li>整体布局保持清晰和专业</li>
          </ul>
        </div>
      </div>
      
      <div class="test-section">
        <h3>📋 测试场景四：性能和稳定性</h3>
        <div class="test-description">
          测试连线重叠管理器在高频操作下的性能表现和稳定性。
        </div>
        
        <div class="test-steps">
          <ol>
            <li>快速创建和删除多条连线</li>
            <li>频繁移动连接了多条线的节点</li>
            <li>测试撤销/重做操作对偏移管理的影响</li>
            <li>检查浏览器控制台是否有错误日志</li>
            <li>观察内存使用情况和响应速度</li>
          </ol>
        </div>
        
        <div class="expected-result">
          <h4>🎯 预期结果：</h4>
          <ul>
            <li>高频操作下系统保持稳定，无错误</li>
            <li>偏移计算响应及时，无明显延迟</li>
            <li>内存使用合理，无内存泄漏</li>
            <li>撤销/重做功能正常工作</li>
          </ul>
        </div>
      </div>
      
      <div style="text-align: center; margin-top: 30px;">
        <a href="/marketing/tasks" class="canvas-link">
          🚀 开始测试画布功能
        </a>
      </div>
    </div>
  </div>
  
  <script>
    // 添加一些交互效果
    document.addEventListener('DOMContentLoaded', function() {
      // 为测试步骤添加点击高亮效果
      const steps = document.querySelectorAll('.test-steps li');
      steps.forEach(step => {
        step.addEventListener('click', function() {
          this.style.background = '#e6f7ff';
          this.style.borderRadius = '4px';
          this.style.padding = '4px 8px';
          this.style.margin = '4px 0';
          
          setTimeout(() => {
            this.style.background = '';
            this.style.borderRadius = '';
            this.style.padding = '';
            this.style.margin = '8px 0';
          }, 2000);
        });
      });
      
      // 添加状态指示器动画
      const indicators = document.querySelectorAll('.status-active');
      indicators.forEach(indicator => {
        setInterval(() => {
          indicator.style.opacity = '0.3';
          setTimeout(() => {
            indicator.style.opacity = '1';
          }, 500);
        }, 2000);
      });
    });
  </script>
</body>
</html>