import{_ as j,p as V,r as f,a as E,c as D,f as e,w as a,M as v,e as s,o as y,j as c,F as J,m as q,R as S,T as G,U as H,V as Q,d as X,W as Y,i as N,y as Z,N as ee}from"./index-CsgcdrY7.js";import{I as ae}from"./index-CrAnsjHE.js";const te={class:"coupon-inventory-container"},le={__name:"index",setup(oe){const z=[{title:"用户ID",dataIndex:"userId",width:120,align:"center"},{title:"券实例ID",dataIndex:"couponId",width:120,align:"center"},{title:"券模版ID",dataIndex:"templateId",width:120,align:"center"},{title:"券名称",dataIndex:"couponName",width:200},{title:"券类型",dataIndex:"couponType",width:100,align:"center",customCell:({record:t})=>S("a-tag",{color:t.couponType==="discount"?"blue":t.couponType==="reduction"?"green":"orange"},t.couponType==="discount"?"折扣券":t.couponType==="reduction"?"满减券":"立减券")},{title:"有效期",dataIndex:"validPeriod",width:200,customCell:({record:t})=>`${t.startTime} ~ ${t.endTime}`},{title:"券状态",dataIndex:"status",width:100,align:"center",customCell:({record:t})=>S("a-tag",{color:{received:"blue",locked:"orange",used:"green",expired:"red",invalid:"gray"}[t.status]},{received:"已领取",locked:"已锁定",used:"已核销",expired:"已过期",invalid:"已作废"}[t.status])}],o=V({couponId:"",templateId:"",userId:"",packageId:"",status:""}),T=f([]),h=f(!1),i=f([]),d=f([]),L=E(()=>({type:"checkbox",showCheckedAll:!0,selectedRowKeys:i.value,onChange:(t,l)=>{i.value=t,d.value=l},checkStrictly:!1,onlyCurrent:!1})),p=V({total:0,current:1,pageSize:10,showTotal:!0,showJumper:!0,showPageSize:!0}),_=async()=>{h.value=!0;try{await new Promise(t=>setTimeout(t,1e3)),T.value=[{userId:"10001",couponId:"CP001",templateId:"TPL001",couponName:"新人专享券",couponType:"discount",startTime:"2024-01-01",endTime:"2024-12-31",status:"received"},{userId:"10002",couponId:"CP002",templateId:"TPL002",couponName:"满100减10券",couponType:"reduction",startTime:"2024-01-01",endTime:"2024-12-31",status:"locked"},{userId:"10003",couponId:"CP003",templateId:"TPL003",couponName:"立减50券",couponType:"instant",startTime:"2024-01-01",endTime:"2024-12-31",status:"used"},{userId:"10004",couponId:"CP004",templateId:"TPL004",couponName:"周年庆券",couponType:"discount",startTime:"2023-01-01",endTime:"2023-12-31",status:"expired"},{userId:"10005",couponId:"CP005",templateId:"TPL005",couponName:"限时特惠券",couponType:"reduction",startTime:"2024-01-01",endTime:"2024-12-31",status:"invalid"}],p.total=100}catch{v.error("获取库存统计数据失败")}finally{h.value=!1}},x=()=>{p.current=1,_()},g=f(!1),R=async()=>{if(!d.value.length){v.warning("请先选择要撤回的券");return}const t=["received","locked"],l=d.value.filter(r=>t.includes(r.status));l.length!==d.value.length?ee.confirm({title:"部分券不可撤回",content:`当前选中${d.value.length}张券，其中${l.length}张可撤回`,okText:"继续撤回可操作券",cancelText:"取消操作",onOk:()=>C(l)}):await C(l)},C=async t=>{try{g.value=!0,await Promise.all(t.map(l=>withdrawCouponAPI(l.couponId))),await _(),i.value=[],d.value=[],v.success(`成功撤回${t.length}张券`)}catch(l){v.error(`撤回失败: ${l.message}`)}finally{g.value=!1}},U=()=>{o.couponId="",o.templateId="",o.userId="",o.packageId="",o.status="",x()},$=t=>{p.current=t,_()},B=t=>{p.pageSize=t,p.current=1,_()},M=t=>{i.value.indexOf(t.couponId)===-1?(i.value=[...i.value,t.couponId],d.value=[...d.value,t]):(i.value=i.value.filter(u=>u!==t.couponId),d.value=d.value.filter(u=>u.couponId!==t.couponId));const r=["received","locked"];d.value.some(u=>!r.includes(u.status))&&v.warning('只能选择状态为"已领取"或"已锁定"的券')};return _(),(t,l)=>{const r=s("a-input"),m=s("a-form-item"),u=s("a-col"),I=s("a-option"),F=s("a-select"),k=s("a-row"),w=s("a-button"),b=s("a-space"),W=s("a-form"),P=s("a-card"),A=s("a-table-column"),K=s("a-table");return y(),D("div",te,[e(P,{class:"search-card"},{default:a(()=>[e(W,{model:o,onSubmit:x,layout:"horizontal",style:{width:"100%"}},{default:a(()=>[e(k,{gutter:16},{default:a(()=>[e(u,{span:8},{default:a(()=>[e(m,{field:"couponId",label:"券实例ID"},{default:a(()=>[e(r,{modelValue:o.couponId,"onUpdate:modelValue":l[0]||(l[0]=n=>o.couponId=n),placeholder:"请输入券实例ID","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:8},{default:a(()=>[e(m,{field:"templateId",label:"券模版"},{default:a(()=>[e(r,{modelValue:o.templateId,"onUpdate:modelValue":l[1]||(l[1]=n=>o.templateId=n),placeholder:"请输入券模版ID","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:8},{default:a(()=>[e(m,{field:"userId",label:"用户ID"},{default:a(()=>[e(r,{modelValue:o.userId,"onUpdate:modelValue":l[2]||(l[2]=n=>o.userId=n),placeholder:"请输入用户ID","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:8},{default:a(()=>[e(m,{field:"packageId",label:"券包ID"},{default:a(()=>[e(r,{modelValue:o.packageId,"onUpdate:modelValue":l[3]||(l[3]=n=>o.packageId=n),placeholder:"请输入券包ID","allow-clear":""},null,8,["modelValue"])]),_:1})]),_:1}),e(u,{span:8},{default:a(()=>[e(m,{field:"status",label:"券状态"},{default:a(()=>[e(F,{modelValue:o.status,"onUpdate:modelValue":l[4]||(l[4]=n=>o.status=n),placeholder:"请选择券状态","allow-clear":""},{default:a(()=>[e(I,{value:"received"},{default:a(()=>[c("已领取")]),_:1}),e(I,{value:"locked"},{default:a(()=>[c("已锁定")]),_:1}),e(I,{value:"used"},{default:a(()=>[c("已核销")]),_:1}),e(I,{value:"expired"},{default:a(()=>[c("已过期")]),_:1}),e(I,{value:"invalid"},{default:a(()=>[c("已作废")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(k,null,{default:a(()=>[e(u,{span:24,style:{"text-align":"right"}},{default:a(()=>[e(b,null,{default:a(()=>[e(w,{onClick:U},{default:a(()=>[c("重置")]),_:1}),e(w,{type:"primary","html-type":"submit"},{default:a(()=>[c("查询")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),e(P,{class:"table-card"},{title:a(()=>[c(" 库存统计列表 ")]),extra:a(()=>[e(b,null,{default:a(()=>[e(w,{type:"primary",status:"danger",disabled:!d.value.length||g.value,loading:g.value,onClick:R},{icon:a(()=>[e(N(Z))]),default:a(()=>[c(" 批量撤回 ")]),_:1},8,["disabled","loading"]),e(w,{type:"text"},{icon:a(()=>[e(N(ae))]),default:a(()=>[c(" 导出数据 ")]),_:1})]),_:1})]),default:a(()=>[e(K,{data:T.value,loading:h.value,pagination:p,onPageChange:$,onPageSizeChange:B,bordered:{cell:!0,wrapper:!0},stripe:"","row-selection":L.value,onRowClick:M},{columns:a(()=>[(y(),D(J,null,q(z,n=>e(A,G(H({key:n.dataIndex},n)),Q({_:2},[n.customCell?{name:"cell",fn:a(({record:O})=>[(y(),X(Y(n.customCell),{record:O},null,8,["record"]))]),key:"0"}:void 0]),1040)),64))]),_:1},8,["data","loading","pagination","row-selection"])]),_:1})])}}},ue=j(le,[["__scopeId","data-v-29ee12c8"]]);export{ue as default};
