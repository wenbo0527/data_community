import{A as it,B as fe,c as k,o as h,h as s,C as rt,n as Fe,D as ct,a as Z,E as ut,r as y,K as _e,b as qe,f as t,e as g,w as n,g as Q,i as S,Q as Re,F as ee,m as oe,t as w,j as _,y as We,d as J,J as Xe,s as Pe,v as xe,_ as Ce,x as we,a2 as He,l as dt,ao as mt,k as be,M as X,N as pt,ap as vt,an as ht,aq as je,a1 as De,Z as Ye,ab as _t,R as de,aa as ft}from"./index-CsgcdrY7.js";import{u as et,L as gt,I as yt}from"./LoadingState-u3p8U4_Q.js";import{I as bt}from"./index-D3r115Ij.js";import{t as tt}from"./tableData-DYle3NyQ.js";import{I as Le}from"./index-CyZFS1Lf.js";import{m as Ae}from"./data-map-BtHUnIhr.js";const wt=fe({name:"IconBarChart",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:e=>["butt","round","square"].includes(e)},strokeLinejoin:{type:String,default:"miter",validator:e=>["arcs","bevel","miter","miter-clip","round"].includes(e)},rotate:Number,spin:Boolean},emits:{click:e=>!0},setup(e,{emit:o}){const a=ct("icon"),i=Z(()=>[a,`${a}-bar-chart`,{[`${a}-spin`]:e.spin}]),l=Z(()=>{const r={};return e.size&&(r.fontSize=ut(e.size)?`${e.size}px`:e.size),e.rotate&&(r.transform=`rotate(${e.rotate}deg)`),r});return{cls:i,innerStyle:l,onClick:r=>{o("click",r)}}}}),kt=["stroke-width","stroke-linecap","stroke-linejoin"];function Ct(e,o,a,i,l,b){return h(),k("svg",{viewBox:"0 0 48 48",stroke:"currentColor",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:Fe(e.cls),style:rt(e.innerStyle),"stroke-width":e.strokeWidth,"stroke-linecap":e.strokeLinecap,"stroke-linejoin":e.strokeLinejoin,onClick:o[0]||(o[0]=(...r)=>e.onClick&&e.onClick(...r))},o[1]||(o[1]=[s("path",{d:"M41 7H29v34h12V7ZM29 18H18v23h11V18ZM18 29H7v12h11V29Z"},null,-1)]),14,kt)}var Be=it(wt,[["render",Ct]]);const Ve=Object.assign(Be,{install:(e,o)=>{var a;const i=(a=o==null?void 0:o.iconPrefix)!=null?a:"";e.component(i+Be.name,Be)}}),at=e=>(Pe("data-v-6ee34567"),e=e(),xe(),e),$t={class:"search-section"},St={key:0,class:"search-suggestions"},Mt=at(()=>s("div",{class:"suggestions-header"},[s("span",null,"搜索建议")],-1)),Dt={class:"suggestions-list"},Pt=["onClick"],xt={class:"suggestion-text"},Tt={key:1,class:"search-history"},It={class:"history-header"},Vt=at(()=>s("span",null,"最近搜索",-1)),zt={class:"history-list"},Ft={key:2,class:"advanced-filter"},Wt=fe({__name:"SearchSection",props:{placeholder:{},loading:{type:Boolean},modelValue:{},showAdvancedFilter:{type:Boolean},showHistory:{type:Boolean}},emits:["search","clear","filter-change"],setup(e,{emit:o}){const a=e,i=Xe(),l=y(a.modelValue||""),b=y(!1),r=y([]),p=y([]),$=y({}),P=et(u=>{u.length>=2?A(u):(r.value=[],b.value=!1)},300),A=u=>{const F=["用户基础信息表","交易流水表","产品信息表","风险评估表","客户画像表"];r.value=F.filter(Y=>Y.toLowerCase().includes(u.toLowerCase())),b.value=r.value.length>0},L=()=>{const u=localStorage.getItem("search-history");u&&(p.value=JSON.parse(u))},z=u=>{if(!u.trim())return;const F=[...p.value],Y=F.indexOf(u);Y>-1&&F.splice(Y,1),F.unshift(u),p.value=F.slice(0,10),localStorage.setItem("search-history",JSON.stringify(p.value))},O=u=>{l.value=u,P(u)},E=(u=l.value)=>{u.trim()&&(z(u),b.value=!1,i.push({path:"/discovery/search",query:{q:u}}),o("search",u,$.value))},B=()=>{l.value="",r.value=[],b.value=!1,o("clear")},te=u=>{l.value=u,E(u)},c=u=>{l.value=u,E(u)},f=()=>{p.value=[],localStorage.removeItem("search-history")},x=()=>{o("filter-change",$.value)},T=()=>{$.value={},o("filter-change",$.value)};_e(()=>a.modelValue,u=>{l.value=u||""});const W=u=>{u.target.closest(".search-section")||(b.value=!1)};return qe(()=>{L(),document.addEventListener("click",W)}),(u,F)=>{const Y=g("a-input-search"),ae=g("a-button"),ne=g("a-tag"),R=g("a-option"),j=g("a-select"),K=g("a-col"),I=g("a-row"),G=g("a-card");return h(),k("div",$t,[t(G,{class:"search-card"},{default:n(()=>[t(Y,{modelValue:l.value,"onUpdate:modelValue":F[0]||(F[0]=v=>l.value=v),placeholder:u.placeholder,"search-button":"","allow-clear":"",loading:u.loading,onSearch:E,onClear:B,onInput:O},{prefix:n(()=>[t(S(Re),{style:{color:"var(--color-text-3)"}})]),_:1},8,["modelValue","placeholder","loading"]),b.value&&r.value.length>0?(h(),k("div",St,[Mt,s("div",Dt,[(h(!0),k(ee,null,oe(r.value,(v,V)=>(h(),k("div",{key:V,class:"suggestion-item",onClick:C=>te(v)},[t(S(Re),{class:"suggestion-icon"}),s("span",xt,w(v),1)],8,Pt))),128))])])):Q("",!0),a.showHistory&&p.value.length>0?(h(),k("div",Tt,[s("div",It,[Vt,t(ae,{type:"text",size:"mini",onClick:f},{default:n(()=>[t(S(We)),_("清空 ")]),_:1})]),s("div",zt,[(h(!0),k(ee,null,oe(p.value.slice(0,5),(v,V)=>(h(),J(ne,{key:V,class:"history-tag",onClick:C=>c(v)},{default:n(()=>[_(w(v),1)]),_:2},1032,["onClick"]))),128))])])):Q("",!0),a.showAdvancedFilter?(h(),k("div",Ft,[t(I,{gutter:16},{default:n(()=>[t(K,{span:6},{default:n(()=>[t(j,{modelValue:$.value.type,"onUpdate:modelValue":F[1]||(F[1]=v=>$.value.type=v),placeholder:"表类型","allow-clear":"",onChange:x},{default:n(()=>[t(R,{value:"维度表"},{default:n(()=>[_("维度表")]),_:1}),t(R,{value:"事实表"},{default:n(()=>[_("事实表")]),_:1}),t(R,{value:"明细表"},{default:n(()=>[_("明细表")]),_:1}),t(R,{value:"汇总表"},{default:n(()=>[_("汇总表")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(K,{span:6},{default:n(()=>[t(j,{modelValue:$.value.domain,"onUpdate:modelValue":F[2]||(F[2]=v=>$.value.domain=v),placeholder:"业务域","allow-clear":"",onChange:x},{default:n(()=>[t(R,{value:"用户域"},{default:n(()=>[_("用户域")]),_:1}),t(R,{value:"交易域"},{default:n(()=>[_("交易域")]),_:1}),t(R,{value:"产品域"},{default:n(()=>[_("产品域")]),_:1}),t(R,{value:"风控域"},{default:n(()=>[_("风控域")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(K,{span:6},{default:n(()=>[t(j,{modelValue:$.value.updateFrequency,"onUpdate:modelValue":F[3]||(F[3]=v=>$.value.updateFrequency=v),placeholder:"更新频率","allow-clear":"",onChange:x},{default:n(()=>[t(R,{value:"实时"},{default:n(()=>[_("实时")]),_:1}),t(R,{value:"日更新"},{default:n(()=>[_("日更新")]),_:1}),t(R,{value:"周更新"},{default:n(()=>[_("周更新")]),_:1}),t(R,{value:"月更新"},{default:n(()=>[_("月更新")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(K,{span:6},{default:n(()=>[t(ae,{type:"outline",onClick:T},{default:n(()=>[_(" 重置筛选 ")]),_:1})]),_:1})]),_:1})])):Q("",!0)]),_:1})])}}}),Ot=Ce(Wt,[["__scopeId","data-v-6ee34567"]]),Ie=43200,Je=1440,Ke=Symbol.for("constructDateFrom");function Ee(e,o){return typeof e=="function"?e(o):e&&typeof e=="object"&&Ke in e?e[Ke](o):e instanceof Date?new e.constructor(o):new Date(o)}function me(e,o){return Ee(o||e,e)}let Nt={};function nt(){return Nt}function Qe(e,o){var p,$,P,A;const a=nt(),i=(o==null?void 0:o.weekStartsOn)??(($=(p=o==null?void 0:o.locale)==null?void 0:p.options)==null?void 0:$.weekStartsOn)??a.weekStartsOn??((A=(P=a.locale)==null?void 0:P.options)==null?void 0:A.weekStartsOn)??0,l=me(e,o==null?void 0:o.in),b=l.getDay(),r=(b<i?7:0)+b-i;return l.setDate(l.getDate()-r),l.setHours(0,0,0,0),l}function Ze(e){const o=me(e),a=new Date(Date.UTC(o.getFullYear(),o.getMonth(),o.getDate(),o.getHours(),o.getMinutes(),o.getSeconds(),o.getMilliseconds()));return a.setUTCFullYear(o.getFullYear()),+e-+a}function Oe(e,...o){const a=Ee.bind(null,e||o.find(i=>typeof i=="object"));return o.map(a)}function ze(e,o){const a=+me(e)-+me(o);return a<0?-1:a>0?1:a}function Ut(e){return Ee(e,Date.now())}function Lt(e,o,a){const[i,l]=Oe(a==null?void 0:a.in,e,o),b=i.getFullYear()-l.getFullYear(),r=i.getMonth()-l.getMonth();return b*12+r}function At(e){return o=>{const i=(e?Math[e]:Math.trunc)(o);return i===0?0:i}}function Bt(e,o){return+me(e)-+me(o)}function qt(e,o){const a=me(e,o==null?void 0:o.in);return a.setHours(23,59,59,999),a}function Xt(e,o){const a=me(e,o==null?void 0:o.in),i=a.getMonth();return a.setFullYear(a.getFullYear(),i+1,0),a.setHours(23,59,59,999),a}function Et(e,o){const a=me(e,o==null?void 0:o.in);return+qt(a,o)==+Xt(a,o)}function Rt(e,o,a){const[i,l,b]=Oe(a==null?void 0:a.in,e,e,o),r=ze(l,b),p=Math.abs(Lt(l,b));if(p<1)return 0;l.getMonth()===1&&l.getDate()>27&&l.setDate(30),l.setMonth(l.getMonth()-r*p);let $=ze(l,b)===-r;Et(i)&&p===1&&ze(i,b)===1&&($=!1);const P=r*(p-+$);return P===0?0:P}function Ht(e,o,a){const i=Bt(e,o)/1e3;return At(a==null?void 0:a.roundingMethod)(i)}const jt={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Yt=(e,o,a)=>{let i;const l=jt[e];return typeof l=="string"?i=l:o===1?i=l.one:i=l.other.replace("{{count}}",o.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+i:i+" ago":i};function ke(e){return(o={})=>{const a=o.width?String(o.width):e.defaultWidth;return e.formats[a]||e.formats[e.defaultWidth]}}const Jt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Kt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Qt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Zt={date:ke({formats:Jt,defaultWidth:"full"}),time:ke({formats:Kt,defaultWidth:"full"}),dateTime:ke({formats:Qt,defaultWidth:"full"})},Gt={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},ea=(e,o,a,i)=>Gt[e];function ce(e){return(o,a)=>{const i=a!=null&&a.context?String(a.context):"standalone";let l;if(i==="formatting"&&e.formattingValues){const r=e.defaultFormattingWidth||e.defaultWidth,p=a!=null&&a.width?String(a.width):r;l=e.formattingValues[p]||e.formattingValues[r]}else{const r=e.defaultWidth,p=a!=null&&a.width?String(a.width):e.defaultWidth;l=e.values[p]||e.values[r]}const b=e.argumentCallback?e.argumentCallback(o):o;return l[b]}}const ta={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},aa={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},na={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},sa={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},oa={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},la={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},ia=(e,o)=>{const a=Number(e),i=a%100;if(i>20||i<10)switch(i%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},ra={ordinalNumber:ia,era:ce({values:ta,defaultWidth:"wide"}),quarter:ce({values:aa,defaultWidth:"wide",argumentCallback:e=>e-1}),month:ce({values:na,defaultWidth:"wide"}),day:ce({values:sa,defaultWidth:"wide"}),dayPeriod:ce({values:oa,defaultWidth:"wide",formattingValues:la,defaultFormattingWidth:"wide"})};function ue(e){return(o,a={})=>{const i=a.width,l=i&&e.matchPatterns[i]||e.matchPatterns[e.defaultMatchWidth],b=o.match(l);if(!b)return null;const r=b[0],p=i&&e.parsePatterns[i]||e.parsePatterns[e.defaultParseWidth],$=Array.isArray(p)?ua(p,L=>L.test(r)):ca(p,L=>L.test(r));let P;P=e.valueCallback?e.valueCallback($):$,P=a.valueCallback?a.valueCallback(P):P;const A=o.slice(r.length);return{value:P,rest:A}}}function ca(e,o){for(const a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&o(e[a]))return a}function ua(e,o){for(let a=0;a<e.length;a++)if(o(e[a]))return a}function st(e){return(o,a={})=>{const i=o.match(e.matchPattern);if(!i)return null;const l=i[0],b=o.match(e.parsePattern);if(!b)return null;let r=e.valueCallback?e.valueCallback(b[0]):b[0];r=a.valueCallback?a.valueCallback(r):r;const p=o.slice(l.length);return{value:r,rest:p}}}const da=/^(\d+)(th|st|nd|rd)?/i,ma=/\d+/i,pa={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},va={any:[/^b/i,/^(a|c)/i]},ha={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},_a={any:[/1/i,/2/i,/3/i,/4/i]},fa={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},ga={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},ya={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ba={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},wa={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},ka={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Ca={ordinalNumber:st({matchPattern:da,parsePattern:ma,valueCallback:e=>parseInt(e,10)}),era:ue({matchPatterns:pa,defaultMatchWidth:"wide",parsePatterns:va,defaultParseWidth:"any"}),quarter:ue({matchPatterns:ha,defaultMatchWidth:"wide",parsePatterns:_a,defaultParseWidth:"any",valueCallback:e=>e+1}),month:ue({matchPatterns:fa,defaultMatchWidth:"wide",parsePatterns:ga,defaultParseWidth:"any"}),day:ue({matchPatterns:ya,defaultMatchWidth:"wide",parsePatterns:ba,defaultParseWidth:"any"}),dayPeriod:ue({matchPatterns:wa,defaultMatchWidth:"any",parsePatterns:ka,defaultParseWidth:"any"})},$a={code:"en-US",formatDistance:Yt,formatLong:Zt,formatRelative:ea,localize:ra,match:Ca,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Sa(e,o,a){const i=nt(),l=(a==null?void 0:a.locale)??i.locale??$a,b=2520,r=ze(e,o);if(isNaN(r))throw new RangeError("Invalid time value");const p=Object.assign({},a,{addSuffix:a==null?void 0:a.addSuffix,comparison:r}),[$,P]=Oe(a==null?void 0:a.in,...r>0?[o,e]:[e,o]),A=Ht(P,$),L=(Ze(P)-Ze($))/1e3,z=Math.round((A-L)/60);let O;if(z<2)return a!=null&&a.includeSeconds?A<5?l.formatDistance("lessThanXSeconds",5,p):A<10?l.formatDistance("lessThanXSeconds",10,p):A<20?l.formatDistance("lessThanXSeconds",20,p):A<40?l.formatDistance("halfAMinute",0,p):A<60?l.formatDistance("lessThanXMinutes",1,p):l.formatDistance("xMinutes",1,p):z===0?l.formatDistance("lessThanXMinutes",1,p):l.formatDistance("xMinutes",z,p);if(z<45)return l.formatDistance("xMinutes",z,p);if(z<90)return l.formatDistance("aboutXHours",1,p);if(z<Je){const E=Math.round(z/60);return l.formatDistance("aboutXHours",E,p)}else{if(z<b)return l.formatDistance("xDays",1,p);if(z<Ie){const E=Math.round(z/Je);return l.formatDistance("xDays",E,p)}else if(z<Ie*2)return O=Math.round(z/Ie),l.formatDistance("aboutXMonths",O,p)}if(O=Rt(P,$),O<12){const E=Math.round(z/Ie);return l.formatDistance("xMonths",E,p)}else{const E=O%12,B=Math.trunc(O/12);return E<3?l.formatDistance("aboutXYears",B,p):E<9?l.formatDistance("overXYears",B,p):l.formatDistance("almostXYears",B+1,p)}}function Ma(e,o){return Sa(e,Ut(e),o)}function Da(e,o,a){const[i,l]=Oe(a==null?void 0:a.in,e,o);return+Qe(i,a)==+Qe(l,a)}const Pa={lessThanXSeconds:{one:"不到 1 秒",other:"不到 {{count}} 秒"},xSeconds:{one:"1 秒",other:"{{count}} 秒"},halfAMinute:"半分钟",lessThanXMinutes:{one:"不到 1 分钟",other:"不到 {{count}} 分钟"},xMinutes:{one:"1 分钟",other:"{{count}} 分钟"},xHours:{one:"1 小时",other:"{{count}} 小时"},aboutXHours:{one:"大约 1 小时",other:"大约 {{count}} 小时"},xDays:{one:"1 天",other:"{{count}} 天"},aboutXWeeks:{one:"大约 1 个星期",other:"大约 {{count}} 个星期"},xWeeks:{one:"1 个星期",other:"{{count}} 个星期"},aboutXMonths:{one:"大约 1 个月",other:"大约 {{count}} 个月"},xMonths:{one:"1 个月",other:"{{count}} 个月"},aboutXYears:{one:"大约 1 年",other:"大约 {{count}} 年"},xYears:{one:"1 年",other:"{{count}} 年"},overXYears:{one:"超过 1 年",other:"超过 {{count}} 年"},almostXYears:{one:"将近 1 年",other:"将近 {{count}} 年"}},xa=(e,o,a)=>{let i;const l=Pa[e];return typeof l=="string"?i=l:o===1?i=l.one:i=l.other.replace("{{count}}",String(o)),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?i+"内":i+"前":i},Ta={full:"y'年'M'月'd'日' EEEE",long:"y'年'M'月'd'日'",medium:"yyyy-MM-dd",short:"yy-MM-dd"},Ia={full:"zzzz a h:mm:ss",long:"z a h:mm:ss",medium:"a h:mm:ss",short:"a h:mm"},Va={full:"{{date}} {{time}}",long:"{{date}} {{time}}",medium:"{{date}} {{time}}",short:"{{date}} {{time}}"},za={date:ke({formats:Ta,defaultWidth:"full"}),time:ke({formats:Ia,defaultWidth:"full"}),dateTime:ke({formats:Va,defaultWidth:"full"})};function Ge(e,o,a){const i="eeee p";return Da(e,o,a)?i:e.getTime()>o.getTime()?"'下个'"+i:"'上个'"+i}const Fa={lastWeek:Ge,yesterday:"'昨天' p",today:"'今天' p",tomorrow:"'明天' p",nextWeek:Ge,other:"PP p"},Wa=(e,o,a,i)=>{const l=Fa[e];return typeof l=="function"?l(o,a,i):l},Oa={narrow:["前","公元"],abbreviated:["前","公元"],wide:["公元前","公元"]},Na={narrow:["1","2","3","4"],abbreviated:["第一季","第二季","第三季","第四季"],wide:["第一季度","第二季度","第三季度","第四季度"]},Ua={narrow:["一","二","三","四","五","六","七","八","九","十","十一","十二"],abbreviated:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],wide:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]},La={narrow:["日","一","二","三","四","五","六"],short:["日","一","二","三","四","五","六"],abbreviated:["周日","周一","周二","周三","周四","周五","周六"],wide:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},Aa={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},Ba={narrow:{am:"上",pm:"下",midnight:"凌晨",noon:"午",morning:"早",afternoon:"下午",evening:"晚",night:"夜"},abbreviated:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"},wide:{am:"上午",pm:"下午",midnight:"凌晨",noon:"中午",morning:"早晨",afternoon:"中午",evening:"晚上",night:"夜间"}},qa=(e,o)=>{const a=Number(e);switch(o==null?void 0:o.unit){case"date":return a.toString()+"日";case"hour":return a.toString()+"时";case"minute":return a.toString()+"分";case"second":return a.toString()+"秒";default:return"第 "+a.toString()}},Xa={ordinalNumber:qa,era:ce({values:Oa,defaultWidth:"wide"}),quarter:ce({values:Na,defaultWidth:"wide",argumentCallback:e=>e-1}),month:ce({values:Ua,defaultWidth:"wide"}),day:ce({values:La,defaultWidth:"wide"}),dayPeriod:ce({values:Aa,defaultWidth:"wide",formattingValues:Ba,defaultFormattingWidth:"wide"})},Ea=/^(第\s*)?\d+(日|时|分|秒)?/i,Ra=/\d+/i,Ha={narrow:/^(前)/i,abbreviated:/^(前)/i,wide:/^(公元前|公元)/i},ja={any:[/^(前)/i,/^(公元)/i]},Ya={narrow:/^[1234]/i,abbreviated:/^第[一二三四]刻/i,wide:/^第[一二三四]刻钟/i},Ja={any:[/(1|一)/i,/(2|二)/i,/(3|三)/i,/(4|四)/i]},Ka={narrow:/^(一|二|三|四|五|六|七|八|九|十[二一])/i,abbreviated:/^(一|二|三|四|五|六|七|八|九|十[二一]|\d|1[12])月/i,wide:/^(一|二|三|四|五|六|七|八|九|十[二一])月/i},Qa={narrow:[/^一/i,/^二/i,/^三/i,/^四/i,/^五/i,/^六/i,/^七/i,/^八/i,/^九/i,/^十(?!(一|二))/i,/^十一/i,/^十二/i],any:[/^一|1/i,/^二|2/i,/^三|3/i,/^四|4/i,/^五|5/i,/^六|6/i,/^七|7/i,/^八|8/i,/^九|9/i,/^十(?!(一|二))|10/i,/^十一|11/i,/^十二|12/i]},Za={narrow:/^[一二三四五六日]/i,short:/^[一二三四五六日]/i,abbreviated:/^周[一二三四五六日]/i,wide:/^星期[一二三四五六日]/i},Ga={any:[/日/i,/一/i,/二/i,/三/i,/四/i,/五/i,/六/i]},en={any:/^(上午?|下午?|午夜|[中正]午|早上?|下午|晚上?|凌晨|)/i},tn={any:{am:/^上午?/i,pm:/^下午?/i,midnight:/^午夜/i,noon:/^[中正]午/i,morning:/^早上/i,afternoon:/^下午/i,evening:/^晚上?/i,night:/^凌晨/i}},an={ordinalNumber:st({matchPattern:Ea,parsePattern:Ra,valueCallback:e=>parseInt(e,10)}),era:ue({matchPatterns:Ha,defaultMatchWidth:"wide",parsePatterns:ja,defaultParseWidth:"any"}),quarter:ue({matchPatterns:Ya,defaultMatchWidth:"wide",parsePatterns:Ja,defaultParseWidth:"any",valueCallback:e=>e+1}),month:ue({matchPatterns:Ka,defaultMatchWidth:"wide",parsePatterns:Qa,defaultParseWidth:"any"}),day:ue({matchPatterns:Za,defaultMatchWidth:"wide",parsePatterns:Ga,defaultParseWidth:"any"}),dayPeriod:ue({matchPatterns:en,defaultMatchWidth:"any",parsePatterns:tn,defaultParseWidth:"any"})},nn={code:"zh-CN",formatDistance:xa,formatLong:za,formatRelative:Wa,localize:Xa,match:an,options:{weekStartsOn:1,firstWeekContainsDate:4}},sn=e=>(Pe("data-v-64eca865"),e=e(),xe(),e),on={class:"table-collection-grid"},ln={key:0,class:"grid-header"},rn={class:"header-left"},cn={class:"collection-count"},un={class:"header-right"},dn={class:"card-content"},mn={class:"card-title"},pn=["title"],vn={class:"title-actions"},hn={class:"collection-stats"},_n={class:"table-count"},fn=["title"],gn={class:"card-footer"},yn={class:"table-tags"},bn={key:0,class:"more-tables"},wn={class:"footer-meta"},kn={class:"meta-item"},Cn={class:"meta-item"},$n=sn(()=>s("span",null,"暂无表集合",-1)),Sn={key:3,class:"pagination-wrapper"},Mn=fe({__name:"TableCollectionGrid",props:{collections:{},loading:{type:Boolean},pageSize:{}},emits:["collection-click","create-collection","edit-collection","copy-collection","delete-collection","favorite-change"],setup(e,{emit:o}){const a=e,i=y(1),l=y(a.pageSize||12),b=Z(()=>{const c=(i.value-1)*l.value,f=c+l.value;return a.collections.slice(c,f)}),r=Z(()=>a.collections.length),p=c=>({业务流程:"blue",数据分析:"green",风险管控:"red",用户画像:"purple",营销活动:"orange"})[c||"通用"]||"gray",$=c=>{if(!c)return"未知";try{return Ma(new Date(c),{addSuffix:!0,locale:nn})}catch{return"未知"}},P=c=>{o("collection-click",c)},A=()=>{o("create-collection")},L=c=>{const f=!c.isFavorite;o("favorite-change",c,f),X.success(f?"已添加到收藏":"已取消收藏")},z=c=>{const[f,x]=c.split("-"),T=a.collections.find(W=>W.id===x);if(T)switch(f){case"edit":o("edit-collection",T);break;case"copy":O(T);break;case"delete":E(T);break}},O=c=>{const f={...c,id:Date.now().toString(),name:`${c.name} (副本)`,createTime:new Date().toISOString()};o("copy-collection",f),X.success("集合已复制")},E=c=>{pt.confirm({title:"确认删除",content:`确定要删除集合 "${c.name}" 吗？此操作不可撤销。`,okText:"删除",cancelText:"取消",okButtonProps:{status:"danger"},onOk:()=>{o("delete-collection",c),X.success("集合已删除")}})},B=c=>{i.value=c},te=c=>{l.value=c,i.value=1};return _e(()=>a.collections.length,()=>{i.value>Math.ceil(a.collections.length/l.value)&&(i.value=1)}),(c,f)=>{const x=g("a-button"),T=g("a-skeleton-shape"),W=g("a-skeleton"),u=g("a-col"),F=g("a-row"),Y=g("a-doption"),ae=g("a-dropdown"),ne=g("a-tag"),R=g("a-card"),j=g("a-empty"),K=g("a-pagination");return h(),k("div",on,[c.loading?Q("",!0):(h(),k("div",ln,[s("div",rn,[s("span",cn,"共 "+w(r.value)+" 个集合",1)]),s("div",un,[t(x,{type:"primary",onClick:A},{icon:n(()=>[t(S(we))]),default:n(()=>[_(" 新增集合 ")]),_:1})])])),c.loading?(h(),J(F,{key:1,gutter:[16,16]},{default:n(()=>[(h(),k(ee,null,oe(6,I=>t(u,{key:I,span:8},{default:n(()=>[t(W,null,{default:n(()=>[t(T,{shape:"square",style:{width:"100%",height:"200px"}})]),_:1})]),_:2},1024)),64))]),_:1})):(h(),k(ee,{key:2},[b.value.length>0?(h(),J(F,{key:0,gutter:[16,16]},{default:n(()=>[(h(!0),k(ee,null,oe(b.value,I=>(h(),J(u,{key:I.id,xs:24,sm:12,md:12,lg:8,xl:6},{default:n(()=>[t(R,{class:"collection-card",hoverable:"",onClick:G=>P(I)},{default:n(()=>[s("div",dn,[s("div",mn,[s("h4",{class:"title-text",title:I.name},w(I.name),9,pn),s("div",vn,[t(x,{type:"text",size:"mini",onClick:He(G=>L(I),["stop"]),class:Fe({favorited:I.isFavorite})},{default:n(()=>[I.isFavorite?(h(),J(S(dt),{key:0})):(h(),J(S(bt),{key:1}))]),_:2},1032,["onClick","class"]),t(ae,{onSelect:z},{content:n(()=>[t(Y,{value:`edit-${I.id}`},{default:n(()=>[t(S(be)),_("编辑 ")]),_:2},1032,["value"]),t(Y,{value:`delete-${I.id}`,class:"danger-option"},{default:n(()=>[t(S(We)),_("删除 ")]),_:2},1032,["value"])]),default:n(()=>[t(x,{type:"text",size:"mini",onClick:f[0]||(f[0]=He(()=>{},["stop"]))},{default:n(()=>[t(S(mt))]),_:1})]),_:2},1024)])]),s("div",hn,[t(ne,{size:"small",color:p(I.type)},{default:n(()=>[_(w(I.type||"通用"),1)]),_:2},1032,["color"]),s("span",_n,w(I.tables.length)+"张表",1)]),s("p",{class:"card-description",title:I.description||"暂无描述"},w(I.description||"暂无描述"),9,fn),s("div",gn,[s("div",yn,[(h(!0),k(ee,null,oe(I.tables.slice(0,3),G=>(h(),J(ne,{key:G.name,size:"small",class:"table-tag"},{default:n(()=>[_(w(G.name),1)]),_:2},1024))),128)),I.tables.length>3?(h(),k("span",bn," +"+w(I.tables.length-3)+"个表 ",1)):Q("",!0)]),s("div",wn,[s("span",kn,w(I.owner||"未指定"),1),s("span",Cn,w($(I.updateTime)),1)])])])]),_:2},1032,["onClick"])]),_:2},1024))),128))]),_:1})):(h(),J(j,{key:1,class:"empty-state"},{description:n(()=>[$n]),footer:n(()=>[t(x,{type:"primary",onClick:f[1]||(f[1]=I=>c.$emit("create-collection"))},{default:n(()=>[_(" 创建第一个集合 ")]),_:1})]),_:1}))],64)),!c.loading&&r.value>l.value?(h(),k("div",Sn,[t(K,{current:i.value,"onUpdate:current":f[2]||(f[2]=I=>i.value=I),total:r.value,"page-size":l.value,"show-total":!0,"show-jumper":!0,"show-page-size":!0,onChange:B,onPageSizeChange:te},null,8,["current","total","page-size"])])):Q("",!0)])}}}),Dn=Ce(Mn,[["__scopeId","data-v-64eca865"]]),Pn={class:"table-selection"},xn={key:0,class:"selected-tables"},Tn={class:"available-tables",style:{"margin-top":"16px"}},In=fe({__name:"CreateCollectionModal",props:{visible:{type:Boolean},editData:{}},emits:["create","update","update:visible"],setup(e,{emit:o}){const a=e,i=y(),l=y(""),b=y([]),r=y({name:"",description:"",type:"通用",owner:"当前用户",tables:[]}),p=Z(()=>!!a.editData),$={name:[{required:!0,message:"请输入集合名称"},{minLength:2,message:"集合名称至少2个字符"},{maxLength:50,message:"集合名称不能超过50个字符"}],type:[{required:!0,message:"请选择集合类型"}],owner:[{required:!0,message:"请选择负责人"}]},P=Z(()=>tt.map((c,f)=>({key:`table_${f}`,name:c.name,type:c.type,category:c.category,domain:c.domain,updateFrequency:c.updateFrequency,owner:c.owner,description:c.description,fields:c.fields}))),A=Z(()=>l.value?P.value.filter(c=>c.name.toLowerCase().includes(l.value.toLowerCase())||c.description.toLowerCase().includes(l.value.toLowerCase())):P.value),L=[{title:"表名",dataIndex:"name",width:180},{title:"类型",dataIndex:"type",width:100},{title:"描述",dataIndex:"description"}],z=Z(()=>({type:"checkbox",selectedRowKeys:b.value,onSelect:(c,f,x)=>{const T=P.value.find(W=>W.key===f);T&&(c.includes(f)?r.value.tables.find(W=>W.name===T.name)||r.value.tables.push(T):r.value.tables=r.value.tables.filter(W=>W.name!==T.name))},onSelectAll:(c,f,x)=>{c?x.forEach(T=>{const W=P.value.find(u=>u.key===T.key);W&&!r.value.tables.find(u=>u.name===W.name)&&r.value.tables.push(W)}):x.forEach(T=>{r.value.tables=r.value.tables.filter(W=>W.name!==T.name)})}}));_e(()=>r.value.tables,c=>{b.value=c.map(f=>{const x=P.value.find(T=>T.name===f.name);return(x==null?void 0:x.key)||""}).filter(f=>f)},{deep:!0});const O=c=>{r.value.tables=r.value.tables.filter(x=>x.name!==c.name);const f=P.value.find(x=>x.name===c.name);f&&(b.value=b.value.filter(x=>x!==f.key))},E=c=>c&&{维度表:"blue",事实表:"green",明细表:"orange",汇总表:"purple"}[c]||"gray",B=async()=>{var c;try{if(!await((c=i.value)==null?void 0:c.validate()))return;if(r.value.tables.length===0){X.warning("请至少选择一张表");return}p.value&&a.editData?(o("update",{...a.editData,name:r.value.name,description:r.value.description,type:r.value.type,owner:r.value.owner,tables:r.value.tables,updateTime:new Date().toISOString()}),X.success("集合更新成功")):(o("create",{name:r.value.name,description:r.value.description,type:r.value.type,owner:r.value.owner,tables:r.value.tables,updateTime:new Date().toISOString(),isFavorite:!1}),X.success("集合创建成功")),te()}catch(f){console.error("表单验证失败:",f)}},te=()=>{var c;o("update:visible",!1),r.value={name:"",description:"",type:"通用",owner:"当前用户",tables:[]},b.value=[],l.value="",(c=i.value)==null||c.resetFields()};return _e(()=>a.visible,c=>{c?c&&a.editData&&(r.value={name:a.editData.name,description:a.editData.description||"",type:a.editData.type||"通用",owner:a.editData.owner||"当前用户",tables:[...a.editData.tables]}):te()}),_e(()=>a.editData,c=>{c&&a.visible&&(r.value={name:c.name,description:c.description||"",type:c.type||"通用",owner:c.owner||"当前用户",tables:[...c.tables]})},{deep:!0}),(c,f)=>{const x=g("a-input"),T=g("a-form-item"),W=g("a-textarea"),u=g("a-option"),F=g("a-select"),Y=g("a-input-search"),ae=g("a-typography-title"),ne=g("a-tag"),R=g("a-space"),j=g("a-typography-text"),K=g("a-table-column"),I=g("a-typography-paragraph"),G=g("a-table"),v=g("a-form"),V=g("a-modal");return h(),J(V,{visible:c.visible,title:p.value?"编辑表集合":"创建表集合",width:"800px",onOk:B,onCancel:te,"onUpdate:visible":f[5]||(f[5]=C=>c.$emit("update:visible",C))},{default:n(()=>[t(v,{model:r.value,ref_key:"formRef",ref:i,rules:$,layout:"vertical"},{default:n(()=>[t(T,{field:"name",label:"集合名称"},{default:n(()=>[t(x,{modelValue:r.value.name,"onUpdate:modelValue":f[0]||(f[0]=C=>r.value.name=C),placeholder:"请输入集合名称，如：贷前分析常用表","max-length":50,"show-word-limit":""},null,8,["modelValue"])]),_:1}),t(T,{field:"description",label:"集合描述"},{default:n(()=>[t(W,{modelValue:r.value.description,"onUpdate:modelValue":f[1]||(f[1]=C=>r.value.description=C),placeholder:"请输入集合描述","auto-size":{minRows:2,maxRows:5},"max-length":200,"show-word-limit":""},null,8,["modelValue"])]),_:1}),t(T,{field:"type",label:"集合类型"},{default:n(()=>[t(F,{modelValue:r.value.type,"onUpdate:modelValue":f[2]||(f[2]=C=>r.value.type=C),placeholder:"请选择集合类型"},{default:n(()=>[t(u,{value:"业务流程"},{default:n(()=>[_("业务流程")]),_:1}),t(u,{value:"数据分析"},{default:n(()=>[_("数据分析")]),_:1}),t(u,{value:"风险管控"},{default:n(()=>[_("风险管控")]),_:1}),t(u,{value:"用户画像"},{default:n(()=>[_("用户画像")]),_:1}),t(u,{value:"营销活动"},{default:n(()=>[_("营销活动")]),_:1}),t(u,{value:"通用"},{default:n(()=>[_("通用")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(T,{field:"owner",label:"负责人"},{default:n(()=>[t(F,{modelValue:r.value.owner,"onUpdate:modelValue":f[3]||(f[3]=C=>r.value.owner=C),placeholder:"请选择负责人","allow-search":""},{default:n(()=>[t(u,{value:"张三"},{default:n(()=>[_("张三")]),_:1}),t(u,{value:"李四"},{default:n(()=>[_("李四")]),_:1}),t(u,{value:"王五"},{default:n(()=>[_("王五")]),_:1}),t(u,{value:"赵六"},{default:n(()=>[_("赵六")]),_:1}),t(u,{value:"钱七"},{default:n(()=>[_("钱七")]),_:1}),t(u,{value:"当前用户"},{default:n(()=>[_("当前用户")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(T,{label:"选择表"},{default:n(()=>[s("div",Pn,[t(Y,{modelValue:l.value,"onUpdate:modelValue":f[4]||(f[4]=C=>l.value=C),placeholder:"搜索表名或描述",style:{"margin-bottom":"16px"}},null,8,["modelValue"]),r.value.tables.length>0?(h(),k("div",xn,[t(ae,{heading:6,style:{"margin-bottom":"12px"}},{default:n(()=>[_(" 已选表 ("+w(r.value.tables.length)+") ",1)]),_:1}),t(R,{wrap:""},{default:n(()=>[(h(!0),k(ee,null,oe(r.value.tables,C=>(h(),J(ne,{key:C.name,closable:"",onClose:ie=>O(C),size:"small",color:"blue"},{default:n(()=>[_(w(C.name),1)]),_:2},1032,["onClose"]))),128))]),_:1})])):Q("",!0),s("div",Tn,[t(ae,{heading:6,style:{"margin-bottom":"12px"}},{default:n(()=>[_(" 可选表 ")]),_:1}),t(G,{data:A.value,columns:L,pagination:{pageSize:5,simple:!0},"row-selection":z.value,"row-key":"key",size:"small",class:"table-selector",scroll:{y:300}},{columns:n(()=>[t(K,{title:"表名","data-index":"name",width:180},{cell:n(({record:C})=>[t(j,{strong:""},{default:n(()=>[_(w(C.name),1)]),_:2},1024)]),_:1}),t(K,{title:"类型","data-index":"type",width:100},{cell:n(({record:C})=>[t(ne,{size:"small",color:E(C.type)},{default:n(()=>[_(w(C.type),1)]),_:2},1032,["color"])]),_:1}),t(K,{title:"描述","data-index":"description"},{cell:n(({record:C})=>[t(I,{type:"secondary",ellipsis:{rows:1}},{default:n(()=>[_(w(C.description),1)]),_:2},1024)]),_:1})]),_:1},8,["data","row-selection"])])])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])}}}),Vn=Ce(In,[["__scopeId","data-v-1231fbab"]]),zn=[{name:"注册",description:"用户首次进入系统，完成基本信息注册",icon:"icon-user-add",tables:[{name:"user_register",description:"用户注册信息表",usage:"用于记录用户注册信息，可分析注册渠道转化率和用户增长趋势。",type:"table",owner:"张三",fields:[{name:"user_id",type:"string",description:"用户ID",usage:"用户唯一标识"},{name:"register_time",type:"timestamp",description:"注册时间",usage:"记录用户注册时间"},{name:"register_channel",type:"string",description:"注册渠道",usage:"记录用户注册来源渠道"},{name:"invite_code",type:"string",description:"邀请码",usage:"记录用户邀请码信息"}],metrics:[{name:"日注册量",description:"每日新增注册用户数",formula:"count(distinct user_id)",unit:"人",owner:"张三"},{name:"渠道转化率",description:"各渠道注册成功率",formula:"count(success)/count(total)",unit:"%",owner:"张三"}]},{name:"user_device",description:"用户设备信息表",usage:"存储用户设备信息，可用于分析用户设备分布和版本兼容性。",type:"table",owner:"李四",fields:[{name:"device_id",type:"string",description:"设备ID",usage:"用户设备唯一标识"},{name:"device_type",type:"string",description:"设备类型",usage:"记录用户设备类型"},{name:"os_version",type:"string",description:"操作系统版本",usage:"记录设备操作系统版本"},{name:"app_version",type:"string",description:"APP版本",usage:"记录APP版本号"}],metrics:[{name:"设备类型分布",description:"各设备类型用户占比",formula:"count(device_type)/count(total)",unit:"%",owner:"李四"},{name:"APP版本覆盖率",description:"最新版本APP使用率",formula:"count(latest_version)/count(total)",unit:"%",owner:"李四"}]}]},{name:"实名",description:"用户完成身份认证和银行卡绑定",icon:"icon-idcard",tables:[{name:"user_auth",description:"用户实名认证表",usage:"用于记录用户实名认证信息，可分析实名认证转化率和通过率。",type:"table",owner:"王五",fields:[{name:"user_id",type:"string",description:"用户ID",usage:"用户唯一标识"},{name:"real_name",type:"string",description:"真实姓名",usage:"用户实名认证姓名"},{name:"id_card",type:"string",description:"身份证号",usage:"用户身份证号码"},{name:"auth_time",type:"timestamp",description:"认证时间",usage:"记录实名认证时间"}],metrics:[{name:"实名认证率",description:"完成实名认证的用户占比",formula:"count(distinct auth_user)/count(distinct total_user)",unit:"%",owner:"王五"},{name:"认证通过率",description:"实名认证通过的比例",formula:"count(success)/count(total)",unit:"%",owner:"王五"}]},{name:"user_bankcard",description:"用户银行卡信息表",usage:"存储用户银行卡绑定信息，可用于分析银行卡绑定率和银行分布。",type:"table",owner:"赵六",fields:[{name:"card_id",type:"string",description:"银行卡ID",usage:"银行卡唯一标识"},{name:"bank_name",type:"string",description:"银行名称",usage:"记录银行名称"},{name:"card_type",type:"string",description:"卡类型",usage:"记录银行卡类型"},{name:"bind_time",type:"timestamp",description:"绑定时间",usage:"记录银行卡绑定时间"}],metrics:[{name:"银行卡绑定率",description:"完成银行卡绑定的用户占比",formula:"count(distinct bind_user)/count(distinct total_user)",unit:"%",owner:"赵六"},{name:"主流银行占比",description:"主要银行卡绑定占比",formula:"count(main_banks)/count(total_cards)",unit:"%",owner:"赵六"}]}]},{name:"授信",description:"评估用户资质，确定授信额度",icon:"icon-file-protection",tables:[{name:"credit_apply",description:"授信申请记录表",usage:"用于记录用户授信申请信息，可分析授信申请转化率和申请金额分布。",type:"table",owner:"孙七",fields:[{name:"apply_id",type:"string",description:"申请ID",usage:"授信申请唯一标识"},{name:"user_id",type:"string",description:"用户ID",usage:"用户唯一标识"},{name:"apply_amount",type:"decimal",description:"申请金额",usage:"记录授信申请金额"},{name:"apply_time",type:"timestamp",description:"申请时间",usage:"记录授信申请时间"}],metrics:[{name:"授信申请率",description:"注册用户中申请授信的比例",formula:"count(distinct apply_user)/count(distinct register_user)",unit:"%",owner:"孙七"},{name:"平均申请金额",description:"授信申请平均金额",formula:"avg(apply_amount)",unit:"元",owner:"孙七"}]},{name:"credit_result",description:"授信结果表",usage:"用于记录用户授信审批结果，可分析授信通过率和额度分布。",type:"table",owner:"周八",fields:[{name:"apply_id",type:"string",description:"申请ID",usage:"授信申请唯一标识"},{name:"credit_score",type:"integer",description:"信用评分",usage:"记录用户信用评分"},{name:"credit_limit",type:"decimal",description:"授信额度",usage:"记录用户授信额度"},{name:"result_time",type:"timestamp",description:"审批时间",usage:"记录授信审批时间"}],metrics:[{name:"授信通过率",description:"授信申请通过的比例",formula:"count(approved)/count(total_apply)",unit:"%",owner:"周八"},{name:"平均授信额度",description:"授信通过用户的平均额度",formula:"avg(credit_limit)",unit:"元",owner:"周八"}]}]},{name:"支用",description:"用户申请借款，签订借款合同",icon:"icon-money",tables:[{name:"loan_apply",description:"借款申请记录表",usage:"用于记录用户借款申请信息，可分析借款申请转化率和金额分布。",type:"table",fields:[{name:"loan_id",type:"string",description:"借款ID",usage:"借款唯一标识"},{name:"user_id",type:"string",description:"用户ID",usage:"用户唯一标识"},{name:"loan_amount",type:"decimal",description:"借款金额",usage:"记录借款金额"},{name:"loan_term",type:"integer",description:"借款期限",usage:"记录借款期限"}],metrics:[{name:"支用转化率",description:"授信用户中申请借款的比例",formula:"count(distinct loan_user)/count(distinct credit_user)",unit:"%",owner:"李四"},{name:"平均借款金额",description:"借款申请平均金额",formula:"avg(loan_amount)",unit:"元",owner:"李四"}]},{name:"loan_contract",description:"借款合同表",usage:"用于记录用户借款合同信息，可分析合同签约率和条款分布。",type:"table",owner:"吴九",fields:[{name:"contract_id",type:"string",description:"合同ID",usage:"借款合同唯一标识"},{name:"loan_id",type:"string",description:"借款ID",usage:"借款唯一标识"},{name:"interest_rate",type:"decimal",description:"利率",usage:"记录借款利率"},{name:"sign_time",type:"timestamp",description:"签约时间",usage:"记录合同签约时间"}],metrics:[{name:"合同签约率",description:"借款申请中完成签约的比例",formula:"count(signed)/count(loan_apply)",unit:"%",owner:"吴九"},{name:"平均利率",description:"借款合同平均利率",formula:"avg(interest_rate)",unit:"%",owner:"吴九"}]}]},{name:"还款",description:"用户按期还款，维护还款计划",icon:"icon-calendar",tables:[{name:"repayment_plan",description:"还款计划表",usage:"用于记录用户还款计划信息，可分析还款计划和实际还款情况。",type:"table",fields:[{name:"plan_id",type:"string",description:"计划ID",usage:"还款计划唯一标识"},{name:"loan_id",type:"string",description:"借款ID",usage:"借款唯一标识"},{name:"due_amount",type:"decimal",description:"应还金额",usage:"记录应还金额"},{name:"due_date",type:"date",description:"应还日期",usage:"记录应还日期"}],metrics:[{name:"按期还款率",description:"按期还款的比例",formula:"count(ontime_repay)/count(total_repay)",unit:"%",owner:"李四"},{name:"提前还款率",description:"提前还款的比例",formula:"count(early_repay)/count(total_repay)",unit:"%",owner:"李四"}]},{name:"repayment_record",description:"还款记录表",usage:"用于记录用户实际还款信息，可分析还款及时率和逾期情况。",type:"table",owner:"郑十",fields:[{name:"record_id",type:"string",description:"记录ID",usage:"还款记录唯一标识"},{name:"plan_id",type:"string",description:"计划ID",usage:"还款计划唯一标识"},{name:"paid_amount",type:"decimal",description:"实还金额",usage:"记录实际还款金额"},{name:"paid_time",type:"timestamp",description:"实还时间",usage:"记录实际还款时间"}],metrics:[{name:"实际还款率",description:"完成还款的计划占比",formula:"count(paid_plans)/count(total_plans)",unit:"%",owner:"郑十"},{name:"平均还款金额",description:"实际还款平均金额",formula:"avg(paid_amount)",unit:"元",owner:"郑十"}]}]},{name:"贷后管理",description:"管理逾期账户，进行催收工作",icon:"icon-alert",tables:[{name:"loan_overdue",description:"逾期记录表",usage:"用于记录用户逾期信息，可分析逾期率和催收效果。",type:"table",fields:[{name:"overdue_id",type:"string",description:"逾期ID",usage:"逾期记录唯一标识"},{name:"loan_id",type:"string",description:"借款ID",usage:"借款唯一标识"},{name:"overdue_days",type:"integer",description:"逾期天数",usage:"记录逾期天数"},{name:"overdue_amount",type:"decimal",description:"逾期金额",usage:"记录逾期金额"}],metrics:[{name:"逾期率",description:"逾期账户占比",formula:"count(distinct overdue_loan)/count(distinct total_loan)",unit:"%",owner:"李四"},{name:"逾期金额占比",description:"逾期金额占总放款金额比例",formula:"sum(overdue_amount)/sum(loan_amount)",unit:"%",owner:"李四"}]},{name:"collection_record",description:"催收记录表",usage:"用于记录催收操作信息，可分析催收效果和回款率。",type:"table",owner:"钱十一",fields:[{name:"collection_id",type:"string",description:"催收ID",usage:"催收记录唯一标识"},{name:"overdue_id",type:"string",description:"逾期ID",usage:"逾期记录唯一标识"},{name:"collector",type:"string",description:"催收员",usage:"记录催收人员"},{name:"collection_result",type:"string",description:"催收结果",usage:"记录催收结果"}],metrics:[{name:"催收成功率",description:"催收成功的案例占比",formula:"count(success_collection)/count(total_collection)",unit:"%",owner:"钱十一"},{name:"催收回款率",description:"通过催收回收的金额占比",formula:"sum(recovered_amount)/sum(overdue_amount)",unit:"%",owner:"钱十一"}]}]}],Ne=e=>(Pe("data-v-1a5511f7"),e=e(),xe(),e),Fn={class:"business-process-edit"},Wn={class:"basic-config"},On={class:"steps-config"},Nn={class:"steps-header"},Un=Ne(()=>s("h3",null,"业务步骤配置",-1)),Ln={class:"steps-list"},An={class:"step-header"},Bn={class:"step-order"},qn={class:"step-number"},Xn={class:"step-actions"},En={class:"step-basic-info"},Rn={class:"step-content"},Hn={class:"association-section"},jn={class:"section-header"},Yn={class:"associated-items"},Jn={class:"item-info"},Kn={class:"item-name"},Qn={class:"item-desc"},Zn={key:0,class:"empty-state"},Gn=Ne(()=>s("span",null,"暂无关联数据表",-1)),es={class:"association-section"},ts={class:"section-header"},as={class:"associated-items"},ns={class:"item-info"},ss={class:"item-name"},os={class:"item-desc"},ls={key:0,class:"empty-state"},is=Ne(()=>s("span",null,"暂无关联指标",-1)),rs={key:0,class:"empty-steps"},cs=Ne(()=>s("span",null,"暂无业务步骤，请点击上方按钮添加",-1)),us={class:"table-select-content"},ds={class:"metric-select-content"},ms=fe({__name:"BusinessProcessEditModal",props:{visible:{type:Boolean},initialData:{}},emits:["update:visible","save"],setup(e,{emit:o}){const a=e,i=Z({get:()=>a.visible,set:m=>o("update:visible",m)}),l=y({businessType:"",productType:"",steps:[]}),b=y(["self","general"]),r=y([{value:"self",label:"自营",children:[{value:"general",label:"通用"},{value:"personal",label:"个人贷"},{value:"business",label:"企业贷"},{value:"mortgage",label:"房贷"},{value:"car",label:"车贷"}]},{value:"supermarket",label:"贷超",children:[{value:"general",label:"通用"},{value:"personal",label:"个人贷"},{value:"business",label:"企业贷"}]},{value:"assist",label:"助贷",children:[{value:"general",label:"通用"},{value:"personal",label:"个人贷"},{value:"mortgage",label:"房贷"}]}]),p=y(!1),$=y(-1),P=y(""),A=y([]),L=y(!1),z=y(""),O=y([]),E=y([{name:"user_register",description:"用户注册信息表",type:"table",owner:"张三"},{name:"user_device",description:"用户设备信息表",type:"table",owner:"李四"},{name:"user_auth",description:"用户实名认证表",type:"table",owner:"王五"},{name:"user_bankcard",description:"用户银行卡信息表",type:"table",owner:"赵六"},{name:"credit_apply",description:"授信申请记录表",type:"table",owner:"钱七"},{name:"credit_result",description:"授信结果表",type:"table",owner:"孙八"}]),B=y([{name:"日注册量",description:"每日新增注册用户数",unit:"人",formula:"count(distinct user_id)"},{name:"渠道转化率",description:"各渠道注册成功率",unit:"%",formula:"count(success)/count(total)"},{name:"实名认证率",description:"完成实名认证的用户占比",unit:"%",formula:"count(distinct auth_user)/count(distinct total_user)"},{name:"认证通过率",description:"实名认证通过的比例",unit:"%",formula:"count(success)/count(total)"},{name:"授信申请率",description:"注册用户中申请授信的比例",unit:"%",formula:"count(distinct apply_user)/count(distinct register_user)"},{name:"平均申请金额",description:"授信申请平均金额",unit:"元",formula:"avg(apply_amount)"}]),te=Z(()=>P.value?E.value.filter(m=>m.name.includes(P.value)||m.description.includes(P.value)):E.value),c=Z(()=>z.value?B.value.filter(m=>m.name.includes(z.value)||m.description.includes(z.value)):B.value),f=[{title:"表名",dataIndex:"name",width:200},{title:"描述",dataIndex:"description"},{title:"类型",dataIndex:"type",width:100},{title:"负责人",dataIndex:"owner",width:100}],x=[{title:"指标名",dataIndex:"name",width:200},{title:"描述",dataIndex:"description"},{title:"单位",dataIndex:"unit",width:80},{title:"计算公式",dataIndex:"formula",width:200}];_e(()=>a.initialData,m=>{m&&(l.value=JSON.parse(JSON.stringify(m)),b.value=[m.businessType||"self",m.productType||"general"])},{immediate:!0}),_e(()=>a.visible,m=>{m&&!a.initialData&&(l.value={businessType:"",productType:"",steps:[]},b.value=["self","general"])});const T=()=>{const m={id:`step_${Date.now()}`,name:"",description:"",tables:[],metrics:[]};l.value.steps.push(m)},W=m=>{l.value.steps.splice(m,1)},u=(m,D)=>{const q=l.value.steps,le=D==="up"?m-1:m+1;if(le>=0&&le<q.length){const he=q[m];q[m]=q[le],q[le]=he}},F=m=>{$.value=m;const D=l.value.steps[m];A.value=D.tables.map(q=>q.name),p.value=!0},Y=m=>{A.value=m},ae=()=>{const m=E.value.filter(D=>A.value.includes(D.name));l.value.steps[$.value].tables=m,p.value=!1},ne=(m,D)=>{const q=l.value.steps[m];q.tables=q.tables.filter(le=>le.name!==D)},R=m=>{$.value=m;const D=l.value.steps[m];O.value=D.metrics.map(q=>q.name),L.value=!0},j=m=>{O.value=m},K=()=>{const m=B.value.filter(D=>O.value.includes(D.name));l.value.steps[$.value].metrics=m,L.value=!1},I=(m,D)=>{const q=l.value.steps[m];q.metrics=q.metrics.filter(le=>le.name!==D)},G=m=>{m&&m.length===2&&(l.value.businessType=m[0],l.value.productType=m[1],console.log("业务类型变化:",m[0],"产品类型变化:",m[1]),X.info(`已选择${v(m[0])}模式 - ${V(m[1])}产品`))},v=m=>({self:"自营",supermarket:"贷超",assist:"助贷"})[m]||m,V=m=>({general:"通用",personal:"个人贷",business:"企业贷",mortgage:"房贷",car:"车贷"})[m]||m,C=()=>{if(!l.value.businessType){X.error("请选择业务类型");return}if(!l.value.productType){X.error("请选择产品类型");return}if(l.value.steps.length===0){X.error("请至少添加一个业务步骤");return}for(let m=0;m<l.value.steps.length;m++){const D=l.value.steps[m];if(!D.name){X.error(`第${m+1}个步骤的名称不能为空`);return}if(!D.description){X.error(`第${m+1}个步骤的说明不能为空`);return}}o("save",l.value),i.value=!1,X.success("保存成功")},ie=()=>{i.value=!1};return(m,D)=>{const q=g("a-cascader"),le=g("a-form-item"),he=g("a-col"),Te=g("a-row"),d=g("a-button"),N=g("a-input"),pe=g("a-tab-pane"),re=g("a-tabs"),$e=g("a-input-search"),Se=g("a-table"),Me=g("a-modal");return h(),J(Me,{visible:i.value,"onUpdate:visible":D[7]||(D[7]=U=>i.value=U),title:"编辑业务流程",width:"1200px","mask-closable":!1,onOk:C,onCancel:ie},{default:n(()=>[s("div",Fn,[s("div",Wn,[t(Te,{gutter:16},{default:n(()=>[t(he,{span:24},{default:n(()=>[t(le,{label:"业务产品",required:""},{default:n(()=>[t(q,{modelValue:b.value,"onUpdate:modelValue":D[0]||(D[0]=U=>b.value=U),options:r.value,placeholder:"请选择业务类型和产品类型",style:{width:"300px"},"allow-search":"","expand-trigger":"hover",onChange:G},null,8,["modelValue","options"])]),_:1})]),_:1})]),_:1})]),s("div",On,[s("div",Nn,[Un,t(d,{type:"primary",onClick:T},{icon:n(()=>[t(S(we))]),default:n(()=>[_(" 添加步骤 ")]),_:1})]),s("div",Ln,[(h(!0),k(ee,null,oe(l.value.steps,(U,se)=>(h(),k("div",{key:U.id,class:"step-item"},[s("div",An,[s("div",Bn,[s("span",qn,w(se+1),1),s("div",Xn,[se>0?(h(),J(d,{key:0,type:"text",size:"mini",onClick:H=>u(se,"up")},{icon:n(()=>[t(S(vt))]),_:2},1032,["onClick"])):Q("",!0),se<l.value.steps.length-1?(h(),J(d,{key:1,type:"text",size:"mini",onClick:H=>u(se,"down")},{icon:n(()=>[t(S(ht))]),_:2},1032,["onClick"])):Q("",!0),t(d,{type:"text",size:"mini",status:"danger",onClick:H=>W(se)},{icon:n(()=>[t(S(We))]),_:2},1032,["onClick"])])]),s("div",En,[t(Te,{gutter:16},{default:n(()=>[t(he,{span:12},{default:n(()=>[t(N,{modelValue:U.name,"onUpdate:modelValue":H=>U.name=H,placeholder:"请输入步骤名称",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(he,{span:12},{default:n(()=>[t(N,{modelValue:U.description,"onUpdate:modelValue":H=>U.description=H,placeholder:"请输入步骤说明",size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)])]),s("div",Rn,[t(re,{"default-active-key":"tables"},{default:n(()=>[t(pe,{key:"tables",title:"关联数据表"},{default:n(()=>[s("div",Hn,[s("div",jn,[s("span",null,"已关联数据表 ("+w(U.tables.length)+")",1),t(d,{type:"text",size:"small",onClick:H=>F(se)},{icon:n(()=>[t(S(we))]),default:n(()=>[_(" 选择数据表 ")]),_:2},1032,["onClick"])]),s("div",Yn,[(h(!0),k(ee,null,oe(U.tables,H=>(h(),k("div",{key:H.name,class:"associated-item"},[s("div",Jn,[s("span",Kn,w(H.name),1),s("span",Qn,w(H.description),1)]),t(d,{type:"text",size:"mini",status:"danger",onClick:Ue=>ne(se,H.name)},{icon:n(()=>[t(S(je))]),_:2},1032,["onClick"])]))),128)),U.tables.length===0?(h(),k("div",Zn,[t(S(De),{class:"empty-icon"}),Gn])):Q("",!0)])])]),_:2},1024),t(pe,{key:"metrics",title:"关联指标"},{default:n(()=>[s("div",es,[s("div",ts,[s("span",null,"已关联指标 ("+w(U.metrics.length)+")",1),t(d,{type:"text",size:"small",onClick:H=>R(se)},{icon:n(()=>[t(S(we))]),default:n(()=>[_(" 选择指标 ")]),_:2},1032,["onClick"])]),s("div",as,[(h(!0),k(ee,null,oe(U.metrics,H=>(h(),k("div",{key:H.name,class:"associated-item"},[s("div",ns,[s("span",ss,w(H.name),1),s("span",os,w(H.description),1)]),t(d,{type:"text",size:"mini",status:"danger",onClick:Ue=>I(se,H.name)},{icon:n(()=>[t(S(je))]),_:2},1032,["onClick"])]))),128)),U.metrics.length===0?(h(),k("div",ls,[t(S(Ve),{class:"empty-icon"}),is])):Q("",!0)])])]),_:2},1024)]),_:2},1024)])]))),128)),l.value.steps.length===0?(h(),k("div",rs,[t(S(we),{class:"empty-icon"}),cs])):Q("",!0)])])]),t(Me,{visible:p.value,"onUpdate:visible":D[2]||(D[2]=U=>p.value=U),title:"选择数据表",width:"800px",onOk:ae,onCancel:D[3]||(D[3]=U=>p.value=!1)},{default:n(()=>[s("div",us,[t($e,{modelValue:P.value,"onUpdate:modelValue":D[1]||(D[1]=U=>P.value=U),placeholder:"搜索数据表",style:{"margin-bottom":"16px"}},null,8,["modelValue"]),t(Se,{data:te.value,columns:f,"row-selection":{type:"checkbox",selectedRowKeys:A.value,onSelectionChange:Y},pagination:{pageSize:10},size:"small"},null,8,["data","row-selection"])])]),_:1},8,["visible"]),t(Me,{visible:L.value,"onUpdate:visible":D[5]||(D[5]=U=>L.value=U),title:"选择指标",width:"800px",onOk:K,onCancel:D[6]||(D[6]=U=>L.value=!1)},{default:n(()=>[s("div",ds,[t($e,{modelValue:z.value,"onUpdate:modelValue":D[4]||(D[4]=U=>z.value=U),placeholder:"搜索指标",style:{"margin-bottom":"16px"}},null,8,["modelValue"]),t(Se,{data:c.value,columns:x,"row-selection":{type:"checkbox",selectedRowKeys:O.value,onSelectionChange:j},pagination:{pageSize:10},size:"small"},null,8,["data","row-selection"])])]),_:1},8,["visible"])]),_:1},8,["visible"])}}}),ps=Ce(ms,[["__scopeId","data-v-1a5511f7"]]),ve=e=>(Pe("data-v-a654e12e"),e=e(),xe(),e),vs={class:"business-process-flow"},hs={class:"steps-header"},_s=ve(()=>s("div",{class:"steps-title-group"},[s("h3",{class:"steps-title"},"业务流程")],-1)),fs={class:"steps-actions"},gs={class:"steps-filters"},ys={class:"filter-group"},bs=ve(()=>s("span",{class:"filter-label"},"业务产品",-1)),ws={class:"steps-stats"},ks={class:"step-count"},Cs={class:"enhanced-steps"},$s=["onClick"],Ss={class:"step-indicator"},Ms={class:"step-number"},Ds={key:0,class:"step-connector"},Ps={class:"step-content"},xs={class:"step-title"},Ts={class:"current-step-overview"},Is={class:"step-overview"},Vs={class:"step-indicator"},zs={class:"step-circle"},Fs={class:"step-total"},Ws={class:"step-content"},Os={class:"step-name"},Ns={class:"step-description"},Us={class:"step-stats"},Ls={class:"stat-item"},As={class:"stat-item"},Bs={class:"main-content"},qs={class:"tab-extra-actions"},Xs={class:"tab-title"},Es=ve(()=>s("span",null,"核心底表",-1)),Rs={class:"tab-content"},Hs={class:"tables-container"},js={key:0},Ys={key:0,class:"tables-grid-view"},Js=["onClick"],Ks={class:"table-header"},Qs={class:"table-name"},Zs={class:"table-desc"},Gs={class:"table-footer"},eo={class:"table-owner"},to={key:1,class:"tables-list-view"},ao={key:1,class:"empty-tables-state"},no={class:"empty-content"},so=ve(()=>s("h4",{class:"empty-title"},"当前步骤暂无关联数据表",-1)),oo=ve(()=>s("p",{class:"empty-description"},"该业务步骤尚未配置相关的数据表，您可以通过编辑流程来添加数据表关联。",-1)),lo={class:"tab-title"},io=ve(()=>s("span",null,"业务指标",-1)),ro={class:"tab-content"},co={class:"metrics-container"},uo={key:0},mo={key:0,class:"metrics-grid-view"},po=["onClick"],vo={class:"metric-header"},ho={class:"metric-name"},_o={class:"metric-desc"},fo={class:"metric-footer"},go={class:"metric-owner"},yo={key:1,class:"metrics-list-view"},bo={key:1,class:"empty-metrics-state"},wo={class:"empty-content"},ko=ve(()=>s("h4",{class:"empty-title"},"当前步骤暂无关联指标",-1)),Co=ve(()=>s("p",{class:"empty-description"},"该业务步骤尚未配置相关的业务指标，您可以通过编辑流程来添加指标关联。",-1)),$o={class:"process-list-modal"},So={class:"modal-header"},Mo={class:"header-actions"},Do={class:"process-list"},Po={class:"process-info"},xo={class:"process-header"},To={class:"process-name"},Io={class:"process-tags"},Vo={class:"process-description"},zo={class:"process-meta"},Fo={class:"meta-item"},Wo={class:"meta-item"},Oo={class:"meta-item"},No={class:"process-actions"},Uo=fe({__name:"BusinessProcessFlow",emits:["show-table-detail"],setup(e,{emit:o}){const a=Xe(),i=y(0),l=y("self"),b=y("general"),r=y(["self","general"]),p=y([{value:"self",label:"自营",children:[{value:"general",label:"通用"},{value:"personal",label:"个人贷"},{value:"business",label:"企业贷"},{value:"mortgage",label:"房贷"},{value:"car",label:"车贷"}]},{value:"supermarket",label:"贷超",children:[{value:"general",label:"通用"},{value:"personal",label:"个人贷"},{value:"business",label:"企业贷"}]},{value:"assist",label:"助贷",children:[{value:"general",label:"通用"},{value:"personal",label:"个人贷"},{value:"business",label:"企业贷"}]}]),$=y("grid"),P=y("grid"),A=y(!1),L=y("tables"),z=y(""),O=y(""),E=y(1),B=y(1),te=y(!1),c=y([]),f=y(!1),x=y(!1),T=y(null),W=y([{id:1,name:"个人信贷业务流程",description:"个人信贷业务的完整流程，包含申请、审核、放款等环节",businessType:"self",productType:"personal",stepCount:6,creator:"张三",updateTime:"2024-01-15 14:30"},{id:2,name:"企业贷款业务流程",description:"企业贷款业务流程，涵盖企业资质审核、风险评估等步骤",businessType:"self",productType:"business",stepCount:8,creator:"李四",updateTime:"2024-01-12 09:15"},{id:3,name:"贷超平台流程",description:"贷超平台业务流程，包含渠道对接、订单分发等环节",businessType:"supermarket",productType:"general",stepCount:5,creator:"王五",updateTime:"2024-01-10 16:45"}]),u=Z(()=>zn),F=Z(()=>i.value>=0&&i.value<u.value.length?u.value[i.value].tables:[]);qe(()=>{var d;console.groupCollapsed("[业务流程] 初始化加载"),console.log("初始步骤数据表:",(d=u.value[0])==null?void 0:d.tables),console.log("初始步骤指标:",j.value),console.log("业务类型:",l.value),console.log("产品选型:",b.value),console.groupEnd(),G(0)});const Y=[{title:"表名",dataIndex:"name",width:180,ellipsis:!0,tooltip:!0,render:({record:d})=>de("div",{class:"table-name-cell"},[de("span",{class:"table-name"},d.name),de("span",{class:"table-type"},d.type)])},{title:"描述",dataIndex:"description",ellipsis:!0,tooltip:!0},{title:"负责人",dataIndex:"owner",width:100,render:({record:d})=>de("span",{class:"owner-name"},d.owner||"未指定")}],ae=d=>{d&&d.length===2&&(l.value=d[0],b.value=d[1],console.log("业务类型变化:",d[0],"产品类型变化:",d[1]),X.info(`已切换到${ne(d[0])}模式 - ${R(d[1])}产品`))},ne=d=>({self:"自营",supermarket:"贷超",assist:"助贷"})[d]||"未知",R=d=>({general:"通用",personal:"个人贷",business:"企业贷",mortgage:"房贷",car:"车贷"})[d]||"未知",j=Z(()=>i.value<0||i.value>=u.value.length?[]:u.value[i.value].tables.flatMap(N=>N.metrics||[])),K=[{title:"指标名称",dataIndex:"name",key:"name",width:180,render:({record:d})=>de("div",{class:"metric-name-cell"},[de("div",{class:"metric-name"},d.name),de("span",{class:"metric-unit"},d.unit?`(${d.unit})`:"")])},{title:"计算公式",dataIndex:"formula",key:"formula",ellipsis:!0,tooltip:!0,render:({record:d})=>de("code",{class:"formula-code"},d.formula)},{title:"负责人",dataIndex:"owner",key:"owner",width:100,render:({record:d})=>de("span",{class:"owner-name"},d.owner)}],I=d=>{console.log("查看指标详情:",d)},G=d=>{d<0||d>=u.value.length||d!==i.value&&(console.groupCollapsed(`[业务流程] 切换到步骤: ${d+1}. ${u.value[d].name} (索引: ${d})`),i.value=d,z.value="",O.value="",E.value=1,B.value=1,te.value=!1,c.value=[],console.log("更新后activeStep:",i.value),console.log("当前步骤数据表:",F.value),console.log("当前步骤指标:",j.value),console.groupEnd())},v=d=>{te.value||(console.groupCollapsed(`[数据表] 点击表: ${d.name}`),console.log("表详情:",d),console.log("点击时间:",new Date().toLocaleString()),console.groupEnd(),a.push({name:"TableDetail",params:{tableName:d.name,tableData:encodeURIComponent(JSON.stringify(d))}}))},V=()=>{console.log("编辑数据表绑定"),X.info("编辑数据表绑定功能")},C=()=>{console.log("编辑指标绑定"),X.info("编辑指标绑定功能")},ie=()=>{x.value=!0},m=()=>{T.value=null,x.value=!1,f.value=!0},D=d=>{T.value=d,x.value=!1,f.value=!0},q=d=>{const N=W.value.findIndex(pe=>pe.id===d);N>-1&&(W.value.splice(N,1),X.success("流程删除成功"))},le=d=>({self:"自营",supermarket:"贷超",assist:"助贷"})[d]||d,he=d=>({general:"通用",personal:"个人贷",business:"企业贷",mortgage:"房贷",car:"车贷"})[d]||d,Te=d=>{if(console.log("保存业务流程数据:",d),T.value){const N=W.value.findIndex(pe=>pe.id===T.value.id);N>-1&&(W.value[N]={...W.value[N],...d},X.success("业务流程更新成功"))}else{const N={id:Date.now(),...d,creator:"当前用户",updateTime:new Date().toLocaleString("zh-CN")};W.value.push(N),X.success("业务流程创建成功")}f.value=!1,T.value=null};return(d,N)=>{const pe=g("a-cascader"),re=g("a-button"),$e=g("a-card"),Se=g("a-option"),Me=g("a-select"),U=g("a-tag"),se=g("a-table"),H=g("a-tab-pane"),Ue=g("a-tabs"),ot=g("a-modal");return h(),k("div",vs,[t($e,{class:"steps-card",bordered:!1},{title:n(()=>[s("div",hs,[_s,s("div",fs,[s("div",gs,[s("div",ys,[bs,t(pe,{modelValue:r.value,"onUpdate:modelValue":N[0]||(N[0]=M=>r.value=M),options:p.value,size:"small",style:{width:"200px"},placeholder:"请选择业务类型和产品类型",onChange:ae,"expand-trigger":"hover","show-search":!0},null,8,["modelValue","options"])])]),s("div",ws,[s("span",ks,"共 "+w(u.value.length)+" 个步骤",1),t(re,{type:"primary",size:"small",onClick:ie},{icon:n(()=>[t(S(be))]),default:n(()=>[_(" 编辑流程 ")]),_:1})])])])]),default:n(()=>{var M,ge;return[s("div",Cs,[(h(!0),k(ee,null,oe(u.value,(lt,ye)=>(h(),k("div",{key:ye,class:Fe(["step-item",{active:i.value===ye,completed:ye<i.value}]),onClick:Ko=>G(ye)},[s("div",Ss,[s("div",Ms,w(ye+1),1),ye<u.value.length-1?(h(),k("div",Ds)):Q("",!0)]),s("div",Ps,[s("h4",xs,w(lt.name),1)])],10,$s))),128))]),s("div",Ts,[s("div",Is,[s("div",Vs,[s("div",zs,w(i.value+1),1),s("div",Fs,"/ "+w(u.value.length),1)]),s("div",Ws,[s("h2",Os,w((M=u.value[i.value])==null?void 0:M.name),1),s("p",Ns,w((ge=u.value[i.value])==null?void 0:ge.description),1),s("div",Us,[s("span",Ls,[t(S(De),{class:"stat-icon"}),_(" "+w(F.value.length)+" 个数据表 ",1)]),s("span",As,[t(S(Ve),{class:"stat-icon"}),_(" "+w(j.value.length)+" 个指标 ",1)])])])])])]}),_:1}),s("div",Bs,[t($e,{class:"data-content-card",bordered:!1},{extra:n(()=>[s("div",qs,[t(re,{type:"text",size:"small",onClick:N[1]||(N[1]=M=>L.value==="tables"?V():C())},{icon:n(()=>[t(S(be))]),default:n(()=>[_(" 编辑绑定 ")]),_:1}),t(Me,{"model-value":L.value==="tables"?$.value:P.value,"onUpdate:modelValue":N[2]||(N[2]=M=>L.value==="tables"?$.value=M:P.value=M),size:"small",style:{width:"100px"}},{default:n(()=>[t(Se,{value:"grid"},{default:n(()=>[_("网格")]),_:1}),t(Se,{value:"list"},{default:n(()=>[_("列表")]),_:1})]),_:1},8,["model-value"])])]),default:n(()=>[t(Ue,{"active-key":L.value,"onUpdate:activeKey":N[3]||(N[3]=M=>L.value=M),type:"line",size:"large",class:"data-tabs"},{default:n(()=>[t(H,{key:"tables",title:"核心底表"},{title:n(()=>[s("div",Xs,[t(S(De),{class:"tab-icon"}),Es])]),default:n(()=>[s("div",Rs,[s("div",Hs,[F.value.length>0?(h(),k("div",js,[$.value==="grid"?(h(),k("div",Ys,[(h(!0),k(ee,null,oe(F.value,M=>(h(),k("div",{key:M.name,class:"table-card",onClick:ge=>v(M)},[s("div",Ks,[s("h5",Qs,w(M.name),1),M.type?(h(),J(U,{key:0,size:"small",color:"green"},{default:n(()=>[_(w(M.type),1)]),_:2},1024)):Q("",!0)]),s("p",Zs,w(M.description),1),s("div",Gs,[s("span",eo,[t(S(Le),{class:"owner-icon"}),_(" "+w(M.owner||"未指定"),1)]),t(re,{type:"text",size:"mini"},{icon:n(()=>[t(S(Ye))]),_:1})])],8,Js))),128))])):(h(),k("div",to,[t(se,{data:F.value,columns:Y,pagination:!0,"page-size":10,size:"small",onRowClick:v,loading:A.value},null,8,["data","loading"])]))])):(h(),k("div",ao,[s("div",no,[t(S(De),{class:"empty-icon"}),so,oo,t(re,{type:"primary",onClick:ie},{icon:n(()=>[t(S(be))]),default:n(()=>[_(" 配置数据表 ")]),_:1})])]))])])]),_:1}),t(H,{key:"metrics",title:"业务指标"},{title:n(()=>[s("div",lo,[t(S(Ve),{class:"tab-icon"}),io])]),default:n(()=>[s("div",ro,[s("div",co,[j.value.length>0?(h(),k("div",uo,[P.value==="grid"?(h(),k("div",mo,[(h(!0),k(ee,null,oe(j.value,M=>(h(),k("div",{key:M.name,class:"metric-card",onClick:ge=>I(M)},[s("div",vo,[s("h5",ho,w(M.name),1),M.unit?(h(),J(U,{key:0,size:"small",color:"blue"},{default:n(()=>[_(w(M.unit),1)]),_:2},1024)):Q("",!0)]),s("p",_o,w(M.description),1),s("div",fo,[s("span",go,[t(S(Le),{class:"owner-icon"}),_(" "+w(M.owner||"未指定"),1)]),t(re,{type:"text",size:"mini"},{icon:n(()=>[t(S(Ye))]),_:1})])],8,po))),128))])):(h(),k("div",yo,[t(se,{data:j.value,columns:K,pagination:!0,"page-size":8,size:"small",onRowClick:I},null,8,["data"])]))])):(h(),k("div",bo,[s("div",wo,[t(S(Ve),{class:"empty-icon"}),ko,Co,t(re,{type:"primary",onClick:ie},{icon:n(()=>[t(S(be))]),default:n(()=>[_(" 配置指标 ")]),_:1})])]))])])]),_:1})]),_:1},8,["active-key"])]),_:1})]),t(ot,{visible:x.value,"onUpdate:visible":N[4]||(N[4]=M=>x.value=M),title:"业务流程管理",width:"800px",footer:!1,"mask-closable":!1},{default:n(()=>[s("div",$o,[s("div",So,[s("div",Mo,[t(re,{type:"primary",onClick:m},{icon:n(()=>[t(S(we))]),default:n(()=>[_(" 新增流程 ")]),_:1})])]),s("div",Do,[(h(!0),k(ee,null,oe(W.value,M=>(h(),k("div",{key:M.id,class:"process-item"},[s("div",Po,[s("div",xo,[s("h4",To,w(M.name),1),s("div",Io,[t(U,{size:"small",color:"blue"},{default:n(()=>[_(w(le(M.businessType)),1)]),_:2},1024),t(U,{size:"small",color:"green"},{default:n(()=>[_(w(he(M.productType)),1)]),_:2},1024)])]),s("p",Vo,w(M.description),1),s("div",zo,[s("span",Fo,[t(S(De),{class:"meta-icon"}),_(" "+w(M.stepCount)+" 个步骤 ",1)]),s("span",Wo,[t(S(Le),{class:"meta-icon"}),_(" "+w(M.creator),1)]),s("span",Oo,[t(S(_t),{class:"meta-icon"}),_(" "+w(M.updateTime),1)])])]),s("div",No,[t(re,{type:"text",size:"small",onClick:ge=>D(M)},{icon:n(()=>[t(S(be))]),default:n(()=>[_(" 编辑 ")]),_:2},1032,["onClick"]),t(re,{type:"text",size:"small",status:"danger",onClick:ge=>q(M.id)},{icon:n(()=>[t(S(We))]),default:n(()=>[_(" 删除 ")]),_:2},1032,["onClick"])])]))),128))])])]),_:1},8,["visible"]),t(ps,{visible:f.value,"onUpdate:visible":N[5]||(N[5]=M=>f.value=M),"process-data":T.value,onSave:Te},null,8,["visible","process-data"])])}}}),Lo=Ce(Uo,[["__scopeId","data-v-a654e12e"]]),Ao=e=>(Pe("data-v-c6b54062"),e=e(),xe(),e),Bo={class:"data-map-container"},qo={class:"header-section"},Xo={class:"header-top-row"},Eo=Ao(()=>s("div",{class:"title-area"},[s("h2",{class:"page-title"},"数据搜索"),s("p",{class:"page-description"},"搜索和管理您的数据资产")],-1)),Ro={class:"search-actions"},Ho={class:"tabs-section"},jo={class:"tab-content-wrapper"},Yo={class:"tab-content-wrapper business-process"},Jo=fe({__name:"index",setup(e){const o=y("1"),a=y(!1),i=y(!1),l=y({}),b=y(!1),r=y(null),p=y(!1),$=y(!1),P=et(async()=>{await f()},300),A=Xe(),L=y({name:""}),z=y(!1),O=y(null),E=y(tt),B=y(Ae.collections||[]);Z(()=>O.value?[{label:"表名",value:O.value.name},{label:"表类型",value:O.value.type},{label:"所属目录",value:O.value.category},{label:"业务域",value:O.value.domain},{label:"更新频率",value:O.value.updateFrequency},{label:"负责人",value:O.value.owner},{label:"描述",value:O.value.description}]:[]);const te=Z(()=>B.value.map(v=>({...v,type:v.type||c(v),owner:v.owner||"系统管理员",updateTime:v.updateTime||new Date().toISOString(),isFavorite:v.isFavorite||!1}))),c=v=>{const V=v.tables.map(C=>C.type);return V.includes("事实表")?"业务流程":V.includes("维度表")?"数据分析":"通用"},f=async()=>{i.value=!0;try{await new Promise(v=>setTimeout(v,800)),B.value=Ae.collections||[],E.value=Ae.favoriteTables||[]}catch(v){X.error("获取数据失败"),console.error("Failed to fetch collections:",v)}finally{i.value=!1}},x=async(v,V)=>{if(!v.trim()){X.warning("请输入搜索关键词");return}a.value=!0;try{await new Promise(C=>setTimeout(C,500)),A.push({path:"/discovery/search",query:{q:v,type:V.type,domain:V.domain,updateFrequency:V.updateFrequency}})}catch{X.error("搜索失败，请重试")}finally{a.value=!1}},T=()=>{L.value.name="",l.value={}},W=v=>{l.value=v,L.value.name&&x(L.value.name,v)},u=v=>{o.value=v,v==="1"&&!B.value.length&&P()},F=v=>{A.push({name:"CollectionDetail",params:{id:v.id},state:{data:v}})},Y=()=>{r.value=null,b.value=!0},ae=v=>{const V={id:String(Date.now()),name:v.name,description:v.description||"",type:v.type||c(v),tables:v.tables,owner:v.owner||"当前用户",updateTime:v.updateTime||new Date().toISOString(),isFavorite:v.isFavorite||!1};B.value.push(V),r.value=null,X.success("创建成功")},ne=v=>{const V=B.value.findIndex(C=>C.id===v.id);V>-1&&(B.value[V]=v,r.value=null,X.success("更新成功"))},R=v=>{r.value=v,b.value=!0},j=v=>{const V=B.value.findIndex(C=>C.id===v.id);V>-1&&(B.value.splice(V,1),X.success("删除成功"))},K=(v,V)=>{const C=B.value.findIndex(ie=>ie.id===v.id);C>-1&&(B.value[C].isFavorite=V)},I=()=>{p.value=!p.value,p.value&&($.value=!1)},G=()=>{$.value=!$.value,$.value&&(p.value=!1)};return qe(async()=>{z.value=!0;try{await f()}finally{z.value=!1}}),(v,V)=>{const C=g("a-button"),ie=g("a-tab-pane"),m=g("a-tabs"),D=g("router-link");return h(),k("div",Bo,[z.value?(h(),J(gt,{key:0,type:"skeleton","show-search":!0,"show-tabs":!0,"show-grid":!0,"loading-text":"正在加载数据资产..."})):(h(),k(ee,{key:1},[s("div",qo,[s("div",Xo,[Eo,s("div",Ro,[t(C,{type:"text",onClick:I,class:Fe({active:p.value})},{default:n(()=>[t(S(ft)),_("高级搜索 ")]),_:1},8,["class"]),t(C,{type:"text",onClick:G},{default:n(()=>[t(S(yt)),_("搜索历史 ")]),_:1})])]),t(Ot,{modelValue:L.value.name,"onUpdate:modelValue":V[0]||(V[0]=q=>L.value.name=q),placeholder:"请输入表名、描述或业务域进行搜索",loading:a.value,"show-advanced-filter":p.value,"show-history":$.value,onSearch:x,onClear:T,onFilterChange:W},null,8,["modelValue","loading","show-advanced-filter","show-history"])]),s("div",Ho,[t(m,{"active-key":o.value,"onUpdate:activeKey":V[1]||(V[1]=q=>o.value=q),animation:"",onChange:u},{default:n(()=>[t(ie,{key:"1",title:"常用表"},{default:n(()=>[s("div",jo,[t(Dn,{collections:te.value,loading:i.value,"page-size":12,onCollectionClick:F,onCreateCollection:Y,onEditCollection:R,onDeleteCollection:j,onFavoriteChange:K},null,8,["collections","loading"])])]),_:1}),t(ie,{key:"2",title:"核心业务流程"},{default:n(()=>[s("div",Yo,[t(Lo)])]),_:1})]),_:1},8,["active-key"])]),O.value?(h(),J(D,{key:0,to:`/discovery/data-map/${encodeURIComponent(JSON.stringify(O.value))}`,class:"hidden-link"},null,8,["to"])):Q("",!0),t(Vn,{visible:b.value,"onUpdate:visible":V[2]||(V[2]=q=>b.value=q),"edit-data":r.value,onCreate:ae,onUpdate:ne},null,8,["visible","edit-data"])],64))])}}}),nl=Ce(Jo,[["__scopeId","data-v-c6b54062"]]);export{nl as default};
