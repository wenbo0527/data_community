import{_ as E,r,b as F,c as I,h as O,f as e,w as l,M as d,e as i,o as j,j as u,i as J,x as A,t as G,N as H}from"./index-CsgcdrY7.js";const K={class:"coupon-rules-container"},Q={class:"header-actions"},W={__name:"index",setup(X){const x=r([]),y=r(!1),m=r({total:0,current:1,pageSize:10,showTotal:!0,showJumper:!0,showPageSize:!0}),c=r(!1),h=r(null),p=r(null),o=r({name:"",description:"",limitType:"user",limitValue:1,status:!0}),C={name:[{required:!0,message:"请输入规则名称"}],description:[{required:!0,message:"请输入规则描述"}],limitValue:[{required:!0,message:"请输入限制值"}]},_=async()=>{if(!y.value){y.value=!0;try{const t=[{id:1,name:"单用户限制",description:"限制单个用户领券数量",limitType:"user",limitValue:10,status:!0,createTime:"2024-01-01 12:00:00"},{id:2,name:"单用户单日限制",description:"限制每日领券总数量",limitType:"daily",limitValue:3,status:!0,createTime:"2024-01-01 12:00:00"},{id:3,name:"单用户单周限制",description:"限制每周领券总数量",limitType:"weekly",limitValue:10,status:!0,createTime:"2024-01-01 12:00:00"},{id:4,name:"单用户单月限制",description:"限制每月领券总数量",limitType:"monthly",limitValue:30,status:!0,createTime:"2024-01-01 12:00:00"}];x.value=t,m.value.total=1}catch{d.error("获取数据失败")}finally{y.value=!1}}},k=t=>{m.value.current=t,_()},S=t=>{m.value.pageSize=t,m.value.current=1,_()},b=()=>{var t;(t=h.value)==null||t.resetFields(),p.value=null,c.value=!1},U=async()=>{const{error:t}=await h.value.validate();if(t)return!1;try{return d.success(p.value?"更新成功":"创建成功"),b(),_(),!0}catch{return d.error(p.value?"更新失败":"创建失败"),!1}},q=t=>{p.value=t,o.value={...t},c.value=!0},z=t=>{H.confirm({title:"确认删除",content:`确定要删除规则「${t.name}」吗？`,onOk:async()=>{try{d.success("删除成功"),await _()}catch{d.error("删除失败")}}})},D=async(t,n)=>{t.statusLoading=!0;try{t.status=n,d.success("状态更新成功")}catch{t.status=!n,d.error("状态更新失败")}finally{t.statusLoading=!1}};return F(()=>{_()}),(t,n)=>{const g=i("a-button"),w=i("a-space"),s=i("a-table-column"),T=i("a-switch"),P=i("a-table"),M=i("a-input"),f=i("a-form-item"),$=i("a-textarea"),V=i("a-option"),B=i("a-select"),N=i("a-input-number"),L=i("a-form"),R=i("a-modal");return j(),I("div",K,[O("div",Q,[e(w,null,{default:l(()=>[e(g,{type:"primary",onClick:n[0]||(n[0]=a=>c.value=!0)},{icon:l(()=>[e(J(A))]),default:l(()=>[u(" 新建规则 ")]),_:1})]),_:1})]),e(P,{data:x.value,loading:y.value,pagination:m.value,onPageChange:k,onPageSizeChange:S},{columns:l(()=>[e(s,{title:"规则名称","data-index":"name"}),e(s,{title:"规则描述","data-index":"description"}),e(s,{title:"规则类型","data-index":"limitType"},{cell:l(({record:a})=>[u(G({user:"单用户上限",daily:"单日上限",weekly:"单周上限",monthly:"单月上限"}[a.limitType]),1)]),_:1}),e(s,{title:"限制值","data-index":"limitValue"}),e(s,{title:"状态","data-index":"status"},{cell:l(({record:a})=>[e(T,{modelValue:a.status,"onUpdate:modelValue":v=>a.status=v,loading:a.statusLoading,onChange:v=>D(a,v)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),e(s,{title:"创建时间","data-index":"createTime"}),e(s,{title:"操作",fixed:"right",width:150},{cell:l(({record:a})=>[e(w,null,{default:l(()=>[e(g,{type:"text",size:"small",onClick:v=>q(a)},{default:l(()=>[u("编辑")]),_:2},1032,["onClick"]),e(g,{type:"text",size:"small",status:"danger",onClick:v=>z(a)},{default:l(()=>[u("删除")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1})]),_:1},8,["data","loading","pagination"]),e(R,{visible:c.value,"onUpdate:visible":n[6]||(n[6]=a=>c.value=a),title:p.value?"编辑规则":"创建规则",onCancel:b,onBeforeOk:U},{default:l(()=>[e(L,{ref_key:"formRef",ref:h,model:o.value,rules:C,layout:"vertical"},{default:l(()=>[e(f,{field:"name",label:"规则名称",required:""},{default:l(()=>[e(M,{modelValue:o.value.name,"onUpdate:modelValue":n[1]||(n[1]=a=>o.value.name=a),placeholder:"请输入规则名称","allow-clear":""},null,8,["modelValue"])]),_:1}),e(f,{field:"description",label:"规则描述",required:""},{default:l(()=>[e($,{modelValue:o.value.description,"onUpdate:modelValue":n[2]||(n[2]=a=>o.value.description=a),placeholder:"请输入规则描述","max-length":200,"show-word-limit":""},null,8,["modelValue"])]),_:1}),e(f,{field:"limitType",label:"规则类型",required:""},{default:l(()=>[e(B,{modelValue:o.value.limitType,"onUpdate:modelValue":n[3]||(n[3]=a=>o.value.limitType=a),placeholder:"请选择规则类型"},{default:l(()=>[e(V,{value:"user"},{default:l(()=>[u("单用户上限")]),_:1}),e(V,{value:"daily"},{default:l(()=>[u("单日上限")]),_:1}),e(V,{value:"weekly"},{default:l(()=>[u("单周上限")]),_:1}),e(V,{value:"monthly"},{default:l(()=>[u("单月上限")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(f,{field:"limitValue",label:"限制值",required:""},{default:l(()=>[e(N,{modelValue:o.value.limitValue,"onUpdate:modelValue":n[4]||(n[4]=a=>o.value.limitValue=a),placeholder:`请输入${{user:"单用户",daily:"单用户单日",weekly:"单用户单周",monthly:"单用户单月"}[o.value.limitType]}可获取的最大数量`,min:1,max:999999,step:1},null,8,["modelValue","placeholder"])]),_:1}),e(f,{field:"status",label:"是否生效"},{default:l(()=>[e(T,{modelValue:o.value.status,"onUpdate:modelValue":n[5]||(n[5]=a=>o.value.status=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}},Z=E(W,[["__scopeId","data-v-1ae2bd07"]]);export{Z as default};
