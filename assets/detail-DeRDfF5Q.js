import{K as b,b as k,e as c,c as g,o as d,d as h,w as s,f as e,j as u,t as l,_ as $,g as D,h as q,s as U,v as z,u as H,r as R,a as M,ae as G,F,J as S,m as K,M as T}from"./index-CsgcdrY7.js";import{f as O}from"./customer360-uz3bfQck.js";const J={class:"basic-info"},W={__name:"BasicInfo",props:{userInfo:{type:Object,default:()=>null}},setup(o){const m=o;return b(()=>m.userInfo,t=>{console.debug("[BasicInfo] userInfo数据变化:",{timestamp:Date.now(),hasData:!!t,hasError:t==null?void 0:t.error,dataKeys:t?Object.keys(t):[],basicInfoFields:t?{hasName:"name"in t,nameValue:t.name,hasAge:"age"in t,ageValue:t.age,hasGender:"gender"in t,genderValue:t.gender,hasMobile:"mobile"in t,mobileValue:t.mobile,hasCustomerNo:"customerNo"in t,customerNoValue:t.customerNo,hasAddress:"address"in t,addressValue:t.address,hasIdCard:"idCard"in t,idCardValue:t.idCard,hasIdExpiry:"idExpiry"in t,idExpiryValue:t.idExpiry,hasStatus:"status"in t,statusValue:t.status,hasSimilarity:"similarity"in t,similarityValue:t.similarity,hasThreshold:"threshold"in t,thresholdValue:t.threshold,hasErrorMsg:"errorMsg"in t,errorMsgValue:t.errorMsg}:null})},{immediate:!0,deep:!0}),k(()=>{var t;console.debug("[BasicInfo] 组件挂载完成，初始数据:",{timestamp:Date.now(),hasUserInfo:!!m.userInfo,userInfoError:(t=m.userInfo)==null?void 0:t.error})}),(t,v)=>{const f=c("a-skeleton"),a=c("a-descriptions-item"),p=c("a-descriptions");return d(),g("div",J,[o.userInfo?(d(),h(p,{key:1,bordered:"",column:{xs:1,sm:2,md:3},size:"small"},{default:s(()=>[e(a,{label:"姓名"},{default:s(()=>[u(l(o.userInfo.name),1)]),_:1}),e(a,{label:"年龄"},{default:s(()=>[u(l(o.userInfo.age),1)]),_:1}),e(a,{label:"性别"},{default:s(()=>[u(l(o.userInfo.gender),1)]),_:1}),e(a,{label:"手机号码"},{default:s(()=>[u(l(o.userInfo.mobile),1)]),_:1}),e(a,{label:"客户号"},{default:s(()=>[u(l(o.userInfo.customerNo),1)]),_:1}),e(a,{label:"户籍"},{default:s(()=>[u(l(o.userInfo.address),1)]),_:1}),e(a,{label:"身份证号"},{default:s(()=>[u(l(o.userInfo.idCard),1)]),_:1}),e(a,{label:"身份证有效期"},{default:s(()=>[u(l(o.userInfo.idExpiry),1)]),_:1}),e(a,{label:"用户状态"},{default:s(()=>[u(l(o.userInfo.status),1)]),_:1}),e(a,{label:"活体相似度"},{default:s(()=>[u(l(o.userInfo.similarity),1)]),_:1}),e(a,{label:"相似度阈值"},{default:s(()=>[u(l(o.userInfo.threshold),1)]),_:1}),e(a,{label:"错误信息"},{default:s(()=>[u(l(o.userInfo.errorMsg),1)]),_:1})]),_:1})):(d(),h(f,{key:0,loading:!0}))])}}},Q=o=>(U("data-v-90fb46bd"),o=o(),z(),o),X={class:"product-info"},Y={key:1},Z={key:2},V=Q(()=>q("div",{class:"section-title"},"产品级客户信息",-1)),w={key:0,class:"section-title mt-4"},tt={__name:"ProductInfo",props:{userInfo:{type:Object,default:()=>null},productData:{type:Array,default:()=>[]}},setup(o){const m=o;return b(()=>m.userInfo,t=>{console.debug("[ProductInfo] userInfo数据变化:",{timestamp:Date.now(),hasError:t==null?void 0:t.error,hasData:!!t,maxOverdueDays:t==null?void 0:t.maxOverdueDays,currentOverdueDays:t==null?void 0:t.currentOverdueDays,overdueAmount:t==null?void 0:t.overdueAmount,repaymentRate:t==null?void 0:t.repaymentRate})},{immediate:!0,deep:!0}),b(()=>m.productData,t=>{console.debug("[ProductInfo] productData数据变化:",{timestamp:Date.now(),count:t==null?void 0:t.length,isEmpty:!t||t.length===0,firstItem:t&&t.length>0?{productKey:t[0].productKey,name:t[0].name,hasBalance:"balance"in t[0],balanceValue:t[0].balance}:null})},{immediate:!0,deep:!0}),k(()=>{var t,v;console.debug("[ProductInfo] 组件挂载完成，初始数据:",{timestamp:Date.now(),hasUserInfo:!!m.userInfo,userInfoError:(t=m.userInfo)==null?void 0:t.error,productDataCount:(v=m.productData)==null?void 0:v.length})}),(t,v)=>{const f=c("a-skeleton"),a=c("a-empty"),p=c("a-descriptions-item"),_=c("a-descriptions"),y=c("a-table-column"),n=c("a-table");return d(),g("div",X,[o.userInfo?o.userInfo.error?(d(),g("div",Y,[e(a,{description:"找不到用户相关信息"})])):(d(),g("div",Z,[V,e(_,{bordered:"",column:{xs:1,sm:2,md:4},size:"small"},{default:s(()=>[e(p,{label:"历史最大透支天数"},{default:s(()=>[u(l(o.userInfo.maxOverdueDays||0)+" 天",1)]),_:1}),e(p,{label:"当前透支天数"},{default:s(()=>[u(l(o.userInfo.currentOverdueDays||0)+" 天",1)]),_:1}),e(p,{label:"当前透支金额"},{default:s(()=>[u(l((o.userInfo.overdueAmount||0).toFixed(2))+" 元",1)]),_:1}),e(p,{label:"当前还款率"},{default:s(()=>[u(l(o.userInfo.repaymentRate||0)+"%",1)]),_:1})]),_:1}),o.productData&&o.productData.length>0?(d(),g("div",w,"产品信息")):D("",!0),o.productData&&o.productData.length>0?(d(),h(n,{key:1,data:o.productData,pagination:!1,size:"small","border-cell":""},{default:s(()=>[e(y,{title:"产品编号","data-index":"productKey"}),e(y,{title:"产品名称","data-index":"name"}),e(y,{title:"余额","data-index":"balance"},{cell:s(({record:A})=>[u(l((A.balance||0).toFixed(2))+" 元 ",1)]),_:1}),e(y,{title:"状态","data-index":"status"})]),_:1},8,["data"])):o.userInfo.error?D("",!0):(d(),h(a,{key:2,description:"暂无产品信息"}))])):(d(),h(f,{key:0,loading:!0}))])}}},et=$(tt,[["__scopeId","data-v-90fb46bd"]]),at={class:"credit-list"},ot={__name:"CreditList",props:{credits:{type:Array,default:()=>[]}},setup(o){const m=o;return b(()=>m.credits,t=>{console.debug("[CreditList] credits数据变化:",{timestamp:Date.now(),count:t==null?void 0:t.length,isEmpty:!t||t.length===0,firstItem:t&&t.length>0?{creditNo:t[0].creditNo,creditDate:t[0].creditDate,hasInitialAmount:"initialAmount"in t[0],initialAmountValue:t[0].initialAmount,hasCurrentAmount:"currentAmount"in t[0],currentAmountValue:t[0].currentAmount,hasUsedAmount:"usedAmount"in t[0],usedAmountValue:t[0].usedAmount}:null})},{immediate:!0,deep:!0}),k(()=>{var t;console.debug("[CreditList] 组件挂载完成，初始数据:",{timestamp:Date.now(),hasCredits:!!m.credits,creditsCount:(t=m.credits)==null?void 0:t.length})}),(t,v)=>{const f=c("a-empty"),a=c("a-table-column"),p=c("a-button"),_=c("a-table");return d(),g("div",at,[!o.credits||o.credits.length===0?(d(),h(f,{key:0,description:"暂无授信信息"})):(d(),h(_,{key:1,data:o.credits,pagination:!1,size:"small","border-cell":""},{default:s(()=>[e(a,{title:"授信编号","data-index":"creditNo"}),e(a,{title:"授信日期","data-index":"creditDate"}),e(a,{title:"渠道","data-index":"channel"}),e(a,{title:"结果","data-index":"result"}),e(a,{title:"拒绝原因","data-index":"rejectReason"}),e(a,{title:"初始额度","data-index":"initialAmount"},{cell:s(({record:y})=>[u(l((y.initialAmount||0).toFixed(2)),1)]),_:1}),e(a,{title:"当前额度","data-index":"currentAmount"},{cell:s(({record:y})=>[u(l((y.currentAmount||0).toFixed(2)),1)]),_:1}),e(a,{title:"已用额度","data-index":"usedAmount"},{cell:s(({record:y})=>[u(l((y.usedAmount||0).toFixed(2)),1)]),_:1}),e(a,{title:"风险等级","data-index":"riskLevel"}),e(a,{title:"操作"},{cell:s(()=>[e(p,{type:"text",size:"small"},{default:s(()=>[u("查看详情")]),_:1})]),_:1})]),_:1},8,["data"]))])}}},st={class:"loan-list"},rt={class:"operations"},ut={__name:"LoanList",props:{loans:{type:Array,default:()=>[]}},setup(o){const m=o;return b(()=>m.loans,t=>{console.debug("[LoanList] loans数据变化:",{timestamp:Date.now(),count:t==null?void 0:t.length,isEmpty:!t||t.length===0,firstItem:t&&t.length>0?{loanNo:t[0].loanNo,loanDate:t[0].loanDate,hasAmount:"amount"in t[0],amountValue:t[0].amount,hasBalance:"balance"in t[0],balanceValue:t[0].balance,hasInstallments:"installments"in t[0],installmentsValue:t[0].installments,hasPaidInstallments:"paidInstallments"in t[0],paidInstallmentsValue:t[0].paidInstallments}:null})},{immediate:!0,deep:!0}),k(()=>{var t;console.debug("[LoanList] 组件挂载完成，初始数据:",{timestamp:Date.now(),hasLoans:!!m.loans,loansCount:(t=m.loans)==null?void 0:t.length})}),(t,v)=>{const f=c("a-empty"),a=c("a-table-column"),p=c("a-button"),_=c("a-table");return d(),g("div",st,[!o.loans||o.loans.length===0?(d(),h(f,{key:0,description:"暂无用信信息"})):(d(),h(_,{key:1,data:o.loans,pagination:!1,size:"small","border-cell":""},{default:s(()=>[e(a,{title:"用信编号","data-index":"loanNo"}),e(a,{title:"用信日期","data-index":"loanDate"}),e(a,{title:"银行卡号","data-index":"bankCard"}),e(a,{title:"渠道","data-index":"channel"}),e(a,{title:"产品名称","data-index":"productName"}),e(a,{title:"结果","data-index":"result"}),e(a,{title:"合同编号","data-index":"contractNo"}),e(a,{title:"状态","data-index":"status"}),e(a,{title:"金额","data-index":"amount"},{cell:s(({record:y})=>[u(l((y.amount||0).toFixed(2)),1)]),_:1}),e(a,{title:"操作",fixed:"right"},{cell:s(()=>[q("div",rt,[e(p,{type:"text",size:"small"},{default:s(()=>[u("查看详情")]),_:1}),e(p,{type:"text",size:"small"},{default:s(()=>[u("查看合同")]),_:1}),e(p,{type:"text",size:"small"},{default:s(()=>[u("查看账单")]),_:1})])]),_:1})]),_:1},8,["data"]))])}}},nt={class:"adjustment-history"},dt={__name:"AdjustmentHistory",props:{history:{type:Array,default:()=>[]}},setup(o){const m=o;return b(()=>m.history,t=>{console.debug("[AdjustmentHistory] history数据变化:",{timestamp:Date.now(),count:t==null?void 0:t.length,isEmpty:!t||t.length===0,firstItem:t&&t.length>0?{customerNo:t[0].customerNo,adjustDate:t[0].adjustDate,hasBeforeAmount:"beforeAmount"in t[0],beforeAmountValue:t[0].beforeAmount,hasAfterAmount:"afterAmount"in t[0],afterAmountValue:t[0].afterAmount,hasBeforeRate:"beforeRate"in t[0],beforeRateValue:t[0].beforeRate,hasAfterRate:"afterRate"in t[0],afterRateValue:t[0].afterRate,hasBeforePeriod:"beforePeriod"in t[0],beforePeriodValue:t[0].beforePeriod,hasAfterPeriod:"afterPeriod"in t[0],afterPeriodValue:t[0].afterPeriod}:null})},{immediate:!0,deep:!0}),k(()=>{var t;console.debug("[AdjustmentHistory] 组件挂载完成，初始数据:",{timestamp:Date.now(),hasHistory:!!m.history,historyCount:(t=m.history)==null?void 0:t.length})}),(t,v)=>{const f=c("a-empty"),a=c("a-table-column"),p=c("a-table");return d(),g("div",nt,[!o.history||o.history.length===0?(d(),h(f,{key:0,description:"暂无调额历史"})):(d(),h(p,{key:1,data:o.history,pagination:!1,size:"small","border-cell":""},{default:s(()=>[e(a,{title:"客户号","data-index":"customerNo"}),e(a,{title:"调整日期","data-index":"adjustDate"}),e(a,{title:"调整前额度","data-index":"beforeAmount"},{cell:s(({record:_})=>[u(l((_.beforeAmount||0).toFixed(2)),1)]),_:1}),e(a,{title:"调整后额度","data-index":"afterAmount"},{cell:s(({record:_})=>[u(l((_.afterAmount||0).toFixed(2)),1)]),_:1}),e(a,{title:"调整原因","data-index":"adjustReason"}),e(a,{title:"调整前利率","data-index":"beforeRate"},{cell:s(({record:_})=>[u(l((_.beforeRate||0).toFixed(2)),1)]),_:1}),e(a,{title:"调整后利率","data-index":"afterRate"},{cell:s(({record:_})=>[u(l((_.afterRate||0).toFixed(2)),1)]),_:1}),e(a,{title:"调整前期限","data-index":"beforePeriod"}),e(a,{title:"调整后期限","data-index":"afterPeriod"}),e(a,{title:"操作人","data-index":"operator"}),e(a,{title:"结果","data-index":"result"})]),_:1},8,["data"]))])}}},it={class:"info-sections"},lt={__name:"detail",props:["userId"],setup(o){const m=o,t=H(),v=S();console.log("路由参数:",t.params),console.log("查询参数:",t.query);const f=R(t.query.product||"deposit");console.debug("[DEBUG] 初始化selectedProduct:",f.value);const a=R(m.userId||t.query.userId);console.log("组件接收参数 - userId:",a.value,"product:",f.value),b(()=>t.params.userId,(i,I)=>{i!==I&&(console.log("userId参数变化:",i),a.value=i,L())}),b(()=>t.query.product,i=>{console.log("product参数变化:",i),f.value=i||"deposit"}),b(f,(i,I)=>{i&&i!==I&&(v.push({...t,query:{...t.query,product:i}}),n.value&&L())});const p=i=>{f.value=i},_=async()=>{try{A.value=!0;const i=await O(a.value);n.value=i}catch(i){console.error("Failed to fetch user info:",i)}finally{A.value=!1}};k(()=>{_()});const y=R([{key:"deposit",name:"存款产品"},{key:"loan",name:"贷款产品"}]);M(()=>y.value.find(i=>i.key===f.value));const n=R({});console.debug("[DEBUG] 初始化userInfo:",{timestamp:Date.now(),value:n.value});const A=R(!1);b(t,i=>{i.query.product&&i.query.product!==f.value&&(f.value=i.query.product)});const L=async()=>{var i,I,N,j,B,x,C,E,P;try{A.value=!0,console.debug("[DEBUG] 开始获取用户数据，参数:",{userId:a.value,selectedProduct:f.value,timestamp:Date.now()});const r=await O(a.value);console.debug("[DEBUG] fetchUserInfo返回原始数据:",{timestamp:Date.now(),hasError:!!r.error,dataKeys:Object.keys(r),depositProductsCount:(i=r.depositProducts)==null?void 0:i.length,loanProductsCount:(I=r.loanProducts)==null?void 0:I.length,creditsListCount:(N=r.creditsList)==null?void 0:N.length,loanRecordsCount:(j=r.loanRecords)==null?void 0:j.length,quotaAdjustHistoryCount:(B=r.quotaAdjustHistory)==null?void 0:B.length}),r.error?(console.warn("[WARN] 获取用户数据出现错误:",r.error,r.message),n.value=r):(n.value=f.value==="deposit"?{...r,productData:r.depositProducts||[]}:{...r,productData:r.loanProducts||[]},console.debug("[DEBUG] 处理后的用户数据:",{productDataCount:(x=n.value.productData)==null?void 0:x.length,selectedProduct:f.value})),console.debug("[DEBUG] 用户数据获取成功:",{timestamp:Date.now(),dataStructure:Object.keys(n.value),creditsListExists:!!n.value.creditsList,creditsListCount:(C=n.value.creditsList)==null?void 0:C.length,loanRecordsCount:(E=n.value.loanRecords)==null?void 0:E.length,quotaAdjustHistoryCount:(P=n.value.quotaAdjustHistory)==null?void 0:P.length})}catch(r){console.error("[ERROR] 数据加载失败:",{timestamp:Date.now(),error:r,userId:a.value}),T.error("数据加载失败")}finally{A.value=!1}};return G(()=>{console.debug("[DEBUG] 开始获取用户数据:",{userId:a.value,timestamp:Date.now()}),a&&L()}),(i,I)=>{var C,E;const N=c("a-page-header"),j=c("a-tab-pane"),B=c("a-tabs"),x=c("a-card");return d(),g(F,null,[e(N,{title:((C=n.value)==null?void 0:C.name)||"客户详情","sub-title":"用户ID："+(((E=n.value)==null?void 0:E.customerNo)||""),onBack:I[0]||(I[0]=()=>i.$router.go(-1))},null,8,["title","sub-title"]),e(x,{loading:A.value},{default:s(()=>{var P;return[(P=n.value)!=null&&P.productData&&n.value.productData.length>0?(d(),h(B,{key:0,"active-key":f.value,onChange:p},{default:s(()=>[(d(!0),g(F,null,K(y.value,r=>(d(),h(j,{key:r.key,title:r.name},null,8,["title"]))),128))]),_:1},8,["active-key"])):D("",!0),q("div",it,[n.value?(d(),h(x,{key:0,class:"info-card",bordered:!1},{default:s(()=>[e(W,{"user-info":n.value},null,8,["user-info"])]),_:1})):D("",!0),n.value?(d(),h(x,{key:1,class:"info-card",title:"产品级客户信息",bordered:!1},{default:s(()=>[e(et,{"user-info":n.value,"product-data":n.value.productData},null,8,["user-info","product-data"])]),_:1})):D("",!0),n.value?(d(),h(x,{key:2,class:"info-card",title:"授信列表",bordered:!1},{default:s(()=>{var r;return[e(ot,{credits:(r=n.value)==null?void 0:r.creditsList},null,8,["credits"])]}),_:1})):D("",!0),n.value?(d(),h(x,{key:3,class:"info-card",title:"用信列表",bordered:!1},{default:s(()=>{var r;return[e(ut,{loans:(r=n.value)==null?void 0:r.loanRecords},null,8,["loans"])]}),_:1})):D("",!0),n.value?(d(),h(x,{key:4,class:"info-card",title:"调额历史",bordered:!1},{default:s(()=>{var r;return[e(dt,{history:(r=n.value)==null?void 0:r.quotaAdjustHistory},null,8,["history"])]}),_:1})):D("",!0)])]}),_:1},8,["loading"])],64)}}},ft=$(lt,[["__scopeId","data-v-46068603"]]);export{ft as default};
