# ç”»å¸ƒæ‹–æ‹½äº‹ä»¶ä¼ é€’ä¿®å¤æµ‹è¯•æŒ‡å—

## ğŸ”§ ä¿®å¤å†…å®¹

### 1. äº‹ä»¶ç›‘å¬å™¨å†²çªä¿®å¤
- **é—®é¢˜**: TaskFlowCanvas çš„è°ƒè¯•äº‹ä»¶ç›‘å¬å™¨ä½¿ç”¨æ•è·é˜¶æ®µï¼Œå¹²æ‰°äº† CanvasPanZoomManager çš„äº‹ä»¶å¤„ç†
- **ä¿®å¤**: å°†è°ƒè¯•äº‹ä»¶ç›‘å¬å™¨æ”¹ä¸ºå†’æ³¡é˜¶æ®µï¼ˆ`false` å‚æ•°ï¼‰

### 2. åˆå§‹åŒ–é¡ºåºä¼˜åŒ–
- **é—®é¢˜**: CanvasPanZoomManager åœ¨è°ƒè¯•äº‹ä»¶ç›‘å¬å™¨ä¹‹ååˆå§‹åŒ–ï¼Œå¯¼è‡´äº‹ä»¶ç»‘å®šé¡ºåºé”™è¯¯
- **ä¿®å¤**: å°† CanvasPanZoomManager åˆå§‹åŒ–æå‰åˆ°äº‹ä»¶ç»‘å®šä¹‹å‰

### 3. è°ƒè¯•æ—¥å¿—å¢å¼º
- **å¢åŠ **: åœ¨ `handleMouseMove` æ–¹æ³•å¼€å§‹å¤„æ·»åŠ å¼ºåˆ¶æ—¥å¿—ï¼Œç¡®è®¤æ–¹æ³•æ˜¯å¦è¢«è°ƒç”¨
- **ç›®çš„**: å¿«é€Ÿè¯Šæ–­äº‹ä»¶ä¼ é€’é—®é¢˜

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åŸºç¡€æ‹–æ‹½æµ‹è¯•
1. æ‰“å¼€ç”»å¸ƒé¡µé¢
2. åœ¨ç©ºç™½åŒºåŸŸæŒ‰ä¸‹é¼ æ ‡å·¦é”®
3. æ‹–æ‹½é¼ æ ‡ç§»åŠ¨
4. è§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—

### 2. é¢„æœŸæ—¥å¿—è¾“å‡º
```
ğŸš€ [CanvasPanZoomManager] æ‹–æ‹½å¼€å§‹: {startPosition: {...}, currentTranslate: {...}, mode: 'default', sensitivity: 1.5}
ğŸ”„ [CanvasPanZoomManager] handleMouseMove è¢«è°ƒç”¨: {isPanning: true, hasLastPanPoint: true, clientX: xxx, clientY: xxx}
ğŸ”„ [CanvasPanZoomManager] handleMouseMove è¢«è°ƒç”¨: {isPanning: true, hasLastPanPoint: true, clientX: xxx, clientY: xxx}
...
ğŸ”š [CanvasPanZoomManager] æ‹–æ‹½ç»“æŸ: {endPosition: {...}, finalTranslate: {...}, ...}
```

### 3. å…³é”®æ£€æŸ¥ç‚¹
- âœ… `handleMouseMove` æ–¹æ³•è¢«é¢‘ç¹è°ƒç”¨
- âœ… `isPanning: true` çŠ¶æ€æ­£ç¡®
- âœ… `hasLastPanPoint: true` çŠ¶æ€æ­£ç¡®
- âœ… ç”»å¸ƒå®é™…å‘ç”Ÿç§»åŠ¨

## ğŸš¨ é—®é¢˜æ’æŸ¥

### å¦‚æœ `handleMouseMove` ä»æœªè¢«è°ƒç”¨
1. **æ£€æŸ¥äº‹ä»¶ç»‘å®š**:
   ```javascript
   console.log('äº‹ä»¶ç›‘å¬å™¨æ•°é‡:', graph.container.getEventListeners?.('mousemove')?.length)
   ```

2. **æ£€æŸ¥å®¹å™¨å…ƒç´ **:
   ```javascript
   console.log('å®¹å™¨å…ƒç´ :', graph.container)
   console.log('å®¹å™¨æ ·å¼:', getComputedStyle(graph.container))
   ```

3. **æ£€æŸ¥äº‹ä»¶ä¼ æ’­**:
   - ç¡®è®¤æ²¡æœ‰å…¶ä»–ç»„ä»¶è°ƒç”¨ `e.stopPropagation()`
   - æ£€æŸ¥ CSS `pointer-events` å±æ€§

### å¦‚æœæ–¹æ³•è¢«è°ƒç”¨ä½†ç”»å¸ƒä¸ç§»åŠ¨
1. **æ£€æŸ¥ X6 é…ç½®**:
   ```javascript
   console.log('Scroller é…ç½®:', graph.scroller)
   console.log('å½“å‰å˜æ¢:', graph.translate())
   ```

2. **æ£€æŸ¥è¾¹ç•Œé™åˆ¶**:
   ```javascript
   console.log('è¾¹ç•ŒåŒºåŸŸ:', panZoomManager.restrictArea)
   console.log('æ˜¯å¦åœ¨è¾¹ç•Œå†…:', panZoomManager.isWithinBounds(x, y))
   ```

## ğŸ¯ æ€§èƒ½æŒ‡æ ‡

### å“åº”æ€§æµ‹è¯•
- **æ‹–æ‹½å»¶è¿Ÿ**: < 16ms (60fps)
- **ç´¯ç§¯é˜ˆå€¼**: 1px (é™ä½åçš„é˜ˆå€¼)
- **å¹³æ»‘å› å­**: 0.95 (æé«˜åçš„å“åº”æ€§)

### æ—¥å¿—é¢‘ç‡
- **æ‹–æ‹½å¼€å§‹**: 1æ¬¡
- **æ‹–æ‹½è¿‡ç¨‹**: æ ¹æ®é¼ æ ‡ç§»åŠ¨é¢‘ç‡
- **æ‹–æ‹½ç»“æŸ**: 1æ¬¡

## ğŸ”„ å›æ»šæ–¹æ¡ˆ

å¦‚æœä¿®å¤å¯¼è‡´å…¶ä»–é—®é¢˜ï¼Œå¯ä»¥å›æ»šï¼š

1. **æ¢å¤äº‹ä»¶ç›‘å¬å™¨**:
   ```javascript
   container.addEventListener('mousemove', debugMouseMove, true) // æ¢å¤æ•è·é˜¶æ®µ
   ```

2. **æ¢å¤åˆå§‹åŒ–é¡ºåº**:
   ```javascript
   // å°† CanvasPanZoomManager åˆå§‹åŒ–ç§»å›åŸä½ç½®
   ```

3. **ç§»é™¤è°ƒè¯•æ—¥å¿—**:
   ```javascript
   // ç§»é™¤ handleMouseMove å¼€å§‹å¤„çš„å¼ºåˆ¶æ—¥å¿—
   ```

## ğŸ“Š æµ‹è¯•ç”¨ä¾‹

### ç”¨ä¾‹1: åŸºç¡€æ‹–æ‹½
- **æ“ä½œ**: åœ¨ç©ºç™½åŒºåŸŸæ‹–æ‹½
- **é¢„æœŸ**: ç”»å¸ƒå¹³æ»‘ç§»åŠ¨ï¼Œæ—¥å¿—æ­£å¸¸è¾“å‡º

### ç”¨ä¾‹2: è¾¹ç•Œæµ‹è¯•
- **æ“ä½œ**: æ‹–æ‹½åˆ°ç”»å¸ƒè¾¹ç•Œ
- **é¢„æœŸ**: åº”ç”¨é˜»åŠ›ï¼Œä¸è¶…å‡ºè¾¹ç•Œ

### ç”¨ä¾‹3: å¤šç§æ‹–æ‹½æ¨¡å¼
- **æ“ä½œ**: æŒ‰ 1/2/3 é”®åˆ‡æ¢æ¨¡å¼åæ‹–æ‹½
- **é¢„æœŸ**: ä¸åŒçµæ•åº¦å“åº”

### ç”¨ä¾‹4: ä¿®é¥°é”®æµ‹è¯•
- **æ“ä½œ**: æŒ‰ä½ç©ºæ ¼é”®æ‹–æ‹½
- **é¢„æœŸ**: ä¸´æ—¶æ‹–æ‹½æ¨¡å¼ç”Ÿæ•ˆ

## ğŸ‰ æˆåŠŸæ ‡å‡†

- âœ… `handleMouseMove` æ–¹æ³•æ­£å¸¸è¢«è°ƒç”¨
- âœ… ç”»å¸ƒèƒ½å¤Ÿæµç•…æ‹–æ‹½ç§»åŠ¨
- âœ… æ—¥å¿—è¾“å‡ºç®€æ´ä¸”æœ‰ç”¨
- âœ… ä¸å½±å“å…¶ä»–åŠŸèƒ½ï¼ˆèŠ‚ç‚¹æ‹–æ‹½ã€è¿æ¥ç­‰ï¼‰
- âœ… æ€§èƒ½è‰¯å¥½ï¼Œæ— æ˜æ˜¾å¡é¡¿

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **ä¸´æ—¶è°ƒè¯•æ—¥å¿—**: æµ‹è¯•å®Œæˆåå¯ä»¥ç§»é™¤ `handleMouseMove` å¼€å§‹å¤„çš„å¼ºåˆ¶æ—¥å¿—
2. **äº‹ä»¶ç›‘å¬å™¨é¡ºåº**: ç¡®ä¿ CanvasPanZoomManager çš„äº‹ä»¶ç›‘å¬å™¨ä¼˜å…ˆçº§æœ€é«˜
3. **å…¼å®¹æ€§**: ç¡®è®¤ä¿®å¤ä¸å½±å“è§¦æ‘¸è®¾å¤‡çš„æ‹–æ‹½åŠŸèƒ½