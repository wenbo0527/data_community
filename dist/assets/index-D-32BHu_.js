import{B as ye,r as v,p as G,b as Ce,c as P,h as T,f as e,w as t,e as c,s as xe,v as De,o as h,j as s,i as K,x as Q,t as N,F as Se,m as he,d as Te,g as Me,M as C,R as J,_ as Ue}from"./index-CsgcdrY7.js";const ke=x=>(xe("data-v-bb2bc796"),x=x(),De(),x),Ie={class:"metric-management"},Ee={class:"page-header"},Le=ke(()=>T("h2",null,"指标管理",-1)),Re={class:"search-section"},Pe={class:"report-list"},Ne=ye({__name:"index",setup(x){const M=v(!1),O=v(""),$=v(""),q=v(""),_=v(!1),U=v(!1),p=v(null),X=v(null),k=v(),I=v([]),Z=[{title:"指标名称",dataIndex:"name",width:150,render:({record:l})=>J("a-button",{type:"text",onClick:()=>ce(l)},l.name)},{title:"指标编码",dataIndex:"code",width:120},{title:"分类",dataIndex:"category",slotName:"category",width:100},{title:"业务域",dataIndex:"businessDomain",width:100},{title:"业务定义",dataIndex:"businessDefinition",ellipsis:!0,tooltip:!0},{title:"统计周期",dataIndex:"statisticalPeriod",width:100},{title:"负责人",dataIndex:"owner",width:100},{title:"版本号",dataIndex:"version",width:100},{title:"版本状态",dataIndex:"versionStatus",width:100,render:({record:l})=>{const u={active:{text:"当前版本",color:"green"},history:{text:"历史版本",color:"gray"},draft:{text:"草稿",color:"orange"}}[l.versionStatus]||{text:l.versionStatus,color:"blue"};return J("a-tag",{color:u.color},u.text)}},{title:"状态",dataIndex:"status",slotName:"status",width:80},{title:"更新时间",dataIndex:"updateTime",width:150},{title:"操作",slotName:"actions",width:200,fixed:"right"}],ee=[{title:"版本号",dataIndex:"version",width:120},{title:"版本状态",dataIndex:"versionStatus",slotName:"versionStatus",width:100},{title:"版本说明",dataIndex:"versionDescription",ellipsis:!0,tooltip:!0},{title:"创建时间",dataIndex:"createTime",width:150},{title:"创建人",dataIndex:"creator",width:100},{title:"操作",slotName:"actions",width:150,fixed:"right"}],te=v([{id:1,name:"DAU",code:"USER_001",category:"用户指标",businessDomain:"留存域",businessDefinition:"日活跃用户数",owner:"张三",version:"v1.2.0",versionStatus:"active",versionDescription:"优化计算逻辑，提升数据准确性",useCase:"用于监控产品的日常活跃情况，是产品健康度的重要指标",statisticalPeriod:"日更新",sourceTable:"dwd.user_login_detail",processingLogic:`SELECT dt, COUNT(DISTINCT user_id) as dau
FROM dwd.user_login_detail
WHERE dt = \${date}
GROUP BY dt`,fieldDescription:"user_id: 用户唯一标识, dt: 统计日期",reports:[{name:"用户分析报表",url:"/reports/user-analysis"},{name:"核心指标报表",url:"/reports/core-metrics"}],storageLocation:"adm.ads_user_core_metrics",queryCode:"SELECT dau FROM adm.ads_user_core_metrics WHERE dt = ${date}",status:"active",updateTime:"2024-01-15 10:30:00"},{id:2,name:"当日风控授信通过笔数",code:"A00043",category:"业务域",businessDomain:"业务规模",businessDefinition:"授信申请环节中风控审批结果为通过的笔数",owner:"王志雄",version:"v1.0.0",versionStatus:"active",versionDescription:"初始版本",useCase:"",statisticalPeriod:"离线T+2",sourceTable:"a_frms_deparment_sx_his_full",processingLogic:"SELECT COUNT(flow_id) FROM a_frms_deparment_sx_his_full WHERE result='PA'",fieldDescription:"",reports:[{name:"发展日测报告",url:"/reports/daily-development"},{name:"公司级报表",url:"/reports/company-level"},{name:"市场营销报表",url:"/reports/marketing"}],storageLocation:"adm.ads_report_index_commonality_info_full",queryCode:`SELECT data_dt=20250401
FROM adm.ads_report_numbersinfo_free_temporal_code
WHERE data_dt=20250401
AND indicator_name='风控授信通过量'
AND indicator_id='A00043'`,status:"active",updateTime:"2024-01-15 11:45:00"},{id:3,name:"用户注册转化率",code:"USER_002",category:"用户指标",businessDomain:"转化域",businessDefinition:"访问用户转化为注册用户的比率",owner:"李四",version:"v2.1.0",versionStatus:"active",versionDescription:"新增渠道维度分析",useCase:"衡量产品获客效果，优化注册流程",statisticalPeriod:"日更新",sourceTable:"dwd.user_register_detail",processingLogic:`SELECT dt, COUNT(DISTINCT register_user_id) / COUNT(DISTINCT visit_user_id) as conversion_rate
FROM dwd.user_register_detail
WHERE dt = \${date}
GROUP BY dt`,fieldDescription:"register_user_id: 完成注册的用户ID, visit_user_id: 访问用户ID",reports:[{name:"用户分析报表",url:"/reports/user-analysis"},{name:"转化分析报表",url:"/reports/conversion-analysis"}],storageLocation:"adm.ads_user_conversion_metrics",queryCode:"SELECT conversion_rate FROM adm.ads_user_conversion_metrics WHERE dt = ${date}",status:"active",updateTime:"2024-01-14 16:20:00"}]),D=G({current:1,pageSize:10,total:4,showTotal:!0,showPageSize:!0}),o=G({name:"",code:"",category:"",businessDomain:"",owner:"",version:"",versionDescription:"",versionStatus:"draft",businessDefinition:"",useCase:"",statisticalPeriod:"",sourceTable:"",processingLogic:"",fieldDescription:"",reports:[{name:"",url:""}],storageLocation:"",queryCode:""}),ae={name:[{required:!0,message:"请输入指标名称"}],code:[{required:!0,message:"请输入指标编码"}],category:[{required:!0,message:"请选择指标分类"}],businessDomain:[{required:!0,message:"请选择业务域"}],owner:[{required:!0,message:"请输入负责人"}],version:[{required:!0,message:"请输入版本号"}],businessDefinition:[{required:!0,message:"请输入业务定义"}],statisticalPeriod:[{required:!0,message:"请选择统计周期"}],sourceTable:[{required:!0,message:"请输入来源表"}]},E=()=>{M.value=!0,setTimeout(()=>{M.value=!1},500)},le=l=>{D.current=l},oe=l=>{D.pageSize=l,D.current=1},se=l=>({active:"green",inactive:"orange",draft:"gray"})[l]||"gray",ie=l=>({active:"启用",inactive:"停用",draft:"草稿"})[l]||"未知",ne=l=>({用户指标:"blue",业务域:"green",技术指标:"orange",财务指标:"purple",风险指标:"red"})[l]||"gray",re=l=>l,de=()=>{o.reports.push({name:"",url:""})},ue=l=>{o.reports.length>1&&o.reports.splice(l,1)},ce=l=>{p.value={...l,isViewMode:!0},Object.assign(o,l),_.value=!0},me=l=>{p.value=l,Object.assign(o,l),_.value=!0},pe=l=>{X.value=l,I.value=[{id:1,version:"v2.1.0",versionStatus:"active",versionDescription:"新增渠道维度分析",createTime:"2024-01-15 14:30:00",creator:"李四"},{id:2,version:"v2.0.0",versionStatus:"history",versionDescription:"重构计算逻辑，提升性能",createTime:"2024-01-10 09:15:00",creator:"李四"},{id:3,version:"v1.0.0",versionStatus:"history",versionDescription:"初始版本",createTime:"2024-01-01 10:00:00",creator:"张三"}],U.value=!0},ve=l=>{console.log("查看版本详情:",l),C.info("查看版本详情功能开发中")},_e=l=>{console.log("激活版本:",l),I.value.forEach(a=>{a.versionStatus=a.id===l.id?"active":"history"}),C.success(`版本 ${l.version} 已激活`)},fe=l=>{const a={...l};a.name=`${l.name}_副本`,a.code=`${l.code}_COPY`,Object.assign(o,a),p.value=null,_.value=!0},ge=l=>{console.log("删除指标:",l),C.success("删除成功")},Ve=async()=>{var l,a;if((l=p.value)!=null&&l.isViewMode){_.value=!1,L();return}try{await((a=k.value)==null?void 0:a.validate())&&(p.value?(o.versionStatus="active",C.success(`指标编辑成功，版本 ${o.version} 已激活`)):(o.versionStatus="active",C.success(`指标创建成功，版本 ${o.version} 已激活`)),console.log("提交表单:",o),_.value=!1,L())}catch(u){console.error("表单验证失败:",u)}},L=()=>{var l;p.value=null,Object.assign(o,{name:"",code:"",category:"",businessDomain:"",owner:"",version:"",versionDescription:"",versionStatus:"draft",businessDefinition:"",useCase:"",statisticalPeriod:"",sourceTable:"",processingLogic:"",fieldDescription:"",reports:[{name:"",url:""}],storageLocation:"",queryCode:""}),(l=k.value)==null||l.resetFields()};return Ce(()=>{}),(l,a)=>{var B,A,W,j;const u=c("a-button"),be=c("a-input-search"),m=c("a-col"),r=c("a-option"),w=c("a-select"),V=c("a-row"),R=c("a-tag"),z=c("a-space"),F=c("a-table"),y=c("a-divider"),f=c("a-input"),d=c("a-form-item"),b=c("a-textarea"),we=c("a-form"),H=c("a-modal");return h(),P("div",Ie,[T("div",Ee,[Le,e(u,{type:"primary",onClick:a[0]||(a[0]=n=>_.value=!0)},{icon:t(()=>[e(K(Q))]),default:t(()=>[s(" 新建指标 ")]),_:1})]),T("div",Re,[e(V,{gutter:16},{default:t(()=>[e(m,{span:8},{default:t(()=>[e(be,{modelValue:O.value,"onUpdate:modelValue":a[1]||(a[1]=n=>O.value=n),placeholder:"搜索指标名称、描述",onSearch:E},null,8,["modelValue"])]),_:1}),e(m,{span:4},{default:t(()=>[e(w,{modelValue:$.value,"onUpdate:modelValue":a[2]||(a[2]=n=>$.value=n),placeholder:"指标分类","allow-clear":"",onChange:E},{default:t(()=>[e(r,{value:"business"},{default:t(()=>[s("业务指标")]),_:1}),e(r,{value:"technical"},{default:t(()=>[s("技术指标")]),_:1}),e(r,{value:"financial"},{default:t(()=>[s("财务指标")]),_:1}),e(r,{value:"risk"},{default:t(()=>[s("风险指标")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(m,{span:4},{default:t(()=>[e(w,{modelValue:q.value,"onUpdate:modelValue":a[3]||(a[3]=n=>q.value=n),placeholder:"状态","allow-clear":"",onChange:E},{default:t(()=>[e(r,{value:"active"},{default:t(()=>[s("启用")]),_:1}),e(r,{value:"inactive"},{default:t(()=>[s("停用")]),_:1}),e(r,{value:"draft"},{default:t(()=>[s("草稿")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),e(F,{columns:Z,data:te.value,loading:M.value,pagination:D,onPageChange:le,onPageSizeChange:oe},{status:t(({record:n})=>[e(R,{color:se(n.status)},{default:t(()=>[s(N(ie(n.status)),1)]),_:2},1032,["color"])]),category:t(({record:n})=>[e(R,{color:ne(n.category)},{default:t(()=>[s(N(re(n.category)),1)]),_:2},1032,["color"])]),actions:t(({record:n})=>[e(z,null,{default:t(()=>[e(u,{type:"text",size:"small",onClick:g=>me(n)},{default:t(()=>[s(" 编辑 ")]),_:2},1032,["onClick"]),e(u,{type:"text",size:"small",onClick:g=>pe(n)},{default:t(()=>[s(" 版本历史 ")]),_:2},1032,["onClick"]),e(u,{type:"text",size:"small",onClick:g=>fe(n)},{default:t(()=>[s(" 复制 ")]),_:2},1032,["onClick"]),e(u,{type:"text",size:"small",status:"danger",onClick:g=>ge(n)},{default:t(()=>[s(" 删除 ")]),_:2},1032,["onClick"])]),_:2},1024)]),_:1},8,["data","loading","pagination"]),e(H,{visible:_.value,"onUpdate:visible":a[19]||(a[19]=n=>_.value=n),title:(B=p.value)!=null&&B.isViewMode?"指标详情":p.value?"编辑指标":"新建指标",width:"1000px",onOk:Ve,onCancel:L,"ok-text":(A=p.value)!=null&&A.isViewMode?"关闭":"确定","cancel-text":(W=p.value)!=null&&W.isViewMode?"":"取消","hide-cancel":(j=p.value)==null?void 0:j.isViewMode},{default:t(()=>{var n,g;return[e(we,{ref_key:"formRef",ref:k,model:o,rules:(n=p.value)!=null&&n.isViewMode?{}:ae,layout:"vertical",disabled:(g=p.value)==null?void 0:g.isViewMode},{default:t(()=>[e(y,{orientation:"left"},{default:t(()=>[s("基本信息")]),_:1}),e(V,{gutter:16},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(d,{label:"指标名称",field:"name"},{default:t(()=>[e(f,{modelValue:o.name,"onUpdate:modelValue":a[4]||(a[4]=i=>o.name=i),placeholder:"请输入指标名称"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(d,{label:"指标编码",field:"code"},{default:t(()=>[e(f,{modelValue:o.code,"onUpdate:modelValue":a[5]||(a[5]=i=>o.code=i),placeholder:"请输入指标编码"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:16},{default:t(()=>[e(m,{span:8},{default:t(()=>[e(d,{label:"指标分类",field:"category"},{default:t(()=>[e(w,{modelValue:o.category,"onUpdate:modelValue":a[6]||(a[6]=i=>o.category=i),placeholder:"请选择指标分类"},{default:t(()=>[e(r,{value:"用户指标"},{default:t(()=>[s("用户指标")]),_:1}),e(r,{value:"业务域"},{default:t(()=>[s("业务域")]),_:1}),e(r,{value:"技术指标"},{default:t(()=>[s("技术指标")]),_:1}),e(r,{value:"财务指标"},{default:t(()=>[s("财务指标")]),_:1}),e(r,{value:"风险指标"},{default:t(()=>[s("风险指标")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:8},{default:t(()=>[e(d,{label:"业务域",field:"businessDomain"},{default:t(()=>[e(w,{modelValue:o.businessDomain,"onUpdate:modelValue":a[7]||(a[7]=i=>o.businessDomain=i),placeholder:"请选择业务域"},{default:t(()=>[e(r,{value:"留存域"},{default:t(()=>[s("留存域")]),_:1}),e(r,{value:"转化域"},{default:t(()=>[s("转化域")]),_:1}),e(r,{value:"业务规模"},{default:t(()=>[s("业务规模")]),_:1}),e(r,{value:"风控域"},{default:t(()=>[s("风控域")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(m,{span:8},{default:t(()=>[e(d,{label:"统计周期",field:"statisticalPeriod"},{default:t(()=>[e(w,{modelValue:o.statisticalPeriod,"onUpdate:modelValue":a[8]||(a[8]=i=>o.statisticalPeriod=i),placeholder:"请选择统计周期"},{default:t(()=>[e(r,{value:"实时"},{default:t(()=>[s("实时")]),_:1}),e(r,{value:"日更新"},{default:t(()=>[s("日更新")]),_:1}),e(r,{value:"离线T+1"},{default:t(()=>[s("离线T+1")]),_:1}),e(r,{value:"离线T+2"},{default:t(()=>[s("离线T+2")]),_:1}),e(r,{value:"每周"},{default:t(()=>[s("每周")]),_:1}),e(r,{value:"每月"},{default:t(()=>[s("每月")]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:16},{default:t(()=>[e(m,{span:12},{default:t(()=>[e(d,{label:"负责人",field:"owner"},{default:t(()=>[e(f,{modelValue:o.owner,"onUpdate:modelValue":a[9]||(a[9]=i=>o.owner=i),placeholder:"请输入负责人"},null,8,["modelValue"])]),_:1})]),_:1}),e(m,{span:12},{default:t(()=>[e(d,{label:"版本号",field:"version"},{default:t(()=>[e(f,{modelValue:o.version,"onUpdate:modelValue":a[10]||(a[10]=i=>o.version=i),placeholder:"请输入版本号（如：v1.0.0）"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(V,{gutter:16},{default:t(()=>[e(m,{span:24},{default:t(()=>[e(d,{label:"版本说明"},{default:t(()=>[e(b,{modelValue:o.versionDescription,"onUpdate:modelValue":a[11]||(a[11]=i=>o.versionDescription=i),placeholder:"请输入本次版本的更新说明",rows:2},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(y,{orientation:"left"},{default:t(()=>[s("业务定义")]),_:1}),e(d,{label:"业务定义",field:"businessDefinition"},{default:t(()=>[e(b,{modelValue:o.businessDefinition,"onUpdate:modelValue":a[12]||(a[12]=i=>o.businessDefinition=i),placeholder:"请输入业务定义",rows:3},null,8,["modelValue"])]),_:1}),e(d,{label:"使用场景"},{default:t(()=>[e(b,{modelValue:o.useCase,"onUpdate:modelValue":a[13]||(a[13]=i=>o.useCase=i),placeholder:"请输入使用场景",rows:3},null,8,["modelValue"])]),_:1}),e(y,{orientation:"left"},{default:t(()=>[s("技术逻辑")]),_:1}),e(d,{label:"来源表",field:"sourceTable"},{default:t(()=>[e(f,{modelValue:o.sourceTable,"onUpdate:modelValue":a[14]||(a[14]=i=>o.sourceTable=i),placeholder:"请输入来源表"},null,8,["modelValue"])]),_:1}),e(d,{label:"加工逻辑"},{default:t(()=>[e(b,{modelValue:o.processingLogic,"onUpdate:modelValue":a[15]||(a[15]=i=>o.processingLogic=i),placeholder:"请输入加工逻辑SQL",rows:5},null,8,["modelValue"])]),_:1}),e(d,{label:"字段说明"},{default:t(()=>[e(b,{modelValue:o.fieldDescription,"onUpdate:modelValue":a[16]||(a[16]=i=>o.fieldDescription=i),placeholder:"请输入字段说明",rows:3},null,8,["modelValue"])]),_:1}),e(y,{orientation:"left"},{default:t(()=>[s("报表位置")]),_:1}),e(d,{label:"报表列表"},{default:t(()=>[T("div",Pe,[(h(!0),P(Se,null,he(o.reports,(i,Y)=>(h(),P("div",{key:Y,class:"report-item"},[e(V,{gutter:8},{default:t(()=>[e(m,{span:10},{default:t(()=>[e(f,{modelValue:i.name,"onUpdate:modelValue":S=>i.name=S,placeholder:"请输入报表名称"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{span:12},{default:t(()=>[e(f,{modelValue:i.url,"onUpdate:modelValue":S=>i.url=S,placeholder:"请输入报表URL"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(m,{span:2},{default:t(()=>[e(u,{type:"text",status:"danger",onClick:S=>ue(Y),disabled:o.reports.length<=1},{default:t(()=>[s(" 删除 ")]),_:2},1032,["onClick","disabled"])]),_:2},1024)]),_:2},1024)]))),128)),e(u,{type:"dashed",onClick:de,class:"add-report-btn"},{icon:t(()=>[e(K(Q))]),default:t(()=>[s(" 添加报表 ")]),_:1})])]),_:1}),e(y,{orientation:"left"},{default:t(()=>[s("结果表信息")]),_:1}),e(d,{label:"存储位置"},{default:t(()=>[e(f,{modelValue:o.storageLocation,"onUpdate:modelValue":a[17]||(a[17]=i=>o.storageLocation=i),placeholder:"请输入存储位置"},null,8,["modelValue"])]),_:1}),e(d,{label:"查询代码"},{default:t(()=>[e(b,{modelValue:o.queryCode,"onUpdate:modelValue":a[18]||(a[18]=i=>o.queryCode=i),placeholder:"请输入查询代码",rows:5},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules","disabled"])]}),_:1},8,["visible","title","ok-text","cancel-text","hide-cancel"]),e(H,{visible:U.value,"onUpdate:visible":a[20]||(a[20]=n=>U.value=n),title:"版本历史",width:"800px",footer:!1},{default:t(()=>[e(F,{columns:ee,data:I.value,pagination:!1},{versionStatus:t(({record:n})=>[e(R,{color:n.versionStatus==="active"?"green":"gray"},{default:t(()=>[s(N(n.versionStatus==="active"?"当前版本":"历史版本"),1)]),_:2},1032,["color"])]),actions:t(({record:n})=>[e(z,null,{default:t(()=>[e(u,{type:"text",size:"small",onClick:g=>ve(n)},{default:t(()=>[s(" 查看详情 ")]),_:2},1032,["onClick"]),n.versionStatus!=="active"?(h(),Te(u,{key:0,type:"text",size:"small",onClick:g=>_e(n)},{default:t(()=>[s(" 激活版本 ")]),_:2},1032,["onClick"])):Me("",!0)]),_:2},1024)]),_:1},8,["data"])]),_:1},8,["visible"])])}}}),$e=Ue(Ne,[["__scopeId","data-v-bb2bc796"]]);export{$e as default};
