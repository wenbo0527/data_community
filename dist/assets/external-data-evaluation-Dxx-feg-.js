import{f as A}from"./calculations-CX3sW4IW.js";import{i as I}from"./index-CeY0obGP.js";import{a as J}from"./external-data-DD7PQhfO.js";import{B as Y,r as u,K as se,b as re,ad as H,d as W,w as n,e as c,o as N,h as i,f as a,t as p,j as R,s as ue,v as ce,_ as Z,c as O,F as Q,m as X}from"./index-CsgcdrY7.js";import"./mock-Oqb5mk1v.js";const E=y=>(ue("data-v-19cb7252"),y=y(),ce(),y),de={class:"product-modal"},pe={class:"modal-section"},me=E(()=>i("h4",null,"定价变化趋势",-1)),ve={class:"modal-section"},_e=E(()=>i("h4",null,"实际消耗趋势",-1)),he={class:"modal-section"},fe=E(()=>i("h4",null,"性价比趋势 (KS/单价)",-1)),ge={class:"modal-section"},ye=E(()=>i("h4",null,"IV指标趋势",-1)),be={class:"modal-section"},xe=E(()=>i("h4",null,"KS指标趋势",-1)),Ce={class:"modal-section"},Ve=E(()=>i("h4",null,"PSI指标趋势",-1)),ke={class:"modal-actions"},Se=Y({__name:"ExternalProductModal",props:{visible:Boolean,productData:{type:Object,default:()=>({})},selectedProducts:{type:Array,default:()=>[]}},emits:["update:visible","update:productData"],setup(y,{emit:U}){const d=y,C=u(!1),D=u(!1),r=u({dataSourceType:"",dataSourceCategory:"",supplier:"",price:0,description:"",tableName:""}),h=u(),f=u(),g=u(),b=u(),V=u(),k=u();let _=null,m=null,$=null,S=null,L=null,w=null;const j=e=>{if(console.log("更新价格图表，数据长度:",e==null?void 0:e.length),h.value&&_&&(e!=null&&e.length)){const o={tooltip:{trigger:"axis",formatter:t=>t.map(s=>`${s.seriesName}: ${s.value}元/条`).join("<br/>")},legend:{data:["单次调用价格"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(t=>t.month),axisLabel:{rotate:45}},yAxis:{type:"value",name:"单次调用价格（元/条）"},series:[{name:"单次调用价格",type:"line",data:e.map(t=>t.pricePerCall),itemStyle:{color:"#165DFF"},smooth:!0,symbol:"circle"}]};_.setOption(o),_.resize()}},x=e=>{if(console.log("更新成本图表，数据长度:",e==null?void 0:e.length),f.value&&m&&(e!=null&&e.length)){const o={tooltip:{trigger:"axis",formatter:t=>t.map(s=>`${s.seriesName}: ${s.value}元`).join("<br/>")},legend:{data:["预算","实际消耗"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(t=>t.month),axisLabel:{rotate:45}},yAxis:{type:"value",name:"金额（元）"},series:[{name:"预算",type:"line",data:e.map(t=>t.budget),itemStyle:{color:"#14C9C9"},smooth:!0,symbol:"circle"},{name:"实际消耗",type:"line",data:e.map(t=>t.actualCost),itemStyle:{color:"#722ED1"},smooth:!0,symbol:"circle"}]};m.setOption(o),m.resize()}},K=e=>{if(g.value&&$&&(e!=null&&e.length)){const o={tooltip:{trigger:"axis",formatter:t=>t.map(s=>`${s.seriesName}: ${s.value}`).join("<br/>")},legend:{data:["性价比"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(t=>t.month),axisLabel:{rotate:45}},yAxis:{type:"value",name:"KS/单价"},series:[{name:"性价比",type:"line",data:e.map(t=>t.valuePerPrice),itemStyle:{color:"#14C9C9"},smooth:!0,symbol:"circle"}]};$.setOption(o),$.resize()}},F=e=>{if(b.value&&S&&(e!=null&&e.length)){const o={tooltip:{trigger:"axis",formatter:t=>t.map(s=>`${s.seriesName}: ${s.value}`).join("<br/>")},legend:{data:["IV"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(t=>t.month),axisLabel:{rotate:45}},yAxis:{type:"value",name:"IV值"},series:[{name:"IV",type:"line",data:e.map(t=>t.iv),itemStyle:{color:"#722ED1"},smooth:!0,symbol:"circle"}]};S.setOption(o),S.resize()}},l=e=>{if(V.value&&L&&(e!=null&&e.length)){const o={tooltip:{trigger:"axis",formatter:t=>t.map(s=>`${s.seriesName}: ${s.value}`).join("<br/>")},legend:{data:["KS"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(t=>t.month),axisLabel:{rotate:45}},yAxis:{type:"value",name:"KS值"},series:[{name:"KS",type:"line",data:e.map(t=>t.ks),itemStyle:{color:"#F7BA1E"},smooth:!0,symbol:"circle"}]};L.setOption(o),L.resize()}},T=e=>{if(k.value&&w&&(e!=null&&e.length)){const o={tooltip:{trigger:"axis",formatter:t=>t.map(s=>`${s.seriesName}: ${s.value}`).join("<br/>")},legend:{data:["PSI"],bottom:0},grid:{left:"3%",right:"4%",bottom:"10%",top:"3%",containLabel:!0},xAxis:{type:"category",data:e.map(t=>t.month),axisLabel:{rotate:45}},yAxis:{type:"value",name:"PSI值"},series:[{name:"PSI",type:"line",data:e.map(t=>t.psi),itemStyle:{color:"#D91AD9"},smooth:!0,symbol:"circle"}]};w.setOption(o),w.resize()}},z=()=>{console.log("初始化图表...");const e=()=>{h.value&&h.value.clientWidth>0&&h.value.clientHeight>0&&(console.log("价格图表容器尺寸:",h.value.clientWidth,"x",h.value.clientHeight),_=I(h.value),console.log("价格图表初始化成功")),f.value&&f.value.clientWidth>0&&f.value.clientHeight>0&&(console.log("成本图表容器尺寸:",f.value.clientWidth,"x",f.value.clientHeight),m=I(f.value),console.log("成本图表初始化成功")),g.value&&g.value.clientWidth>0&&g.value.clientHeight>0&&($=I(g.value),console.log("性价比图表初始化成功")),b.value&&b.value.clientWidth>0&&b.value.clientHeight>0&&(S=I(b.value),console.log("IV图表初始化成功")),V.value&&V.value.clientWidth>0&&V.value.clientHeight>0&&(L=I(V.value),console.log("KS图表初始化成功")),k.value&&k.value.clientWidth>0&&k.value.clientHeight>0&&(w=I(k.value),console.log("PSI图表初始化成功")),(!_||!m||!$||!S||!L||!w)&&requestAnimationFrame(e)};e()},ee=()=>{U("update:visible",!1)},te=()=>{},le=()=>{C.value?M():(r.value={dataSourceType:d.productData.dataSourceType||"",dataSourceCategory:d.productData.dataSourceCategory||"",supplier:d.productData.supplier||"",price:d.productData.price||0,description:d.productData.description||"",tableName:d.productData.tableName||""},D.value=!0),C.value=!C.value},M=()=>{const e={...d.productData,...r.value};U("update:productData",e),D.value=!1},oe=()=>{C.value=!1,D.value=!1};return se(()=>d.productData,e=>{if(e){const o=d.selectedProducts.length>1?d.selectedProducts.map(t=>J(t)).flat():J(d.productData.product||"产品A");if(console.log("生成的产品数据:",o),console.log("产品名称:",d.productData.product),console.log("selectedProducts:",d.selectedProducts),!o||o.length===0){console.error("生成的产品数据为空!");return}H(()=>{z(),H(()=>{j(o),x(o),K(o),F(o),l(o),T(o)})})}},{immediate:!0}),re(()=>{H(()=>{z()})}),(e,o)=>{const t=c("a-tab-pane"),s=c("a-tabs"),q=c("a-button"),B=c("a-input"),P=c("a-form-item"),ae=c("a-input-number"),ie=c("a-textarea"),ne=c("a-form"),G=c("a-modal");return N(),W(G,{visible:y.visible,onCancel:ee,footer:!1,width:"80%"},{default:n(()=>[i("div",de,[i("h3",null,p(y.selectedProducts.length>1?"多产品对比":y.productData.product+" 详细信息"),1),a(s,{"default-active-key":"1"},{default:n(()=>[a(t,{key:"1",title:"成本及消耗"},{default:n(()=>[i("div",pe,[me,i("div",{ref_key:"priceChartRef",ref:h,style:{width:"100%",height:"300px"}},null,512)]),i("div",ve,[_e,i("div",{ref_key:"costChartRef",ref:f,style:{width:"100%",height:"300px"}},null,512)])]),_:1}),a(t,{key:"2",title:"性能指标"},{default:n(()=>[i("div",he,[fe,i("div",{ref_key:"valueChartRef",ref:g,style:{width:"100%",height:"300px"}},null,512)]),i("div",ge,[ye,i("div",{ref_key:"ivChartRef",ref:b,style:{width:"100%",height:"300px"}},null,512)]),i("div",be,[xe,i("div",{ref_key:"ksChartRef",ref:V,style:{width:"100%",height:"300px"}},null,512)])]),_:1}),a(t,{key:"3",title:"稳定性指标"},{default:n(()=>[i("div",Ce,[Ve,i("div",{ref_key:"psiChartRef",ref:k,style:{width:"100%",height:"300px"}},null,512)])]),_:1})]),_:1}),i("div",ke,[a(q,{type:"primary",onClick:te},{default:n(()=>[R("导出数据")]),_:1}),a(q,{type:"primary",onClick:le,style:{"margin-left":"8px"}},{default:n(()=>[R(p(C.value?"保存":"编辑"),1)]),_:1})]),a(G,{visible:D.value,"onUpdate:visible":o[6]||(o[6]=v=>D.value=v),title:"编辑接口信息",onOk:M,onCancel:oe},{default:n(()=>[a(ne,{model:r.value},{default:n(()=>[a(P,{label:"数源种类"},{default:n(()=>[a(B,{modelValue:r.value.dataSourceType,"onUpdate:modelValue":o[0]||(o[0]=v=>r.value.dataSourceType=v)},null,8,["modelValue"])]),_:1}),a(P,{label:"数源分类"},{default:n(()=>[a(B,{modelValue:r.value.dataSourceCategory,"onUpdate:modelValue":o[1]||(o[1]=v=>r.value.dataSourceCategory=v)},null,8,["modelValue"])]),_:1}),a(P,{label:"供应商"},{default:n(()=>[a(B,{modelValue:r.value.supplier,"onUpdate:modelValue":o[2]||(o[2]=v=>r.value.supplier=v)},null,8,["modelValue"])]),_:1}),a(P,{label:"单价"},{default:n(()=>[a(ae,{modelValue:r.value.price,"onUpdate:modelValue":o[3]||(o[3]=v=>r.value.price=v)},null,8,["modelValue"])]),_:1}),a(P,{label:"产品描述"},{default:n(()=>[a(ie,{modelValue:r.value.description,"onUpdate:modelValue":o[4]||(o[4]=v=>r.value.description=v)},null,8,["modelValue"])]),_:1}),a(P,{label:"落库表名"},{default:n(()=>[a(B,{modelValue:r.value.tableName,"onUpdate:modelValue":o[5]||(o[5]=v=>r.value.tableName=v)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])]),_:1},8,["visible"])}}}),Le=Z(Se,[["__scopeId","data-v-19cb7252"]]),De={class:"external-data-evaluation"},$e={class:"filter-section"},we={style:{"margin-right":"8px"}},Pe={style:{color:"var(--color-text-3)"}},Ae={style:{"margin-right":"8px"}},Ie={style:{color:"var(--color-text-3)"}},Ne={style:{"margin-right":"8px"}},Re={style:{color:"var(--color-text-3)"}},Ee={style:{"margin-right":"8px"}},Ue={style:{color:"var(--color-text-3)"}},Ke=Y({__name:"external-data-evaluation",setup(y){const U=u([]),d=u(),C=u(),D=u(["产品A","产品B","产品C","产品D"]),r=u(["平台1","平台2","平台3"]),h=u([{product:"产品A",price:A(1e3),cost:A(5e4),iv:.5,ks:.45,psi:.12,value:.45,valueLevel:"高",performance:"优秀",performanceLevel:"高",priceLevel:"中",usageLevel:"高",stability:"稳定"},{product:"产品B",price:A(1500),cost:A(75e3),iv:.4,ks:.35,psi:.15,value:.23,valueLevel:"中",performance:"良好",performanceLevel:"中",priceLevel:"高",usageLevel:"中",stability:"较稳定"},{product:"产品C",price:A(800),cost:A(4e4),iv:.3,ks:.25,psi:.18,value:.31,valueLevel:"中",performance:"一般",performanceLevel:"低",priceLevel:"低",usageLevel:"高",stability:"一般"}]),f=_=>_>=.4?"高":_>=.3?"中":"低",g=u(!1),b=u({}),V=_=>{b.value=_,g.value=!0},k=()=>{};return(_,m)=>{const $=c("a-button"),S=c("a-option"),L=c("a-select"),w=c("a-month-picker"),j=c("a-link"),x=c("a-table-column"),K=c("a-tooltip"),F=c("a-table");return N(),O("div",De,[i("div",$e,[a($,{type:"primary",onClick:k,style:{"margin-right":"16px"}},{default:n(()=>[R(" 导出数据 ")]),_:1}),a(L,{placeholder:"选择外数产品",style:{width:"200px"},modelValue:U.value,"onUpdate:modelValue":m[0]||(m[0]=l=>U.value=l),multiple:"","allow-clear":""},{default:n(()=>[(N(!0),O(Q,null,X(D.value,l=>(N(),W(S,{key:l,value:l},{default:n(()=>[R(p(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(L,{placeholder:"选择使用平台",style:{width:"200px",marginLeft:"16px"},modelValue:d.value,"onUpdate:modelValue":m[1]||(m[1]=l=>d.value=l),"allow-clear":""},{default:n(()=>[(N(!0),O(Q,null,X(r.value,l=>(N(),W(S,{key:l,value:l},{default:n(()=>[R(p(l),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"]),a(w,{placeholder:"选择数据月份",style:{width:"200px",marginLeft:"16px"},modelValue:C.value,"onUpdate:modelValue":m[2]||(m[2]=l=>C.value=l)},null,8,["modelValue"])]),a(F,{data:h.value,pagination:!1,bordered:{wrapper:!0,cell:!0},class:"evaluation-table"},{columns:n(()=>[a(x,{title:"外数产品","data-index":"product",width:180},{cell:n(({record:l})=>[a(j,{onClick:T=>V(l)},{default:n(()=>[R(p(l.product),1)]),_:2},1032,["onClick"])]),_:1}),a(x,{title:"单价","data-index":"price",width:120},{cell:n(({record:l})=>[a(K,{content:`单价: ${l.price}`},{default:n(()=>[i("span",null,p(l.price),1)]),_:2},1032,["content"])]),_:1}),a(x,{title:"当年实际消耗","data-index":"cost",width:120},{cell:n(({record:l})=>[a(K,{content:`当年实际消耗: ${l.cost}`},{default:n(()=>[i("span",null,p(l.cost),1)]),_:2},1032,["content"])]),_:1}),a(x,{title:"性能","data-index":"ks",width:150},{cell:n(({record:l})=>[i("div",null,[i("span",we,p(f(l.ks)),1),i("span",Pe,p(l.ks.toFixed(2)),1)])]),_:1}),a(x,{title:"价格","data-index":"priceLevel",width:150},{cell:n(({record:l})=>[i("div",null,[i("span",Ae,p(l.priceLevel),1),i("span",Ie,p(l.price),1)])]),_:1}),a(x,{title:"调用量","data-index":"usageLevel",width:150},{cell:n(({record:l})=>[i("div",null,[i("span",Ne,p(l.usageLevel),1),i("span",Re,p(l.cost),1)])]),_:1}),a(x,{title:"稳定性","data-index":"stability",width:150},{cell:n(({record:l})=>[i("div",null,[i("span",Ee,p(l.stability),1),i("span",Ue,p(l.stability==="稳定"?"99.9%":l.stability==="较稳定"?"95%":"90%"),1)])]),_:1})]),_:1},8,["data"]),a(Le,{visible:g.value,"onUpdate:visible":m[3]||(m[3]=l=>g.value=l),"product-data":b.value},null,8,["visible","product-data"])])}}}),We=Z(Ke,[["__scopeId","data-v-e76863e4"]]);export{We as default};
