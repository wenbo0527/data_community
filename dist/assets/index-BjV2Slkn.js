import{A as Ce,B as ae,c as h,o as u,h as n,C as se,n as oe,D as xe,a as U,E as be,r as p,b as Se,u as Ie,K as Fe,d as Y,F as E,g as H,f as e,w as a,m as ee,t as w,e as f,s as $e,v as ze,J as Ve,j as r,i as C,aa as Le,Q as te,y as Te,ab as Re,a7 as He,a2 as Ne,M as Be,_ as Me}from"./index-CsgcdrY7.js";import{L as Pe,I as Ue,u as je}from"./LoadingState-u3p8U4_Q.js";import{m as De}from"./data-map-BtHUnIhr.js";import{m as Ae}from"./metrics-fYl7z8N6.js";import{I as Oe}from"./index-CyZFS1Lf.js";const Je=ae({name:"IconHeart",props:{size:{type:[Number,String]},strokeWidth:{type:Number,default:4},strokeLinecap:{type:String,default:"butt",validator:s=>["butt","round","square"].includes(s)},strokeLinejoin:{type:String,default:"miter",validator:s=>["arcs","bevel","miter","miter-clip","round"].includes(s)},rotate:Number,spin:Boolean},emits:{click:s=>!0},setup(s,{emit:_}){const k=xe("icon"),F=U(()=>[k,`${k}-heart`,{[`${k}-spin`]:s.spin}]),x=U(()=>{const v={};return s.size&&(v.fontSize=be(s.size)?`${s.size}px`:s.size),s.rotate&&(v.transform=`rotate(${s.rotate}deg)`),v});return{cls:F,innerStyle:x,onClick:v=>{_("click",v)}}}}),qe=["stroke-width","stroke-linecap","stroke-linejoin"];function Qe(s,_,k,F,x,d){return u(),h("svg",{viewBox:"0 0 48 48",fill:"none",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",class:oe(s.cls),style:se(s.innerStyle),"stroke-width":s.strokeWidth,"stroke-linecap":s.strokeLinecap,"stroke-linejoin":s.strokeLinejoin,onClick:_[0]||(_[0]=(...v)=>s.onClick&&s.onClick(...v))},_[1]||(_[1]=[n("path",{d:"M38.083 12.912a9.929 9.929 0 0 1 .177 13.878l-.177.18L25.76 39.273c-.972.97-2.548.97-3.52 0L9.917 26.971l-.177-.181a9.929 9.929 0 0 1 .177-13.878c3.889-3.883 10.194-3.883 14.083 0 3.889-3.883 10.194-3.883 14.083 0Z"},null,-1)]),14,qe)}var K=Ce(Je,[["render",Qe]]);const Ee=Object.assign(K,{install:(s,_)=>{var k;const F=(k=_==null?void 0:_.iconPrefix)!=null?k:"";s.component(F+K.name,K)}}),ne=s=>($e("data-v-55310463"),s=s(),ze(),s),Ke={class:"search-page-container"},We={class:"search-section"},Ze={class:"search-header"},Ge=ne(()=>n("div",{class:"title-area"},[n("h2",{class:"page-title"},"聚合搜索"),n("p",{class:"page-description"},"搜索和管理您的数据资产")],-1)),Xe={class:"search-actions"},Ye={class:"search-input-area"},et={key:0,class:"advanced-filter"},tt={key:1,class:"search-history"},at={class:"history-header"},st=ne(()=>n("span",null,"最近搜索",-1)),ot={class:"history-list"},nt={class:"results-section"},lt={class:"results-header"},rt={class:"results-count"},ct={key:0,class:"search-term"},it={class:"result-type-tabs"},ut={class:"results-content"},dt={key:0,class:"empty-results"},vt={key:1,class:"results-grid"},pt=["onClick"],_t={class:"item-header"},mt={class:"item-type"},ht={class:"item-actions"},ft={class:"item-content"},yt={class:"item-title"},gt={class:"item-description"},kt={class:"item-meta"},wt={class:"meta-item"},Ct={class:"meta-item"},xt={key:0,class:"meta-item"},bt={key:2,class:"pagination-wrapper"},St=ae({__name:"index",setup(s){const _=Ve(),k=Ie(),F=p(!1),x=p(!1),d=p(""),v=p(!1),$=p(!1),N=p("all"),z=p(1),W=p(12),b=p([]),y=p({}),B=p([]),L=p([]),T=p([]),R=p([]),M=U(()=>{switch(N.value){case"table":return L.value;case"metric":return T.value;case"external":return R.value;default:return B.value}}),Z=U(()=>M.value.length),j=je(async()=>{await G()},300);Se(()=>{ue();const t=k.query.q;t&&(d.value=t,D(t))}),Fe(d,t=>{t?j():X()});const D=async t=>{const l=t||d.value;if(l.trim()){x.value=!0,de(l);try{await G(l)}finally{x.value=!1}}},G=async t=>{var I,P;const l=t||d.value;await new Promise(c=>setTimeout(c,500));const g=((I=De.collections)==null?void 0:I.flatMap(c=>c.tables.map(i=>({id:`table_${i.name}`,name:i.name,description:i.description,type:"table",owner:i.owner,updateTime:"2024-01-15",domain:i.domain,isFavorite:!1}))))||[],O=((P=Ae)==null?void 0:P.map(c=>({id:`metric_${c.id}`,name:c.name,description:c.description,type:"metric",owner:c.owner||"系统管理员",updateTime:c.updateTime||"2024-01-15",domain:c.category,isFavorite:!1})))||[],m=[{id:"external_1",name:"外部数据源A",description:"来自第三方的数据源",type:"external",owner:"系统管理员",updateTime:"2024-01-15",domain:"金融",isFavorite:!1},{id:"external_2",name:"外部数据源B",description:"合作伙伴提供的数据",type:"external",owner:"数据管理员",updateTime:"2024-01-10",domain:"营销",isFavorite:!1}],S=c=>c.filter(i=>{const V=!l||i.name.toLowerCase().includes(l.toLowerCase())||i.description.toLowerCase().includes(l.toLowerCase()),J=!y.value.type||i.type===y.value.type,q=!y.value.domain||i.domain===y.value.domain;return V&&J&&q});L.value=S(g),T.value=S(O),R.value=S(m),B.value=[...L.value,...T.value,...R.value]},le=()=>{d.value="",X()},X=()=>{B.value=[],L.value=[],T.value=[],R.value=[],z.value=1},A=()=>{d.value&&j()},re=()=>{y.value={},d.value&&j()},ce=()=>{v.value=!v.value,v.value&&($.value=!1)},ie=()=>{$.value=!$.value,$.value&&(v.value=!1)},ue=()=>{const t=localStorage.getItem("search-history");t&&(b.value=JSON.parse(t))},de=t=>{if(!t.trim())return;const l=[...b.value],g=l.indexOf(t);g>-1&&l.splice(g,1),l.unshift(t),b.value=l.slice(0,10),localStorage.setItem("search-history",JSON.stringify(b.value))},ve=t=>{d.value=t,$.value=!1,D(t)},pe=()=>{b.value=[],localStorage.removeItem("search-history")},_e=t=>{N.value=t,z.value=1},me=t=>{switch(t.type){case"table":_.push(`/discovery/data-map/${encodeURIComponent(JSON.stringify(t))}`);break;case"metric":_.push(`/discovery/metrics-map/${t.id}`);break;case"external":_.push(`/discovery/external/${t.id}`);break}},he=t=>{t.isFavorite=!t.isFavorite,Be.success(t.isFavorite?"已添加到收藏":"已取消收藏")},fe=t=>{z.value=t},ye=t=>{W.value=t,z.value=1},ge=t=>{switch(t){case"table":return"blue";case"metric":return"green";case"external":return"orange";default:return"gray"}},ke=t=>{switch(t){case"table":return"数据表";case"metric":return"指标";case"external":return"外部数据";default:return"未知"}};return(t,l)=>{const g=f("a-button"),O=f("a-input-search"),m=f("a-option"),S=f("a-select"),I=f("a-col"),P=f("a-row"),c=f("a-tag"),i=f("a-badge"),V=f("a-tab-pane"),J=f("a-tabs"),q=f("a-empty"),we=f("a-pagination");return u(),h("div",Ke,[F.value?(u(),Y(Pe,{key:0,type:"skeleton","show-search":!0,"show-tabs":!0,"show-grid":!0,"loading-text":"正在搜索数据资产..."})):(u(),h(E,{key:1},[n("div",We,[n("div",Ze,[Ge,n("div",Xe,[e(g,{type:"text",onClick:ce,class:oe({active:v.value})},{default:a(()=>[e(C(Le)),r("高级搜索 ")]),_:1},8,["class"]),e(g,{type:"text",onClick:ie},{default:a(()=>[e(C(Ue)),r("搜索历史 ")]),_:1})])]),n("div",Ye,[e(O,{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=o=>d.value=o),placeholder:"请输入表名、描述或业务域进行搜索","search-button":"","allow-clear":"",loading:x.value,onSearch:D,onClear:le,size:"large"},{prefix:a(()=>[e(C(te),{style:{color:"var(--color-text-3)"}})]),_:1},8,["modelValue","loading"])]),v.value?(u(),h("div",et,[e(P,{gutter:16},{default:a(()=>[e(I,{span:6},{default:a(()=>[e(S,{modelValue:y.value.type,"onUpdate:modelValue":l[1]||(l[1]=o=>y.value.type=o),placeholder:"数据类型","allow-clear":"",onChange:A},{default:a(()=>[e(m,{value:"table"},{default:a(()=>[r("数据表")]),_:1}),e(m,{value:"metric"},{default:a(()=>[r("指标")]),_:1}),e(m,{value:"external"},{default:a(()=>[r("外部数据")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(I,{span:6},{default:a(()=>[e(S,{modelValue:y.value.domain,"onUpdate:modelValue":l[2]||(l[2]=o=>y.value.domain=o),placeholder:"业务域","allow-clear":"",onChange:A},{default:a(()=>[e(m,{value:"用户域"},{default:a(()=>[r("用户域")]),_:1}),e(m,{value:"交易域"},{default:a(()=>[r("交易域")]),_:1}),e(m,{value:"产品域"},{default:a(()=>[r("产品域")]),_:1}),e(m,{value:"风控域"},{default:a(()=>[r("风控域")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(I,{span:6},{default:a(()=>[e(S,{modelValue:y.value.updateFrequency,"onUpdate:modelValue":l[3]||(l[3]=o=>y.value.updateFrequency=o),placeholder:"更新频率","allow-clear":"",onChange:A},{default:a(()=>[e(m,{value:"实时"},{default:a(()=>[r("实时")]),_:1}),e(m,{value:"日更新"},{default:a(()=>[r("日更新")]),_:1}),e(m,{value:"周更新"},{default:a(()=>[r("周更新")]),_:1}),e(m,{value:"月更新"},{default:a(()=>[r("月更新")]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(I,{span:6},{default:a(()=>[e(g,{type:"outline",onClick:re},{default:a(()=>[r(" 重置筛选 ")]),_:1})]),_:1})]),_:1})])):H("",!0),$.value&&b.value.length>0?(u(),h("div",tt,[n("div",at,[st,e(g,{type:"text",size:"mini",onClick:pe},{default:a(()=>[e(C(Te)),r("清空 ")]),_:1})]),n("div",ot,[(u(!0),h(E,null,ee(b.value.slice(0,5),(o,Q)=>(u(),Y(c,{key:Q,class:"history-tag",onClick:It=>ve(o)},{default:a(()=>[r(w(o),1)]),_:2},1032,["onClick"]))),128))])])):H("",!0)]),n("div",nt,[n("div",lt,[n("div",rt,[n("span",null,"找到 "+w(Z.value)+" 个结果",1),d.value?(u(),h("span",ct,'"'+w(d.value)+'"',1)):H("",!0)]),n("div",it,[e(J,{"active-key":N.value,"onUpdate:activeKey":l[4]||(l[4]=o=>N.value=o),onChange:_e},{default:a(()=>[e(V,{key:"all",title:"全部"},{title:a(()=>[r(" 全部 "),e(i,{count:B.value.length,"max-count":99},null,8,["count"])]),_:1}),e(V,{key:"table",title:"数据表"},{title:a(()=>[r(" 数据表 "),e(i,{count:L.value.length,"max-count":99},null,8,["count"])]),_:1}),e(V,{key:"metric",title:"指标"},{title:a(()=>[r(" 指标 "),e(i,{count:T.value.length,"max-count":99},null,8,["count"])]),_:1}),e(V,{key:"external",title:"外部数据"},{title:a(()=>[r(" 外部数据 "),e(i,{count:R.value.length,"max-count":99},null,8,["count"])]),_:1})]),_:1},8,["active-key"])])]),n("div",ut,[M.value.length===0&&!x.value?(u(),h("div",dt,[e(q,{description:"暂无搜索结果"},{image:a(()=>[e(C(te),{style:{"font-size":"64px",color:"var(--color-text-4)"}})]),_:1})])):(u(),h("div",vt,[(u(!0),h(E,null,ee(M.value,o=>(u(),h("div",{key:o.id,class:"result-item",onClick:Q=>me(o)},[n("div",_t,[n("div",mt,[e(c,{color:ge(o.type)},{default:a(()=>[r(w(ke(o.type)),1)]),_:2},1032,["color"])]),n("div",ht,[e(g,{type:"text",size:"mini",onClick:Ne(Q=>he(o),["stop"])},{default:a(()=>[e(C(Ee),{style:se({color:o.isFavorite?"#f53f3f":"#86909c"})},null,8,["style"])]),_:2},1032,["onClick"])])]),n("div",ft,[n("h3",yt,w(o.name),1),n("p",gt,w(o.description),1),n("div",kt,[n("span",wt,[e(C(Oe)),r(w(o.owner),1)]),n("span",Ct,[e(C(Re)),r(w(o.updateTime),1)]),o.domain?(u(),h("span",xt,[e(C(He)),r(w(o.domain),1)])):H("",!0)])])],8,pt))),128))])),M.value.length>0?(u(),h("div",bt,[e(we,{current:z.value,"onUpdate:current":l[5]||(l[5]=o=>z.value=o),total:Z.value,"page-size":W.value,"show-total":"","show-jumper":"","show-page-size":"",onChange:fe,onPageSizeChange:ye},null,8,["current","total","page-size"])])):H("",!0)])])],64))])}}}),Tt=Me(St,[["__scopeId","data-v-55310463"]]);export{Tt as default};
